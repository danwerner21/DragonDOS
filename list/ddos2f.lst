                      (       ddos2f.asm):00001         ;
                      (       ddos2f.asm):00002         ; DragonDos 1.0, Copyright (C) 1982, Dragon Data Ltd.
                      (       ddos2f.asm):00003         ;
                      (       ddos2f.asm):00004         ; Disassembled 2020-03-09, P.Harvey-Smith.
                      (       ddos2f.asm):00005         ;
                      (       ddos2f.asm):00006                         use     cpudefs.asm
                      (      cpudefs.asm):00001         ;
                      (      cpudefs.asm):00002         ; CPUDEFS
                      (      cpudefs.asm):00003         ;
                      (      cpudefs.asm):00004         
                      (      cpudefs.asm):00005         ; bitmasks for flags
     0001             (      cpudefs.asm):00006         FlagCarry               equ             $01
     0002             (      cpudefs.asm):00007         FlagOverflow    equ             $02
     0004             (      cpudefs.asm):00008         FlagZero                equ             $04
     0008             (      cpudefs.asm):00009         FlagNegative    equ             $08
     0010             (      cpudefs.asm):00010         FlagIRQ                 equ             $10
     0020             (      cpudefs.asm):00011         FlagHlafCarry   equ             $20
     0040             (      cpudefs.asm):00012         FlagFIRQ                equ             $40
     0080             (      cpudefs.asm):00013         FlagEntire              equ             $80
                      (       ddos2f.asm):00007                         use     dgndefs.asm
                      (      dgndefs.asm):00001         *
                      (      dgndefs.asm):00002         * Deinitions for ports on Dragon 32/64/Alpha.
                      (      dgndefs.asm):00003         *
                      (      dgndefs.asm):00004         * 2004-11-16. P.Harvey-Smith.
                      (      dgndefs.asm):00005         *       Fixed the stupid error I made in the defines below
                      (      dgndefs.asm):00006         *       that made all the non DPxxxxx defines equal to FF00 !!!
                      (      dgndefs.asm):00007         *
                      (      dgndefs.asm):00008         * 2004-10-10. P.Harvey-Smith.
                      (      dgndefs.asm):00009         *       Tidyed up a little, moved romdefs into their own file.
                      (      dgndefs.asm):00010         *
                      (      dgndefs.asm):00011         
     FF00             (      dgndefs.asm):00012         IO              equ             $ff00           ; IO page on Dragon
                      (      dgndefs.asm):00013         
                      (      dgndefs.asm):00014         *
                      (      dgndefs.asm):00015         * Most of these symbols will be defined twice, as some 
                      (      dgndefs.asm):00016         * of the Dragon code, sets DP=$FF, and uses direct page
                      (      dgndefs.asm):00017         * addressing to access the io ports, whilst some of it
                      (      dgndefs.asm):00018         * uses absolute addressing.
                      (      dgndefs.asm):00019         * The versions starting DP must be used with DP=$FF.
                      (      dgndefs.asm):00020         *
                      (      dgndefs.asm):00021         
                      (      dgndefs.asm):00022         *Pia 0 and 1 standard on all Dragons.
                      (      dgndefs.asm):00023         
     0000             (      dgndefs.asm):00024         DPPIA0DA        EQU             $00             ; Side A Data/DDR
     0001             (      dgndefs.asm):00025         DPPIA0CRA       EQU             $01             ; Side A Control.
     0002             (      dgndefs.asm):00026         DPPIA0DB        EQU             $02             ; Side B Data/DDR
     0003             (      dgndefs.asm):00027         DPPIA0CRB       EQU             $03             ; Side B Control.
                      (      dgndefs.asm):00028         
     FF00             (      dgndefs.asm):00029         PIA0DA          EQU             DPPIA0DA+IO     ; Side A Data/DDR
     FF01             (      dgndefs.asm):00030         PIA0CRA         EQU             DPPIA0CRA+IO    ; Side A Control.
     FF02             (      dgndefs.asm):00031         PIA0DB          EQU             DPPIA0DB+IO     ; Side A Data/DDR
     FF03             (      dgndefs.asm):00032         PIA0CRB         EQU             DPPIA0CRB+IO    ; Side A Control.
                      (      dgndefs.asm):00033         
     0020             (      dgndefs.asm):00034         DPPIA1DA        EQU             $20             ; Side A Data/DDR
     0021             (      dgndefs.asm):00035         DPPIA1CRA       EQU             $21             ; Side A Control.
     0022             (      dgndefs.asm):00036         DPPIA1DB        EQU             $22             ; Side B Data/DDR
     0023             (      dgndefs.asm):00037         DPPIA1CRB       EQU             $23             ; Side B Control.
                      (      dgndefs.asm):00038         
     FF20             (      dgndefs.asm):00039         PIA1DA          EQU             DPPIA1DA+IO     ; Side A Data/DDR
     FF21             (      dgndefs.asm):00040         PIA1CRA         EQU             DPPIA1CRA+IO    ; Side A Control.
     FF22             (      dgndefs.asm):00041         PIA1DB          EQU             DPPIA1DB+IO     ; Side A Data/DDR
     FF23             (      dgndefs.asm):00042         PIA1CRB         EQU             DPPIA1CRB+IO    ; Side A Control.
                      (      dgndefs.asm):00043         
                      (      dgndefs.asm):00044         * Dragon Alpha has a third PIA at FF24.
                      (      dgndefs.asm):00045         
     0024             (      dgndefs.asm):00046         DPPIA2DA        EQU             $24             ; Side A Data/DDR
     0025             (      dgndefs.asm):00047         DPPIA2CRA       EQU             $25             ; Side A Control.
     0026             (      dgndefs.asm):00048         DPPIA2DB        EQU             $26             ; Side B Data/DDR
     0027             (      dgndefs.asm):00049         DPPIA2CRB       EQU             $27             ; Side B Control.
                      (      dgndefs.asm):00050         
     FF24             (      dgndefs.asm):00051         PIA2DA          EQU             DPPIA2DA+IO     ; Side A Data/DDR
     FF25             (      dgndefs.asm):00052         PIA2CRA         EQU             DPPIA2CRA+IO    ; Side A Control.
     FF26             (      dgndefs.asm):00053         PIA2DB          EQU             DPPIA2DB+IO     ; Side A Data/DDR
     FF27             (      dgndefs.asm):00054         PIA2CRB         EQU             DPPIA2CRB+IO    ; Side A Control.
                      (      dgndefs.asm):00055         
                      (      dgndefs.asm):00056         ;WD2797 Floppy disk controler, used in Alpha Note registers in reverse order !
     002F             (      dgndefs.asm):00057         DPCmdRegA       EQU             $2F             ; command/status                        
     002E             (      dgndefs.asm):00058         DPTrkRegA       EQU             $2E             ; Track register
     002D             (      dgndefs.asm):00059         DPSecRegA       EQU             $2D             ; Sector register
     002C             (      dgndefs.asm):00060         DPDataRegA      EQU             $2C             ; Data register
                      (      dgndefs.asm):00061         
     FF2F             (      dgndefs.asm):00062         CmdRegA         EQU             DPCmdRegA+IO    ; command/status                        
     FF2E             (      dgndefs.asm):00063         TrkRegA         EQU             DPTrkRegA+IO    ; Track register
     FF2D             (      dgndefs.asm):00064         SecRegA         EQU             DPSecRegA+IO    ; Sector register
     FF2C             (      dgndefs.asm):00065         DataRegA        EQU             DPDataRegA+IO   ; Data register
                      (      dgndefs.asm):00066         
                      (      dgndefs.asm):00067         ; Constants for Alpha AY-8912 sound chip, which is used to control
                      (      dgndefs.asm):00068         ; Drive select and motor on the Alpha
                      (      dgndefs.asm):00069         
     000E             (      dgndefs.asm):00070         AYIOREG         EQU             $0E             ; AY-8912, IO Register number.
     0000             (      dgndefs.asm):00071         AYIdle          EQU             $00             ; Make AY Idle.
     0001             (      dgndefs.asm):00072         AYWriteReg      EQU             $01             ; Write AY Register
     0002             (      dgndefs.asm):00073         AYReadReg       EQU             $02             ; Read AY Register
     0003             (      dgndefs.asm):00074         AYREGLatch      EQU             $03             ; Latch register into AY
                      (      dgndefs.asm):00075         
     0003             (      dgndefs.asm):00076         DSMask          EQU             $03             ; Drive select mask.
     0004             (      dgndefs.asm):00077         MotorMask       EQU             $04             ; Motor enable mask
     0008             (      dgndefs.asm):00078         DDENMask        EQU             $08             ; DDEN Mask
     0010             (      dgndefs.asm):00079         ENPMask         EQU             $10             ; Enable Precomp mask
     0020             (      dgndefs.asm):00080         NMIMask         EQU             $20             ; NMI enable Mask
                      (      dgndefs.asm):00081         
                      (      dgndefs.asm):00082         ; Dragon 64/Alpha Serial port.
     0004             (      dgndefs.asm):00083         DPAciaData      EQU             $04             ; Acia Rx/Tx Register
     0005             (      dgndefs.asm):00084         DPAciaStat      EQU             $05             ; Acia status register
     0006             (      dgndefs.asm):00085         DPAciaCmd       EQU             $06             ; Acia command register
     0007             (      dgndefs.asm):00086         DPAciaCtrl      EQU             $07             ; Acia control register
                      (      dgndefs.asm):00087         
     FF04             (      dgndefs.asm):00088         AciaData        EQU             DPAciaData+IO   ; Acia Rx/Tx Register
     FF05             (      dgndefs.asm):00089         AciaStat        EQU             DPAciaStat+IO   ; Acia status register
     FF06             (      dgndefs.asm):00090         AciaCmd         EQU             DPAciaCmd+IO    ; Acia command register
     FF07             (      dgndefs.asm):00091         AciaCtrl        EQU             DPAciaCtrl+IO   ; Acia control register
                      (      dgndefs.asm):00092         
                      (      dgndefs.asm):00093         ; constants for the ACIA status register
                      (      dgndefs.asm):00094         
     0001             (      dgndefs.asm):00095         AciaSParityErr  EQU             $01             ; parity error
     0002             (      dgndefs.asm):00096         AciaSFrameErr   EQU             $02             ; framing error
     0004             (      dgndefs.asm):00097         AciaSOverrun    EQU             $04             ; data overrun
     0008             (      dgndefs.asm):00098         AciaSRxFull     EQU             $08             ; receiver register full
     0010             (      dgndefs.asm):00099         AciaSTxEmpty    EQU             $10             ; transmit register empty
     0020             (      dgndefs.asm):00100         AciaSDCD        EQU             $20             ; data carrier detect =0detect, 1=not detect
     0040             (      dgndefs.asm):00101         AciaSDSR        EQU             $40             ; data set ready 0=ready, 1=not ready
     0080             (      dgndefs.asm):00102         AciaSIRQ        EQU             $80             ; interrupt, 0=no int, 1=int
                      (      dgndefs.asm):00103         
                      (      dgndefs.asm):00104         ; constants for ACIA command register
     00C0             (      dgndefs.asm):00105         AciaPMCMask     EQU             $C0             ; mask for PMC bits
     000C             (      dgndefs.asm):00106         AciaTICMask     EQU             $0C             ; transmitter interrupt control mask
                      (      dgndefs.asm):00107         
     0000             (      dgndefs.asm):00108         AciaPMCPOdd     EQU             $00             ; odd parity tx/rx
     0040             (      dgndefs.asm):00109         AciaPMCPEven    EQU             $40             ; even parity tx/rx
     0080             (      dgndefs.asm):00110         AciaPMCPMark    EQU             $80             ; mark parity tx, rx parity disabled
     00C0             (      dgndefs.asm):00111         AciaPMCPSpace   EQU             $C0             ; space parity tx, rx parity disabled
     0020             (      dgndefs.asm):00112         AciaPME         EQU             $20             ; parity mode enable = 1, disable = 0
     0010             (      dgndefs.asm):00113         AciaREM         EQU             $10             ; receiver echo mode, 0=no echo, 1=echo
     0000             (      dgndefs.asm):00114         AcidTICRHDis    EQU             $00             ; RTS high, interrupt disabled
     0004             (      dgndefs.asm):00115         AcidTICRLEna    EQU             $04             ; RTS low, interrupt enabled
     0008             (      dgndefs.asm):00116         AcidTICRLDis    EQU             $08             ; RTS low, interrupt disabled
     000C             (      dgndefs.asm):00117         AcidTICRLBrk    EQU             $0C             ; RTS low, interrupt disabled, break on txd
     0002             (      dgndefs.asm):00118         AciaIRD         EQU             $02             ; receiver interrupt disable, 0=int enabled, 1=int disabled
     0001             (      dgndefs.asm):00119         AciaDTR         EQU             $01             ; data terminal ready 0=DTR high, 1=DTR low
                      (      dgndefs.asm):00120         
                      (      dgndefs.asm):00121         ; constants for the ACIA control register 
                      (      dgndefs.asm):00122         ; bits 0..3 specify the baud rate
                      (      dgndefs.asm):00123         
     000F             (      dgndefs.asm):00124         AciaBrdMask     EQU             $0F             ; baud rate mask
     0000             (      dgndefs.asm):00125         AciaCBrdExt     EQU             $00             ; 1/16th external clock
     0001             (      dgndefs.asm):00126         AciaCBrd50      EQU             $01             ; 50 baud
     0002             (      dgndefs.asm):00127         AciaCBrd75      EQU             $02             ; 75 baud
     0003             (      dgndefs.asm):00128         AciaCBrd110     EQU             $03             ; 110 baud
     0004             (      dgndefs.asm):00129         AciaCBrd135     EQU             $04             ; 135 baud
     0005             (      dgndefs.asm):00130         AciaCBrd150     EQU             $05             ; 150 baud
     0006             (      dgndefs.asm):00131         AciaCBrd300     EQU             $06             ; 300 baud
     0007             (      dgndefs.asm):00132         AciaCBrd600     EQU             $07             ; 600 baud
     0008             (      dgndefs.asm):00133         AciaCBrd1200    EQU             $08             ; 1200 baud
     0009             (      dgndefs.asm):00134         AciaCBrd1800    EQU             $09             ; 1800 baud
     000A             (      dgndefs.asm):00135         AciaCBrd2400    EQU             $0A             ; 2400 baud
     000B             (      dgndefs.asm):00136         AciaCBrd3600    EQU             $0B             ; 3600 baud
     000C             (      dgndefs.asm):00137         AciaCBrd4800    EQU             $0C             ; 4800 baud
     000D             (      dgndefs.asm):00138         AciaCBrd7200    EQU             $0D             ; 7200 baud
     000E             (      dgndefs.asm):00139         AciaCBrd9600    EQU             $0E             ; 9600 baud
     000E             (      dgndefs.asm):00140         AciaCBrd19200   EQU             $0E             ; 19200 baud
                      (      dgndefs.asm):00141         
     0010             (      dgndefs.asm):00142         AciaCRxClk      EQU             $10             ; receiver clock source, 0= external, 1=baud rate
     0060             (      dgndefs.asm):00143         AciaWrdMask     EQU             $60             ; word length bits mask
     0000             (      dgndefs.asm):00144         AciaCWrd8       EQU             $00             ; 8 bit word
     0020             (      dgndefs.asm):00145         AciaCWrd7       EQU             $20             ; 7 bit word
     0040             (      dgndefs.asm):00146         AciaCWrd6       EQU             $40             ; 6 bit word
     0060             (      dgndefs.asm):00147         AciaCWrd5       EQU             $60             ; 5 bit word3
     0080             (      dgndefs.asm):00148         AciaCSBN        EQU             $80             ; stop bit number, 0=1 bit, 1=2 bits
                      (      dgndefs.asm):00149         
                      (      dgndefs.asm):00150         ; Dragon Alpha Modem port (6850)
                      (      dgndefs.asm):00151         
     0028             (      dgndefs.asm):00152         DPModemCtrl     EQU             $28             ; Modem Control/Status
     0029             (      dgndefs.asm):00153         DPModemData     EQU             $29             ; Modem Rx/Tx Data
                      (      dgndefs.asm):00154         
     FF28             (      dgndefs.asm):00155         ModemCtrl       EQU             DPModemCtrl+IO  ; Modem Control/Status
     FF29             (      dgndefs.asm):00156         ModemData       EQU             DPModemData+IO  ; Modem Rx/Tx Data
                      (      dgndefs.asm):00157         
                      (      dgndefs.asm):00158         ;DragonDos Cartrage IO for WD2797
                      (      dgndefs.asm):00159         
                      (      dgndefs.asm):00160         ;WD2797 Floppy disk controler, used in DragonDos.
     0040             (      dgndefs.asm):00161         DPCmdRegD       EQU             $40             ; command/status                        
     0041             (      dgndefs.asm):00162         DPTrkRegD       EQU             $41             ; Track register
     0042             (      dgndefs.asm):00163         DPSecRegD       EQU             $42             ; Sector register
     0043             (      dgndefs.asm):00164         DPDataRegD      EQU             $43             ; Data register
                      (      dgndefs.asm):00165         
     FF40             (      dgndefs.asm):00166         CmdRegD         EQU             DPCmdRegD+IO    ; command/status        4               
     FF41             (      dgndefs.asm):00167         TrkRegD         EQU             DPTrkRegD+IO    ; Track register
     FF42             (      dgndefs.asm):00168         SecRegD         EQU             DPSecRegD+IO    ; Sector register
     FF43             (      dgndefs.asm):00169         DataRegD        EQU             DPDataRegD+IO   ; Data register
                      (      dgndefs.asm):00170         
     0048             (      dgndefs.asm):00171         DPDSKCTLD       EQU             $48             ; Disk DS/motor control reg
     FF48             (      dgndefs.asm):00172         DSKCTLD         EQU             DPDSKCTLD+IO            
                      (      dgndefs.asm):00173         
                      (      dgndefs.asm):00174         ; Disk IO bitmasks (DragonDos).
                      (      dgndefs.asm):00175         
     0020             (      dgndefs.asm):00176         NMIEnD          EQU             %00100000 
     0010             (      dgndefs.asm):00177         WPCEnD          EQU             %00010000 
     0008             (      dgndefs.asm):00178         SDensEnD        EQU             %00001000 
     0004             (      dgndefs.asm):00179         MotorOnD        EQU             %00000100 
     0000             (      dgndefs.asm):00180         Drive0D         EQU             %00000000
     0001             (      dgndefs.asm):00181         Drive1D         EQU             %00000001
     0002             (      dgndefs.asm):00182         Drive2D         EQU             %00000010
     0003             (      dgndefs.asm):00183         Drive3D         EQU             %00000011
     0003             (      dgndefs.asm):00184         DriveMaskD      EQU             %00000011       ; Mask to extract drives
                      (      dgndefs.asm):00185         
                      (      dgndefs.asm):00186         ; Disk IO bitmasks (Dragon Alpha).
                      (      dgndefs.asm):00187         
                      (      dgndefs.asm):00188         ;NMIEnA         EQU             %10000000       ; This is just a guess, but in current code just used as a flag 
     0080             (      dgndefs.asm):00189         Drive5or8       EQU             %10000000       ; is drive in 5" or 8" mode Acording to circuit trace on R.Harding's machine
     0040             (      dgndefs.asm):00190         WPCEnA          EQU             %01000000       ; Acording to circuit trace by R.Harding.
     0020             (      dgndefs.asm):00191         SDensEnA        EQU             %00100000       ; DDen Acording to circuit trace on R.Harding's machine
     0010             (      dgndefs.asm):00192         MotorOnA        EQU             %00010000       
     0001             (      dgndefs.asm):00193         Drive0A         EQU             %00000001       ; Drive selects acording to OS9 headers
     0002             (      dgndefs.asm):00194         Drive1A         EQU             %00000010
     0004             (      dgndefs.asm):00195         Drive2A         EQU             %00000100
     0008             (      dgndefs.asm):00196         Drive3A         EQU             %00001000
     000F             (      dgndefs.asm):00197         DriveMaskA      EQU             %00001111       ; Mask to extract drives
                      (      dgndefs.asm):00198         
                      (      dgndefs.asm):00199         ; On the Alpha, NMI is enabled/disabled by setting CA2 of the third PIA, High=enabled.
                      (      dgndefs.asm):00200         
                      (      dgndefs.asm):00201         ;WD1793/1772 Floppy disk controler, used in RS-DOS.
     0048             (      dgndefs.asm):00202         DPCmdRegT       EQU             $48             ; command/status                        
     0049             (      dgndefs.asm):00203         DPTrkRegT       EQU             $49             ; Track register
     004A             (      dgndefs.asm):00204         DPSecRegT       EQU             $4A             ; Sector register
     004B             (      dgndefs.asm):00205         DPDataRegT      EQU             $4B             ; Data registerT
                      (      dgndefs.asm):00206         
     FF48             (      dgndefs.asm):00207         CmdRegT         EQU             DPCmdRegT+IO    ; command/status        4               
     FF49             (      dgndefs.asm):00208         TrkRegT         EQU             DPTrkRegT+IO    ; Track register
     FF4A             (      dgndefs.asm):00209         SecRegT         EQU             DPSecRegT+IO    ; Sector register
     FF4B             (      dgndefs.asm):00210         DataRegT        EQU             DPDataRegT+IO   ; Data register
                      (      dgndefs.asm):00211         
     0040             (      dgndefs.asm):00212         DPDSKCTLT       EQU             $40             ; Disk DS/motor control reg
     FF40             (      dgndefs.asm):00213         DSKCTLT         EQU             DPDSKCTLT+IO            
                      (      dgndefs.asm):00214         
                      (      dgndefs.asm):00215         ; Disk IO bitmasks (RSDos FD-500).
                      (      dgndefs.asm):00216         
     0080             (      dgndefs.asm):00217         HaltEn          EQU             %10000000       ; Halt enable
     0040             (      dgndefs.asm):00218         SS0             EQU             %01000000       ; Side select
     0020             (      dgndefs.asm):00219         SDensEnT        EQU             %00100000       ; Double density enable 
     0020             (      dgndefs.asm):00220         NMIEnT          EQU             %00100000       ; Enable NMI, always enabled when in DD mode
     0010             (      dgndefs.asm):00221         WPCEnT          EQU             %00010000       
     0008             (      dgndefs.asm):00222         MotorOnT        EQU             %00001000       ; Drive selects only 3
     0001             (      dgndefs.asm):00223         Drive0T         EQU             %00000001
     0002             (      dgndefs.asm):00224         Drive1T         EQU             %00000010
     0004             (      dgndefs.asm):00225         Drive2T         EQU             %00000100
     0004             (      dgndefs.asm):00226         Drive3T         EQU             %00000100       ; Drive 3 same as drive 2 !
     0007             (      dgndefs.asm):00227         DriveMaskT      EQU             %00000111       ; Mask to extract drives
     000F             (      dgndefs.asm):00228         DriveOffMaskT   EQU             MotorOnT+DriveMaskT     
                      (      dgndefs.asm):00229         
                      (      dgndefs.asm):00230         ; PIA control register bitmasks
     0080             (      dgndefs.asm):00231         CRIRQ1          EQU             %10000000       ; goes to 1 when an inerrupt is triggered on CA1/CB1
     0040             (      dgndefs.asm):00232         CRIRQ2          EQU             %01000000       ; goes to 1 when an inerrupt is triggered on CA2/CB2
     0020             (      dgndefs.asm):00233         CRC2IO          EQU             %00100000       ; CA2/CB2 output when 1, input when 0
     0004             (      dgndefs.asm):00234         CRDDRDATA       EQU             %00000100       ; DDR register accessed if 1, data if 0
     0002             (      dgndefs.asm):00235         CRIRQDir        EQU             %00000010       ; CA1/CB1 IRQ edge : 0 = falling, 1=rising
     0001             (      dgndefs.asm):00236         CRIRQ           EQU             %00000001       ; CA1/CB1 IRQ enable
                      (      dgndefs.asm):00237         
                      (      dgndefs.asm):00238         ; PIA1 bismasks
                      (      dgndefs.asm):00239         
                      (      dgndefs.asm):00240         ; Port B
                      (      dgndefs.asm):00241         
     0080             (      dgndefs.asm):00242         MaskAG          equ             %10000000       ; VDG A/G
     0040             (      dgndefs.asm):00243         MaskGM2         equ             %01000000       ; VDG GM2
     0020             (      dgndefs.asm):00244         MaskGM1         equ             %00100000       ; VDG GM1
     0010             (      dgndefs.asm):00245         MaskGM0         equ             %00010000       ; VDG GM0
     0008             (      dgndefs.asm):00246         MaskCSS         equ             %00001000       ; VDG CSS
     0004             (      dgndefs.asm):00247         MaskROMSEL      equ             %00000100       ; ROM select output on Dragon 64
     0004             (      dgndefs.asm):00248         MaskRAMType     equ             %00000100       ; RAM type input on Dragon 32
     0002             (      dgndefs.asm):00249         MaskSBS         equ             %00000010       ; Single bit sound sense
     0001             (      dgndefs.asm):00250         MaskBUSY        equ             %00000001       ; Printer busy 
                      (      dgndefs.asm):00251         
                      (      dgndefs.asm):00252         ; following 2 for convenience
     00F8             (      dgndefs.asm):00253         MaskVideo       equ             (MaskAG+MaskGM2+MaskGM1+MaskGM0+MaskCSS)
     0007             (      dgndefs.asm):00254         MaskNONVideo    equ             (MaskRAMType+MaskSBS+MaskBUSY)
                      (       ddos2f.asm):00008                         use     dosdefs.asm
                      (      dosdefs.asm):00001         ;
                      (      dosdefs.asm):00002         ; DragonDos,  Copyright (C) 1983,1984 Dragon Data Ltd.
                      (      dosdefs.asm):00003         ;
                      (      dosdefs.asm):00004         ; Disassembled 2004-11-05, P.Harvey-Smith.
                      (      dosdefs.asm):00005         ;
                      (      dosdefs.asm):00006         ; 2005-10-10, forked ram vars into seperate include file.
                      (      dosdefs.asm):00007         ;
                      (      dosdefs.asm):00008                         
     0010             (      dosdefs.asm):00009         TrackPrecomp    EQU     $10             ; Track to enable precomp if greater
                      (      dosdefs.asm):00010         
     0012             (      dosdefs.asm):00011         SectorsPerTrack EQU     $12             ; Sectors per track
     0028             (      dosdefs.asm):00012         FmtDefTracks    EQU     $28             ; Default tracks for format
     0050             (      dosdefs.asm):00013         FmtDefTracksA   EQU     $50             ; Dragon Alpha default tracks for format
     0001             (      dosdefs.asm):00014         FmtDefSides     EQU     $01
                      (      dosdefs.asm):00015         
     0004             (      dosdefs.asm):00016         MaxDriveNo      EQU     $04             ; Maximum valid drive no
     000E             (      dosdefs.asm):00017         MaxFilenameLen  EQU     $0E             ; Max filename length, DriveNo:Filename.EXT
     004F             (      dosdefs.asm):00018         MaxTrack        EQU     $4F             ; Maximum track no (80)
                      (      dosdefs.asm):00019         
                      (      dosdefs.asm):00020         ;
                      (      dosdefs.asm):00021         ; Boot command related.
                      (      dosdefs.asm):00022         ;
                      (      dosdefs.asm):00023         
     0003             (      dosdefs.asm):00024         BootFirstSector EQU     $03             ; Boot sector is track 0 sector 3
     0012             (      dosdefs.asm):00025         BootLastSector  EQU     $12             ; Last sector of boot
     4F53             (      dosdefs.asm):00026         BootSignature   EQU     $4F53           ; Boot signature 'OS'
     2600             (      dosdefs.asm):00027         BootLoadAddr    EQU     $2600           ; Boot area load address.
     2602             (      dosdefs.asm):00028         BootEntryAddr   EQU     $2602           ; Boot entry address
                      (      dosdefs.asm):00029         
                      (      dosdefs.asm):00030         ;
                      (      dosdefs.asm):00031         ; Dir track related
                      (      dosdefs.asm):00032         ;
                      (      dosdefs.asm):00033         
     0014             (      dosdefs.asm):00034         DirPrimary      EQU     $14             ; Primary dir track is track 20
     0010             (      dosdefs.asm):00035         DirBackup       EQU     $10             ; Backup on track 16
                      (      dosdefs.asm):00036         
                      (      dosdefs.asm):00037         ;
                      (      dosdefs.asm):00038         ; DOS Low memory variables
                      (      dosdefs.asm):00039         ;
                      (      dosdefs.asm):00040         
     00FF             (      dosdefs.asm):00041         AutoFlag        EQU     $FF             ; Auto re-number flag, if $613=this then auto enter basic lines
                      (      dosdefs.asm):00042         
     00EA             (      dosdefs.asm):00043         DosCommand      EQU     $00EA           ; Dos function no to execute
     00EB             (      dosdefs.asm):00044         DosDriveNo      EQU     $00EB           ; Last active drive number
     00EC             (      dosdefs.asm):00045         DskTrackNo      EQU     $00EC           ; Disk track no
     00ED             (      dosdefs.asm):00046         DskSectorNo     EQU     $00ED           ; Disk sectror no
     00EE             (      dosdefs.asm):00047         DiskBuffPtr     EQU     $00EE           ; Disk buffer pointer
     00F0             (      dosdefs.asm):00048         DosDiskError    EQU     $00F0           ; Disk error status byte
     00F1             (      dosdefs.asm):00049         DosCurrCtrlBlk  EQU     $00F1           ; Current file control block (FIB) (0..9) $FF=no files open
     00F2             (      dosdefs.asm):00050         DosBytesInDTA   EQU     $00F2           ; Number of bytes in DTA (also used for tracks in DSKINIT).
     00F2             (      dosdefs.asm):00051         DosDSKINITraks  EQU     $00F2           
     00F3             (      dosdefs.asm):00052         DosNoBytesMove  EQU     $00F3           ; Number of bytes to transfer to/from buffer, also head during format
     00F3             (      dosdefs.asm):00053         DosDSKINIHead   EQU     $00F3           
     00F4             (      dosdefs.asm):00054         DosRecLenFlag   EQU     $00F4           ; Record length flag, 00 don'r care $FF=do care, also DS flag in format
     00F5             (      dosdefs.asm):00055         DosRWFlag       EQU     $00F5           ; Read write flag, $00=read, $01= write, $FF=verifying
     00F6             (      dosdefs.asm):00056         DosIOInProgress EQU     $00f6           ; I/O currently in progress flag 0x00 check for time out, Non-0x00 skip timeout check
     00F7             (      dosdefs.asm):00057         DosMakeSysDsk   EQU     $00f7           ; Make system disk during format, $00=no, $FF=yes
                      (      dosdefs.asm):00058         
     00F8             (      dosdefs.asm):00059         DosSectorSeek   EQU     $00F8           ; Sector currently seeking {SuperDos Rom}
                      (      dosdefs.asm):00060         
                      (      dosdefs.asm):00061         *************************************************************************
                      (      dosdefs.asm):00062         
     0600             (      dosdefs.asm):00063         DosAreaStart    EQU     $0600           ; Start of RAM used by DOS
     0600             (      dosdefs.asm):00064         Thrash          EQU     $0600           ; Work byte, yes that's what it's called in the DD sourcecode!
     0601             (      dosdefs.asm):00065         Temps1          EQU     $0601           ; Temp storage for registers #1
     0602             (      dosdefs.asm):00066         Temps2          EQU     $0602           ; Temp storage for registers #2
     0603             (      dosdefs.asm):00067         TempC           EQU     $0603           ; Temp for FREAD
     0604             (      dosdefs.asm):00068         TempL           EQU     $0604           ; Temp for FREAD
                      (      dosdefs.asm):00069         
     0603             (      dosdefs.asm):00070         DosErrorCode    EQU     $0603           ; Error code from DOS
     0605             (      dosdefs.asm):00071         DosTimeout      EQU     $0605           ; Timeout count, Motor timer
                      (      dosdefs.asm):00072                                                 ; timeout occurs when this location is decremented from 0x01 to 0x00,                   
     0606             (      dosdefs.asm):00073         DosHWMaskFF40   EQU     $0606           ; Hardware command byte mask for FF40 (disk option)
     0607             (      dosdefs.asm):00074         DosHWMaskFF48   EQU     $0607           ; hardware control mask for $ff48 (latch temp)
     0608             (      dosdefs.asm):00075         DosVerifyFlag   EQU     $0608           ; Verify flag, 00=no verify $FF=verify
     0609             (      dosdefs.asm):00076         DosErrorMask    EQU     $0609           ; Error mask, ANDed with error code from WD
     060A             (      dosdefs.asm):00077         DosDefDriveNo   EQU     $060A           ; Default drive number
     060B             (      dosdefs.asm):00078         DosFWriteBPtr   EQU     $060B           ; FWrite buffer pointer 
     060D             (      dosdefs.asm):00079         DosBuffStart    EQU     $060D           ; Buffer start
     060F             (      dosdefs.asm):00080         DosBuffEnd      EQU     $060F           ; Buffer end
     0611             (      dosdefs.asm):00081         DosRunLoadFlag  EQU     $0611           ; Run/load flag $00=LOAD
     0612             (      dosdefs.asm):00082         DosFlFreadFlag  EQU     $0612           ; Fread/FLread flag 00=fread, $FF=FLread
                      (      dosdefs.asm):00083         
                      (      dosdefs.asm):00084         *************************************************************************
                      (      dosdefs.asm):00085         
                      (      dosdefs.asm):00086         ; Auto flags share their locations with FWrite buffers as they cannot both be 
                      (      dosdefs.asm):00087         ; active together
     0613             (      dosdefs.asm):00088         DosAutoFlag     EQU     $0613           ; Auto flag, $FF=auto, $00=no auto
     060D             (      dosdefs.asm):00089         DosAutoCurrent  EQU     DosBuffStart    ; AUTO current line no
     060F             (      dosdefs.asm):00090         DosAutoInc      EQU     DosBuffEnd      ; AUTO line increment
                      (      dosdefs.asm):00091         
                      (      dosdefs.asm):00092         *************************************************************************
                      (      dosdefs.asm):00093         
                      (      dosdefs.asm):00094         ; variables for ON ERROR
     0614             (      dosdefs.asm):00095         DosErrGotoFlag  EQU     $0614           ; ERROR GOTO flag, 0x00 Off Non-0x00 On 
     0615             (      dosdefs.asm):00096         DosErrDestLine  EQU     $0615           ; Error destination line
     0617             (      dosdefs.asm):00097         DosErrLineNo    EQU     $0617           ; line no error occured in (ERR line no)
     0619             (      dosdefs.asm):00098         DosErrLast      EQU     $0619           ; Error that occured
     061A             (      dosdefs.asm):00099         DosErrPtr       EQU     $061A           ; pointer to the statement that caused the error
                      (      dosdefs.asm):00100         
                      (      dosdefs.asm):00101         *************************************************************************
                      (      dosdefs.asm):00102         
     061C             (      dosdefs.asm):00103         Drv0Details     EQU     $061C           ; Drive 0 details (6 bytes)
     0622             (      dosdefs.asm):00104         Drv1Details     EQU     $0622           ; Drive 1 details (6 bytes)
     0628             (      dosdefs.asm):00105         Drv2Details     EQU     $0628           ; Drive 2 details (6 bytes)
     062E             (      dosdefs.asm):00106         Drv3Details     EQU     $062E           ; Drive 3 details (6 bytes)
     0006             (      dosdefs.asm):00107         DrvDeatailLen   EQU     $06             ; Entries are 6 bytes long
                      (      dosdefs.asm):00108         
                      (      dosdefs.asm):00109         ; Offsets into drive details
     0000             (      dosdefs.asm):00110         DrvDetDirLSN    EQU     $00             ; LSN of directory
     0002             (      dosdefs.asm):00111         DrvDetFreeLen   EQU     $02             ; Free length
     0003             (      dosdefs.asm):00112         DrvDetFreeEPtr  EQU     $03             ; Free extent pointer (LSN)
     0005             (      dosdefs.asm):00113         DrvDetUseCnt    EQU     $05             ; Usage/open file count ?
                      (      dosdefs.asm):00114         
                      (      dosdefs.asm):00115         *************************************************************************
                      (      dosdefs.asm):00116         
     0004             (      dosdefs.asm):00117         BuffCount       EQU     $04             ; 4 disk buffers
     0007             (      dosdefs.asm):00118         BuffDetailSize  EQU     $07             ; Buffer detail entries ar 7 bytes long
                      (      dosdefs.asm):00119         
     0634             (      dosdefs.asm):00120         Buff1Details    EQU     $0634           ; Disk buffer 1 details
     063B             (      dosdefs.asm):00121         Buff2Details    EQU     $063B           ; Disk buffer 2 details
     0642             (      dosdefs.asm):00122         Buff3Details    EQU     $0642           ; Disk buffer 3 details
     0649             (      dosdefs.asm):00123         Buff4Details    EQU     $0649           ; Disk buffer 4 details
                      (      dosdefs.asm):00124         
                      (      dosdefs.asm):00125         
                      (      dosdefs.asm):00126         ; Disk buffer details offsets for above table
     0000             (      dosdefs.asm):00127         BuffLSN         EQU     $00             ; LSN number 
     0002             (      dosdefs.asm):00128         BuffFlag        EQU     $02             ; Flag, see below...
     0003             (      dosdefs.asm):00129         BuffDrive       EQU     $03             ; Drive no 1..4
     0004             (      dosdefs.asm):00130         BuffAge         EQU     $04             ; Age of buffer since last use, 1=oldest..4=youngest
     0005             (      dosdefs.asm):00131         BuffAddr        EQU     $05             ; Buffer address
                      (      dosdefs.asm):00132         
                      (      dosdefs.asm):00133         ;BuffFlag values
                      (      dosdefs.asm):00134         
     0000             (      dosdefs.asm):00135         BuffFree        EQU     $00             ; Disk buffer is free
     0001             (      dosdefs.asm):00136         BuffUnknown     EQU     $01             ; Valid, clean
     0055             (      dosdefs.asm):00137         BuffInUse       EQU     $55             ; Buffer in use** not documented in DDv2c source.
     00FE             (      dosdefs.asm):00138         BuffDirtyExpire EQU     $FE             ; Buffer has been modified, but not written to disk, grace period expired
     00FF             (      dosdefs.asm):00139         BuffDirty       EQU     $FF             ; Buffer has been modified, but not written to disk
                      (      dosdefs.asm):00140         
                      (      dosdefs.asm):00141         *************************************************************************
                      (      dosdefs.asm):00142         
     0650             (      dosdefs.asm):00143         DosCurDriveInfo EQU     $0650           ; Dos current drive info
     0650             (      dosdefs.asm):00144         DosCurFilename  EQU     $0650           ; Current filename
     0658             (      dosdefs.asm):00145         DosCurExtension EQU     $0658           ; Current extension, used in validation
                      (      dosdefs.asm):00146         
     065B             (      dosdefs.asm):00147         DosCurDriveNo   EQU     $065B           ; Current drive no
     065C             (      dosdefs.asm):00148         DosLSNCounter   EQU     $065C           ; LSN counter in directory search
     065E             (      dosdefs.asm):00149         DosSaveBuffAddr EQU     $065E           ; Save buffer address
                      (      dosdefs.asm):00150         
                      (      dosdefs.asm):00151         
     0660             (      dosdefs.asm):00152         DosCurCount     EQU     $0660           ; Current count, used in various places (extent found?)
                      (      dosdefs.asm):00153                                                 ; marked as "Temp1, extent found" in DDv2c source
     0661             (      dosdefs.asm):00154         DosBytesRead    EQU     $0661           ; Number of bytes to read in DosFRead
     0663             (      dosdefs.asm):00155         DosSecOffset    EQU     $0663           ; Offset within sector for DosFRead to start
     0664             (      dosdefs.asm):00156         DosFWriteAddr   EQU     $0664           ; Fwrite address
     0667             (      dosdefs.asm):00157         DosPageBufAddr  EQU     $0667           ; Page buffer address
     0669             (      dosdefs.asm):00158         DosCurrSector   EQU     $0669           ; Current sector (LSN?)
     066B             (      dosdefs.asm):00159         DosTotalSFound  EQU     $066B           ; Total sectors found
     066D             (      dosdefs.asm):00160         DosFSNToFind    EQU     $066D           ; FSN sought
     066F             (      dosdefs.asm):00161         DosCurLSN       EQU     $066F           ; Current LSN, of current DIR sector being processed
     0671             (      dosdefs.asm):00162         DosFWBufPtr     EQU     $0671           ; Pointer to buffer in FWrite
     0673             (      dosdefs.asm):00163         DosFWByteCount  EQU     $0673           ; Number of bytes to write in FWrite
     0675             (      dosdefs.asm):00164         DosFWFPoint     EQU     $0675           ; File pointer to write at in FWrite
                      (      dosdefs.asm):00165         
     0678             (      dosdefs.asm):00166         DosSaveFCB      EQU     $0678           ; Temparary FCB pointer used by DosCreateFile.
     067A             (      dosdefs.asm):00167         DosSaveExt      EQU     $067A           ; Temporary extension used during DosCreateFile
     067D             (      dosdefs.asm):00168         DosTempFCBNo    EQU     $067D           ; Temporary Fileno / FCB no storage used by DosCreateFile.
     067F             (      dosdefs.asm):00169         DosCurDirBuff   EQU     $067F           ; Pointer to the current Dir sector, Buffer def block
     0681             (      dosdefs.asm):00170         DosTempFileNo   EQU     $0681           ; Temp file no whilst opening file
     0682             (      dosdefs.asm):00171         DosCurFileNo    EQU     $0682           ; Current file number on disk, to get dir entry for
                      (      dosdefs.asm):00172         
     0683             (      dosdefs.asm):00173         DosNewUSRTable  EQU     $0683           ; New USR table, relocated from low ram
                      (      dosdefs.asm):00174         
                      (      dosdefs.asm):00175         ;Drive parameter tables, note these need to be in this order.
     0697             (      dosdefs.asm):00176         DosD0Online     EQU     $0697           ; Drive 0 online flag
     0698             (      dosdefs.asm):00177         DosD1Online     EQU     $0698           ; Drive 1 online flag
     0699             (      dosdefs.asm):00178         DosD2Online     EQU     $0699           ; Drive 2 online flag
     069A             (      dosdefs.asm):00179         DosD3Online     EQU     $069A           ; Drive 3 online flag
                      (      dosdefs.asm):00180         
     069B             (      dosdefs.asm):00181         DosD0Track      EQU     $069B           ; Drive 0 current track
     069C             (      dosdefs.asm):00182         DosD1Track      EQU     $069C           ; Drive 1 current track
     069D             (      dosdefs.asm):00183         DosD2Track      EQU     $069D           ; Drive 2 current track
     069E             (      dosdefs.asm):00184         DosD3Track      EQU     $069E           ; Drive 3 current track
                      (      dosdefs.asm):00185         
     067E             (      dosdefs.asm):00186         DosTemp2        EQU     $067E           ; Temp, used in FindEmptyDir, CmdFLRead.... 
     069F             (      dosdefs.asm):00187         DosLBASec       EQU     $069F           ; as step rates meaningless for disk image
                      (      dosdefs.asm):00188         
     069F             (      dosdefs.asm):00189         DosD0StepRate   EQU     $069F           ; Drive 0 step rate
     06A0             (      dosdefs.asm):00190         DosD1StepRate   EQU     $06A0           ; Drive 1 step rate
     06A1             (      dosdefs.asm):00191         DosD2StepRate   EQU     $06A1           ; Drive 2 step rate
     06A2             (      dosdefs.asm):00192         DosD3StepRate   EQU     $06A2           ; Drive 3 step rate
                      (      dosdefs.asm):00193         
     06A3             (      dosdefs.asm):00194         DosD0Tracks     EQU     $06A3           ; Tracks on disk in drive 0
     06A4             (      dosdefs.asm):00195         DosD1Tracks     EQU     $06A4           ; Tracks on disk in drive 1
     06A5             (      dosdefs.asm):00196         DosD2Tracks     EQU     $06A5           ; Tracks on disk in drive 2
     06A6             (      dosdefs.asm):00197         DosD3Tracks     EQU     $06A6           ; Tracks on disk in drive 3
                      (      dosdefs.asm):00198         
     06A7             (      dosdefs.asm):00199         DosD0SecTrack   EQU     $06A7           ; Sectors per track drive 0
     06A8             (      dosdefs.asm):00200         DosD1SecTrack   EQU     $06A8           ; Sectors per track drive 1
     06A9             (      dosdefs.asm):00201         DosD2SecTrack   EQU     $06A9           ; Sectors per track drive 2
     06AA             (      dosdefs.asm):00202         DosD3SecTrack   EQU     $06AA           ; Sectors per track drive 3
                      (      dosdefs.asm):00203         
                      (      dosdefs.asm):00204         ; Offsets of tables from Online table, this way we can point an index register
                      (      dosdefs.asm):00205         ; at the drive online byte and access the other tables with offset,IR
                      (      dosdefs.asm):00206         
     0004             (      dosdefs.asm):00207         DosTrackTblOfs  EQU     (DosD0Track-DosD0Online)
     0008             (      dosdefs.asm):00208         DosStepTblOfs   EQU     (DosD0StepRate-DosD0Online)
     000C             (      dosdefs.asm):00209         DosTracksTblOfs EQU     (DosD0Tracks-DosD0Online)
     0010             (      dosdefs.asm):00210         DosSecTrkTblOfs EQU     (DosD0SecTrack-DosD0Online)
                      (      dosdefs.asm):00211         
     06AB             (      dosdefs.asm):00212         DosDirSecStatus EQU     $06AB           ; Directory sector status $06ab-$06bc
                      (      dosdefs.asm):00213         
     06BD             (      dosdefs.asm):00214         DosFCB0Addr     EQU     $06BD           ; File Control Block 0 Address 
     06DC             (      dosdefs.asm):00215         DosFCB1Addr     EQU     $06DC           ; File Control Block 1 Address
     06FB             (      dosdefs.asm):00216         DosFCB2Addr     EQU     $06FB           ; File Control Block 2 Address 
     071A             (      dosdefs.asm):00217         DosFCB3Addr     EQU     $071A           ; File Control Block 3 Address 
     0739             (      dosdefs.asm):00218         DosFCB4Addr     EQU     $0739           ; File Control Block 4 Address 
     0758             (      dosdefs.asm):00219         DosFCB5Addr     EQU     $0758           ; File Control Block 5 Address 
     0777             (      dosdefs.asm):00220         DosFCB6Addr     EQU     $0777           ; File Control Block 6 Address 
     0796             (      dosdefs.asm):00221         DosFCB7Addr     EQU     $0796           ; File Control Block 7 Address 
     07B5             (      dosdefs.asm):00222         DosFCB8Addr     EQU     $07B5           ; File Control Block 8 Address 
     07D4             (      dosdefs.asm):00223         DosFCB9Addr     EQU     $07D4           ; File Control Block 9 Address 
     07F3             (      dosdefs.asm):00224         DosFCBEnd       EQU     $07F3           ; First byte beyond last FCB
                      (      dosdefs.asm):00225         
     0800             (      dosdefs.asm):00226         DosDiskBuffBase EQU     $0800           ; Base of Disk buffers
                      (      dosdefs.asm):00227         
     001F             (      dosdefs.asm):00228         DosFCBLength    EQU     $1F             ; 31 bytes per FCB
                      (      dosdefs.asm):00229         
     000A             (      dosdefs.asm):00230         DosNumFCBs      EQU     (DosFCBEnd-DosFCB0Addr)/DosFCBLength    ; number of FCBs
                      (      dosdefs.asm):00231         
                      (      dosdefs.asm):00232         ;
                      (      dosdefs.asm):00233         ; FCB structure is :
                      (      dosdefs.asm):00234         ;
                      (      dosdefs.asm):00235         ; FCB format :
                      (      dosdefs.asm):00236         ; Pos   Len     Use
                      (      dosdefs.asm):00237         ; $00   8       File name
                      (      dosdefs.asm):00238         ; $08   3       Extension
                      (      dosdefs.asm):00239         ; $0B   1       Drive no (1..4)
                      (      dosdefs.asm):00240         ; $0C   3       Next read byte (file pointer?)
                      (      dosdefs.asm):00241         ; $0F   1       Directory flags
                      (      dosdefs.asm):00242         ; $10   3       Length of file
                      (      dosdefs.asm):00243         ; $13   2       First sector number (FSN) of extent 1
                      (      dosdefs.asm):00244         ; $15   2       LSN of extent 1
                      (      dosdefs.asm):00245         ; $17   1       sextors in extent 1
                      (      dosdefs.asm):00246         ; $18   2       First sector number (FSN) of extent 1
                      (      dosdefs.asm):00247         ; $1A   2       LSN of extent 1
                      (      dosdefs.asm):00248         ; $1C   1       sectors in extent 1
                      (      dosdefs.asm):00249         ; $1D   1       Number of dir entry
                      (      dosdefs.asm):00250         ; $1E   1       Directory number of last entry
                      (      dosdefs.asm):00251         
     0000             (      dosdefs.asm):00252         FCBFileName     EQU     $00     ; Filename (zero padded)
     0008             (      dosdefs.asm):00253         FCBExtension    EQU     $08     ; Extension (zero padded)
     000B             (      dosdefs.asm):00254         FCBDrive        EQU     $0B     ; Drive no
     000C             (      dosdefs.asm):00255         FCBFilePointer  EQU     $0C     ; File Pointer 
     000F             (      dosdefs.asm):00256         FCBDirFlags     EQU     $0F     ; Dir flags (attributes)
     0010             (      dosdefs.asm):00257         FCBFileLen      EQU     $10     ; File Length
     0013             (      dosdefs.asm):00258         FCBFSNExtent1   EQU     $13     ; FSN of extent 1
     0015             (      dosdefs.asm):00259         FCBLSNExtent1   EQU     $15     ; LSN of extent 1 
     0017             (      dosdefs.asm):00260         FCBSecExtent1   EQU     $17     ; Sectors in extent 1
     0018             (      dosdefs.asm):00261         FCBFSNExtent2   EQU     $18     ; FSN of extent 2
     001A             (      dosdefs.asm):00262         FCBLSNExtent2   EQU     $1A     ; LSN of extent 2 
     001C             (      dosdefs.asm):00263         FCBSecExtent2   EQU     $1C     ; Sectors in extent 2
     001D             (      dosdefs.asm):00264         FCBDiskFileNo   EQU     $1D     ; File number on disk, (dir entry no).
     001E             (      dosdefs.asm):00265         FCBDirNoLast    EQU     $1E     ; Dir no of last entry
                      (      dosdefs.asm):00266         
                      (      dosdefs.asm):00267         ;
                      (      dosdefs.asm):00268         ; Backup command stack frame offsets
                      (      dosdefs.asm):00269         ;
                      (      dosdefs.asm):00270         ; These are offset from U on stack
                      (      dosdefs.asm):00271         ;
                      (      dosdefs.asm):00272         
     0000             (      dosdefs.asm):00273         BupSrcDrive     EQU     0       ; Drive number of source 
     0001             (      dosdefs.asm):00274         BupSrcTrk       EQU     1       ; Source track 
     0002             (      dosdefs.asm):00275         BupSrcSec       EQU     2       ; Source sector no
     0003             (      dosdefs.asm):00276         BupSrcMess      EQU     3       ; Insert source message ptr
     0005             (      dosdefs.asm):00277         BupSrcBuff      EQU     5       ; Source sector buffer addr 
     0007             (      dosdefs.asm):00278         BupDestDrive    EQU     7       ; Drive number of dest 
     0008             (      dosdefs.asm):00279         BupDestTrk      EQU     8       ; Dest track a
     0009             (      dosdefs.asm):00280         BupDestSec      EQU     9       ; Dest sector no
     000A             (      dosdefs.asm):00281         BupDestMess     EQU     10      ; Insert dest message ptr
     000C             (      dosdefs.asm):00282         BupDestBuff     EQU     12      ; Dest sector buffer addr 
     000E             (      dosdefs.asm):00283         BupSecTrk       EQU     14      ; Sector count per track to copy 
     000F             (      dosdefs.asm):00284         BupAvailPages   EQU     15      ; Pages available to buffer sectors
                      (      dosdefs.asm):00285         
                      (      dosdefs.asm):00286         ;
                      (      dosdefs.asm):00287         ; Offset from X, which will point to BupSrcDrive, or BupDestDrive
                      (      dosdefs.asm):00288         ; 
                      (      dosdefs.asm):00289         
     0000             (      dosdefs.asm):00290         BupDrive        EQU     0       ; Drive number  
     0001             (      dosdefs.asm):00291         BupTrk          EQU     1       ; track 
     0002             (      dosdefs.asm):00292         BupSec          EQU     2       ; sector
     0003             (      dosdefs.asm):00293         BupMess         EQU     3       ; backup message
     0005             (      dosdefs.asm):00294         BupBuff         EQU     5       ; Source sector buffer addr ?
                      (      dosdefs.asm):00295         
     0010             (      dosdefs.asm):00296         BupStackFrame   EQU     16      ; backup stack frame size
                      (      dosdefs.asm):00297         
     D800             (      dosdefs.asm):00298         SpinUpDelay     EQU     $D800   ; Value for timeout loop
                      (      dosdefs.asm):00299         
                      (      dosdefs.asm):00300         
                      (      dosdefs.asm):00301         ;
                      (      dosdefs.asm):00302         ; Sync dir stack frame offsets
                      (      dosdefs.asm):00303         ;
                      (      dosdefs.asm):00304         ; These are offset from U on stack
                      (      dosdefs.asm):00305         ;
                      (      dosdefs.asm):00306         
     0000             (      dosdefs.asm):00307         SyncDriveCount  EQU     0       ; drive counter, done by bitshift
     0001             (      dosdefs.asm):00308         SyncDrive       EQU     1       ; Drive we are syncing
     0002             (      dosdefs.asm):00309         SyncBufferNo    EQU     2       ; Current buffer no
     0003             (      dosdefs.asm):00310         SyncSecNo       EQU     3       ; Sector we are syncing
     0004             (      dosdefs.asm):00311         SyncSectors     EQU     4       ; 4 sector numbers in the disk buffers
                      (      dosdefs.asm):00312         
                      (      dosdefs.asm):00313         ;
                      (      dosdefs.asm):00314         ; Dos function codes used by hardware routine.
                      (      dosdefs.asm):00315         ; 
                      (      dosdefs.asm):00316         
     0000             (      dosdefs.asm):00317         DosFnRestore    EQU     $00     ; Restore to track 0
     0001             (      dosdefs.asm):00318         DosFnSeek       EQU     $01     ; Seek to a track
     0002             (      dosdefs.asm):00319         DosFnReadSec    EQU     $02     ; Read a sector
     0003             (      dosdefs.asm):00320         DosFnWriteSecV  EQU     $03     ; Write a sector with verify
     0004             (      dosdefs.asm):00321         DosFnWriteSecN  EQU     $04     ; Write a sector no verify
     0005             (      dosdefs.asm):00322         DosFnWriteTrack EQU     $05     ; Write (format) track
     0006             (      dosdefs.asm):00323         DosFnReadAddr   EQU     $06     ; Read address mark
     0007             (      dosdefs.asm):00324         DosFnReadSec2   EQU     $07     ; Read first two bytes of a sector
     0008             (      dosdefs.asm):00325         DosFnWriteDef   EQU     $08     ; Write defective sector
                      (      dosdefs.asm):00326         
                      (      dosdefs.asm):00327         *******************************************
                      (      dosdefs.asm):00328         ***** Directory Track realted defines *****
                      (      dosdefs.asm):00329         *******************************************
                      (      dosdefs.asm):00330         
                      (      dosdefs.asm):00331         ;
                      (      dosdefs.asm):00332         ; Dir entry format(s).
                      (      dosdefs.asm):00333         ;
                      (      dosdefs.asm):00334         ; Dragon/Super dos directory entries can take one of 2 formats, they can be either a
                      (      dosdefs.asm):00335         ; filename block, containing filename, attributes & 4 allocation entries, or they can
                      (      dosdefs.asm):00336         ; be a continuation block, containing just allocation entries. 
                      (      dosdefs.asm):00337         ; This is controled by the byte at offset $18, and the attributes.
                      (      dosdefs.asm):00338         ;
                      (      dosdefs.asm):00339         ; if AttrContinued = 0 then 
                      (      dosdefs.asm):00340         ;       the byte at offset $18, contains the number of number of bytes in the last sector (256 bytes = 0).
                      (      dosdefs.asm):00341         ;
                      (      dosdefs.asm):00342         ; if AttrContinued = 1 then 
                      (      dosdefs.asm):00343         ;       the byte at offset $18 controls the format of the entry :
                      (      dosdefs.asm):00344         ;               if 0 then 
                      (      dosdefs.asm):00345         ;                       Entry is a filename entry
                      (      dosdefs.asm):00346         ;               else
                      (      dosdefs.asm):00347         ;                       Entry is a continuation block.
                      (      dosdefs.asm):00348         
                      (      dosdefs.asm):00349         ; Filename block format 
                      (      dosdefs.asm):00350         
     0000             (      dosdefs.asm):00351         DirEntAttr      EQU     $00             ; Attributes (see below)
     0001             (      dosdefs.asm):00352         DirEntFilename  EQU     $01             ; Filename, zero padded
     0009             (      dosdefs.asm):00353         DirEntExtension EQU     $09             ; Extension, zero padded
     000C             (      dosdefs.asm):00354         DirEntFnBlock1  EQU     $0C             ; Allocation block #1
     000F             (      dosdefs.asm):00355         DirEntFnBlock2  EQU     $0F             ; Allocation block #2
     0012             (      dosdefs.asm):00356         DirEntFnBlock3  EQU     $12             ; Allocation block #3
     0015             (      dosdefs.asm):00357         DirEntFnBlock4  EQU     $15             ; Allocation block #4
     0018             (      dosdefs.asm):00358         DirEntFlag      EQU     $18             ; Filename/Continuation flag 0/nonzero
     0018             (      dosdefs.asm):00359         DirEntLastBytes EQU     $18             ; bytes in last sector
                      (      dosdefs.asm):00360         
     0019             (      dosdefs.asm):00361         DirEntryLen     EQU     $19             ; Length of Dir Entry.
     0004             (      dosdefs.asm):00362         DirEntExts      EQU     4               ; 4 allocatoion blocks in filename block
                      (      dosdefs.asm):00363         
                      (      dosdefs.asm):00364         ; Continuation block, DirEntAttr, and DirEntFlag, as above.
                      (      dosdefs.asm):00365         
     0001             (      dosdefs.asm):00366         DirEntCntBlock1 EQU     $01             ; Allocation block #1
     0004             (      dosdefs.asm):00367         DirEntCntBlock2 EQU     $04             ; Allocation block #2
     0007             (      dosdefs.asm):00368         DirEntCntBlock3 EQU     $07             ; Allocation block #3
     000A             (      dosdefs.asm):00369         DirEntCntBlock4 EQU     $0A             ; Allocation block #4
     000D             (      dosdefs.asm):00370         DirEntCntBlock5 EQU     $0D             ; Allocation block #5
     0010             (      dosdefs.asm):00371         DirEntCntBlock6 EQU     $10             ; Allocation block #6
     0013             (      dosdefs.asm):00372         DirEntCntBlock7 EQU     $13             ; Allocation block #7
                      (      dosdefs.asm):00373         
     0007             (      dosdefs.asm):00374         DirEntCntExts   EQU     7               ; 7 allocatoion blocks in continuation block
                      (      dosdefs.asm):00375         
     000A             (      dosdefs.asm):00376         DirBlksPerSec   EQU     $0A             ; Number of dir blocks per dir sector
                      (      dosdefs.asm):00377         
                      (      dosdefs.asm):00378         ;
                      (      dosdefs.asm):00379         ; Allocation block format.
                      (      dosdefs.asm):00380         ;
                      (      dosdefs.asm):00381         
     0000             (      dosdefs.asm):00382         AllocLSN        EQU     $00             ; Logical sector number of start of allocation
     0002             (      dosdefs.asm):00383         AllocCount      EQU     $02             ; Count of number of sectors allocated.
     0003             (      dosdefs.asm):00384         AllocEntrySize  EQU     $03             ; Size of allocation entry
                      (      dosdefs.asm):00385         
     0003             (      dosdefs.asm):00386         AllocLen        EQU     3               ; Allocation length
                      (      dosdefs.asm):00387         
                      (      dosdefs.asm):00388         ;
                      (      dosdefs.asm):00389         ; File Attributes
                      (      dosdefs.asm):00390         ;
                      (      dosdefs.asm):00391         
     0080             (      dosdefs.asm):00392         AttrDeleted     EQU     %10000000       ; Deleted, may be reused
     0020             (      dosdefs.asm):00393         AttrContinued   EQU     %00100000       ; Continuation entry, byte at $18 giver next entry no
     0008             (      dosdefs.asm):00394         AttrEndOfDir    EQU     %00001000       ; End of directory, no more entries need to be scanned
     0002             (      dosdefs.asm):00395         AttrWriteProt   EQU     %00000010       ; Write protect flag
     0001             (      dosdefs.asm):00396         AttrIsCont      EQU     %00000001       ; This is a continuation entry.
                      (      dosdefs.asm):00397         
     0089             (      dosdefs.asm):00398         AttrAtFormat    EQU     AttrDeleted+AttrEndOfDir+AttrIsCont     ; Attributes set in DSKINIT     
     0081             (      dosdefs.asm):00399         AttrAfterDel    EQU     AttrDeleted+AttrIsCont                  ; Attributes set by DosDeleteFile
                      (      dosdefs.asm):00400         
     000A             (      dosdefs.asm):00401         DirEntPerSec    EQU     $0A                             ; Directory entries per sector
     00FA             (      dosdefs.asm):00402         DirLastByte     EQU     (DirEntPerSec*DirEntryLen)      ; First byte beyond last dire entry in sector
                      (      dosdefs.asm):00403         
                      (      dosdefs.asm):00404         ;
                      (      dosdefs.asm):00405         ; Offsets in Sector 0 on Dir track
                      (      dosdefs.asm):00406         ;
                      (      dosdefs.asm):00407         
     0000             (      dosdefs.asm):00408         BitmapPart1     EQU     $00             ; Bitmap uses bytes $00..$FB on first sector
     00FC             (      dosdefs.asm):00409         DirTracks       EQU     $FC             ; Tracks on disk
     00FD             (      dosdefs.asm):00410         DirSecPerTrk    EQU     $FD             ; Sectors/track 18=Single sided, 36=Double sided
     00FE             (      dosdefs.asm):00411         DirTracks1s     EQU     $FE             ; complement of DirTracks (used to validate)
     00FF             (      dosdefs.asm):00412         DirSecPerTrk1s  EQU     $FF             ; Complement of DirSecPerTrk (used to validate)
                      (      dosdefs.asm):00413         
                      (      dosdefs.asm):00414         ;
                      (      dosdefs.asm):00415         ; DOS Error codes.
                      (      dosdefs.asm):00416         ;
                      (      dosdefs.asm):00417         
     0080             (      dosdefs.asm):00418         ErrNR   EQU     $80                     ; not ready
     0082             (      dosdefs.asm):00419         ErrSK   EQU     $82                     ; seek
     0084             (      dosdefs.asm):00420         ErrWP   EQU     $84                     ; write protect
     0086             (      dosdefs.asm):00421         ErrRT   EQU     $86                     ; record type
     0088             (      dosdefs.asm):00422         ErrRF   EQU     $88                     ; record not found
     008A             (      dosdefs.asm):00423         ErrCC   EQU     $8A                     ; CRC
     008C             (      dosdefs.asm):00424         ErrLD   EQU     $8C                     ; Lost data
     008E             (      dosdefs.asm):00425         ErrBT   EQU     $8E                     ; boot
     0090             (      dosdefs.asm):00426         ErrIV   EQU     $90                     ; invalid volume / directory
     0092             (      dosdefs.asm):00427         ErrFD   EQU     $92                     ; Full directory
     0094             (      dosdefs.asm):00428         ErrDF   EQU     $94                     ; Disk full
     0096             (      dosdefs.asm):00429         ErrFS   EQU     $96                     ; File spec
     0098             (      dosdefs.asm):00430         ErrPT   EQU     $98                     ; Protection
     009A             (      dosdefs.asm):00431         ErrPE   EQU     $9A                     ; (read) Past end 
     009C             (      dosdefs.asm):00432         ErrFF   EQU     $9C                     ; File not Found 
     009E             (      dosdefs.asm):00433         ErrFE   EQU     $9E                     ; File exists
     00A0             (      dosdefs.asm):00434         ErrNE   EQU     $A0                     ; (file does) Not Exist
     00A2             (      dosdefs.asm):00435         ErrTF   EQU     $A2                     ; Too many Files open
     00A4             (      dosdefs.asm):00436         ErrPR   EQU     $A4                     ; Parameter
     00A6             (      dosdefs.asm):00437         ErrUD   EQU     $A6                     ; Undefined
     00FF             (      dosdefs.asm):00438         ErrSFF  EQU     $FF                     ; ????
                      (      dosdefs.asm):00439         
                      (      dosdefs.asm):00440                 if 0
0000                  (      dosdefs.asm):00441         DDErrNR         EQU     $80             ; Not ready
0000                  (      dosdefs.asm):00442         DDErrSK         EQU     $82             ; seek
0000                  (      dosdefs.asm):00443         DDErrWP         EQU     $84             ; write protect
0000                  (      dosdefs.asm):00444         DDErrRT         EQU     $86             ; record type
0000                  (      dosdefs.asm):00445         DDErrRF         EQU     $88             ; record not found
0000                  (      dosdefs.asm):00446         DDErrCC         EQU     $8A             ; CRC
0000                  (      dosdefs.asm):00447         DDErrLD         EQU     $8C             ; Lost data
0000                  (      dosdefs.asm):00448         DDErrBT         EQU     $8E             ; boot
0000                  (      dosdefs.asm):00449         DDErrIV         EQU     $90             ; invalid volume / directory
0000                  (      dosdefs.asm):00450         DDErrFD         EQU     $92             ; Full directory
0000                  (      dosdefs.asm):00451         DDErrDF         EQU     $94             ; Disk full
0000                  (      dosdefs.asm):00452         DDErrFS         EQU     $96             ; File spec
0000                  (      dosdefs.asm):00453         DDErrPT         EQU     $98             ; Protection
0000                  (      dosdefs.asm):00454         DDErrPE         EQU     $9A             ; (read) Past end 
0000                  (      dosdefs.asm):00455         DDErrFF         EQU     $9C             ; File not Found 
0000                  (      dosdefs.asm):00456         DDErrFE         EQU     $9E             ; File exists
0000                  (      dosdefs.asm):00457         DDErrNE         EQU     $A0             ; (file does) Not Exist
0000                  (      dosdefs.asm):00458         DDErrTF         EQU     $A2             ; Too many Files open
0000                  (      dosdefs.asm):00459         DDErrPR         EQU     $A4             ; Parameter
0000                  (      dosdefs.asm):00460         DDErrUD         EQU     $A6             ; Undefined
0000                  (      dosdefs.asm):00461         DDErrSFF        EQU     $FF             ; ????
                      (      dosdefs.asm):00462                 endc
     0080             (      dosdefs.asm):00463         DDFirstError    EQU     ErrNR           ; First error code
                      (      dosdefs.asm):00464         
     0012             (      dosdefs.asm):00465         SecTrkSS        EQU     18              ; 18 sectors / track single sided
     0024             (      dosdefs.asm):00466         SecTrkDS        EQU     36              ; 36 sectors / track double sided
                      (      dosdefs.asm):00467         
     0B40             (      dosdefs.asm):00468         MaxLSN          EQU     (SecTrkDS*80)   ; Maximum possible LSN
                      (      dosdefs.asm):00469         
     0800             (      dosdefs.asm):00470         DskInitBuffer   EQU     $0800           ; Address of format disk buffer
     0008             (      dosdefs.asm):00471         SectorsPerBAM   EQU     $08             ; Each BAM entry is for 8 sectors
     005A             (      dosdefs.asm):00472         BAMEntries40SS  EQU     (SectorsPerTrack*40)/SectorsPerBAM      ; Number of BAM entries for a single sided 40 track disk
     00B4             (      dosdefs.asm):00473         BAMEntriesSec   EQU     (MaxLSN/2)/SectorsPerBAM                ; Number of BAM entries per BAM sector
     05A0             (      dosdefs.asm):00474         BAMLSNPerSec    EQU     MaxLSN/2        ; Number of LSNs per BAM sector
                      (      dosdefs.asm):00475         
                      (      dosdefs.asm):00476         ; Offsets within BAM of directory track flags
     002D             (      dosdefs.asm):00477         BAMOffDirPriSS  EQU     (SectorsPerTrack*DirPrimary)/SectorsPerBAM
     0024             (      dosdefs.asm):00478         BAMOffDirBakSS  EQU     (SectorsPerTrack*DirBackup)/SectorsPerBAM
     005A             (      dosdefs.asm):00479         BAMOffDirPriDS  EQU     (SectorsPerTrack*(DirPrimary*2))/SectorsPerBAM
     0048             (      dosdefs.asm):00480         BAMOffDirBakDS  EQU     (SectorsPerTrack*(DirBackup*2))/SectorsPerBAM
                      (      dosdefs.asm):00481         
     0002             (      dosdefs.asm):00482         BAMSecCount     EQU     $02             ; No of BAM Sectors
     0010             (      dosdefs.asm):00483         DIRSecCount     EQU     $10             ; Dir sector count
                      (      dosdefs.asm):00484         
     00FF             (      dosdefs.asm):00485         DosFlagTrue     EQU     $FF             ; flag true / enabled
     0000             (      dosdefs.asm):00486         DosFlagFalse    EQU     $00             ; flag false /disabled
                      (      dosdefs.asm):00487         
     00FF             (      dosdefs.asm):00488         IOInProgress    EQU     DosFlagTrue     ; Flag that DOS IO in progress
     00FF             (      dosdefs.asm):00489         ErrGotoEnabled  EQU     DosFlagTrue     ; Flag that on error goto is enabled
                      (      dosdefs.asm):00490         
     0064             (      dosdefs.asm):00491         AutoStartLine   EQU     100             ; Default start line for AUTO
     000A             (      dosdefs.asm):00492         AutoIncrement   EQU     10              ; Default increment for AUTO
                      (      dosdefs.asm):00493         
                      (      dosdefs.asm):00494         ; DosFRead code shared between file read wrie and verify
                      (      dosdefs.asm):00495         ; DosRWFlag determines the operation to be performed
                      (      dosdefs.asm):00496         
     0000             (      dosdefs.asm):00497         FileOpRead      EQU     $00             ; Reading file
     0001             (      dosdefs.asm):00498         FileOpWrite     EQU     $01             ; Writing file
     00FF             (      dosdefs.asm):00499         FileOpVerify    EQU     $FF             ; verifying written data
                      (      dosdefs.asm):00500         
                      (      dosdefs.asm):00501         ; Extend file stack fram offsets
                      (      dosdefs.asm):00502         
     0000             (      dosdefs.asm):00503         ExtendSecCount  EQU     $00             ; Sector count
                      (      dosdefs.asm):00504         ;ExtendDirEntPtr        EQU     $04             ; Pointer to dir entry with last sector 
                      (      dosdefs.asm):00505         ;ExtendGeomPtr  EQU     $08             ; Pointer to disk geometry buffer
     000A             (      dosdefs.asm):00506         ExtendSecCount2 EQU     $0A             ; Sector count
                      (      dosdefs.asm):00507         
                      (      dosdefs.asm):00508         ;
                      (      dosdefs.asm):00509         ; Offsets within file header, compatible with DragonDos/SuperDos
                      (      dosdefs.asm):00510         ;
     0000             (      dosdefs.asm):00511         HdrID55         EQU     $00             ; magic marker byte #1
     0001             (      dosdefs.asm):00512         HdrType         EQU     $01             ; file type see filetypes below
     0002             (      dosdefs.asm):00513         HdrLoad         EQU     $02             ; Load address of file
     0004             (      dosdefs.asm):00514         HdrLen          EQU     $04             ; length of file
     0006             (      dosdefs.asm):00515         HdrExec         EQU     $06             ; entry address of file
     0008             (      dosdefs.asm):00516         HdrIDAA         EQU     $08             ; magic marker byte #2
                      (      dosdefs.asm):00517         
     0009             (      dosdefs.asm):00518         FileHeadLen     EQU     $09             ; header length in bytes
                      (      dosdefs.asm):00519         
                      (      dosdefs.asm):00520         ; File types
                      (      dosdefs.asm):00521         
     0001             (      dosdefs.asm):00522         FTypeBas        EQU     $01             ; Basic files
     0002             (      dosdefs.asm):00523         FTypeBin        EQU     $02             ; Binary file types
                      (      dosdefs.asm):00524         
                      (      dosdefs.asm):00525         ; Marker bytes
     0055             (      dosdefs.asm):00526         MarkerHeadStart EQU     $55             ; start header marker
     00AA             (      dosdefs.asm):00527         MarkerHeadEnd   EQU     $AA             ; end header marker
                      (      dosdefs.asm):00528         
                      (      dosdefs.asm):00529         ; Device number
     0001             (      dosdefs.asm):00530         DevDisk         EQU     $01             ; disk device
                      (       ddos2f.asm):00009                         use     romdefs.asm
     0000             (      romdefs.asm):00001         DStubResWordsOfs                EQU     $0000           Offset of number of reserved words
     0001             (      romdefs.asm):00002         DStubResLookupOfs               EQU     $0001           Offset of reserved word lookup table
     0003             (      romdefs.asm):00003         DStubResJumpOfs                 EQU     $0003           Offset of reserved word jump table
     0005             (      romdefs.asm):00004         DStubFuncsOfs                   EQU     $0005           Offset of nummber of functions
     0006             (      romdefs.asm):00005         DStubFuncsLookupOfs             EQU     $0006           Offset of function lookup table
     0008             (      romdefs.asm):00006         DStubFuncsJumpOfs               EQU     $0008           Offset of functions jump table
                      (      romdefs.asm):00007         
     0021             (      romdefs.asm):00008         DSkip1                          EQU     $0021           Skip 1 byte (BRN)
     008C             (      romdefs.asm):00009         DSkip2                          EQU     $008C           Skip 2 bytes (CMPX)
     0086             (      romdefs.asm):00010         DSkip1LD                        EQU     $0086           Skip 1 byte (LDA)
     007D             (      romdefs.asm):00011         DSkip2TST                       EQU     $007D           Skip 2 bytes (TST)
                      (      romdefs.asm):00012         
     0000             (      romdefs.asm):00013         DCoCoVec167                     EQU     $0000           Vector dest for 167 
     0000             (      romdefs.asm):00014         DCoCoVect16A                    EQU     $0000           Vector dest for 16A
     0000             (      romdefs.asm):00015         DCoCoVect176                    EQU     $0000           Vector dest for 176
     0000             (      romdefs.asm):00016         DCoCoVect179                    EQU     $0000           Vector dest for 179
     0000             (      romdefs.asm):00017         DCoCoVect18B                    EQU     $0000           Vector dest for 18B
     0000             (      romdefs.asm):00018         DCoCoVect191                    EQU     $0000           Vector dest for 191
     0000             (      romdefs.asm):00019         DCoCoVect194                    EQU     $0000           Vector Dest for 194
     0000             (      romdefs.asm):00020         DCoCoVect197                    EQU     $0000           Vector Dest for 197
     0000             (      romdefs.asm):00021         DCoCoVect19A                    EQU     $0000           Vector Dest for 19A
     0000             (      romdefs.asm):00022         DCoCoVect1A3                    EQU     $0000           Vector Dest for 1A3
     0027             (      romdefs.asm):00023         DAddrFWareRamTop                EQU     $0027           Top of firmware RAM CLEAR xxx,yyyy set this to yyyy
     0074             (      romdefs.asm):00024         DAddrRamTop                     EQU     $0074           Physical end of RAM (4K, 16K, 32K or 64K).
     0021             (      romdefs.asm):00025         DAddrStack                      EQU     $0021           Address of top of machine stack
     0123             (      romdefs.asm):00026         DBasAddrCmdDisp                 EQU     $0123           Address of basic command dispatch
     0121             (      romdefs.asm):00027         DBasAddrCmdList                 EQU     $0121           Address of basic command list
     012D             (      romdefs.asm):00028         DBasAddrDskCmdDisp              EQU     $012D           Address of disk basic command dispatch
     012B             (      romdefs.asm):00029         DBasAddrDskCmdList              EQU     $012B           Address of disk basic command list
     0132             (      romdefs.asm):00030         DBasAddrDskFuncDisp             EQU     $0132           Address of disk basic function dispatcher
     0130             (      romdefs.asm):00031         DBasAddrDskFuncList             EQU     $0130           Address of disk basic function list
     0128             (      romdefs.asm):00032         DBasAddrFuncDisp                EQU     $0128           Address of basic function dispatcher
     0126             (      romdefs.asm):00033         DBasAddrFuncList                EQU     $0126           Address of basic function list
     00A6             (      romdefs.asm):00034         DBasAddrSigByte                 EQU     $00A6           Address of current significant bit in command line
     B84E             (      romdefs.asm):00035         DBasAOError                     EQU     $B84E           Print ?AO Error and return to basic
     0005             (      romdefs.asm):00036         DBasArrayEval                   EQU     $0005           Array evaluation flag, 0=eval, 1=dimensioning
     B400             (      romdefs.asm):00037         DBasBootBasic                   EQU     $B400           Restart basic, as if power on, also deletes current program
     0017             (      romdefs.asm):00038         DBasBotStack                    EQU     $0017           Bottom of stack at last check
     84DA             (      romdefs.asm):00039         DBasBRARun                      EQU     $84DA           BRA to main loop, used by DOS
     0000             (      romdefs.asm):00040         DBasBreakFlag                   EQU     $0000           Break flag, +ve=stop,-ve=end
     03D7             (      romdefs.asm):00041         DBasBuffer                      EQU     $03D7           Basic buffer space
     831C             (      romdefs.asm):00042         DBasChkArrSpaceMv               EQU     $831C           Check memory space at top of arrays + move arrays
     8331             (      romdefs.asm):00043         DBasChkB2Free                   EQU     $8331           Check B*2 bytes free above Arrays, OM error if not
     9C76             (      romdefs.asm):00044         DBasChkDirect                   EQU     $9C76           Check for direct mode, ID Error if so
     009F             (      romdefs.asm):00045         DBasChrGet                      EQU     $009F           Get next basic character routine
     00A5             (      romdefs.asm):00046         DBasChrGetCurr                  EQU     $00A5           Get current basic ccharacter
     00D3             (      romdefs.asm):00047         DBasCloadMOffs                  EQU     $00D3           2s complement of CLOADM offset
     8371             (      romdefs.asm):00048         DBasCmdMode                     EQU     $8371           Return to command mode
     0029             (      romdefs.asm):00049         DBasContLine                    EQU     $0029           Line no used by CONT
     0068             (      romdefs.asm):00050         DBasCurrentLine                 EQU     $0068           Current line no $FFFF in direct mode
     0001             (      romdefs.asm):00051         DBasDelim1                      EQU     $0001           First string delimiter
     0002             (      romdefs.asm):00052         DBasDelim2                      EQU     $0002           Second string delimiter
     002F             (      romdefs.asm):00053         DBasDirectTextPtr               EQU     $002F           Direct mode text pointer
     0008             (      romdefs.asm):00054         DBasDisArraySearch              EQU     $0008           Disable array search flag, 0=allow 0<>disable
     B851             (      romdefs.asm):00055         DBasDNError                     EQU     $B851           Print ?DN Error and return to basic
     84ED             (      romdefs.asm):00056         DBasDoDispatch                  EQU     $84ED           Do command dispatech, X must point to dispatch table
     00D7             (      romdefs.asm):00057         DBasEditorLineLen               EQU     $00D7           Editor line length
     82A9             (      romdefs.asm):00058         DBasErrorCodeTable              EQU     $82A9           List of 2 byte error codes eg 'SN' 'OM' 'UL' etc
     009D             (      romdefs.asm):00059         DBasExecAddr                    EQU     $009D           Exec address, on D64, at startup points to routine to boot all ram mode
     8B8D             (      romdefs.asm):00060         DBasFCError                     EQU     $8B8D           Print ?FC Error and return to basic
     83FF             (      romdefs.asm):00061         DBasFindLineNo                  EQU     $83FF           Find a line number in basic program
     B848             (      romdefs.asm):00062         DBasFMError                     EQU     $B848           Print ?FM Error and return to basic
     0007             (      romdefs.asm):00063         DBasGarbageFlag                 EQU     $0007           Garbage collection flag
     0003             (      romdefs.asm):00064         DBasGenCount                    EQU     $0003           General count/scratch var
     B7D4             (      romdefs.asm):00065         DBasGetDevNo                    EQU     $B7D4           Get dev no from line & validate
     869A             (      romdefs.asm):00066         DBasGetLineNo                   EQU     $869A           Get line no and store in BasTempLine
     8DEA             (      romdefs.asm):00067         DBasGetStrFirst                 EQU     $8DEA           Get first character of string into B
     8D9A             (      romdefs.asm):00068         DBasGetStrLenAddr               EQU     $8D9A           Get string len in B and address in X of string desc in FPA2
     8027             (      romdefs.asm):00069         DBasicCassBitIn                 EQU     $8027           Cassette bit input
     8024             (      romdefs.asm):00070         DBasicCassByIn                  EQU     $8024           Cassette byte input
     801E             (      romdefs.asm):00071         DBasicCassByOut                 EQU     $801E           Cassette byte output
     8018             (      romdefs.asm):00072         DBasicCassOff                   EQU     $8018           Cassette player motor off
     8015             (      romdefs.asm):00073         DBasicCassOn                    EQU     $8015           Cassette player motor on
     8021             (      romdefs.asm):00074         DBasicCassOnRd                  EQU     $8021           Cassette on for reading
     8009             (      romdefs.asm):00075         DBasicCursorB                   EQU     $8009           Cursor blink
     8000             (      romdefs.asm):00076         DBasicHWInit                    EQU     $8000           Hardware initialisation
     8012             (      romdefs.asm):00077         DBasicJoyIn                     EQU     $8012           Joystick input
     8006             (      romdefs.asm):00078         DBasicKbdIn                     EQU     $8006           Keyboard input
     800F             (      romdefs.asm):00079         DBasicPrintOut                  EQU     $800F           Printer output
     800C             (      romdefs.asm):00080         DBasicScreenOut                 EQU     $800C           Screen output
     802A             (      romdefs.asm):00081         DBasicSerIn                     EQU     $802A           Read a byte from serial
     802D             (      romdefs.asm):00082         DBasicSerOut                    EQU     $802D           Write a byte to serial port
     8030             (      romdefs.asm):00083         DBasicSetBaud                   EQU     $8030           Set baud rate
     8003             (      romdefs.asm):00084         DBasicSWInit                    EQU     $8003           Software initialisation
     801B             (      romdefs.asm):00085         DBasicWriteLead                 EQU     $801B           Cassette write leader
     9C7C             (      romdefs.asm):00086         DBasIDError                     EQU     $9C7C           Print ?ID Error and return to basic
     0004             (      romdefs.asm):00087         DBasIfCount                     EQU     $0004           If count - how many in a line
     B5D3             (      romdefs.asm):00088         DBasInBuffFromX                 EQU     $B5D3           Read input buffer at X as basic input
     0009             (      romdefs.asm):00089         DBasInputFlag                   EQU     $0009           Iinput/read flag, 0=input 0<>read
     B84B             (      romdefs.asm):00090         DBasIOError                     EQU     $B84B           Print ?IO Error and return to basic
     9D3D             (      romdefs.asm):00091         DBasIRQVec                      EQU     $9D3D           Basic IRQ routine, increments timer
     015A             (      romdefs.asm):00092         DBasJoyVal0                     EQU     $015A           Joystick(0) value
     015B             (      romdefs.asm):00093         DBasJoyVal1                     EQU     $015B           Joystick(1) value
     015C             (      romdefs.asm):00094         DBasJoyVal2                     EQU     $015C           Joystick(2) value
     015D             (      romdefs.asm):00095         DBasJoyVal3                     EQU     $015D           Joystick(3) value
     9DD9             (      romdefs.asm):00096         DBasLineInputEntry              EQU     $9DD9           Entry into LINE INPUT routine, used by DOS
     02DC             (      romdefs.asm):00097         DBasLinInpBuff                  EQU     $02DC           Basic line input buffer
     02DA             (      romdefs.asm):00098         DBasLinInpHead                  EQU     $02DA           Basic line input buffer header
     8EAA             (      romdefs.asm):00099         DBasList                        EQU     $8EAA           List basic program to SysDevN A must be 0 on entry
     0066             (      romdefs.asm):00100         DBasListLine                    EQU     $0066           Current line during list
     AA87             (      romdefs.asm):00101         DBasLocateScreen                EQU     $AA87           Initialise beginning of basic after graphics screen, no of pages in A
     8D6B             (      romdefs.asm):00102         DBasLSError                     EQU     $8D6B           Print ?LS Error and return to basic
     A101             (      romdefs.asm):00103         DBasNEError                     EQU     $A101           Print ?NE Error and return to basic
     8417             (      romdefs.asm):00104         DBasNew                         EQU     $8417           Remove current basic program from meory, like NEW command
     B631             (      romdefs.asm):00105         DBasNOError                     EQU     $B631           Print ?NO Error and return to basic
     0120             (      romdefs.asm):00106         DBasNumCmds                     EQU     $0120           Number of basic commands
     012A             (      romdefs.asm):00107         DBasNumDskCmds                  EQU     $012A           Number of disk basic commands
     012F             (      romdefs.asm):00108         DBasNumDskFuncs                 EQU     $012F           Number of disk basic functions
     0125             (      romdefs.asm):00109         DBasNumFuncs                    EQU     $0125           Number of basic functions
     002D             (      romdefs.asm):00110         DBasOldInputPtr                 EQU     $002D           Pointer to saved input during a STOP
     8342             (      romdefs.asm):00111         DBasOMError                     EQU     $8342           Print ?OM Error and return to basic
     91DB             (      romdefs.asm):00112         DBasOVError                     EQU     $91DB           Print ?OV Error and return to basic
     851B             (      romdefs.asm):00113         DBasPollKeyboard                EQU     $851B           Basic, poll keyboard and check for break
     978E             (      romdefs.asm):00114         DBasRandom8                     EQU     $978E           Generate an 8 bit random number and place in BasRandomSeed+1
     0115             (      romdefs.asm):00115         DBasRandomSeed                  EQU     $0115           Random number seed for RND function
     000A             (      romdefs.asm):00116         DBasRelateFlag                  EQU     $000A           Relational operator flag
     00D1             (      romdefs.asm):00117         DBasRenumStart                  EQU     $00D1           Renum start line no
     00D5             (      romdefs.asm):00118         DBasRenumStartLine              EQU     $00D5           Renum start line number
     00CF             (      romdefs.asm):00119         DBasRenumVal                    EQU     $00CF           Renum increment value
     8434             (      romdefs.asm):00120         DBasResetStack                  EQU     $8434           Reset basic stack to initial position
     8C52             (      romdefs.asm):00121         DBasResStr                      EQU     $8C52           Reserve B bytes of string space return start in X, setup low mem vars
     8CB3             (      romdefs.asm):00122         DBasResStr2                     EQU     $8CB3           Reserve B bytes of string space return start in X
     00AB             (      romdefs.asm):00123         DBasRndData                     EQU     $00AB           Used by RND
     849F             (      romdefs.asm):00124         DBasRun                         EQU     $849F           Run basic program in memory, like RUN
     85EE             (      romdefs.asm):00125         DBasSetProgPtrX                 EQU     $85EE           Sets basic program pointer to X-1
     B4B2             (      romdefs.asm):00126         DBasSignonMess                  EQU     $B4B2           Signon message address, for CoCo this is for Extended basic.
     85E7             (      romdefs.asm):00127         DBasSkipLineNo                  EQU     $85E7           Skip past line no in basic line, UL error if no line no.
     89B4             (      romdefs.asm):00128         DBasSNError                     EQU     $89B4           Print ?SN Error and return to basic
     0019             (      romdefs.asm):00129         DBasStartProg                   EQU     $0019           Start addr of basic program
     8C99             (      romdefs.asm):00130         DBasSTError                     EQU     $8C99           Print ?OM Error and return to basic
     01A9             (      romdefs.asm):00131         DBasStrDescStack                EQU     $01A9           String descriptor stack
     000B             (      romdefs.asm):00132         DBasStrFirstFreeTemp            EQU     $000B           First free temory string space pointer
     000D             (      romdefs.asm):00133         DBasStrLastUsedTemp             EQU     $000D           Last used tempory string space pointer
     0025             (      romdefs.asm):00134         DBasStrUtil                     EQU     $0025           Utility string pointer
     0120             (      romdefs.asm):00135         DBasStub0                       EQU     $0120           Basic Stub 0 (All basic on Dragon, Colour basic on Tandy)
     012A             (      romdefs.asm):00136         DBasStub1                       EQU     $012A           Basic stub 1 (Disk basic on Dragon, Extended basic on Tandy)
     0134             (      romdefs.asm):00137         DBasStub2                       EQU     $0134           Basic Stub 2 (Null on dragon, Disk basic on Tandy)
     013E             (      romdefs.asm):00138         DBasStub3                       EQU     $013E           Basic Stub 3 (do not use on dragon, user stub on Tandy)
     0013             (      romdefs.asm):00139         DBasTempFPA2                    EQU     $0013           Tempory FPA Mantissa for FPA2
     002B             (      romdefs.asm):00140         DBasTempLine                    EQU     $002B           Tempory line no
     000F             (      romdefs.asm):00141         DBasTempPtr                     EQU     $000F           Tempory pointer
     0011             (      romdefs.asm):00142         DBasTempPtr1                    EQU     $0011           Tempory discriptor pointer (stack search)
     003F             (      romdefs.asm):00143         DBasTempRelateFlag              EQU     $003F           Tempory relational operator flag
     003B             (      romdefs.asm):00144         DBasTempVarDesc                 EQU     $003B           Pointer to a tempory var descriptor
     8882             (      romdefs.asm):00145         DBasTMError                     EQU     $8882           Print ?TM Error and return to basic
     00AF             (      romdefs.asm):00146         DBasTronFlag                    EQU     $00AF           Tron flag nonzero=trace on
     8605             (      romdefs.asm):00147         DBasULError                     EQU     $8605           Print ?UL Error and return to basic
     0076             (      romdefs.asm):00148         DBasUnused1                     EQU     $0076           2 unused bytes
     00B0             (      romdefs.asm):00149         DBasUSRTableAddr                EQU     $00B0           Address of USR address table
     0134             (      romdefs.asm):00150         DBasUsrVecNoDisk                EQU     $0134           USR vector tabl when basic not installed
     001D             (      romdefs.asm):00151         DBasVarArrayAddr                EQU     $001D           Start address of Array table
     0052             (      romdefs.asm):00152         DBasVarAssign16                 EQU     $0052           Part of FPA1, used for 16bit assigns
     0033             (      romdefs.asm):00153         DBasVarDataAddr                 EQU     $0033           Address of next item in data
     0031             (      romdefs.asm):00154         DBasVarDataLine                 EQU     $0031           Line number of current data statement
     001F             (      romdefs.asm):00155         DBasVarEnd                      EQU     $001F           End of storage in use by basic
     004F             (      romdefs.asm):00156         DBasVarFPAcc1                   EQU     $004F           Floating point acumulator 1
     005C             (      romdefs.asm):00157         DBasVarFPAcc2                   EQU     $005C           Floating point acumulator 2
     0040             (      romdefs.asm):00158         DBasVarFPAcc3                   EQU     $0040           Floating point accumulator 3 (packed)
     0045             (      romdefs.asm):00159         DBasVarFPAcc4                   EQU     $0045           Floating point accumulator 4 (packed)
     004A             (      romdefs.asm):00160         DBasVarFPAcc5                   EQU     $004A           Floating point accumulator 5 (packed)
     0037             (      romdefs.asm):00161         DBasVarLastInUse                EQU     $0037           Pointer to variable last in use
     0039             (      romdefs.asm):00162         DBasVarPtrLast                  EQU     $0039           Poiinter to VARPTR last in use
     001B             (      romdefs.asm):00163         DBasVarSimpleAddr               EQU     $001B           Start address of simple variables
     0021             (      romdefs.asm):00164         DBasVarStringBase               EQU     $0021           Base address of string space (and stack)
     0023             (      romdefs.asm):00165         DBasVarStrTop                   EQU     $0023           Top of string space in use
     0006             (      romdefs.asm):00166         DBasVarType                     EQU     $0006           Variable type flag 0=numeric, $ff=string
     841F             (      romdefs.asm):00167         DBasVect1                       EQU     $841F           Sets up various basic vectors (after load), should be followed by call to BasVect2
     8424             (      romdefs.asm):00168         DBasVect1a                      EQU     $8424           Same as Vect1, but doesn't reset input pointer
     83ED             (      romdefs.asm):00169         DBasVect2                       EQU     $83ED           Finalises setup of basic vectors (after load), should be preceeded by call to BasVect1
     93B1             (      romdefs.asm):00170         DBasZDError                     EQU     $93B1           Print ?ZD Error and return to basic
     01E3             (      romdefs.asm):00171         DCasASCIIFlag                   EQU     $01E3           ASCII flag byte
     BAC3             (      romdefs.asm):00172         DCasAudioOff                    EQU     $BAC3           Turn off audio from cassette
     BAEC             (      romdefs.asm):00173         DCasAudioOn                     EQU     $BAEC           Turn on Audio from cassete to speaker
     0083             (      romdefs.asm):00174         DCasBitCount                    EQU     $0083           Cassette bit counter
     BDA5             (      romdefs.asm):00175         DCasBitIn                       EQU     $BDA5           Reads a bity into the 'Z' flag
     B93E             (      romdefs.asm):00176         DCasBlockIn                     EQU     $B93E           Reads a block into the cassete buffer pointed to by CasIOBuffAddr
     007D             (      romdefs.asm):00177         DCasBlockLen                    EQU     $007D           Cassete block length, number of bytes read, or to be written
     B999             (      romdefs.asm):00178         DCasBlockOut                    EQU     $B999           Write a block to cassete pointed to by CasIOBuffAddr
     007C             (      romdefs.asm):00179         DCasBlockType                   EQU     $007C           Cassete block type, 0=filename, 1=data, 255=EOF
     BDAD             (      romdefs.asm):00180         DCasByteIn                      EQU     $BDAD           Reads a single byte into the A register
     BE12             (      romdefs.asm):00181         DCasByteOut                     EQU     $BE12           Write byte in A register to cassete
     0080             (      romdefs.asm):00182         DCasCkSum                       EQU     $0080           Used by cassette routines for calculating checksum
     B65F             (      romdefs.asm):00183         DCasClosFiles                   EQU     $B65F           Close any open cassete file
     01E5             (      romdefs.asm):00184         DCasEntryAddr                   EQU     $01E5           Entry address for MC programs
     0070             (      romdefs.asm):00185         DCasEOFFlag                     EQU     $0070           Cassette IO Flag, nonzero if EOF reached
     B8B3             (      romdefs.asm):00186         DCasFindFile                    EQU     $B8B3           Searches a tape for specified filename
     01D2             (      romdefs.asm):00187         DCasFName                       EQU     $01D2           Cassete filename to search for or write out
     01DA             (      romdefs.asm):00188         DCasFNameFound                  EQU     $01DA           Filename found, when reading
     01D1             (      romdefs.asm):00189         DCasFNameLen                    EQU     $01D1           Length of cassette filename can be 0 to 8
     01E2             (      romdefs.asm):00190         DCasFType                       EQU     $01E2           File type 0=tokenized basic, 1=ASCII data, 2=Binary
     01E4             (      romdefs.asm):00191         DCasGapFlag                     EQU     $01E4           Gap flag byte
     007A             (      romdefs.asm):00192         DCasHeadBuffAddr                EQU     $007A           Address of cassette file header
     01DA             (      romdefs.asm):00193         DCasIOBuff                      EQU     $01DA           COS default IO buffer, if this contains filename block then folloing are valid
     007E             (      romdefs.asm):00194         DCasIOBuffAddr                  EQU     $007E           Cassette IO buffer address, where data will be read/written
     0079             (      romdefs.asm):00195         DCasIOBuffSize                  EQU     $0079           Size of cassette IO buffer
     0081             (      romdefs.asm):00196         DCasIOErrorCode                 EQU     $0081           Cassette IO error code 0=no error, 1=CRC, 2=attempt to load in non-ram area
     006E             (      romdefs.asm):00197         DCasIOFlag                      EQU     $006E           Cassette IO Flag, set to $FF when IO in progress
     0085             (      romdefs.asm):00198         DCasLastSine                    EQU     $0085           Casette last sine tabe entry
     0090             (      romdefs.asm):00199         DCasLeadCount                   EQU     $0090           Cassete leader count, number of $55 bytes in the leader
     01E7             (      romdefs.asm):00200         DCasLoadAddr                    EQU     $01E7           Load address
     0093             (      romdefs.asm):00201         DCasMax12                       EQU     $0093           Cassette Upper limit of 1200Hz
     0094             (      romdefs.asm):00202         DCasMax24                       EQU     $0094           Cassette Upper limit of 2400Hz
     0095             (      romdefs.asm):00203         DCasMotorDelay                  EQU     $0095           Cassette motor on delay (also inter-block gap)
     BDDC             (      romdefs.asm):00204         DCasMotorOff                    EQU     $BDDC           Turn off cassette motor
     BDCF             (      romdefs.asm):00205         DCasMotorOn                     EQU     $BDCF           Turn on motor, and wait for delay in CasMotorDelay
     0092             (      romdefs.asm):00206         DCasPartrt                      EQU     $0092           Cassette 1200/2400 partition
     0084             (      romdefs.asm):00207         DCasPhaseFlag                   EQU     $0084           Cassette Phase flag
     B748             (      romdefs.asm):00208         DCasReadBin                     EQU     $B748           Read in a binary file, similar to CLOADM
     B933             (      romdefs.asm):00209         DCasReadBlock1                  EQU     $B933           Turns on motor, reads header and then first block into CasIOBufAddr
     BDE7             (      romdefs.asm):00210         DCasReadLeader                  EQU     $BDE7           Turn on motor and read past leader
     0078             (      romdefs.asm):00211         DCasStatus                      EQU     $0078           Cassette status byte, 0=cassette closed, 1=open for input, 2=open for output
     0082             (      romdefs.asm):00212         DCasTemp                        EQU     $0082           Cassette tempory storage
     B6A5             (      romdefs.asm):00213         DCasWriteBasic                  EQU     $B6A5           Write tokenized basic program out, similar to CSAVE
     991B             (      romdefs.asm):00214         DCasWriteBin                    EQU     $991B           Write a binary file out push return address, then start,end and entry addresses and then JMP to this
     B991             (      romdefs.asm):00215         DCasWriteBlock1                 EQU     $B991           Turn on motor, write leader and then first block
     801B             (      romdefs.asm):00216         DCasWriteLeader                 EQU     $801B           Turn on motor and write out leader
     943E             (      romdefs.asm):00217         DCmdABS                         EQU     $943E           Basic Command
     8A12             (      romdefs.asm):00218         DCmdAND                         EQU     $8A12           Basic Command
     8DE6             (      romdefs.asm):00219         DCmdASC                         EQU     $8DE6           Basic Command
     9877             (      romdefs.asm):00220         DCmdATN                         EQU     $9877           Basic Command
     BADF             (      romdefs.asm):00221         DCmdAudio                       EQU     $BADF           Basic Command
     8DD2             (      romdefs.asm):00222         DCmdCHRS                        EQU     $8DD2           Basic Command
     B238             (      romdefs.asm):00223         DCmdCircle                      EQU     $B238           Basic Command
     8571             (      romdefs.asm):00224         DCmdClear                       EQU     $8571           Basic Command
     B6D5             (      romdefs.asm):00225         DCmdCload                       EQU     $B6D5           Basic Command
     B64D             (      romdefs.asm):00226         DCmdClose                       EQU     $B64D           Basic Command
     BA60             (      romdefs.asm):00227         DCmdCLS                         EQU     $BA60           Basic Command
     A8D4             (      romdefs.asm):00228         DCmdColor                       EQU     $A8D4           Basic Command
     8560             (      romdefs.asm):00229         DCmdCont                        EQU     $8560           Basic Command
     97CB             (      romdefs.asm):00230         DCmdCOS                         EQU     $97CB           Basic Command
     B683             (      romdefs.asm):00231         DCmdCsave                       EQU     $B683           Basic Command
     8613             (      romdefs.asm):00232         DCmdData                        EQU     $8613           Basic Command
     9C81             (      romdefs.asm):00233         DCmdDef                         EQU     $9C81           Basic Command
     9D61             (      romdefs.asm):00234         DCmdDelete                      EQU     $9D61           Basic Command
     8A8B             (      romdefs.asm):00235         DCmdDim                         EQU     $8A8B           Basic Command
     933C             (      romdefs.asm):00236         DCmdDivide                      EQU     $933C           Basic Command
     A049             (      romdefs.asm):00237         DCmdDload                       EQU     $A049           Basic Command
     B051             (      romdefs.asm):00238         DCmdDraw                        EQU     $B051           Basic Command
     9965             (      romdefs.asm):00239         DCmdEdit                        EQU     $9965           Basic Command
     8532             (      romdefs.asm):00240         DCmdEnd                         EQU     $8532           Basic Command
     B801             (      romdefs.asm):00241         DCmdEOF                         EQU     $B801           Basic Command
     B771             (      romdefs.asm):00242         DCmdExec                        EQU     $B771           Basic Command
     9713             (      romdefs.asm):00243         DCmdEXP                         EQU     $9713           Basic Command
     96A0             (      romdefs.asm):00244         DCmdExponet                     EQU     $96A0           Basic Command
     9956             (      romdefs.asm):00245         DCmdFIX                         EQU     $9956           Basic Command
     8448             (      romdefs.asm):00246         DCmdFor                         EQU     $8448           Basic Command
     AAF0             (      romdefs.asm):00247         DCmdGet                         EQU     $AAF0           Basic Command
     85B9             (      romdefs.asm):00248         DCmdGo                          EQU     $85B9           Basic Command
     A00E             (      romdefs.asm):00249         DCmdHexS                        EQU     $A00E           Basic Command
     8647             (      romdefs.asm):00250         DCmdIF                          EQU     $8647           Basic Command
     B797             (      romdefs.asm):00251         DCmdInkeyS                      EQU     $B797           Basic Command
     872B             (      romdefs.asm):00252         DCmdInput                       EQU     $872B           Basic Command
     9BB4             (      romdefs.asm):00253         DCmdInstr                       EQU     $9BB4           Basic Command
     9499             (      romdefs.asm):00254         DCmdINT                         EQU     $9499           Basic Command
     BB0D             (      romdefs.asm):00255         DCmdJoystk                      EQU     $BB0D           Basic Command
     8DF1             (      romdefs.asm):00256         DCmdLeftS                       EQU     $8DF1           Basic Command
     8DC7             (      romdefs.asm):00257         DCmdLEN                         EQU     $8DC7           Basic Command
     86BC             (      romdefs.asm):00258         DCmdLet                         EQU     $86BC           Basic Command
     A749             (      romdefs.asm):00259         DCmdLine                        EQU     $A749           Basic Command
     9DB1             (      romdefs.asm):00260         DCmdLineInput                   EQU     $9DB1           Line input command
     8EAA             (      romdefs.asm):00261         DCmdList                        EQU     $8EAA           Basic Command
     8EA4             (      romdefs.asm):00262         DCmdLList                       EQU     $8EA4           Basic Command
     923C             (      romdefs.asm):00263         DCmdLOG                         EQU     $923C           Basic Command
     8C31             (      romdefs.asm):00264         DCmdMEM                         EQU     $8C31           Basic Command
     8E15             (      romdefs.asm):00265         DCmdMidS                        EQU     $8E15           Basic Command
     9105             (      romdefs.asm):00266         DCmdMinus                       EQU     $9105           Basic Command
     B982             (      romdefs.asm):00267         DCmdMotor                       EQU     $B982           Basic Command
     9275             (      romdefs.asm):00268         DCmdMultiply                    EQU     $9275           Basic Command
     8415             (      romdefs.asm):00269         DCmdNew                         EQU     $8415           Basic Command
     8829             (      romdefs.asm):00270         DCmdNext                        EQU     $8829           Basic Command
     8675             (      romdefs.asm):00271         DCmdON                          EQU     $8675           Basic Command
     B829             (      romdefs.asm):00272         DCmdOpen                        EQU     $B829           Basic Command
     B835             (      romdefs.asm):00273         DCmdOpenEntry                   EQU     $B835           Entry into Basic open command used by Dragon/SuperDos
     8A11             (      romdefs.asm):00274         DCmdOR                          EQU     $8A11           Basic Command
     AC87             (      romdefs.asm):00275         DCmdPaint                       EQU     $AC87           Basic Command
     AA19             (      romdefs.asm):00276         DCmdPClear                      EQU     $AA19           Basic Command
     A8C0             (      romdefs.asm):00277         DCmdPCls                        EQU     $A8C0           Basic Command
     AABE             (      romdefs.asm):00278         DCmdPcopy                       EQU     $AABE           Basic Command
     8E96             (      romdefs.asm):00279         DCmdPeek                        EQU     $8E96           Basic Command
     ADBD             (      romdefs.asm):00280         DCmdPlay                        EQU     $ADBD           Basic Command
     910E             (      romdefs.asm):00281         DCmdPlus                        EQU     $910E           Basic Command
     A9AF             (      romdefs.asm):00282         DCmdPmode                       EQU     $A9AF           Basic Command
     BA45             (      romdefs.asm):00283         DCmdPoint                       EQU     $BA45           Basic Command
     8E9D             (      romdefs.asm):00284         DCmdPoke                        EQU     $8E9D           Basic Command
     9ADE             (      romdefs.asm):00285         DCmdPOS                         EQU     $9ADE           Basic Command
     A6C7             (      romdefs.asm):00286         DCmdPPoint                      EQU     $A6C7           Basic Command
     A6F3             (      romdefs.asm):00287         DCmdPReset                      EQU     $A6F3           Basic Command
     903D             (      romdefs.asm):00288         DCmdPrint                       EQU     $903D           Basic Command
     A6EF             (      romdefs.asm):00289         DCmdPset                        EQU     $A6EF           Basic Command
     AAF3             (      romdefs.asm):00290         DCmdPut                         EQU     $AAF3           Basic Command
     8777             (      romdefs.asm):00291         DCmdRead                        EQU     $8777           Basic Command
     877A             (      romdefs.asm):00292         DCmdReadFromX                   EQU     $877A           As basic READ command but ptr in X supplied by caller
     8616             (      romdefs.asm):00293         DCmdREM                         EQU     $8616           Basic Command
     9DFA             (      romdefs.asm):00294         DCmdRenum                       EQU     $9DFA           Basic Command
     BA04             (      romdefs.asm):00295         DCmdReset                       EQU     $BA04           Basic Command
     8514             (      romdefs.asm):00296         DCmdRestore                     EQU     $8514           Basic Command
     85F3             (      romdefs.asm):00297         DCmdReturn                      EQU     $85F3           Basic Command
     8E0E             (      romdefs.asm):00298         DCmdRightS                      EQU     $8E0E           Basic Command
     9772             (      romdefs.asm):00299         DCmdRND                         EQU     $9772           Basic Command
     85A5             (      romdefs.asm):00300         DCmdRun                         EQU     $85A5           Basic Command
     A9FE             (      romdefs.asm):00301         DCmdScreen                      EQU     $A9FE           Basic Command
     B9D3             (      romdefs.asm):00302         DCmdSet                         EQU     $B9D3           Basic Command
     9425             (      romdefs.asm):00303         DCmdSGN                         EQU     $9425           Basic Command
     97D1             (      romdefs.asm):00304         DCmdSIN                         EQU     $97D1           Basic Command
     B81F             (      romdefs.asm):00305         DCmdSkipf                       EQU     $B81F           Basic Command
     BA9B             (      romdefs.asm):00306         DCmdSound                       EQU     $BA9B           Basic Command
     9697             (      romdefs.asm):00307         DCmdSQR                         EQU     $9697           Basic Command
     8539             (      romdefs.asm):00308         DCmdStop                        EQU     $8539           Basic Command
     9B84             (      romdefs.asm):00309         DCmdStringS                     EQU     $9B84           Basic Command
     8C40             (      romdefs.asm):00310         DCmdSTRS                        EQU     $8C40           Basic Command
     9816             (      romdefs.asm):00311         DCmdTAN                         EQU     $9816           Basic Command
     9D59             (      romdefs.asm):00312         DCmdTimer                       EQU     $9D59           Basic Command
     9ADA             (      romdefs.asm):00313         DCmdTroff                       EQU     $9ADA           Basic Command
     9AD9             (      romdefs.asm):00314         DCmdTron                        EQU     $9AD9           Basic Command
     9D1D             (      romdefs.asm):00315         DCmdUSR                         EQU     $9D1D           Basic Command
     8E5C             (      romdefs.asm):00316         DCmdVAL                         EQU     $8E5C           Basic Command
     9AF4             (      romdefs.asm):00317         DCmdVarptr                      EQU     $9AF4           Basic Command
     00B3             (      romdefs.asm):00318         DGrBackground                   EQU     $00B3           Current background colour
     00B9             (      romdefs.asm):00319         DGrBytesPerLine                 EQU     $00B9           Number of byts/lin in current mode
     BA28             (      romdefs.asm):00320         DGrCalcPixelPos                 EQU     $BA28           Calculates Lo-res pixel pos from data on stack
     00D0             (      romdefs.asm):00321         DGrCircleRadius                 EQU     $00D0           Circle radius
     00CB             (      romdefs.asm):00322         DGrCircleXCo                    EQU     $00CB           Circle command X
     00CD             (      romdefs.asm):00323         DGrCircleYCo                    EQU     $00CD           Circle command Y
     A8C7             (      romdefs.asm):00324         DGrClearGrScreen                EQU     $A8C7           Clears grapics screen to value in B
     00C1             (      romdefs.asm):00325         DGrColourSet                    EQU     $00C1           Colour set currently in use
     00B4             (      romdefs.asm):00326         DGrColourTemp                   EQU     $00B4           Tempory colour in use
     00B5             (      romdefs.asm):00327         DGrCurrColour                   EQU     $00B5           Byte value for current colour, to set all pixels in byte to that colour
     00B6             (      romdefs.asm):00328         DGrCurrPmode                    EQU     $00B6           Current PMODE number
     00BD             (      romdefs.asm):00329         DGrCurrX                        EQU     $00BD           Current X cursor pos
     00C7             (      romdefs.asm):00330         DGrCurrXCo                      EQU     $00C7           Current Cursor X
     00BF             (      romdefs.asm):00331         DGrCurrY                        EQU     $00BF           Current Y cursor pos
     00C9             (      romdefs.asm):00332         DGrCurrYCo                      EQU     $00C9           Current Cursor Y
     00DB             (      romdefs.asm):00333         DGrDirtyFlag                    EQU     $00DB           Flag to tell if graphics screen has changed
     00BA             (      romdefs.asm):00334         DGrDisplayStartAddr             EQU     $00BA           Address of first byte in current display
     B051             (      romdefs.asm):00335         DGrDraw                         EQU     $B051           Draw on pmode screen as in DRAW command
     00E8             (      romdefs.asm):00336         DGrDrawAngle                    EQU     $00E8           Current angle for DRAW command
     00E9             (      romdefs.asm):00337         DGrDrawScale                    EQU     $00E9           Current scale for DRAW command
     00B2             (      romdefs.asm):00338         DGrForeground                   EQU     $00B2           Current foreground colour
     00B7             (      romdefs.asm):00339         DGrLastDisplayAddr              EQU     $00B7           Address of last byte in current display
     00C3             (      romdefs.asm):00340         DGrPixelNoX                     EQU     $00C3           Current horizontal pixel no
     00C5             (      romdefs.asm):00341         DGrPixelNoY                     EQU     $00C5           Current vertical pixel number
     00C2             (      romdefs.asm):00342         DGrPlotFlag                     EQU     $00C2           Plot/Unplot flag, 0=reset, nonzero=set
     AA23             (      romdefs.asm):00343         DGrReserveGrRam                 EQU     $AA23           Reserves memory for graphics, no graphics pages in B
     BA07             (      romdefs.asm):00344         DGrResetLRGPixel                EQU     $BA07           ReSets lo res pixel
     AA10             (      romdefs.asm):00345         DGrSelectColourSet              EQU     $AA10           Selects colour set dependent on B
     A938             (      romdefs.asm):00346         DGrSelectDisplay                EQU     $A938           Sets Text or Graphics screen, if Z=1 then text
     A9E1             (      romdefs.asm):00347         DGrSelectPage                   EQU     $A9E1           On entry B contains Pmode page to be used
     A9A4             (      romdefs.asm):00348         DGrSelectVDGColSet              EQU     $A9A4           Select colour set from data in GrColourSet
     A928             (      romdefs.asm):00349         DGrSetColours                   EQU     $A928           Sets up colours in low memory
     B9DF             (      romdefs.asm):00350         DGrSetLRGPixel                  EQU     $B9DF           Sets lo res pixel
     0086             (      romdefs.asm):00351         DGrSetResetData                 EQU     $0086           Data for Lo-res set/reset
     A989             (      romdefs.asm):00352         DGrSetVDGMode                   EQU     $A989           Set VDG to mode in A register
     A99D             (      romdefs.asm):00353         DGrSetVDGOffset                 EQU     $A99D           Set VDG offset to page in A
     00BC             (      romdefs.asm):00354         DGrStartPages                   EQU     $00BC           Page number of Start of graphics pages
     A006             (      romdefs.asm):00355         DIndCasBlockIn                  EQU     $A006           Indirect Read cassette block
     A008             (      romdefs.asm):00356         DIndCasBlockOut                 EQU     $A008           Indirect Write cassete block
     A004             (      romdefs.asm):00357         DIndCasOnRead                   EQU     $A004           Indirect prepare cassette for read
     A00C             (      romdefs.asm):00358         DIndCasWriteLead                EQU     $A00C           Indirect Write cassette leader
     A002             (      romdefs.asm):00359         DIndCharOutput                  EQU     $A002           Indirect Character output
     A00A             (      romdefs.asm):00360         DIndJoystickIn                  EQU     $A00A           Indirect joystick in
     A000             (      romdefs.asm):00361         DIndKeyInput                    EQU     $A000           Indirect keyboard input jsr()
     0072             (      romdefs.asm):00362         DIndVecReset                    EQU     $0072           Secondary Reset vector address, must point to NOP
     008A             (      romdefs.asm):00363         DMisc16BitScratch               EQU     $008A           Misc 16 bit scratch register (always zero ??)
     A66B             (      romdefs.asm):00364         DPixMaskTable2Col               EQU     $A66B           Pixel mask table 2 colour mode
     A673             (      romdefs.asm):00365         DPixMaskTable4Col               EQU     $A673           Pixel mask table 4 colour mode
     BD0A             (      romdefs.asm):00366         DPrinterCRLF                    EQU     $BD0A           Moves printer head to next line.
     BCF5             (      romdefs.asm):00367         DPrinterDirOut                  EQU     $BCF5           Sends character in A register to printer (uncooked)
     BD1A             (      romdefs.asm):00368         DPrinterOut                     EQU     $BD1A           Sends character in A register to printer
     010F             (      romdefs.asm):00369         DSecVecFIRQ                     EQU     $010F           Secondary FIRQ vector JMP+ address
     010C             (      romdefs.asm):00370         DSecVecIRQ                      EQU     $010C           Secondary IRQ vector JMP+ address
     0109             (      romdefs.asm):00371         DSecVecNMI                      EQU     $0109           Secondary NMI vector JMP+ address
     0106             (      romdefs.asm):00372         DSecVecSWI                      EQU     $0106           Secondary NMI vector JMP+ address
     0103             (      romdefs.asm):00373         DSecVecSWI2                     EQU     $0103           Secondary SWI2 vector JMP+ address
     0100             (      romdefs.asm):00374         DSecVecSWI3                     EQU     $0100           Secondary SWI3 vector JMP+ address
     0000             (      romdefs.asm):00375         DSerDLBaud                      EQU     $0000           Baud rate for DLOAD, unknown for Dragon
     0000             (      romdefs.asm):00376         DSerDLTimeout                   EQU     $0000           Timeourt for DLOAD, unknown for Dragon
     BAA0             (      romdefs.asm):00377         DSndBeep                        EQU     $BAA0           Play a beep duration in B, frequency in SndPitch
     BAC3             (      romdefs.asm):00378         DSndDisable                     EQU     $BAC3           Disables D/A sound output
     00E5             (      romdefs.asm):00379         DSndDotNoteScale                EQU     $00E5           Dotted note scale factor for Play
     BAED             (      romdefs.asm):00380         DSndDTOAOn                      EQU     $BAED           Turn on audio to D/A converter
     BAC5             (      romdefs.asm):00381         DSndEnable                      EQU     $BAC5           Enables D/A sound output
     008D             (      romdefs.asm):00382         DSndLength                      EQU     $008D           Sound duration
     00E1             (      romdefs.asm):00383         DSndNoteLen                     EQU     $00E1           Note length for PLAY
     00DE             (      romdefs.asm):00384         DSndOctave                      EQU     $00DE           Sound octave value for PLAY
     008C             (      romdefs.asm):00385         DSndPitch                       EQU     $008C           Sound pitch value
     AE9A             (      romdefs.asm):00386         DSndPlayNote                    EQU     $AE9A           Plays a note from the A register (ASCII)
     00E2             (      romdefs.asm):00387         DSndTempo                       EQU     $00E2           Tempo for PLAY
     00E3             (      romdefs.asm):00388         DSndTimerPlay                   EQU     $00E3           Timer for the Play command
     00DF             (      romdefs.asm):00389         DSndVolume                      EQU     $00DF           Sound volume for PLAY
     BB80             (      romdefs.asm):00390         DSysBoot64                      EQU     $BB80           Dragon 64 only, boots basic into all ram mode, with 48K available to basic.
     8344             (      romdefs.asm):00391         DSysErr                         EQU     $8344           Report error code in B register, cleanup and return to basic
     835E             (      romdefs.asm):00392         DSysErr2                        EQU     $835E           Report error in B, do NOT hook to RAM, or turn of cas etc
     BD52             (      romdefs.asm):00393         DSysReadJoystick                EQU     $BD52           Read hardware joystick values & update BasJoyVal0..3
     B3B4             (      romdefs.asm):00394         DSysReset                       EQU     $B3B4           Perform soft reset, as if reset button pressed
     BAD4             (      romdefs.asm):00395         DSysResetDA                     EQU     $BAD4           Reset D/A converter to $7E
     BD41             (      romdefs.asm):00396         DSysSelJoystick                 EQU     $BD41           Select joystick alue to read from A
     0112             (      romdefs.asm):00397         DSysTimeVal                     EQU     $0112           Current value of system timer
     BAD6             (      romdefs.asm):00398         DSysWriteDA                     EQU     $BAD6           Write value in A to D/A, bits 0 &1 should be 0
     0149             (      romdefs.asm):00399         DTextCapsLock                   EQU     $0149           Capslock flag, nonzero=uppercase
     BCA0             (      romdefs.asm):00400         DTextClearLine                  EQU     $BCA0           Clears a VDU line from current cursor pos to EOL
     BA77             (      romdefs.asm):00401         DTextCls                        EQU     $BA77           Clear text mode screen, resets cursor to top left
     BA79             (      romdefs.asm):00402         DTextClsChar                    EQU     $BA79           Clears srcrren to character in B register & resets cursor
     008F             (      romdefs.asm):00403         DTextCursFalshCnt               EQU     $008F           Cusrsor flash counter
     006F             (      romdefs.asm):00404         DTextDevN                       EQU     $006F           Current device number
     0035             (      romdefs.asm):00405         DTextKbdBuffAddr                EQU     $0035           Address of keyboard input buffer
     0097             (      romdefs.asm):00406         DTextKbdDelay                   EQU     $0097           Keyboard scan delay constant, used to debounce
     0150             (      romdefs.asm):00407         DTextKbdRollover                EQU     $0150           Rollover table, to check for key releases
     0087             (      romdefs.asm):00408         DTextLastKey                    EQU     $0087           ASCII code of last keypress, not cleard by key release
     B54A             (      romdefs.asm):00409         DTextOutChar                    EQU     $B54A           Outputs character in A to screen
     90A1             (      romdefs.asm):00410         DTextOutCRLF                    EQU     $90A1           Outputs an EOL sequence to the screen
     957A             (      romdefs.asm):00411         DTextOutNum16                   EQU     $957A           Outputs unsigned integer in D to the TextDevN device
     9582             (      romdefs.asm):00412         DTextOutNumFPA0                 EQU     $9582           Outputs number in FPA0 to screen
     90F8             (      romdefs.asm):00413         DTextOutQuestion                EQU     $90F8           Outputs a question mark to screen
     90F5             (      romdefs.asm):00414         DTextOutSpace                   EQU     $90F5           Outputs a space to screen
     90E5             (      romdefs.asm):00415         DTextOutString                  EQU     $90E5           Outputs string pointed to by X to screen, X should point to byte before first byte of string
     0148             (      romdefs.asm):00416         DTextPrnAutoCRLF                EQU     $0148           Printer auto EOL flag, nonzero will send EOL sequence at end of line
     0099             (      romdefs.asm):00417         DTextPrnCommaW                  EQU     $0099           Printer comma width
     009C             (      romdefs.asm):00418         DTextPrnCurrCol                 EQU     $009C           Printer current column
     014A             (      romdefs.asm):00419         DTextPrnEOLCnt                  EQU     $014A           Number of characters in EOL sequence 1..4
     014B             (      romdefs.asm):00420         DTextPrnEOLSeq                  EQU     $014B           End of line characters
     009A             (      romdefs.asm):00421         DTextPrnLastComma               EQU     $009A           Printer last comma width, should be printer line width - prinnter comma width
     009B             (      romdefs.asm):00422         DTextPrnLineW                   EQU     $009B           Printer line width
     03FF             (      romdefs.asm):00423         DTextPrnSelFlag                 EQU     $03FF           Dragon 64 printer selection flag, 0=paralell port, nonzero=RS232
     A93A             (      romdefs.asm):00424         DTextResetVDU                   EQU     $A93A           Resets to text mode and screen base address of $400
     BBE5             (      romdefs.asm):00425         DTextScanKbd                    EQU     $BBE5           Scan keyboard, return Char in A, Zero flag set if no key
     FF07             (      romdefs.asm):00426         DTextSerBaudRate                EQU     $FF07           Serial baud rate, note on Dragon 64, this is the actual hardware baud rate reg.
     03FD             (      romdefs.asm):00427         DTextSerEOLDelay                EQU     $03FD           End of line delay for serial port on Dragon 64 & CoCo
     BBB5             (      romdefs.asm):00428         DTextUpdateCurs                 EQU     $BBB5           Decrements TextCursFlashCnt, if zero resets and flashes cursor
     006A             (      romdefs.asm):00429         DTextVDUCommaW                  EQU     $006A           VDU comma width field
     006C             (      romdefs.asm):00430         DTextVDUCurrCol                 EQU     $006C           Current column for VDU output
     0088             (      romdefs.asm):00431         DTextVDUCursAddr                EQU     $0088           Current VDU cursor address
     006B             (      romdefs.asm):00432         DTextVDULastComma               EQU     $006B           VDU last comma field, should be VDU line width - VDU comma width
     006D             (      romdefs.asm):00433         DTextVDULineW                   EQU     $006D           VDU line width, normally 32
     BCAB             (      romdefs.asm):00434         DTextVDUOut                     EQU     $BCAB           Outputs Char in A to VDU, does not reset screen.
     852B             (      romdefs.asm):00435         DTextWaitKey                    EQU     $852B           Wait for a keypress, calls TextScanKbd, also handles break
     A0EA             (      romdefs.asm):00436         DTextWaitKeyCurs                EQU     $A0EA           Same as TextWaitKey, but with cursor
     B505             (      romdefs.asm):00437         DTextWaitKeyCurs2               EQU     $B505           Same as TextWaitKey, but with cursor
     B7CC             (      romdefs.asm):00438         DUtilCopyBXtoU                  EQU     $B7CC           Copy B bytes from X to U
     8C35             (      romdefs.asm):00439         DVarAssign16Bit                 EQU     $8C35           Assigns value in D register to a variable, and returns to basic
     8C37             (      romdefs.asm):00440         DVarAssign16Bit2                EQU     $8C37           Assigns value in D register to a variable, and returns to basic (1 less instruction!).
     9C3E             (      romdefs.asm):00441         DVarAssign16BitB                EQU     $9C3E           Assigns value in BasVarAssign16 to a variable, and returns to basic
     8C36             (      romdefs.asm):00442         DVarAssign8Bit                  EQU     $8C36           Assigns value in B register to a variable, and returns to basic
     89AC             (      romdefs.asm):00443         DVarCKChar                      EQU     $89AC           Check for char in B register in command line, SNError if not
     89A4             (      romdefs.asm):00444         DVarCKClBrac                    EQU     $89A4           Check for Close bracket ')' in command line, SNError if not
     89AA             (      romdefs.asm):00445         DVarCKComma                     EQU     $89AA           Check for Comma in command line, SNError if not
     89A7             (      romdefs.asm):00446         DVarCKOpBrac                    EQU     $89A7           Check for Open bracket '(' in command line, SNError if not
     8D9F             (      romdefs.asm):00447         DVarDelVar                      EQU     $8D9F           Frees up storage used by a variable
     8CD7             (      romdefs.asm):00448         DVarGarbageCollect              EQU     $8CD7           Forces garbage collection in string space
     8E83             (      romdefs.asm):00449         DVarGet16Bit                    EQU     $8E83           Returns value of variable in D,FCError if more than 16 bits
     8E51             (      romdefs.asm):00450         DVarGet8Bit                     EQU     $8E51           Returns value of variable in B,FCError if more than 8 bits
     8E7E             (      romdefs.asm):00451         DVarGetComma8                   EQU     $8E7E           Checks for comman then gets 8 bit.
     8877             (      romdefs.asm):00452         DVarGetExpr                     EQU     $8877           Evaluate and put the VARPTR of experssion which follows in BasVarAssign16 (carry set)
     8874             (      romdefs.asm):00453         DVarGetExprCC                   EQU     $8874           Evaluate and put the VARPTR of experssion which follows in BasVarAssign16 (carry clear)
     8887             (      romdefs.asm):00454         DVarGetStr                      EQU     $8887           Compiles string and moves to free string space, should be followed by VarGetExpr
     8B29             (      romdefs.asm):00455         DVarGetUsr                      EQU     $8B29           Returns argument to USRnn as a 16bit no in D
     8A94             (      romdefs.asm):00456         DVarGetVar                      EQU     $8A94           Gets VARPTR address of following name and places in BasVarPtrLast
     9165             (      romdefs.asm):00457         DVarNormFPA0                    EQU     $9165           Normalize FPA0
     01A0             (      romdefs.asm):00458         DVectAccessScreen               EQU     $01A0           Called before CLS, GET & PUT are executed
     019D             (      romdefs.asm):00459         DVectAssignStr                  EQU     $019D           Called before assigning string to string variable
     015E             (      romdefs.asm):00460         DVectBase                       EQU     $015E           Base address of ram hooks/vectors
     0188             (      romdefs.asm):00461         DVectCheckEOF                   EQU     $0188           called before checking for end of file
     017F             (      romdefs.asm):00462         DVectCheckKeys                  EQU     $017F           Called before keyboard is scanned for BREAK,SHIFT-@
     0173             (      romdefs.asm):00463         DVectCloseAllFiles              EQU     $0173           Called before closing all files
     0176             (      romdefs.asm):00464         DVectCloseFile                  EQU     $0176           Called before closing a file
     0185             (      romdefs.asm):00465         DVectCloseFileCmd               EQU     $0185           Called before closing an ASCII file read in as basic
     0179             (      romdefs.asm):00466         DVectCmdInterp                  EQU     $0179           Called before interpreting a token in A
     01A6             (      romdefs.asm):00467         DVectDeTokenize                 EQU     $01A6           Called before a line is de-tokenized
     0164             (      romdefs.asm):00468         DVectDevInit                    EQU     $0164           Called before initialising a device
     0161             (      romdefs.asm):00469         DVectDevNo                      EQU     $0161           Called when a device number is verified
     015E             (      romdefs.asm):00470         DVectDevOpen                    EQU     $015E           Called before a device is opened
     018B             (      romdefs.asm):00471         DVectEvaluateExpr               EQU     $018B           Called before evaluating expression
     019A             (      romdefs.asm):00472         DVectGetNextCmd                 EQU     $019A           Called before fetching next command to be executed by BASIC
     016A             (      romdefs.asm):00473         DVectInChar                     EQU     $016A           Called before inputting a char to A
     016D             (      romdefs.asm):00474         DVectInputFile                  EQU     $016D           Called before inputting from a file
     0182             (      romdefs.asm):00475         DVectLineInputFile              EQU     $0182           Called before LINE INPUT is executed
     0167             (      romdefs.asm):00476         DVectOutChar                    EQU     $0167           Called before outputting char in A to a device
     0170             (      romdefs.asm):00477         DVectOutputFile                 EQU     $0170           Called before outputting to a file
     017C             (      romdefs.asm):00478         DVectReReqestIn                 EQU     $017C           Called before re-requesing input from keyboard
     0197             (      romdefs.asm):00479         DVectResetBasMem                EQU     $0197           Called before changing BASIC memory vectors after LOAD etc
     0194             (      romdefs.asm):00480         DVectRunLink                    EQU     $0194           Called when RUN about to be executed
     0191             (      romdefs.asm):00481         DVectSysError                   EQU     $0191           Can be patched by system to trap error messages
     01A3             (      romdefs.asm):00482         DVectTokenize                   EQU     $01A3           Called before an ASCII line is tokenized
     018E             (      romdefs.asm):00483         DVectUserError                  EQU     $018E           Can be patched by user to trap error messages
     B44F             (      romdefs.asm):00484         DWarmStart                      EQU     $B44F           Warm start routine
     0071             (      romdefs.asm):00485         DWarmStartFlag                  EQU     $0071           Warm start flag $55=warm start, else cold start
                      (      romdefs.asm):00486         
     0000             (      romdefs.asm):00487         CStubResWordsOfs                EQU     $0000           Offset of number of reserved words
     0001             (      romdefs.asm):00488         CStubResLookupOfs               EQU     $0001           Offset of reserved word lookup table
     0003             (      romdefs.asm):00489         CStubResJumpOfs                 EQU     $0003           Offset of reserved word jump table
     0005             (      romdefs.asm):00490         CStubFuncsOfs                   EQU     $0005           Offset of nummber of functions
     0006             (      romdefs.asm):00491         CStubFuncsLookupOfs             EQU     $0006           Offset of function lookup table
     0008             (      romdefs.asm):00492         CStubFuncsJumpOfs               EQU     $0008           Offset of functions jump table
                      (      romdefs.asm):00493         
     0021             (      romdefs.asm):00494         CSkip1                          EQU     $0021           Skip 1 byte (BRN)
     008C             (      romdefs.asm):00495         CSkip2                          EQU     $008C           Skip 2 bytes (CMPX)
     0086             (      romdefs.asm):00496         CSkip1LD                        EQU     $0086           Skip 1 byte (LDA)
     007D             (      romdefs.asm):00497         CSkip2TST                       EQU     $007D           Skip 2 bytes (TST)
                      (      romdefs.asm):00498         
     8272             (      romdefs.asm):00499         CCoCoVec167                     EQU     $8272           Vector dest for 167 
     8CF1             (      romdefs.asm):00500         CCoCoVect16A                    EQU     $8CF1           Vector dest for 16A
     8286             (      romdefs.asm):00501         CCoCoVect176                    EQU     $8286           Vector dest for 176
     8E90             (      romdefs.asm):00502         CCoCoVect179                    EQU     $8E90           Vector dest for 179
     8846             (      romdefs.asm):00503         CCoCoVect18B                    EQU     $8846           Vector dest for 18B
     88F0             (      romdefs.asm):00504         CCoCoVect191                    EQU     $88F0           Vector dest for 191
     829C             (      romdefs.asm):00505         CCoCoVect194                    EQU     $829C           Vector Dest for 194
     87E5             (      romdefs.asm):00506         CCoCoVect197                    EQU     $87E5           Vector Dest for 197
     82B9             (      romdefs.asm):00507         CCoCoVect19A                    EQU     $82B9           Vector Dest for 19A
     8304             (      romdefs.asm):00508         CCoCoVect1A3                    EQU     $8304           Vector Dest for 1A3
     0027             (      romdefs.asm):00509         CAddrFWareRamTop                EQU     $0027           Top of firmware RAM CLEAR xxx,yyyy set this to yyyy
     0074             (      romdefs.asm):00510         CAddrRamTop                     EQU     $0074           Physical end of RAM (4K, 16K, 32K or 64K).
     0021             (      romdefs.asm):00511         CAddrStack                      EQU     $0021           Address of top of machine stack
     0123             (      romdefs.asm):00512         CBasAddrCmdDisp                 EQU     $0123           Address of basic command dispatch
     0121             (      romdefs.asm):00513         CBasAddrCmdList                 EQU     $0121           Address of basic command list
     012D             (      romdefs.asm):00514         CBasAddrDskCmdDisp              EQU     $012D           Address of disk basic command dispatch
     012B             (      romdefs.asm):00515         CBasAddrDskCmdList              EQU     $012B           Address of disk basic command list
     0132             (      romdefs.asm):00516         CBasAddrDskFuncDisp             EQU     $0132           Address of disk basic function dispatcher
     0130             (      romdefs.asm):00517         CBasAddrDskFuncList             EQU     $0130           Address of disk basic function list
     0128             (      romdefs.asm):00518         CBasAddrFuncDisp                EQU     $0128           Address of basic function dispatcher
     0126             (      romdefs.asm):00519         CBasAddrFuncList                EQU     $0126           Address of basic function list
     00A6             (      romdefs.asm):00520         CBasAddrSigByte                 EQU     $00A6           Address of current significant bit in command line
     A61C             (      romdefs.asm):00521         CBasAOError                     EQU     $A61C           Print ?AO Error and return to basic
     0005             (      romdefs.asm):00522         CBasArrayEval                   EQU     $0005           Array evaluation flag, 0=eval, 1=dimensioning
     A0B6             (      romdefs.asm):00523         CBasBootBasic                   EQU     $A0B6           Restart basic, as if power on, also deletes current program
     0017             (      romdefs.asm):00524         CBasBotStack                    EQU     $0017           Bottom of stack at last check
     ADC4             (      romdefs.asm):00525         CBasBRARun                      EQU     $ADC4           BRA to main loop, used by DOS
     0000             (      romdefs.asm):00526         CBasBreakFlag                   EQU     $0000           Break flag, +ve=stop,-ve=end
     03D7             (      romdefs.asm):00527         CBasBuffer                      EQU     $03D7           Basic buffer space
     AC1E             (      romdefs.asm):00528         CBasChkArrSpaceMv               EQU     $AC1E           Check memory space at top of arrays + move arrays
     AC33             (      romdefs.asm):00529         CBasChkB2Free                   EQU     $AC33           Check B*2 bytes free above Arrays, OM error if not
     8866             (      romdefs.asm):00530         CBasChkDirect                   EQU     $8866           Check for direct mode, ID Error if so
     009F             (      romdefs.asm):00531         CBasChrGet                      EQU     $009F           Get next basic character routine
     00A5             (      romdefs.asm):00532         CBasChrGetCurr                  EQU     $00A5           Get current basic ccharacter
     00D3             (      romdefs.asm):00533         CBasCloadMOffs                  EQU     $00D3           2s complement of CLOADM offset
     AC73             (      romdefs.asm):00534         CBasCmdMode                     EQU     $AC73           Return to command mode
     0029             (      romdefs.asm):00535         CBasContLine                    EQU     $0029           Line no used by CONT
     0068             (      romdefs.asm):00536         CBasCurrentLine                 EQU     $0068           Current line no $FFFF in direct mode
     0001             (      romdefs.asm):00537         CBasDelim1                      EQU     $0001           First string delimiter
     0002             (      romdefs.asm):00538         CBasDelim2                      EQU     $0002           Second string delimiter
     002F             (      romdefs.asm):00539         CBasDirectTextPtr               EQU     $002F           Direct mode text pointer
     0008             (      romdefs.asm):00540         CBasDisArraySearch              EQU     $0008           Disable array search flag, 0=allow 0<>disable
     A61F             (      romdefs.asm):00541         CBasDNError                     EQU     $A61F           Print ?DN Error and return to basic
     ADD4             (      romdefs.asm):00542         CBasDoDispatch                  EQU     $ADD4           Do command dispatech, X must point to dispatch table
     00D7             (      romdefs.asm):00543         CBasEditorLineLen               EQU     $00D7           Editor line length
     ABAF             (      romdefs.asm):00544         CBasErrorCodeTable              EQU     $ABAF           List of 2 byte error codes eg 'SN' 'OM' 'UL' etc
     009D             (      romdefs.asm):00545         CBasExecAddr                    EQU     $009D           Exec address, on D64, at startup points to routine to boot all ram mode
     B44A             (      romdefs.asm):00546         CBasFCError                     EQU     $B44A           Print ?FC Error and return to basic
     AD01             (      romdefs.asm):00547         CBasFindLineNo                  EQU     $AD01           Find a line number in basic program
     A616             (      romdefs.asm):00548         CBasFMError                     EQU     $A616           Print ?FM Error and return to basic
     0007             (      romdefs.asm):00549         CBasGarbageFlag                 EQU     $0007           Garbage collection flag
     0003             (      romdefs.asm):00550         CBasGenCount                    EQU     $0003           General count/scratch var
     A5A2             (      romdefs.asm):00551         CBasGetDevNo                    EQU     $A5A2           Get dev no from line & validate
     AF67             (      romdefs.asm):00552         CBasGetLineNo                   EQU     $AF67           Get line no and store in BasTempLine
     B6A4             (      romdefs.asm):00553         CBasGetStrFirst                 EQU     $B6A4           Get first character of string into B
     B654             (      romdefs.asm):00554         CBasGetStrLenAddr               EQU     $B654           Get string len in B and address in X of string desc in FPA2
     A755             (      romdefs.asm):00555         CBasicCassBitIn                 EQU     $A755           Cassette bit input
     A749             (      romdefs.asm):00556         CBasicCassByIn                  EQU     $A749           Cassette byte input
     A82A             (      romdefs.asm):00557         CBasicCassByOut                 EQU     $A82A           Cassette byte output
     A7EB             (      romdefs.asm):00558         CBasicCassOff                   EQU     $A7EB           Cassette player motor off
     A7CA             (      romdefs.asm):00559         CBasicCassOn                    EQU     $A7CA           Cassette player motor on
     A77C             (      romdefs.asm):00560         CBasicCassOnRd                  EQU     $A77C           Cassette on for reading
     A199             (      romdefs.asm):00561         CBasicCursorB                   EQU     $A199           Cursor blink
     0000             (      romdefs.asm):00562         CBasicHWInit                    EQU     $0000           Hardware initialisation
     A9DE             (      romdefs.asm):00563         CBasicJoyIn                     EQU     $A9DE           Joystick input
     A1C1             (      romdefs.asm):00564         CBasicKbdIn                     EQU     $A1C1           Keyboard input
     A2BF             (      romdefs.asm):00565         CBasicPrintOut                  EQU     $A2BF           Printer output
     A30A             (      romdefs.asm):00566         CBasicScreenOut                 EQU     $A30A           Screen output
     0000             (      romdefs.asm):00567         CBasicSerIn                     EQU     $0000           Read a byte from serial
     0000             (      romdefs.asm):00568         CBasicSerOut                    EQU     $0000           Write a byte to serial port
     0000             (      romdefs.asm):00569         CBasicSetBaud                   EQU     $0000           Set baud rate
     0000             (      romdefs.asm):00570         CBasicSWInit                    EQU     $0000           Software initialisation
     A7D8             (      romdefs.asm):00571         CBasicWriteLead                 EQU     $A7D8           Cassette write leader
     886C             (      romdefs.asm):00572         CBasIDError                     EQU     $886C           Print ?ID Error and return to basic
     0004             (      romdefs.asm):00573         CBasIfCount                     EQU     $0004           If count - how many in a line
     A39D             (      romdefs.asm):00574         CBasInBuffFromX                 EQU     $A39D           Read input buffer at X as basic input
     0009             (      romdefs.asm):00575         CBasInputFlag                   EQU     $0009           Iinput/read flag, 0=input 0<>read
     A619             (      romdefs.asm):00576         CBasIOError                     EQU     $A619           Print ?IO Error and return to basic
     A9B3             (      romdefs.asm):00577         CBasIRQVec                      EQU     $A9B3           Basic IRQ routine, increments timer
     015A             (      romdefs.asm):00578         CBasJoyVal0                     EQU     $015A           Joystick(0) value
     015B             (      romdefs.asm):00579         CBasJoyVal1                     EQU     $015B           Joystick(1) value
     015C             (      romdefs.asm):00580         CBasJoyVal2                     EQU     $015C           Joystick(2) value
     015D             (      romdefs.asm):00581         CBasJoyVal3                     EQU     $015D           Joystick(3) value
     89E8             (      romdefs.asm):00582         CBasLineInputEntry              EQU     $89E8           Entry into LINE INPUT routine, used by DOS
     02DC             (      romdefs.asm):00583         CBasLinInpBuff                  EQU     $02DC           Basic line input buffer
     02DA             (      romdefs.asm):00584         CBasLinInpHead                  EQU     $02DA           Basic line input buffer header
     B764             (      romdefs.asm):00585         CBasList                        EQU     $B764           List basic program to SysDevN A must be 0 on entry
     0066             (      romdefs.asm):00586         CBasListLine                    EQU     $0066           Current line during list
     96EC             (      romdefs.asm):00587         CBasLocateScreen                EQU     $96EC           Initialise beginning of basic after graphics screen, no of pages in A
     B625             (      romdefs.asm):00588         CBasLSError                     EQU     $B625           Print ?LS Error and return to basic
     8CDD             (      romdefs.asm):00589         CBasNEError                     EQU     $8CDD           Print ?NE Error and return to basic
     AD19             (      romdefs.asm):00590         CBasNew                         EQU     $AD19           Remove current basic program from meory, like NEW command
     A3FB             (      romdefs.asm):00591         CBasNOError                     EQU     $A3FB           Print ?NO Error and return to basic
     0120             (      romdefs.asm):00592         CBasNumCmds                     EQU     $0120           Number of basic commands
     012A             (      romdefs.asm):00593         CBasNumDskCmds                  EQU     $012A           Number of disk basic commands
     012F             (      romdefs.asm):00594         CBasNumDskFuncs                 EQU     $012F           Number of disk basic functions
     0125             (      romdefs.asm):00595         CBasNumFuncs                    EQU     $0125           Number of basic functions
     002D             (      romdefs.asm):00596         CBasOldInputPtr                 EQU     $002D           Pointer to saved input during a STOP
     AC44             (      romdefs.asm):00597         CBasOMError                     EQU     $AC44           Print ?OM Error and return to basic
     BA92             (      romdefs.asm):00598         CBasOVError                     EQU     $BA92           Print ?OV Error and return to basic
     ADEB             (      romdefs.asm):00599         CBasPollKeyboard                EQU     $ADEB           Basic, poll keyboard and check for break
     BF3B             (      romdefs.asm):00600         CBasRandom8                     EQU     $BF3B           Generate an 8 bit random number and place in BasRandomSeed+1
     0115             (      romdefs.asm):00601         CBasRandomSeed                  EQU     $0115           Random number seed for RND function
     000A             (      romdefs.asm):00602         CBasRelateFlag                  EQU     $000A           Relational operator flag
     00D1             (      romdefs.asm):00603         CBasRenumStart                  EQU     $00D1           Renum start line no
     00D5             (      romdefs.asm):00604         CBasRenumStartLine              EQU     $00D5           Renum start line number
     00CF             (      romdefs.asm):00605         CBasRenumVal                    EQU     $00CF           Renum increment value
     AD33             (      romdefs.asm):00606         CBasResetStack                  EQU     $AD33           Reset basic stack to initial position
     B50F             (      romdefs.asm):00607         CBasResStr                      EQU     $B50F           Reserve B bytes of string space return start in X, setup low mem vars
     B56D             (      romdefs.asm):00608         CBasResStr2                     EQU     $B56D           Reserve B bytes of string space return start in X
     00AB             (      romdefs.asm):00609         CBasRndData                     EQU     $00AB           Used by RND
     AD9E             (      romdefs.asm):00610         CBasRun                         EQU     $AD9E           Run basic program in memory, like RUN
     AEBB             (      romdefs.asm):00611         CBasSetProgPtrX                 EQU     $AEBB           Sets basic program pointer to X-1
     80E7             (      romdefs.asm):00612         CBasSignonMess                  EQU     $80E7           Signon message address, for CoCo this is for Extended basic.
     AEB4             (      romdefs.asm):00613         CBasSkipLineNo                  EQU     $AEB4           Skip past line no in basic line, UL error if no line no.
     B277             (      romdefs.asm):00614         CBasSNError                     EQU     $B277           Print ?SN Error and return to basic
     0019             (      romdefs.asm):00615         CBasStartProg                   EQU     $0019           Start addr of basic program
     B553             (      romdefs.asm):00616         CBasSTError                     EQU     $B553           Print ?OM Error and return to basic
     01A9             (      romdefs.asm):00617         CBasStrDescStack                EQU     $01A9           String descriptor stack
     000B             (      romdefs.asm):00618         CBasStrFirstFreeTemp            EQU     $000B           First free temory string space pointer
     000D             (      romdefs.asm):00619         CBasStrLastUsedTemp             EQU     $000D           Last used tempory string space pointer
     0025             (      romdefs.asm):00620         CBasStrUtil                     EQU     $0025           Utility string pointer
     0120             (      romdefs.asm):00621         CBasStub0                       EQU     $0120           Basic Stub 0 (All basic on Dragon, Colour basic on Tandy)
     012A             (      romdefs.asm):00622         CBasStub1                       EQU     $012A           Basic stub 1 (Disk basic on Dragon, Extended basic on Tandy)
     0134             (      romdefs.asm):00623         CBasStub2                       EQU     $0134           Basic Stub 2 (Null on dragon, Disk basic on Tandy)
     013E             (      romdefs.asm):00624         CBasStub3                       EQU     $013E           Basic Stub 3 (do not use on dragon, user stub on Tandy)
     0013             (      romdefs.asm):00625         CBasTempFPA2                    EQU     $0013           Tempory FPA Mantissa for FPA2
     002B             (      romdefs.asm):00626         CBasTempLine                    EQU     $002B           Tempory line no
     000F             (      romdefs.asm):00627         CBasTempPtr                     EQU     $000F           Tempory pointer
     0011             (      romdefs.asm):00628         CBasTempPtr1                    EQU     $0011           Tempory discriptor pointer (stack search)
     003F             (      romdefs.asm):00629         CBasTempRelateFlag              EQU     $003F           Tempory relational operator flag
     003B             (      romdefs.asm):00630         CBasTempVarDesc                 EQU     $003B           Pointer to a tempory var descriptor
     B151             (      romdefs.asm):00631         CBasTMError                     EQU     $B151           Print ?TM Error and return to basic
     00AF             (      romdefs.asm):00632         CBasTronFlag                    EQU     $00AF           Tron flag nonzero=trace on
     AED2             (      romdefs.asm):00633         CBasULError                     EQU     $AED2           Print ?UL Error and return to basic
     0076             (      romdefs.asm):00634         CBasUnused1                     EQU     $0076           2 unused bytes
     00B0             (      romdefs.asm):00635         CBasUSRTableAddr                EQU     $00B0           Address of USR address table
     013E             (      romdefs.asm):00636         CBasUsrVecNoDisk                EQU     $013E           USR vector tabl when basic not installed
     001D             (      romdefs.asm):00637         CBasVarArrayAddr                EQU     $001D           Start address of Array table
     0052             (      romdefs.asm):00638         CBasVarAssign16                 EQU     $0052           Part of FPA1, used for 16bit assigns
     0033             (      romdefs.asm):00639         CBasVarDataAddr                 EQU     $0033           Address of next item in data
     0031             (      romdefs.asm):00640         CBasVarDataLine                 EQU     $0031           Line number of current data statement
     001F             (      romdefs.asm):00641         CBasVarEnd                      EQU     $001F           End of storage in use by basic
     004F             (      romdefs.asm):00642         CBasVarFPAcc1                   EQU     $004F           Floating point acumulator 1
     005C             (      romdefs.asm):00643         CBasVarFPAcc2                   EQU     $005C           Floating point acumulator 2
     0040             (      romdefs.asm):00644         CBasVarFPAcc3                   EQU     $0040           Floating point accumulator 3 (packed)
     0045             (      romdefs.asm):00645         CBasVarFPAcc4                   EQU     $0045           Floating point accumulator 4 (packed)
     004A             (      romdefs.asm):00646         CBasVarFPAcc5                   EQU     $004A           Floating point accumulator 5 (packed)
     0037             (      romdefs.asm):00647         CBasVarLastInUse                EQU     $0037           Pointer to variable last in use
     0039             (      romdefs.asm):00648         CBasVarPtrLast                  EQU     $0039           Poiinter to VARPTR last in use
     001B             (      romdefs.asm):00649         CBasVarSimpleAddr               EQU     $001B           Start address of simple variables
     0021             (      romdefs.asm):00650         CBasVarStringBase               EQU     $0021           Base address of string space (and stack)
     0023             (      romdefs.asm):00651         CBasVarStrTop                   EQU     $0023           Top of string space in use
     0006             (      romdefs.asm):00652         CBasVarType                     EQU     $0006           Variable type flag 0=numeric, $ff=string
     AD21             (      romdefs.asm):00653         CBasVect1                       EQU     $AD21           Sets up various basic vectors (after load), should be followed by call to BasVect2
     AD26             (      romdefs.asm):00654         CBasVect1a                      EQU     $AD26           Same as Vect1, but doesn't reset input pointer
     ACEF             (      romdefs.asm):00655         CBasVect2                       EQU     $ACEF           Finalises setup of basic vectors (after load), should be preceeded by call to BasVect1
     BC06             (      romdefs.asm):00656         CBasZDError                     EQU     $BC06           Print ?ZD Error and return to basic
     01E3             (      romdefs.asm):00657         CCasASCIIFlag                   EQU     $01E3           ASCII flag byte
     A974             (      romdefs.asm):00658         CCasAudioOff                    EQU     $A974           Turn off audio from cassette
     A99D             (      romdefs.asm):00659         CCasAudioOn                     EQU     $A99D           Turn on Audio from cassete to speaker
     0083             (      romdefs.asm):00660         CCasBitCount                    EQU     $0083           Cassette bit counter
     A755             (      romdefs.asm):00661         CCasBitIn                       EQU     $A755           Reads a bity into the 'Z' flag
     A70B             (      romdefs.asm):00662         CCasBlockIn                     EQU     $A70B           Reads a block into the cassete buffer pointed to by CasIOBuffAddr
     007D             (      romdefs.asm):00663         CCasBlockLen                    EQU     $007D           Cassete block length, number of bytes read, or to be written
     A7F4             (      romdefs.asm):00664         CCasBlockOut                    EQU     $A7F4           Write a block to cassete pointed to by CasIOBuffAddr
     007C             (      romdefs.asm):00665         CCasBlockType                   EQU     $007C           Cassete block type, 0=filename, 1=data, 255=EOF
     A749             (      romdefs.asm):00666         CCasByteIn                      EQU     $A749           Reads a single byte into the A register
     A82A             (      romdefs.asm):00667         CCasByteOut                     EQU     $A82A           Write byte in A register to cassete
     0080             (      romdefs.asm):00668         CCasCkSum                       EQU     $0080           Used by cassette routines for calculating checksum
     A429             (      romdefs.asm):00669         CCasClosFiles                   EQU     $A429           Close any open cassete file
     01E5             (      romdefs.asm):00670         CCasEntryAddr                   EQU     $01E5           Entry address for MC programs
     0070             (      romdefs.asm):00671         CCasEOFFlag                     EQU     $0070           Cassette IO Flag, nonzero if EOF reached
     A681             (      romdefs.asm):00672         CCasFindFile                    EQU     $A681           Searches a tape for specified filename
     01D2             (      romdefs.asm):00673         CCasFName                       EQU     $01D2           Cassete filename to search for or write out
     01DA             (      romdefs.asm):00674         CCasFNameFound                  EQU     $01DA           Filename found, when reading
     01D1             (      romdefs.asm):00675         CCasFNameLen                    EQU     $01D1           Length of cassette filename can be 0 to 8
     01E2             (      romdefs.asm):00676         CCasFType                       EQU     $01E2           File type 0=tokenized basic, 1=ASCII data, 2=Binary
     01E4             (      romdefs.asm):00677         CCasGapFlag                     EQU     $01E4           Gap flag byte
     007A             (      romdefs.asm):00678         CCasHeadBuffAddr                EQU     $007A           Address of cassette file header
     01DA             (      romdefs.asm):00679         CCasIOBuff                      EQU     $01DA           COS default IO buffer, if this contains filename block then folloing are valid
     007E             (      romdefs.asm):00680         CCasIOBuffAddr                  EQU     $007E           Cassette IO buffer address, where data will be read/written
     0079             (      romdefs.asm):00681         CCasIOBuffSize                  EQU     $0079           Size of cassette IO buffer
     0081             (      romdefs.asm):00682         CCasIOErrorCode                 EQU     $0081           Cassette IO error code 0=no error, 1=CRC, 2=attempt to load in non-ram area
     006E             (      romdefs.asm):00683         CCasIOFlag                      EQU     $006E           Cassette IO Flag, set to $FF when IO in progress
     0085             (      romdefs.asm):00684         CCasLastSine                    EQU     $0085           Casette last sine tabe entry
     0092             (      romdefs.asm):00685         CCasLeadCount                   EQU     $0092           Cassete leader count, number of $55 bytes in the leader
     01E7             (      romdefs.asm):00686         CCasLoadAddr                    EQU     $01E7           Load address
     0091             (      romdefs.asm):00687         CCasMax12                       EQU     $0091           Cassette Upper limit of 1200Hz
     0092             (      romdefs.asm):00688         CCasMax24                       EQU     $0092           Cassette Upper limit of 2400Hz
     008A             (      romdefs.asm):00689         CCasMotorDelay                  EQU     $008A           Cassette motor on delay (also inter-block gap)
     A7EB             (      romdefs.asm):00690         CCasMotorOff                    EQU     $A7EB           Turn off cassette motor
     A7CA             (      romdefs.asm):00691         CCasMotorOn                     EQU     $A7CA           Turn on motor, and wait for delay in CasMotorDelay
     008F             (      romdefs.asm):00692         CCasPartrt                      EQU     $008F           Cassette 1200/2400 partition
     0084             (      romdefs.asm):00693         CCasPhaseFlag                   EQU     $0084           Cassette Phase flag
     A511             (      romdefs.asm):00694         CCasReadBin                     EQU     $A511           Read in a binary file, similar to CLOADM
     A701             (      romdefs.asm):00695         CCasReadBlock1                  EQU     $A701           Turns on motor, reads header and then first block into CasIOBufAddr
     A77C             (      romdefs.asm):00696         CCasReadLeader                  EQU     $A77C           Turn on motor and read past leader
     0078             (      romdefs.asm):00697         CCasStatus                      EQU     $0078           Cassette status byte, 0=cassette closed, 1=open for input, 2=open for output
     0082             (      romdefs.asm):00698         CCasTemp                        EQU     $0082           Cassette tempory storage
     A469             (      romdefs.asm):00699         CCasWriteBasic                  EQU     $A469           Write tokenized basic program out, similar to CSAVE
     833D             (      romdefs.asm):00700         CCasWriteBin                    EQU     $833D           Write a binary file out push return address, then start,end and entry addresses and then JMP to this
     A7E5             (      romdefs.asm):00701         CCasWriteBlock1                 EQU     $A7E5           Turn on motor, write leader and then first block
     A7D8             (      romdefs.asm):00702         CCasWriteLeader                 EQU     $A7D8           Turn on motor and write out leader
     BC93             (      romdefs.asm):00703         CCmdABS                         EQU     $BC93           Basic Command
     B2D5             (      romdefs.asm):00704         CCmdAND                         EQU     $B2D5           Basic Command
     B6A0             (      romdefs.asm):00705         CCmdASC                         EQU     $B6A0           Basic Command
     83B0             (      romdefs.asm):00706         CCmdATN                         EQU     $83B0           Basic Command
     A990             (      romdefs.asm):00707         CCmdAudio                       EQU     $A990           Basic Command
     B68C             (      romdefs.asm):00708         CCmdCHRS                        EQU     $B68C           Basic Command
     9E9D             (      romdefs.asm):00709         CCmdCircle                      EQU     $9E9D           Basic Command
     AE41             (      romdefs.asm):00710         CCmdClear                       EQU     $AE41           Basic Command
     A498             (      romdefs.asm):00711         CCmdCload                       EQU     $A498           Basic Command
     A416             (      romdefs.asm):00712         CCmdClose                       EQU     $A416           Basic Command
     A910             (      romdefs.asm):00713         CCmdCLS                         EQU     $A910           Basic Command
     9546             (      romdefs.asm):00714         CCmdColor                       EQU     $9546           Basic Command
     AE30             (      romdefs.asm):00715         CCmdCont                        EQU     $AE30           Basic Command
     8378             (      romdefs.asm):00716         CCmdCOS                         EQU     $8378           Basic Command
     A44C             (      romdefs.asm):00717         CCmdCsave                       EQU     $A44C           Basic Command
     AEE0             (      romdefs.asm):00718         CCmdData                        EQU     $AEE0           Basic Command
     8871             (      romdefs.asm):00719         CCmdDef                         EQU     $8871           Basic Command
     8970             (      romdefs.asm):00720         CCmdDelete                      EQU     $8970           Basic Command
     B34E             (      romdefs.asm):00721         CCmdDim                         EQU     $B34E           Basic Command
     BB91             (      romdefs.asm):00722         CCmdDivide                      EQU     $BB91           Basic Command
     8C18             (      romdefs.asm):00723         CCmdDload                       EQU     $8C18           Basic Command
     9CB6             (      romdefs.asm):00724         CCmdDraw                        EQU     $9CB6           Basic Command
     8533             (      romdefs.asm):00725         CCmdEdit                        EQU     $8533           Basic Command
     AE02             (      romdefs.asm):00726         CCmdEnd                         EQU     $AE02           Basic Command
     A5CE             (      romdefs.asm):00727         CCmdEOF                         EQU     $A5CE           Basic Command
     A53E             (      romdefs.asm):00728         CCmdExec                        EQU     $A53E           Basic Command
     84F2             (      romdefs.asm):00729         CCmdEXP                         EQU     $84F2           Basic Command
     011D             (      romdefs.asm):00730         CCmdExponet                     EQU     $011D           Basic Command
     8524             (      romdefs.asm):00731         CCmdFIX                         EQU     $8524           Basic Command
     AD47             (      romdefs.asm):00732         CCmdFor                         EQU     $AD47           Basic Command
     9755             (      romdefs.asm):00733         CCmdGet                         EQU     $9755           Basic Command
     AE86             (      romdefs.asm):00734         CCmdGo                          EQU     $AE86           Basic Command
     8BDD             (      romdefs.asm):00735         CCmdHexS                        EQU     $8BDD           Basic Command
     AF14             (      romdefs.asm):00736         CCmdIF                          EQU     $AF14           Basic Command
     A564             (      romdefs.asm):00737         CCmdInkeyS                      EQU     $A564           Basic Command
     AFF5             (      romdefs.asm):00738         CCmdInput                       EQU     $AFF5           Basic Command
     877E             (      romdefs.asm):00739         CCmdInstr                       EQU     $877E           Basic Command
     BCEE             (      romdefs.asm):00740         CCmdINT                         EQU     $BCEE           Basic Command
     A9C6             (      romdefs.asm):00741         CCmdJoystk                      EQU     $A9C6           Basic Command
     B6AB             (      romdefs.asm):00742         CCmdLeftS                       EQU     $B6AB           Basic Command
     B681             (      romdefs.asm):00743         CCmdLEN                         EQU     $B681           Basic Command
     AF89             (      romdefs.asm):00744         CCmdLet                         EQU     $AF89           Basic Command
     93BB             (      romdefs.asm):00745         CCmdLine                        EQU     $93BB           Basic Command
     89C0             (      romdefs.asm):00746         CCmdLineInput                   EQU     $89C0           Line input command
     B764             (      romdefs.asm):00747         CCmdList                        EQU     $B764           Basic Command
     B75E             (      romdefs.asm):00748         CCmdLList                       EQU     $B75E           Basic Command
     8446             (      romdefs.asm):00749         CCmdLOG                         EQU     $8446           Basic Command
     B4EE             (      romdefs.asm):00750         CCmdMEM                         EQU     $B4EE           Basic Command
     B6CF             (      romdefs.asm):00751         CCmdMidS                        EQU     $B6CF           Basic Command
     B9BC             (      romdefs.asm):00752         CCmdMinus                       EQU     $B9BC           Basic Command
     A7BD             (      romdefs.asm):00753         CCmdMotor                       EQU     $A7BD           Basic Command
     BACC             (      romdefs.asm):00754         CCmdMultiply                    EQU     $BACC           Basic Command
     AD17             (      romdefs.asm):00755         CCmdNew                         EQU     $AD17           Basic Command
     B0F8             (      romdefs.asm):00756         CCmdNext                        EQU     $B0F8           Basic Command
     AF42             (      romdefs.asm):00757         CCmdON                          EQU     $AF42           Basic Command
     A5F6             (      romdefs.asm):00758         CCmdOpen                        EQU     $A5F6           Basic Command
     A603             (      romdefs.asm):00759         CCmdOpenEntry                   EQU     $A603           Entry into Basic open command used by Dragon/SuperDos
     B2D4             (      romdefs.asm):00760         CCmdOR                          EQU     $B2D4           Basic Command
     98EC             (      romdefs.asm):00761         CCmdPaint                       EQU     $98EC           Basic Command
     968B             (      romdefs.asm):00762         CCmdPClear                      EQU     $968B           Basic Command
     9532             (      romdefs.asm):00763         CCmdPCls                        EQU     $9532           Basic Command
     9723             (      romdefs.asm):00764         CCmdPcopy                       EQU     $9723           Basic Command
     B750             (      romdefs.asm):00765         CCmdPeek                        EQU     $B750           Basic Command
     9A22             (      romdefs.asm):00766         CCmdPlay                        EQU     $9A22           Basic Command
     B9C5             (      romdefs.asm):00767         CCmdPlus                        EQU     $B9C5           Basic Command
     9621             (      romdefs.asm):00768         CCmdPmode                       EQU     $9621           Basic Command
     A8F5             (      romdefs.asm):00769         CCmdPoint                       EQU     $A8F5           Basic Command
     B757             (      romdefs.asm):00770         CCmdPoke                        EQU     $B757           Basic Command
     86AC             (      romdefs.asm):00771         CCmdPOS                         EQU     $86AC           Basic Command
     9339             (      romdefs.asm):00772         CCmdPPoint                      EQU     $9339           Basic Command
     9365             (      romdefs.asm):00773         CCmdPReset                      EQU     $9365           Basic Command
     B8F7             (      romdefs.asm):00774         CCmdPrint                       EQU     $B8F7           Basic Command
     9361             (      romdefs.asm):00775         CCmdPset                        EQU     $9361           Basic Command
     9758             (      romdefs.asm):00776         CCmdPut                         EQU     $9758           Basic Command
     B046             (      romdefs.asm):00777         CCmdRead                        EQU     $B046           Basic Command
     B049             (      romdefs.asm):00778         CCmdReadFromX                   EQU     $B049           As basic READ command but ptr in X supplied by caller
     AEE3             (      romdefs.asm):00779         CCmdREM                         EQU     $AEE3           Basic Command
     8A09             (      romdefs.asm):00780         CCmdRenum                       EQU     $8A09           Basic Command
     A8B1             (      romdefs.asm):00781         CCmdReset                       EQU     $A8B1           Basic Command
     ADE4             (      romdefs.asm):00782         CCmdRestore                     EQU     $ADE4           Basic Command
     AEC0             (      romdefs.asm):00783         CCmdReturn                      EQU     $AEC0           Basic Command
     B6C8             (      romdefs.asm):00784         CCmdRightS                      EQU     $B6C8           Basic Command
     BF1F             (      romdefs.asm):00785         CCmdRND                         EQU     $BF1F           Basic Command
     AE75             (      romdefs.asm):00786         CCmdRun                         EQU     $AE75           Basic Command
     9670             (      romdefs.asm):00787         CCmdScreen                      EQU     $9670           Basic Command
     A880             (      romdefs.asm):00788         CCmdSet                         EQU     $A880           Basic Command
     BC7A             (      romdefs.asm):00789         CCmdSGN                         EQU     $BC7A           Basic Command
     BF78             (      romdefs.asm):00790         CCmdSIN                         EQU     $BF78           Basic Command
     A5EC             (      romdefs.asm):00791         CCmdSkipf                       EQU     $A5EC           Basic Command
     A94B             (      romdefs.asm):00792         CCmdSound                       EQU     $A94B           Basic Command
     8480             (      romdefs.asm):00793         CCmdSQR                         EQU     $8480           Basic Command
     AE09             (      romdefs.asm):00794         CCmdStop                        EQU     $AE09           Basic Command
     874E             (      romdefs.asm):00795         CCmdStringS                     EQU     $874E           Basic Command
     B4FD             (      romdefs.asm):00796         CCmdSTRS                        EQU     $B4FD           Basic Command
     8381             (      romdefs.asm):00797         CCmdTAN                         EQU     $8381           Basic Command
     8968             (      romdefs.asm):00798         CCmdTimer                       EQU     $8968           Basic Command
     86A8             (      romdefs.asm):00799         CCmdTroff                       EQU     $86A8           Basic Command
     86A7             (      romdefs.asm):00800         CCmdTron                        EQU     $86A7           Basic Command
     0112             (      romdefs.asm):00801         CCmdUSR                         EQU     $0112           Basic Command
     B716             (      romdefs.asm):00802         CCmdVAL                         EQU     $B716           Basic Command
     86BE             (      romdefs.asm):00803         CCmdVarptr                      EQU     $86BE           Basic Command
     00B3             (      romdefs.asm):00804         CGrBackground                   EQU     $00B3           Current background colour
     00B9             (      romdefs.asm):00805         CGrBytesPerLine                 EQU     $00B9           Number of byts/lin in current mode
     A8D9             (      romdefs.asm):00806         CGrCalcPixelPos                 EQU     $A8D9           Calculates Lo-res pixel pos from data on stack
     00D0             (      romdefs.asm):00807         CGrCircleRadius                 EQU     $00D0           Circle radius
     00CB             (      romdefs.asm):00808         CGrCircleXCo                    EQU     $00CB           Circle command X
     00CD             (      romdefs.asm):00809         CGrCircleYCo                    EQU     $00CD           Circle command Y
     9539             (      romdefs.asm):00810         CGrClearGrScreen                EQU     $9539           Clears grapics screen to value in B
     00C1             (      romdefs.asm):00811         CGrColourSet                    EQU     $00C1           Colour set currently in use
     00B4             (      romdefs.asm):00812         CGrColourTemp                   EQU     $00B4           Tempory colour in use
     00B5             (      romdefs.asm):00813         CGrCurrColour                   EQU     $00B5           Byte value for current colour, to set all pixels in byte to that colour
     00B6             (      romdefs.asm):00814         CGrCurrPmode                    EQU     $00B6           Current PMODE number
     00BD             (      romdefs.asm):00815         CGrCurrX                        EQU     $00BD           Current X cursor pos
     00C7             (      romdefs.asm):00816         CGrCurrXCo                      EQU     $00C7           Current Cursor X
     00BF             (      romdefs.asm):00817         CGrCurrY                        EQU     $00BF           Current Y cursor pos
     00C9             (      romdefs.asm):00818         CGrCurrYCo                      EQU     $00C9           Current Cursor Y
     00DB             (      romdefs.asm):00819         CGrDirtyFlag                    EQU     $00DB           Flag to tell if graphics screen has changed
     00BA             (      romdefs.asm):00820         CGrDisplayStartAddr             EQU     $00BA           Address of first byte in current display
     9CB6             (      romdefs.asm):00821         CGrDraw                         EQU     $9CB6           Draw on pmode screen as in DRAW command
     00E8             (      romdefs.asm):00822         CGrDrawAngle                    EQU     $00E8           Current angle for DRAW command
     00E9             (      romdefs.asm):00823         CGrDrawScale                    EQU     $00E9           Current scale for DRAW command
     00B2             (      romdefs.asm):00824         CGrForeground                   EQU     $00B2           Current foreground colour
     00B7             (      romdefs.asm):00825         CGrLastDisplayAddr              EQU     $00B7           Address of last byte in current display
     00C3             (      romdefs.asm):00826         CGrPixelNoX                     EQU     $00C3           Current horizontal pixel no
     00C5             (      romdefs.asm):00827         CGrPixelNoY                     EQU     $00C5           Current vertical pixel number
     00C2             (      romdefs.asm):00828         CGrPlotFlag                     EQU     $00C2           Plot/Unplot flag, 0=reset, nonzero=set
     9695             (      romdefs.asm):00829         CGrReserveGrRam                 EQU     $9695           Reserves memory for graphics, no graphics pages in B
     A8B5             (      romdefs.asm):00830         CGrResetLRGPixel                EQU     $A8B5           ReSets lo res pixel
     9682             (      romdefs.asm):00831         CGrSelectColourSet              EQU     $9682           Selects colour set dependent on B
     95AA             (      romdefs.asm):00832         CGrSelectDisplay                EQU     $95AA           Sets Text or Graphics screen, if Z=1 then text
     9653             (      romdefs.asm):00833         CGrSelectPage                   EQU     $9653           On entry B contains Pmode page to be used
     9616             (      romdefs.asm):00834         CGrSelectVDGColSet              EQU     $9616           Select colour set from data in GrColourSet
     959A             (      romdefs.asm):00835         CGrSetColours                   EQU     $959A           Sets up colours in low memory
     A88D             (      romdefs.asm):00836         CGrSetLRGPixel                  EQU     $A88D           Sets lo res pixel
     0086             (      romdefs.asm):00837         CGrSetResetData                 EQU     $0086           Data for Lo-res set/reset
     95FB             (      romdefs.asm):00838         CGrSetVDGMode                   EQU     $95FB           Set VDG to mode in A register
     960F             (      romdefs.asm):00839         CGrSetVDGOffset                 EQU     $960F           Set VDG offset to page in A
     00BC             (      romdefs.asm):00840         CGrStartPages                   EQU     $00BC           Page number of Start of graphics pages
     A006             (      romdefs.asm):00841         CIndCasBlockIn                  EQU     $A006           Indirect Read cassette block
     A008             (      romdefs.asm):00842         CIndCasBlockOut                 EQU     $A008           Indirect Write cassete block
     A004             (      romdefs.asm):00843         CIndCasOnRead                   EQU     $A004           Indirect prepare cassette for read
     A00C             (      romdefs.asm):00844         CIndCasWriteLead                EQU     $A00C           Indirect Write cassette leader
     A002             (      romdefs.asm):00845         CIndCharOutput                  EQU     $A002           Indirect Character output
     A00A             (      romdefs.asm):00846         CIndJoystickIn                  EQU     $A00A           Indirect joystick in
     A000             (      romdefs.asm):00847         CIndKeyInput                    EQU     $A000           Indirect keyboard input jsr()
     0072             (      romdefs.asm):00848         CIndVecReset                    EQU     $0072           Secondary Reset vector address, must point to NOP
     008A             (      romdefs.asm):00849         CMisc16BitScratch               EQU     $008A           Misc 16 bit scratch register (always zero ??)
     92DD             (      romdefs.asm):00850         CPixMaskTable2Col               EQU     $92DD           Pixel mask table 2 colour mode
     92E5             (      romdefs.asm):00851         CPixMaskTable4Col               EQU     $92E5           Pixel mask table 4 colour mode
     0000             (      romdefs.asm):00852         CPrinterCRLF                    EQU     $0000           Moves printer head to next line.
     0000             (      romdefs.asm):00853         CPrinterDirOut                  EQU     $0000           Sends character in A register to printer (uncooked)
     A2BF             (      romdefs.asm):00854         CPrinterOut                     EQU     $A2BF           Sends character in A register to printer
     010F             (      romdefs.asm):00855         CSecVecFIRQ                     EQU     $010F           Secondary FIRQ vector JMP+ address
     010C             (      romdefs.asm):00856         CSecVecIRQ                      EQU     $010C           Secondary IRQ vector JMP+ address
     0109             (      romdefs.asm):00857         CSecVecNMI                      EQU     $0109           Secondary NMI vector JMP+ address
     0106             (      romdefs.asm):00858         CSecVecSWI                      EQU     $0106           Secondary NMI vector JMP+ address
     0103             (      romdefs.asm):00859         CSecVecSWI2                     EQU     $0103           Secondary SWI2 vector JMP+ address
     0100             (      romdefs.asm):00860         CSecVecSWI3                     EQU     $0100           Secondary SWI3 vector JMP+ address
     00E6             (      romdefs.asm):00861         CSerDLBaud                      EQU     $00E6           Baud rate for DLOAD, unknown for Dragon
     00E7             (      romdefs.asm):00862         CSerDLTimeout                   EQU     $00E7           Timeourt for DLOAD, unknown for Dragon
     A951             (      romdefs.asm):00863         CSndBeep                        EQU     $A951           Play a beep duration in B, frequency in SndPitch
     A974             (      romdefs.asm):00864         CSndDisable                     EQU     $A974           Disables D/A sound output
     00E5             (      romdefs.asm):00865         CSndDotNoteScale                EQU     $00E5           Dotted note scale factor for Play
     A99E             (      romdefs.asm):00866         CSndDTOAOn                      EQU     $A99E           Turn on audio to D/A converter
     A976             (      romdefs.asm):00867         CSndEnable                      EQU     $A976           Enables D/A sound output
     008D             (      romdefs.asm):00868         CSndLength                      EQU     $008D           Sound duration
     00E1             (      romdefs.asm):00869         CSndNoteLen                     EQU     $00E1           Note length for PLAY
     00DE             (      romdefs.asm):00870         CSndOctave                      EQU     $00DE           Sound octave value for PLAY
     008C             (      romdefs.asm):00871         CSndPitch                       EQU     $008C           Sound pitch value
     9AFF             (      romdefs.asm):00872         CSndPlayNote                    EQU     $9AFF           Plays a note from the A register (ASCII)
     00E2             (      romdefs.asm):00873         CSndTempo                       EQU     $00E2           Tempo for PLAY
     00E3             (      romdefs.asm):00874         CSndTimerPlay                   EQU     $00E3           Timer for the Play command
     00DF             (      romdefs.asm):00875         CSndVolume                      EQU     $00DF           Sound volume for PLAY
     0000             (      romdefs.asm):00876         CSysBoot64                      EQU     $0000           Dragon 64 only, boots basic into all ram mode, with 48K available to basic.
     AC46             (      romdefs.asm):00877         CSysErr                         EQU     $AC46           Report error code in B register, cleanup and return to basic
     AC60             (      romdefs.asm):00878         CSysErr2                        EQU     $AC60           Report error in B, do NOT hook to RAM, or turn of cas etc
     A9DE             (      romdefs.asm):00879         CSysReadJoystick                EQU     $A9DE           Read hardware joystick values & update BasJoyVal0..3
     A027             (      romdefs.asm):00880         CSysReset                       EQU     $A027           Perform soft reset, as if reset button pressed
     A985             (      romdefs.asm):00881         CSysResetDA                     EQU     $A985           Reset D/A converter to $7E
     A9A2             (      romdefs.asm):00882         CSysSelJoystick                 EQU     $A9A2           Select joystick alue to read from A
     0112             (      romdefs.asm):00883         CSysTimeVal                     EQU     $0112           Current value of system timer
     A987             (      romdefs.asm):00884         CSysWriteDA                     EQU     $A987           Write value in A to D/A, bits 0 &1 should be 0
     011A             (      romdefs.asm):00885         CTextCapsLock                   EQU     $011A           Capslock flag, nonzero=uppercase
     A323             (      romdefs.asm):00886         CTextClearLine                  EQU     $A323           Clears a VDU line from current cursor pos to EOL
     A928             (      romdefs.asm):00887         CTextCls                        EQU     $A928           Clear text mode screen, resets cursor to top left
     A92A             (      romdefs.asm):00888         CTextClsChar                    EQU     $A92A           Clears srcrren to character in B register & resets cursor
     008F             (      romdefs.asm):00889         CTextCursFalshCnt               EQU     $008F           Cusrsor flash counter
     006F             (      romdefs.asm):00890         CTextDevN                       EQU     $006F           Current device number
     0035             (      romdefs.asm):00891         CTextKbdBuffAddr                EQU     $0035           Address of keyboard input buffer
     011B             (      romdefs.asm):00892         CTextKbdDelay                   EQU     $011B           Keyboard scan delay constant, used to debounce
     0152             (      romdefs.asm):00893         CTextKbdRollover                EQU     $0152           Rollover table, to check for key releases
     0087             (      romdefs.asm):00894         CTextLastKey                    EQU     $0087           ASCII code of last keypress, not cleard by key release
     A282             (      romdefs.asm):00895         CTextOutChar                    EQU     $A282           Outputs character in A to screen
     B958             (      romdefs.asm):00896         CTextOutCRLF                    EQU     $B958           Outputs an EOL sequence to the screen
     BDCC             (      romdefs.asm):00897         CTextOutNum16                   EQU     $BDCC           Outputs unsigned integer in D to the TextDevN device
     BDD4             (      romdefs.asm):00898         CTextOutNumFPA0                 EQU     $BDD4           Outputs number in FPA0 to screen
     B9AF             (      romdefs.asm):00899         CTextOutQuestion                EQU     $B9AF           Outputs a question mark to screen
     B9AC             (      romdefs.asm):00900         CTextOutSpace                   EQU     $B9AC           Outputs a space to screen
     B99C             (      romdefs.asm):00901         CTextOutString                  EQU     $B99C           Outputs string pointed to by X to screen, X should point to byte before first byte of string
     0148             (      romdefs.asm):00902         CTextPrnAutoCRLF                EQU     $0148           Printer auto EOL flag, nonzero will send EOL sequence at end of line
     0099             (      romdefs.asm):00903         CTextPrnCommaW                  EQU     $0099           Printer comma width
     009C             (      romdefs.asm):00904         CTextPrnCurrCol                 EQU     $009C           Printer current column
     014A             (      romdefs.asm):00905         CTextPrnEOLCnt                  EQU     $014A           Number of characters in EOL sequence 1..4
     014B             (      romdefs.asm):00906         CTextPrnEOLSeq                  EQU     $014B           End of line characters
     009A             (      romdefs.asm):00907         CTextPrnLastComma               EQU     $009A           Printer last comma width, should be printer line width - prinnter comma width
     009B             (      romdefs.asm):00908         CTextPrnLineW                   EQU     $009B           Printer line width
     03FF             (      romdefs.asm):00909         CTextPrnSelFlag                 EQU     $03FF           Dragon 64 printer selection flag, 0=paralell port, nonzero=RS232
     95AC             (      romdefs.asm):00910         CTextResetVDU                   EQU     $95AC           Resets to text mode and screen base address of $400
     A1C1             (      romdefs.asm):00911         CTextScanKbd                    EQU     $A1C1           Scan keyboard, return Char in A, Zero flag set if no key
     0095             (      romdefs.asm):00912         CTextSerBaudRate                EQU     $0095           Serial baud rate, note on Dragon 64, this is the actual hardware baud rate reg.
     0097             (      romdefs.asm):00913         CTextSerEOLDelay                EQU     $0097           End of line delay for serial port on Dragon 64 & CoCo
     A199             (      romdefs.asm):00914         CTextUpdateCurs                 EQU     $A199           Decrements TextCursFlashCnt, if zero resets and flashes cursor
     006A             (      romdefs.asm):00915         CTextVDUCommaW                  EQU     $006A           VDU comma width field
     006C             (      romdefs.asm):00916         CTextVDUCurrCol                 EQU     $006C           Current column for VDU output
     0088             (      romdefs.asm):00917         CTextVDUCursAddr                EQU     $0088           Current VDU cursor address
     006B             (      romdefs.asm):00918         CTextVDULastComma               EQU     $006B           VDU last comma field, should be VDU line width - VDU comma width
     006D             (      romdefs.asm):00919         CTextVDULineW                   EQU     $006D           VDU line width, normally 32
     A30A             (      romdefs.asm):00920         CTextVDUOut                     EQU     $A30A           Outputs Char in A to VDU, does not reset screen.
     ADFB             (      romdefs.asm):00921         CTextWaitKey                    EQU     $ADFB           Wait for a keypress, calls TextScanKbd, also handles break
     8CC6             (      romdefs.asm):00922         CTextWaitKeyCurs                EQU     $8CC6           Same as TextWaitKey, but with cursor
     A171             (      romdefs.asm):00923         CTextWaitKeyCurs2               EQU     $A171           Same as TextWaitKey, but with cursor
     A59A             (      romdefs.asm):00924         CUtilCopyBXtoU                  EQU     $A59A           Copy B bytes from X to U
     B4F2             (      romdefs.asm):00925         CVarAssign16Bit                 EQU     $B4F2           Assigns value in D register to a variable, and returns to basic
     B4F3             (      romdefs.asm):00926         CVarAssign16Bit2                EQU     $B4F3           Assigns value in D register to a variable, and returns to basic (1 less instruction!).
     880E             (      romdefs.asm):00927         CVarAssign16BitB                EQU     $880E           Assigns value in BasVarAssign16 to a variable, and returns to basic
     B4F3             (      romdefs.asm):00928         CVarAssign8Bit                  EQU     $B4F3           Assigns value in B register to a variable, and returns to basic
     B26F             (      romdefs.asm):00929         CVarCKChar                      EQU     $B26F           Check for char in B register in command line, SNError if not
     B267             (      romdefs.asm):00930         CVarCKClBrac                    EQU     $B267           Check for Close bracket ')' in command line, SNError if not
     B26D             (      romdefs.asm):00931         CVarCKComma                     EQU     $B26D           Check for Comma in command line, SNError if not
     B26A             (      romdefs.asm):00932         CVarCKOpBrac                    EQU     $B26A           Check for Open bracket '(' in command line, SNError if not
     B659             (      romdefs.asm):00933         CVarDelVar                      EQU     $B659           Frees up storage used by a variable
     B591             (      romdefs.asm):00934         CVarGarbageCollect              EQU     $B591           Forces garbage collection in string space
     B73D             (      romdefs.asm):00935         CVarGet16Bit                    EQU     $B73D           Returns value of variable in D,FCError if more than 16 bits
     B70B             (      romdefs.asm):00936         CVarGet8Bit                     EQU     $B70B           Returns value of variable in B,FCError if more than 8 bits
     B738             (      romdefs.asm):00937         CVarGetComma8                   EQU     $B738           Checks for comman then gets 8 bit.
     B146             (      romdefs.asm):00938         CVarGetExpr                     EQU     $B146           Evaluate and put the VARPTR of experssion which follows in BasVarAssign16 (carry set)
     B143             (      romdefs.asm):00939         CVarGetExprCC                   EQU     $B143           Evaluate and put the VARPTR of experssion which follows in BasVarAssign16 (carry clear)
     B156             (      romdefs.asm):00940         CVarGetStr                      EQU     $B156           Compiles string and moves to free string space, should be followed by VarGetExpr
     B3E9             (      romdefs.asm):00941         CVarGetUsr                      EQU     $B3E9           Returns argument to USRnn as a 16bit no in D
     B357             (      romdefs.asm):00942         CVarGetVar                      EQU     $B357           Gets VARPTR address of following name and places in BasVarPtrLast
     BA1C             (      romdefs.asm):00943         CVarNormFPA0                    EQU     $BA1C           Normalize FPA0
     01A0             (      romdefs.asm):00944         CVectAccessScreen               EQU     $01A0           Called before CLS, GET & PUT are executed
     019D             (      romdefs.asm):00945         CVectAssignStr                  EQU     $019D           Called before assigning string to string variable
     015E             (      romdefs.asm):00946         CVectBase                       EQU     $015E           Base address of ram hooks/vectors
     0188             (      romdefs.asm):00947         CVectCheckEOF                   EQU     $0188           called before checking for end of file
     017F             (      romdefs.asm):00948         CVectCheckKeys                  EQU     $017F           Called before keyboard is scanned for BREAK,SHIFT-@
     0173             (      romdefs.asm):00949         CVectCloseAllFiles              EQU     $0173           Called before closing all files
     0176             (      romdefs.asm):00950         CVectCloseFile                  EQU     $0176           Called before closing a file
     0185             (      romdefs.asm):00951         CVectCloseFileCmd               EQU     $0185           Called before closing an ASCII file read in as basic
     0179             (      romdefs.asm):00952         CVectCmdInterp                  EQU     $0179           Called before interpreting a token in A
     01A6             (      romdefs.asm):00953         CVectDeTokenize                 EQU     $01A6           Called before a line is de-tokenized
     0164             (      romdefs.asm):00954         CVectDevInit                    EQU     $0164           Called before initialising a device
     0161             (      romdefs.asm):00955         CVectDevNo                      EQU     $0161           Called when a device number is verified
     015E             (      romdefs.asm):00956         CVectDevOpen                    EQU     $015E           Called before a device is opened
     018B             (      romdefs.asm):00957         CVectEvaluateExpr               EQU     $018B           Called before evaluating expression
     019A             (      romdefs.asm):00958         CVectGetNextCmd                 EQU     $019A           Called before fetching next command to be executed by BASIC
     016A             (      romdefs.asm):00959         CVectInChar                     EQU     $016A           Called before inputting a char to A
     016D             (      romdefs.asm):00960         CVectInputFile                  EQU     $016D           Called before inputting from a file
     0182             (      romdefs.asm):00961         CVectLineInputFile              EQU     $0182           Called before LINE INPUT is executed
     0167             (      romdefs.asm):00962         CVectOutChar                    EQU     $0167           Called before outputting char in A to a device
     0170             (      romdefs.asm):00963         CVectOutputFile                 EQU     $0170           Called before outputting to a file
     017C             (      romdefs.asm):00964         CVectReReqestIn                 EQU     $017C           Called before re-requesing input from keyboard
     0197             (      romdefs.asm):00965         CVectResetBasMem                EQU     $0197           Called before changing BASIC memory vectors after LOAD etc
     0194             (      romdefs.asm):00966         CVectRunLink                    EQU     $0194           Called when RUN about to be executed
     0191             (      romdefs.asm):00967         CVectSysError                   EQU     $0191           Can be patched by system to trap error messages
     01A3             (      romdefs.asm):00968         CVectTokenize                   EQU     $01A3           Called before an ASCII line is tokenized
     018E             (      romdefs.asm):00969         CVectUserError                  EQU     $018E           Can be patched by user to trap error messages
     80C0             (      romdefs.asm):00970         CWarmStart                      EQU     $80C0           Warm start routine
     0071             (      romdefs.asm):00971         CWarmStartFlag                  EQU     $0071           Warm start flag $55=warm start, else cold start
                      (      romdefs.asm):00972         
                      (      romdefs.asm):00973                                 ifdef Dragon
                      (      romdefs.asm):00974         
     0000             (      romdefs.asm):00975         StubResWordsOfs         EQU     DStubResWordsOfs
     0001             (      romdefs.asm):00976         StubResLookupOfs                EQU     DStubResLookupOfs
     0003             (      romdefs.asm):00977         StubResJumpOfs                  EQU     DStubResJumpOfs
     0005             (      romdefs.asm):00978         StubFuncsOfs                    EQU     DStubFuncsOfs
     0006             (      romdefs.asm):00979         StubFuncsLookupOfs              EQU     DStubFuncsLookupOfs
     0008             (      romdefs.asm):00980         StubFuncsJumpOfs                EQU     DStubFuncsJumpOfs
     0021             (      romdefs.asm):00981         Skip1                           EQU     DSkip1
     008C             (      romdefs.asm):00982         Skip2                           EQU     DSkip2
     0086             (      romdefs.asm):00983         Skip1LD                         EQU     DSkip1LD
     007D             (      romdefs.asm):00984         Skip2TST                        EQU     DSkip2TST
     0000             (      romdefs.asm):00985         CoCoVec167                      EQU     DCoCoVec167
     0000             (      romdefs.asm):00986         CoCoVect16A                     EQU     DCoCoVect16A
     0000             (      romdefs.asm):00987         CoCoVect176                     EQU     DCoCoVect176
     0000             (      romdefs.asm):00988         CoCoVect179                     EQU     DCoCoVect179
     0000             (      romdefs.asm):00989         CoCoVect18B                     EQU     DCoCoVect18B
     0000             (      romdefs.asm):00990         CoCoVect191                     EQU     DCoCoVect191
     0000             (      romdefs.asm):00991         CoCoVect194                     EQU     DCoCoVect194
     0000             (      romdefs.asm):00992         CoCoVect197                     EQU     DCoCoVect197
     0000             (      romdefs.asm):00993         CoCoVect19A                     EQU     DCoCoVect19A
     0000             (      romdefs.asm):00994         CoCoVect1A3                     EQU     DCoCoVect1A3
     0027             (      romdefs.asm):00995         AddrFWareRamTop                 EQU     DAddrFWareRamTop
     0074             (      romdefs.asm):00996         AddrRamTop                      EQU     DAddrRamTop
     0021             (      romdefs.asm):00997         AddrStack                       EQU     DAddrStack
     0123             (      romdefs.asm):00998         BasAddrCmdDisp                  EQU     DBasAddrCmdDisp
     0121             (      romdefs.asm):00999         BasAddrCmdList                  EQU     DBasAddrCmdList
     012D             (      romdefs.asm):01000         BasAddrDskCmdDisp               EQU     DBasAddrDskCmdDisp
     012B             (      romdefs.asm):01001         BasAddrDskCmdList               EQU     DBasAddrDskCmdList
     0132             (      romdefs.asm):01002         BasAddrDskFuncDisp              EQU     DBasAddrDskFuncDisp
     0130             (      romdefs.asm):01003         BasAddrDskFuncList              EQU     DBasAddrDskFuncList
     0128             (      romdefs.asm):01004         BasAddrFuncDisp                 EQU     DBasAddrFuncDisp
     0126             (      romdefs.asm):01005         BasAddrFuncList                 EQU     DBasAddrFuncList
     00A6             (      romdefs.asm):01006         BasAddrSigByte                  EQU     DBasAddrSigByte
     B84E             (      romdefs.asm):01007         BasAOError                      EQU     DBasAOError
     0005             (      romdefs.asm):01008         BasArrayEval                    EQU     DBasArrayEval
     B400             (      romdefs.asm):01009         BasBootBasic                    EQU     DBasBootBasic
     0017             (      romdefs.asm):01010         BasBotStack                     EQU     DBasBotStack
     84DA             (      romdefs.asm):01011         BasBRARun                       EQU     DBasBRARun
     0000             (      romdefs.asm):01012         BasBreakFlag                    EQU     DBasBreakFlag
     03D7             (      romdefs.asm):01013         BasBuffer                       EQU     DBasBuffer
     831C             (      romdefs.asm):01014         BasChkArrSpaceMv                EQU     DBasChkArrSpaceMv
     8331             (      romdefs.asm):01015         BasChkB2Free                    EQU     DBasChkB2Free
     9C76             (      romdefs.asm):01016         BasChkDirect                    EQU     DBasChkDirect
     009F             (      romdefs.asm):01017         BasChrGet                       EQU     DBasChrGet
     00A5             (      romdefs.asm):01018         BasChrGetCurr                   EQU     DBasChrGetCurr
     00D3             (      romdefs.asm):01019         BasCloadMOffs                   EQU     DBasCloadMOffs
     8371             (      romdefs.asm):01020         BasCmdMode                      EQU     DBasCmdMode
     0029             (      romdefs.asm):01021         BasContLine                     EQU     DBasContLine
     0068             (      romdefs.asm):01022         BasCurrentLine                  EQU     DBasCurrentLine
     0001             (      romdefs.asm):01023         BasDelim1                       EQU     DBasDelim1
     0002             (      romdefs.asm):01024         BasDelim2                       EQU     DBasDelim2
     002F             (      romdefs.asm):01025         BasDirectTextPtr                EQU     DBasDirectTextPtr
     0008             (      romdefs.asm):01026         BasDisArraySearch               EQU     DBasDisArraySearch
     B851             (      romdefs.asm):01027         BasDNError                      EQU     DBasDNError
     84ED             (      romdefs.asm):01028         BasDoDispatch                   EQU     DBasDoDispatch
     00D7             (      romdefs.asm):01029         BasEditorLineLen                EQU     DBasEditorLineLen
     82A9             (      romdefs.asm):01030         BasErrorCodeTable               EQU     DBasErrorCodeTable
     009D             (      romdefs.asm):01031         BasExecAddr                     EQU     DBasExecAddr
     8B8D             (      romdefs.asm):01032         BasFCError                      EQU     DBasFCError
     83FF             (      romdefs.asm):01033         BasFindLineNo                   EQU     DBasFindLineNo
     B848             (      romdefs.asm):01034         BasFMError                      EQU     DBasFMError
     0007             (      romdefs.asm):01035         BasGarbageFlag                  EQU     DBasGarbageFlag
     0003             (      romdefs.asm):01036         BasGenCount                     EQU     DBasGenCount
     B7D4             (      romdefs.asm):01037         BasGetDevNo                     EQU     DBasGetDevNo
     869A             (      romdefs.asm):01038         BasGetLineNo                    EQU     DBasGetLineNo
     8DEA             (      romdefs.asm):01039         BasGetStrFirst                  EQU     DBasGetStrFirst
     8D9A             (      romdefs.asm):01040         BasGetStrLenAddr                EQU     DBasGetStrLenAddr
     8027             (      romdefs.asm):01041         BasicCassBitIn                  EQU     DBasicCassBitIn
     8024             (      romdefs.asm):01042         BasicCassByIn                   EQU     DBasicCassByIn
     801E             (      romdefs.asm):01043         BasicCassByOut                  EQU     DBasicCassByOut
     8018             (      romdefs.asm):01044         BasicCassOff                    EQU     DBasicCassOff
     8015             (      romdefs.asm):01045         BasicCassOn                     EQU     DBasicCassOn
     8021             (      romdefs.asm):01046         BasicCassOnRd                   EQU     DBasicCassOnRd
     8009             (      romdefs.asm):01047         BasicCursorB                    EQU     DBasicCursorB
     8000             (      romdefs.asm):01048         BasicHWInit                     EQU     DBasicHWInit
     8012             (      romdefs.asm):01049         BasicJoyIn                      EQU     DBasicJoyIn
     8006             (      romdefs.asm):01050         BasicKbdIn                      EQU     DBasicKbdIn
     800F             (      romdefs.asm):01051         BasicPrintOut                   EQU     DBasicPrintOut
     800C             (      romdefs.asm):01052         BasicScreenOut                  EQU     DBasicScreenOut
     802A             (      romdefs.asm):01053         BasicSerIn                      EQU     DBasicSerIn
     802D             (      romdefs.asm):01054         BasicSerOut                     EQU     DBasicSerOut
     8030             (      romdefs.asm):01055         BasicSetBaud                    EQU     DBasicSetBaud
     8003             (      romdefs.asm):01056         BasicSWInit                     EQU     DBasicSWInit
     801B             (      romdefs.asm):01057         BasicWriteLead                  EQU     DBasicWriteLead
     9C7C             (      romdefs.asm):01058         BasIDError                      EQU     DBasIDError
     0004             (      romdefs.asm):01059         BasIfCount                      EQU     DBasIfCount
     B5D3             (      romdefs.asm):01060         BasInBuffFromX                  EQU     DBasInBuffFromX
     0009             (      romdefs.asm):01061         BasInputFlag                    EQU     DBasInputFlag
     B84B             (      romdefs.asm):01062         BasIOError                      EQU     DBasIOError
     9D3D             (      romdefs.asm):01063         BasIRQVec                       EQU     DBasIRQVec
     015A             (      romdefs.asm):01064         BasJoyVal0                      EQU     DBasJoyVal0
     015B             (      romdefs.asm):01065         BasJoyVal1                      EQU     DBasJoyVal1
     015C             (      romdefs.asm):01066         BasJoyVal2                      EQU     DBasJoyVal2
     015D             (      romdefs.asm):01067         BasJoyVal3                      EQU     DBasJoyVal3
     9DD9             (      romdefs.asm):01068         BasLineInputEntry               EQU     DBasLineInputEntry
     02DC             (      romdefs.asm):01069         BasLinInpBuff                   EQU     DBasLinInpBuff
     02DA             (      romdefs.asm):01070         BasLinInpHead                   EQU     DBasLinInpHead
     8EAA             (      romdefs.asm):01071         BasList                         EQU     DBasList
     0066             (      romdefs.asm):01072         BasListLine                     EQU     DBasListLine
     AA87             (      romdefs.asm):01073         BasLocateScreen                 EQU     DBasLocateScreen
     8D6B             (      romdefs.asm):01074         BasLSError                      EQU     DBasLSError
     A101             (      romdefs.asm):01075         BasNEError                      EQU     DBasNEError
     8417             (      romdefs.asm):01076         BasNew                          EQU     DBasNew
     B631             (      romdefs.asm):01077         BasNOError                      EQU     DBasNOError
     0120             (      romdefs.asm):01078         BasNumCmds                      EQU     DBasNumCmds
     012A             (      romdefs.asm):01079         BasNumDskCmds                   EQU     DBasNumDskCmds
     012F             (      romdefs.asm):01080         BasNumDskFuncs                  EQU     DBasNumDskFuncs
     0125             (      romdefs.asm):01081         BasNumFuncs                     EQU     DBasNumFuncs
     002D             (      romdefs.asm):01082         BasOldInputPtr                  EQU     DBasOldInputPtr
     8342             (      romdefs.asm):01083         BasOMError                      EQU     DBasOMError
     91DB             (      romdefs.asm):01084         BasOVError                      EQU     DBasOVError
     851B             (      romdefs.asm):01085         BasPollKeyboard                 EQU     DBasPollKeyboard
     978E             (      romdefs.asm):01086         BasRandom8                      EQU     DBasRandom8
     0115             (      romdefs.asm):01087         BasRandomSeed                   EQU     DBasRandomSeed
     000A             (      romdefs.asm):01088         BasRelateFlag                   EQU     DBasRelateFlag
     00D1             (      romdefs.asm):01089         BasRenumStart                   EQU     DBasRenumStart
     00D5             (      romdefs.asm):01090         BasRenumStartLine               EQU     DBasRenumStartLine
     00CF             (      romdefs.asm):01091         BasRenumVal                     EQU     DBasRenumVal
     8434             (      romdefs.asm):01092         BasResetStack                   EQU     DBasResetStack
     8C52             (      romdefs.asm):01093         BasResStr                       EQU     DBasResStr
     8CB3             (      romdefs.asm):01094         BasResStr2                      EQU     DBasResStr2
     00AB             (      romdefs.asm):01095         BasRndData                      EQU     DBasRndData
     849F             (      romdefs.asm):01096         BasRun                          EQU     DBasRun
     85EE             (      romdefs.asm):01097         BasSetProgPtrX                  EQU     DBasSetProgPtrX
     B4B2             (      romdefs.asm):01098         BasSignonMess                   EQU     DBasSignonMess
     85E7             (      romdefs.asm):01099         BasSkipLineNo                   EQU     DBasSkipLineNo
     89B4             (      romdefs.asm):01100         BasSNError                      EQU     DBasSNError
     0019             (      romdefs.asm):01101         BasStartProg                    EQU     DBasStartProg
     8C99             (      romdefs.asm):01102         BasSTError                      EQU     DBasSTError
     01A9             (      romdefs.asm):01103         BasStrDescStack                 EQU     DBasStrDescStack
     000B             (      romdefs.asm):01104         BasStrFirstFreeTemp             EQU     DBasStrFirstFreeTemp
     000D             (      romdefs.asm):01105         BasStrLastUsedTemp              EQU     DBasStrLastUsedTemp
     0025             (      romdefs.asm):01106         BasStrUtil                      EQU     DBasStrUtil
     0120             (      romdefs.asm):01107         BasStub0                        EQU     DBasStub0
     012A             (      romdefs.asm):01108         BasStub1                        EQU     DBasStub1
     0134             (      romdefs.asm):01109         BasStub2                        EQU     DBasStub2
     013E             (      romdefs.asm):01110         BasStub3                        EQU     DBasStub3
     0013             (      romdefs.asm):01111         BasTempFPA2                     EQU     DBasTempFPA2
     002B             (      romdefs.asm):01112         BasTempLine                     EQU     DBasTempLine
     000F             (      romdefs.asm):01113         BasTempPtr                      EQU     DBasTempPtr
     0011             (      romdefs.asm):01114         BasTempPtr1                     EQU     DBasTempPtr1
     003F             (      romdefs.asm):01115         BasTempRelateFlag               EQU     DBasTempRelateFlag
     003B             (      romdefs.asm):01116         BasTempVarDesc                  EQU     DBasTempVarDesc
     8882             (      romdefs.asm):01117         BasTMError                      EQU     DBasTMError
     00AF             (      romdefs.asm):01118         BasTronFlag                     EQU     DBasTronFlag
     8605             (      romdefs.asm):01119         BasULError                      EQU     DBasULError
     0076             (      romdefs.asm):01120         BasUnused1                      EQU     DBasUnused1
     00B0             (      romdefs.asm):01121         BasUSRTableAddr                 EQU     DBasUSRTableAddr
     0134             (      romdefs.asm):01122         BasUsrVecNoDisk                 EQU     DBasUsrVecNoDisk
     001D             (      romdefs.asm):01123         BasVarArrayAddr                 EQU     DBasVarArrayAddr
     0052             (      romdefs.asm):01124         BasVarAssign16                  EQU     DBasVarAssign16
     0033             (      romdefs.asm):01125         BasVarDataAddr                  EQU     DBasVarDataAddr
     0031             (      romdefs.asm):01126         BasVarDataLine                  EQU     DBasVarDataLine
     001F             (      romdefs.asm):01127         BasVarEnd                       EQU     DBasVarEnd
     004F             (      romdefs.asm):01128         BasVarFPAcc1                    EQU     DBasVarFPAcc1
     005C             (      romdefs.asm):01129         BasVarFPAcc2                    EQU     DBasVarFPAcc2
     0040             (      romdefs.asm):01130         BasVarFPAcc3                    EQU     DBasVarFPAcc3
     0045             (      romdefs.asm):01131         BasVarFPAcc4                    EQU     DBasVarFPAcc4
     004A             (      romdefs.asm):01132         BasVarFPAcc5                    EQU     DBasVarFPAcc5
     0037             (      romdefs.asm):01133         BasVarLastInUse                 EQU     DBasVarLastInUse
     0039             (      romdefs.asm):01134         BasVarPtrLast                   EQU     DBasVarPtrLast
     001B             (      romdefs.asm):01135         BasVarSimpleAddr                EQU     DBasVarSimpleAddr
     0021             (      romdefs.asm):01136         BasVarStringBase                EQU     DBasVarStringBase
     0023             (      romdefs.asm):01137         BasVarStrTop                    EQU     DBasVarStrTop
     0006             (      romdefs.asm):01138         BasVarType                      EQU     DBasVarType
     841F             (      romdefs.asm):01139         BasVect1                        EQU     DBasVect1
     8424             (      romdefs.asm):01140         BasVect1a                       EQU     DBasVect1a
     83ED             (      romdefs.asm):01141         BasVect2                        EQU     DBasVect2
     93B1             (      romdefs.asm):01142         BasZDError                      EQU     DBasZDError
     01E3             (      romdefs.asm):01143         CasASCIIFlag                    EQU     DCasASCIIFlag
     BAC3             (      romdefs.asm):01144         CasAudioOff                     EQU     DCasAudioOff
     BAEC             (      romdefs.asm):01145         CasAudioOn                      EQU     DCasAudioOn
     0083             (      romdefs.asm):01146         CasBitCount                     EQU     DCasBitCount
     BDA5             (      romdefs.asm):01147         CasBitIn                        EQU     DCasBitIn
     B93E             (      romdefs.asm):01148         CasBlockIn                      EQU     DCasBlockIn
     007D             (      romdefs.asm):01149         CasBlockLen                     EQU     DCasBlockLen
     B999             (      romdefs.asm):01150         CasBlockOut                     EQU     DCasBlockOut
     007C             (      romdefs.asm):01151         CasBlockType                    EQU     DCasBlockType
     BDAD             (      romdefs.asm):01152         CasByteIn                       EQU     DCasByteIn
     BE12             (      romdefs.asm):01153         CasByteOut                      EQU     DCasByteOut
     0080             (      romdefs.asm):01154         CasCkSum                        EQU     DCasCkSum
     B65F             (      romdefs.asm):01155         CasClosFiles                    EQU     DCasClosFiles
     01E5             (      romdefs.asm):01156         CasEntryAddr                    EQU     DCasEntryAddr
     0070             (      romdefs.asm):01157         CasEOFFlag                      EQU     DCasEOFFlag
     B8B3             (      romdefs.asm):01158         CasFindFile                     EQU     DCasFindFile
     01D2             (      romdefs.asm):01159         CasFName                        EQU     DCasFName
     01DA             (      romdefs.asm):01160         CasFNameFound                   EQU     DCasFNameFound
     01D1             (      romdefs.asm):01161         CasFNameLen                     EQU     DCasFNameLen
     01E2             (      romdefs.asm):01162         CasFType                        EQU     DCasFType
     01E4             (      romdefs.asm):01163         CasGapFlag                      EQU     DCasGapFlag
     007A             (      romdefs.asm):01164         CasHeadBuffAddr                 EQU     DCasHeadBuffAddr
     01DA             (      romdefs.asm):01165         CasIOBuff                       EQU     DCasIOBuff
     007E             (      romdefs.asm):01166         CasIOBuffAddr                   EQU     DCasIOBuffAddr
     0079             (      romdefs.asm):01167         CasIOBuffSize                   EQU     DCasIOBuffSize
     0081             (      romdefs.asm):01168         CasIOErrorCode                  EQU     DCasIOErrorCode
     006E             (      romdefs.asm):01169         CasIOFlag                       EQU     DCasIOFlag
     0085             (      romdefs.asm):01170         CasLastSine                     EQU     DCasLastSine
     0090             (      romdefs.asm):01171         CasLeadCount                    EQU     DCasLeadCount
     01E7             (      romdefs.asm):01172         CasLoadAddr                     EQU     DCasLoadAddr
     0093             (      romdefs.asm):01173         CasMax12                        EQU     DCasMax12
     0094             (      romdefs.asm):01174         CasMax24                        EQU     DCasMax24
     0095             (      romdefs.asm):01175         CasMotorDelay                   EQU     DCasMotorDelay
     BDDC             (      romdefs.asm):01176         CasMotorOff                     EQU     DCasMotorOff
     BDCF             (      romdefs.asm):01177         CasMotorOn                      EQU     DCasMotorOn
     0092             (      romdefs.asm):01178         CasPartrt                       EQU     DCasPartrt
     0084             (      romdefs.asm):01179         CasPhaseFlag                    EQU     DCasPhaseFlag
     B748             (      romdefs.asm):01180         CasReadBin                      EQU     DCasReadBin
     B933             (      romdefs.asm):01181         CasReadBlock1                   EQU     DCasReadBlock1
     BDE7             (      romdefs.asm):01182         CasReadLeader                   EQU     DCasReadLeader
     0078             (      romdefs.asm):01183         CasStatus                       EQU     DCasStatus
     0082             (      romdefs.asm):01184         CasTemp                         EQU     DCasTemp
     B6A5             (      romdefs.asm):01185         CasWriteBasic                   EQU     DCasWriteBasic
     991B             (      romdefs.asm):01186         CasWriteBin                     EQU     DCasWriteBin
     B991             (      romdefs.asm):01187         CasWriteBlock1                  EQU     DCasWriteBlock1
     801B             (      romdefs.asm):01188         CasWriteLeader                  EQU     DCasWriteLeader
     943E             (      romdefs.asm):01189         CmdABS                          EQU     DCmdABS
     8A12             (      romdefs.asm):01190         CmdAND                          EQU     DCmdAND
     8DE6             (      romdefs.asm):01191         CmdASC                          EQU     DCmdASC
     9877             (      romdefs.asm):01192         CmdATN                          EQU     DCmdATN
     BADF             (      romdefs.asm):01193         CmdAudio                        EQU     DCmdAudio
     8DD2             (      romdefs.asm):01194         CmdCHRS                         EQU     DCmdCHRS
     B238             (      romdefs.asm):01195         CmdCircle                       EQU     DCmdCircle
     8571             (      romdefs.asm):01196         CmdClear                        EQU     DCmdClear
     B6D5             (      romdefs.asm):01197         CmdCload                        EQU     DCmdCload
     B64D             (      romdefs.asm):01198         CmdClose                        EQU     DCmdClose
     BA60             (      romdefs.asm):01199         CmdCLS                          EQU     DCmdCLS
     A8D4             (      romdefs.asm):01200         CmdColor                        EQU     DCmdColor
     8560             (      romdefs.asm):01201         CmdCont                         EQU     DCmdCont
     97CB             (      romdefs.asm):01202         CmdCOS                          EQU     DCmdCOS
     B683             (      romdefs.asm):01203         CmdCsave                        EQU     DCmdCsave
     8613             (      romdefs.asm):01204         CmdData                         EQU     DCmdData
     9C81             (      romdefs.asm):01205         CmdDef                          EQU     DCmdDef
     9D61             (      romdefs.asm):01206         CmdDelete                       EQU     DCmdDelete
     8A8B             (      romdefs.asm):01207         CmdDim                          EQU     DCmdDim
     933C             (      romdefs.asm):01208         CmdDivide                       EQU     DCmdDivide
     A049             (      romdefs.asm):01209         CmdDload                        EQU     DCmdDload
     B051             (      romdefs.asm):01210         CmdDraw                         EQU     DCmdDraw
     9965             (      romdefs.asm):01211         CmdEdit                         EQU     DCmdEdit
     8532             (      romdefs.asm):01212         CmdEnd                          EQU     DCmdEnd
     B801             (      romdefs.asm):01213         CmdEOF                          EQU     DCmdEOF
     B771             (      romdefs.asm):01214         CmdExec                         EQU     DCmdExec
     9713             (      romdefs.asm):01215         CmdEXP                          EQU     DCmdEXP
     96A0             (      romdefs.asm):01216         CmdExponet                      EQU     DCmdExponet
     9956             (      romdefs.asm):01217         CmdFIX                          EQU     DCmdFIX
     8448             (      romdefs.asm):01218         CmdFor                          EQU     DCmdFor
     AAF0             (      romdefs.asm):01219         CmdGet                          EQU     DCmdGet
     85B9             (      romdefs.asm):01220         CmdGo                           EQU     DCmdGo
     A00E             (      romdefs.asm):01221         CmdHexS                         EQU     DCmdHexS
     8647             (      romdefs.asm):01222         CmdIF                           EQU     DCmdIF
     B797             (      romdefs.asm):01223         CmdInkeyS                       EQU     DCmdInkeyS
     872B             (      romdefs.asm):01224         CmdInput                        EQU     DCmdInput
     9BB4             (      romdefs.asm):01225         CmdInstr                        EQU     DCmdInstr
     9499             (      romdefs.asm):01226         CmdINT                          EQU     DCmdINT
     BB0D             (      romdefs.asm):01227         CmdJoystk                       EQU     DCmdJoystk
     8DF1             (      romdefs.asm):01228         CmdLeftS                        EQU     DCmdLeftS
     8DC7             (      romdefs.asm):01229         CmdLEN                          EQU     DCmdLEN
     86BC             (      romdefs.asm):01230         CmdLet                          EQU     DCmdLet
     A749             (      romdefs.asm):01231         CmdLine                         EQU     DCmdLine
     9DB1             (      romdefs.asm):01232         CmdLineInput                    EQU     DCmdLineInput
     8EAA             (      romdefs.asm):01233         CmdList                         EQU     DCmdList
     8EA4             (      romdefs.asm):01234         CmdLList                        EQU     DCmdLList
     923C             (      romdefs.asm):01235         CmdLOG                          EQU     DCmdLOG
     8C31             (      romdefs.asm):01236         CmdMEM                          EQU     DCmdMEM
     8E15             (      romdefs.asm):01237         CmdMidS                         EQU     DCmdMidS
     9105             (      romdefs.asm):01238         CmdMinus                        EQU     DCmdMinus
     B982             (      romdefs.asm):01239         CmdMotor                        EQU     DCmdMotor
     9275             (      romdefs.asm):01240         CmdMultiply                     EQU     DCmdMultiply
     8415             (      romdefs.asm):01241         CmdNew                          EQU     DCmdNew
     8829             (      romdefs.asm):01242         CmdNext                         EQU     DCmdNext
     8675             (      romdefs.asm):01243         CmdON                           EQU     DCmdON
     B829             (      romdefs.asm):01244         CmdOpen                         EQU     DCmdOpen
     B835             (      romdefs.asm):01245         CmdOpenEntry                    EQU     DCmdOpenEntry
     8A11             (      romdefs.asm):01246         CmdOR                           EQU     DCmdOR
     AC87             (      romdefs.asm):01247         CmdPaint                        EQU     DCmdPaint
     AA19             (      romdefs.asm):01248         CmdPClear                       EQU     DCmdPClear
     A8C0             (      romdefs.asm):01249         CmdPCls                         EQU     DCmdPCls
     AABE             (      romdefs.asm):01250         CmdPcopy                        EQU     DCmdPcopy
     8E96             (      romdefs.asm):01251         CmdPeek                         EQU     DCmdPeek
     ADBD             (      romdefs.asm):01252         CmdPlay                         EQU     DCmdPlay
     910E             (      romdefs.asm):01253         CmdPlus                         EQU     DCmdPlus
     A9AF             (      romdefs.asm):01254         CmdPmode                        EQU     DCmdPmode
     BA45             (      romdefs.asm):01255         CmdPoint                        EQU     DCmdPoint
     8E9D             (      romdefs.asm):01256         CmdPoke                         EQU     DCmdPoke
     9ADE             (      romdefs.asm):01257         CmdPOS                          EQU     DCmdPOS
     A6C7             (      romdefs.asm):01258         CmdPPoint                       EQU     DCmdPPoint
     A6F3             (      romdefs.asm):01259         CmdPReset                       EQU     DCmdPReset
     903D             (      romdefs.asm):01260         CmdPrint                        EQU     DCmdPrint
     A6EF             (      romdefs.asm):01261         CmdPset                         EQU     DCmdPset
     AAF3             (      romdefs.asm):01262         CmdPut                          EQU     DCmdPut
     8777             (      romdefs.asm):01263         CmdRead                         EQU     DCmdRead
     877A             (      romdefs.asm):01264         CmdReadFromX                    EQU     DCmdReadFromX
     8616             (      romdefs.asm):01265         CmdREM                          EQU     DCmdREM
     9DFA             (      romdefs.asm):01266         CmdRenum                        EQU     DCmdRenum
     BA04             (      romdefs.asm):01267         CmdReset                        EQU     DCmdReset
     8514             (      romdefs.asm):01268         CmdRestore                      EQU     DCmdRestore
     85F3             (      romdefs.asm):01269         CmdReturn                       EQU     DCmdReturn
     8E0E             (      romdefs.asm):01270         CmdRightS                       EQU     DCmdRightS
     9772             (      romdefs.asm):01271         CmdRND                          EQU     DCmdRND
     85A5             (      romdefs.asm):01272         CmdRun                          EQU     DCmdRun
     A9FE             (      romdefs.asm):01273         CmdScreen                       EQU     DCmdScreen
     B9D3             (      romdefs.asm):01274         CmdSet                          EQU     DCmdSet
     9425             (      romdefs.asm):01275         CmdSGN                          EQU     DCmdSGN
     97D1             (      romdefs.asm):01276         CmdSIN                          EQU     DCmdSIN
     B81F             (      romdefs.asm):01277         CmdSkipf                        EQU     DCmdSkipf
     BA9B             (      romdefs.asm):01278         CmdSound                        EQU     DCmdSound
     9697             (      romdefs.asm):01279         CmdSQR                          EQU     DCmdSQR
     8539             (      romdefs.asm):01280         CmdStop                         EQU     DCmdStop
     9B84             (      romdefs.asm):01281         CmdStringS                      EQU     DCmdStringS
     8C40             (      romdefs.asm):01282         CmdSTRS                         EQU     DCmdSTRS
     9816             (      romdefs.asm):01283         CmdTAN                          EQU     DCmdTAN
     9D59             (      romdefs.asm):01284         CmdTimer                        EQU     DCmdTimer
     9ADA             (      romdefs.asm):01285         CmdTroff                        EQU     DCmdTroff
     9AD9             (      romdefs.asm):01286         CmdTron                         EQU     DCmdTron
     9D1D             (      romdefs.asm):01287         CmdUSR                          EQU     DCmdUSR
     8E5C             (      romdefs.asm):01288         CmdVAL                          EQU     DCmdVAL
     9AF4             (      romdefs.asm):01289         CmdVarptr                       EQU     DCmdVarptr
     00B3             (      romdefs.asm):01290         GrBackground                    EQU     DGrBackground
     00B9             (      romdefs.asm):01291         GrBytesPerLine                  EQU     DGrBytesPerLine
     BA28             (      romdefs.asm):01292         GrCalcPixelPos                  EQU     DGrCalcPixelPos
     00D0             (      romdefs.asm):01293         GrCircleRadius                  EQU     DGrCircleRadius
     00CB             (      romdefs.asm):01294         GrCircleXCo                     EQU     DGrCircleXCo
     00CD             (      romdefs.asm):01295         GrCircleYCo                     EQU     DGrCircleYCo
     A8C7             (      romdefs.asm):01296         GrClearGrScreen                 EQU     DGrClearGrScreen
     00C1             (      romdefs.asm):01297         GrColourSet                     EQU     DGrColourSet
     00B4             (      romdefs.asm):01298         GrColourTemp                    EQU     DGrColourTemp
     00B5             (      romdefs.asm):01299         GrCurrColour                    EQU     DGrCurrColour
     00B6             (      romdefs.asm):01300         GrCurrPmode                     EQU     DGrCurrPmode
     00BD             (      romdefs.asm):01301         GrCurrX                         EQU     DGrCurrX
     00C7             (      romdefs.asm):01302         GrCurrXCo                       EQU     DGrCurrXCo
     00BF             (      romdefs.asm):01303         GrCurrY                         EQU     DGrCurrY
     00C9             (      romdefs.asm):01304         GrCurrYCo                       EQU     DGrCurrYCo
     00DB             (      romdefs.asm):01305         GrDirtyFlag                     EQU     DGrDirtyFlag
     00BA             (      romdefs.asm):01306         GrDisplayStartAddr              EQU     DGrDisplayStartAddr
     B051             (      romdefs.asm):01307         GrDraw                          EQU     DGrDraw
     00E8             (      romdefs.asm):01308         GrDrawAngle                     EQU     DGrDrawAngle
     00E9             (      romdefs.asm):01309         GrDrawScale                     EQU     DGrDrawScale
     00B2             (      romdefs.asm):01310         GrForeground                    EQU     DGrForeground
     00B7             (      romdefs.asm):01311         GrLastDisplayAddr               EQU     DGrLastDisplayAddr
     00C3             (      romdefs.asm):01312         GrPixelNoX                      EQU     DGrPixelNoX
     00C5             (      romdefs.asm):01313         GrPixelNoY                      EQU     DGrPixelNoY
     00C2             (      romdefs.asm):01314         GrPlotFlag                      EQU     DGrPlotFlag
     AA23             (      romdefs.asm):01315         GrReserveGrRam                  EQU     DGrReserveGrRam
     BA07             (      romdefs.asm):01316         GrResetLRGPixel                 EQU     DGrResetLRGPixel
     AA10             (      romdefs.asm):01317         GrSelectColourSet               EQU     DGrSelectColourSet
     A938             (      romdefs.asm):01318         GrSelectDisplay                 EQU     DGrSelectDisplay
     A9E1             (      romdefs.asm):01319         GrSelectPage                    EQU     DGrSelectPage
     A9A4             (      romdefs.asm):01320         GrSelectVDGColSet               EQU     DGrSelectVDGColSet
     A928             (      romdefs.asm):01321         GrSetColours                    EQU     DGrSetColours
     B9DF             (      romdefs.asm):01322         GrSetLRGPixel                   EQU     DGrSetLRGPixel
     0086             (      romdefs.asm):01323         GrSetResetData                  EQU     DGrSetResetData
     A989             (      romdefs.asm):01324         GrSetVDGMode                    EQU     DGrSetVDGMode
     A99D             (      romdefs.asm):01325         GrSetVDGOffset                  EQU     DGrSetVDGOffset
     00BC             (      romdefs.asm):01326         GrStartPages                    EQU     DGrStartPages
     A006             (      romdefs.asm):01327         IndCasBlockIn                   EQU     DIndCasBlockIn
     A008             (      romdefs.asm):01328         IndCasBlockOut                  EQU     DIndCasBlockOut
     A004             (      romdefs.asm):01329         IndCasOnRead                    EQU     DIndCasOnRead
     A00C             (      romdefs.asm):01330         IndCasWriteLead                 EQU     DIndCasWriteLead
     A002             (      romdefs.asm):01331         IndCharOutput                   EQU     DIndCharOutput
     A00A             (      romdefs.asm):01332         IndJoystickIn                   EQU     DIndJoystickIn
     A000             (      romdefs.asm):01333         IndKeyInput                     EQU     DIndKeyInput
     0072             (      romdefs.asm):01334         IndVecReset                     EQU     DIndVecReset
     008A             (      romdefs.asm):01335         Misc16BitScratch                EQU     DMisc16BitScratch
     A66B             (      romdefs.asm):01336         PixMaskTable2Col                EQU     DPixMaskTable2Col
     A673             (      romdefs.asm):01337         PixMaskTable4Col                EQU     DPixMaskTable4Col
     BD0A             (      romdefs.asm):01338         PrinterCRLF                     EQU     DPrinterCRLF
     BCF5             (      romdefs.asm):01339         PrinterDirOut                   EQU     DPrinterDirOut
     BD1A             (      romdefs.asm):01340         PrinterOut                      EQU     DPrinterOut
     010F             (      romdefs.asm):01341         SecVecFIRQ                      EQU     DSecVecFIRQ
     010C             (      romdefs.asm):01342         SecVecIRQ                       EQU     DSecVecIRQ
     0109             (      romdefs.asm):01343         SecVecNMI                       EQU     DSecVecNMI
     0106             (      romdefs.asm):01344         SecVecSWI                       EQU     DSecVecSWI
     0103             (      romdefs.asm):01345         SecVecSWI2                      EQU     DSecVecSWI2
     0100             (      romdefs.asm):01346         SecVecSWI3                      EQU     DSecVecSWI3
     0000             (      romdefs.asm):01347         SerDLBaud                       EQU     DSerDLBaud
     0000             (      romdefs.asm):01348         SerDLTimeout                    EQU     DSerDLTimeout
     BAA0             (      romdefs.asm):01349         SndBeep                         EQU     DSndBeep
     BAC3             (      romdefs.asm):01350         SndDisable                      EQU     DSndDisable
     00E5             (      romdefs.asm):01351         SndDotNoteScale                 EQU     DSndDotNoteScale
     BAED             (      romdefs.asm):01352         SndDTOAOn                       EQU     DSndDTOAOn
     BAC5             (      romdefs.asm):01353         SndEnable                       EQU     DSndEnable
     008D             (      romdefs.asm):01354         SndLength                       EQU     DSndLength
     00E1             (      romdefs.asm):01355         SndNoteLen                      EQU     DSndNoteLen
     00DE             (      romdefs.asm):01356         SndOctave                       EQU     DSndOctave
     008C             (      romdefs.asm):01357         SndPitch                        EQU     DSndPitch
     AE9A             (      romdefs.asm):01358         SndPlayNote                     EQU     DSndPlayNote
     00E2             (      romdefs.asm):01359         SndTempo                        EQU     DSndTempo
     00E3             (      romdefs.asm):01360         SndTimerPlay                    EQU     DSndTimerPlay
     00DF             (      romdefs.asm):01361         SndVolume                       EQU     DSndVolume
     BB80             (      romdefs.asm):01362         SysBoot64                       EQU     DSysBoot64
     8344             (      romdefs.asm):01363         SysErr                          EQU     DSysErr
     835E             (      romdefs.asm):01364         SysErr2                         EQU     DSysErr2
     BD52             (      romdefs.asm):01365         SysReadJoystick                 EQU     DSysReadJoystick
     B3B4             (      romdefs.asm):01366         SysReset                        EQU     DSysReset
     BAD4             (      romdefs.asm):01367         SysResetDA                      EQU     DSysResetDA
     BD41             (      romdefs.asm):01368         SysSelJoystick                  EQU     DSysSelJoystick
     0112             (      romdefs.asm):01369         SysTimeVal                      EQU     DSysTimeVal
     BAD6             (      romdefs.asm):01370         SysWriteDA                      EQU     DSysWriteDA
     0149             (      romdefs.asm):01371         TextCapsLock                    EQU     DTextCapsLock
     BCA0             (      romdefs.asm):01372         TextClearLine                   EQU     DTextClearLine
     BA77             (      romdefs.asm):01373         TextCls                         EQU     DTextCls
     BA79             (      romdefs.asm):01374         TextClsChar                     EQU     DTextClsChar
     008F             (      romdefs.asm):01375         TextCursFalshCnt                EQU     DTextCursFalshCnt
     006F             (      romdefs.asm):01376         TextDevN                        EQU     DTextDevN
     0035             (      romdefs.asm):01377         TextKbdBuffAddr                 EQU     DTextKbdBuffAddr
     0097             (      romdefs.asm):01378         TextKbdDelay                    EQU     DTextKbdDelay
     0150             (      romdefs.asm):01379         TextKbdRollover                 EQU     DTextKbdRollover
     0087             (      romdefs.asm):01380         TextLastKey                     EQU     DTextLastKey
     B54A             (      romdefs.asm):01381         TextOutChar                     EQU     DTextOutChar
     90A1             (      romdefs.asm):01382         TextOutCRLF                     EQU     DTextOutCRLF
     957A             (      romdefs.asm):01383         TextOutNum16                    EQU     DTextOutNum16
     9582             (      romdefs.asm):01384         TextOutNumFPA0                  EQU     DTextOutNumFPA0
     90F8             (      romdefs.asm):01385         TextOutQuestion                 EQU     DTextOutQuestion
     90F5             (      romdefs.asm):01386         TextOutSpace                    EQU     DTextOutSpace
     90E5             (      romdefs.asm):01387         TextOutString                   EQU     DTextOutString
     0148             (      romdefs.asm):01388         TextPrnAutoCRLF                 EQU     DTextPrnAutoCRLF
     0099             (      romdefs.asm):01389         TextPrnCommaW                   EQU     DTextPrnCommaW
     009C             (      romdefs.asm):01390         TextPrnCurrCol                  EQU     DTextPrnCurrCol
     014A             (      romdefs.asm):01391         TextPrnEOLCnt                   EQU     DTextPrnEOLCnt
     014B             (      romdefs.asm):01392         TextPrnEOLSeq                   EQU     DTextPrnEOLSeq
     009A             (      romdefs.asm):01393         TextPrnLastComma                EQU     DTextPrnLastComma
     009B             (      romdefs.asm):01394         TextPrnLineW                    EQU     DTextPrnLineW
     03FF             (      romdefs.asm):01395         TextPrnSelFlag                  EQU     DTextPrnSelFlag
     A93A             (      romdefs.asm):01396         TextResetVDU                    EQU     DTextResetVDU
     BBE5             (      romdefs.asm):01397         TextScanKbd                     EQU     DTextScanKbd
     FF07             (      romdefs.asm):01398         TextSerBaudRate                 EQU     DTextSerBaudRate
     03FD             (      romdefs.asm):01399         TextSerEOLDelay                 EQU     DTextSerEOLDelay
     BBB5             (      romdefs.asm):01400         TextUpdateCurs                  EQU     DTextUpdateCurs
     006A             (      romdefs.asm):01401         TextVDUCommaW                   EQU     DTextVDUCommaW
     006C             (      romdefs.asm):01402         TextVDUCurrCol                  EQU     DTextVDUCurrCol
     0088             (      romdefs.asm):01403         TextVDUCursAddr                 EQU     DTextVDUCursAddr
     006B             (      romdefs.asm):01404         TextVDULastComma                EQU     DTextVDULastComma
     006D             (      romdefs.asm):01405         TextVDULineW                    EQU     DTextVDULineW
     BCAB             (      romdefs.asm):01406         TextVDUOut                      EQU     DTextVDUOut
     852B             (      romdefs.asm):01407         TextWaitKey                     EQU     DTextWaitKey
     A0EA             (      romdefs.asm):01408         TextWaitKeyCurs                 EQU     DTextWaitKeyCurs
     B505             (      romdefs.asm):01409         TextWaitKeyCurs2                EQU     DTextWaitKeyCurs2
     B7CC             (      romdefs.asm):01410         UtilCopyBXtoU                   EQU     DUtilCopyBXtoU
     8C35             (      romdefs.asm):01411         VarAssign16Bit                  EQU     DVarAssign16Bit
     8C37             (      romdefs.asm):01412         VarAssign16Bit2                 EQU     DVarAssign16Bit2
     9C3E             (      romdefs.asm):01413         VarAssign16BitB                 EQU     DVarAssign16BitB
     8C36             (      romdefs.asm):01414         VarAssign8Bit                   EQU     DVarAssign8Bit
     89AC             (      romdefs.asm):01415         VarCKChar                       EQU     DVarCKChar
     89A4             (      romdefs.asm):01416         VarCKClBrac                     EQU     DVarCKClBrac
     89AA             (      romdefs.asm):01417         VarCKComma                      EQU     DVarCKComma
     89A7             (      romdefs.asm):01418         VarCKOpBrac                     EQU     DVarCKOpBrac
     8D9F             (      romdefs.asm):01419         VarDelVar                       EQU     DVarDelVar
     8CD7             (      romdefs.asm):01420         VarGarbageCollect               EQU     DVarGarbageCollect
     8E83             (      romdefs.asm):01421         VarGet16Bit                     EQU     DVarGet16Bit
     8E51             (      romdefs.asm):01422         VarGet8Bit                      EQU     DVarGet8Bit
     8E7E             (      romdefs.asm):01423         VarGetComma8                    EQU     DVarGetComma8
     8877             (      romdefs.asm):01424         VarGetExpr                      EQU     DVarGetExpr
     8874             (      romdefs.asm):01425         VarGetExprCC                    EQU     DVarGetExprCC
     8887             (      romdefs.asm):01426         VarGetStr                       EQU     DVarGetStr
     8B29             (      romdefs.asm):01427         VarGetUsr                       EQU     DVarGetUsr
     8A94             (      romdefs.asm):01428         VarGetVar                       EQU     DVarGetVar
     9165             (      romdefs.asm):01429         VarNormFPA0                     EQU     DVarNormFPA0
     01A0             (      romdefs.asm):01430         VectAccessScreen                EQU     DVectAccessScreen
     019D             (      romdefs.asm):01431         VectAssignStr                   EQU     DVectAssignStr
     015E             (      romdefs.asm):01432         VectBase                        EQU     DVectBase
     0188             (      romdefs.asm):01433         VectCheckEOF                    EQU     DVectCheckEOF
     017F             (      romdefs.asm):01434         VectCheckKeys                   EQU     DVectCheckKeys
     0173             (      romdefs.asm):01435         VectCloseAllFiles               EQU     DVectCloseAllFiles
     0176             (      romdefs.asm):01436         VectCloseFile                   EQU     DVectCloseFile
     0185             (      romdefs.asm):01437         VectCloseFileCmd                EQU     DVectCloseFileCmd
     0179             (      romdefs.asm):01438         VectCmdInterp                   EQU     DVectCmdInterp
     01A6             (      romdefs.asm):01439         VectDeTokenize                  EQU     DVectDeTokenize
     0164             (      romdefs.asm):01440         VectDevInit                     EQU     DVectDevInit
     0161             (      romdefs.asm):01441         VectDevNo                       EQU     DVectDevNo
     015E             (      romdefs.asm):01442         VectDevOpen                     EQU     DVectDevOpen
     018B             (      romdefs.asm):01443         VectEvaluateExpr                EQU     DVectEvaluateExpr
     019A             (      romdefs.asm):01444         VectGetNextCmd                  EQU     DVectGetNextCmd
     016A             (      romdefs.asm):01445         VectInChar                      EQU     DVectInChar
     016D             (      romdefs.asm):01446         VectInputFile                   EQU     DVectInputFile
     0182             (      romdefs.asm):01447         VectLineInputFile               EQU     DVectLineInputFile
     0167             (      romdefs.asm):01448         VectOutChar                     EQU     DVectOutChar
     0170             (      romdefs.asm):01449         VectOutputFile                  EQU     DVectOutputFile
     017C             (      romdefs.asm):01450         VectReReqestIn                  EQU     DVectReReqestIn
     0197             (      romdefs.asm):01451         VectResetBasMem                 EQU     DVectResetBasMem
     0194             (      romdefs.asm):01452         VectRunLink                     EQU     DVectRunLink
     0191             (      romdefs.asm):01453         VectSysError                    EQU     DVectSysError
     01A3             (      romdefs.asm):01454         VectTokenize                    EQU     DVectTokenize
     018E             (      romdefs.asm):01455         VectUserError                   EQU     DVectUserError
     B44F             (      romdefs.asm):01456         WarmStart                       EQU     DWarmStart
     0071             (      romdefs.asm):01457         WarmStartFlag                   EQU     DWarmStartFlag
                      (      romdefs.asm):01458         
                      (      romdefs.asm):01459                                 ENDC
                      (      romdefs.asm):01460         
                      (      romdefs.asm):01461                                 ifdef Tandy
                      (      romdefs.asm):01462         
0000                  (      romdefs.asm):01463         StubResWordsOfs                 EQU     CStubResWordsOfs
0000                  (      romdefs.asm):01464         StubResLookupOfs                EQU     CStubResLookupOfs
0000                  (      romdefs.asm):01465         StubResJumpOfs                  EQU     CStubResJumpOfs
0000                  (      romdefs.asm):01466         StubFuncsOfs                    EQU     CStubFuncsOfs
0000                  (      romdefs.asm):01467         StubFuncsLookupOfs              EQU     CStubFuncsLookupOfs
0000                  (      romdefs.asm):01468         StubFuncsJumpOfs                EQU     CStubFuncsJumpOfs
0000                  (      romdefs.asm):01469         Skip1                           EQU     CSkip1
0000                  (      romdefs.asm):01470         Skip2                           EQU     CSkip2
0000                  (      romdefs.asm):01471         Skip1LD                         EQU     CSkip1LD
0000                  (      romdefs.asm):01472         Skip2TST                        EQU     CSkip2TST
0000                  (      romdefs.asm):01473         CoCoVec167                      EQU     CCoCoVec167
0000                  (      romdefs.asm):01474         CoCoVect16A                     EQU     CCoCoVect16A
0000                  (      romdefs.asm):01475         CoCoVect176                     EQU     CCoCoVect176
0000                  (      romdefs.asm):01476         CoCoVect179                     EQU     CCoCoVect179
0000                  (      romdefs.asm):01477         CoCoVect18B                     EQU     CCoCoVect18B
0000                  (      romdefs.asm):01478         CoCoVect191                     EQU     CCoCoVect191
0000                  (      romdefs.asm):01479         CoCoVect194                     EQU     CCoCoVect194
0000                  (      romdefs.asm):01480         CoCoVect197                     EQU     CCoCoVect197
0000                  (      romdefs.asm):01481         CoCoVect19A                     EQU     CCoCoVect19A
0000                  (      romdefs.asm):01482         CoCoVect1A3                     EQU     CCoCoVect1A3
0000                  (      romdefs.asm):01483         AddrFWareRamTop                 EQU     CAddrFWareRamTop
0000                  (      romdefs.asm):01484         AddrRamTop                      EQU     CAddrRamTop
0000                  (      romdefs.asm):01485         AddrStack                       EQU     CAddrStack
0000                  (      romdefs.asm):01486         BasAddrCmdDisp                  EQU     CBasAddrCmdDisp
0000                  (      romdefs.asm):01487         BasAddrCmdList                  EQU     CBasAddrCmdList
0000                  (      romdefs.asm):01488         BasAddrDskCmdDisp               EQU     CBasAddrDskCmdDisp
0000                  (      romdefs.asm):01489         BasAddrDskCmdList               EQU     CBasAddrDskCmdList
0000                  (      romdefs.asm):01490         BasAddrDskFuncDisp              EQU     CBasAddrDskFuncDisp
0000                  (      romdefs.asm):01491         BasAddrDskFuncList              EQU     CBasAddrDskFuncList
0000                  (      romdefs.asm):01492         BasAddrFuncDisp                 EQU     CBasAddrFuncDisp
0000                  (      romdefs.asm):01493         BasAddrFuncList                 EQU     CBasAddrFuncList
0000                  (      romdefs.asm):01494         BasAddrSigByte                  EQU     CBasAddrSigByte
0000                  (      romdefs.asm):01495         BasAOError                      EQU     CBasAOError
0000                  (      romdefs.asm):01496         BasArrayEval                    EQU     CBasArrayEval
0000                  (      romdefs.asm):01497         BasBootBasic                    EQU     CBasBootBasic
0000                  (      romdefs.asm):01498         BasBotStack                     EQU     CBasBotStack
0000                  (      romdefs.asm):01499         BasBRARun                       EQU     CBasBRARun
0000                  (      romdefs.asm):01500         BasBreakFlag                    EQU     CBasBreakFlag
0000                  (      romdefs.asm):01501         BasBuffer                       EQU     CBasBuffer
0000                  (      romdefs.asm):01502         BasChkArrSpaceMv                EQU     CBasChkArrSpaceMv
0000                  (      romdefs.asm):01503         BasChkB2Free                    EQU     CBasChkB2Free
0000                  (      romdefs.asm):01504         BasChkDirect                    EQU     CBasChkDirect
0000                  (      romdefs.asm):01505         BasChrGet                       EQU     CBasChrGet
0000                  (      romdefs.asm):01506         BasChrGetCurr                   EQU     CBasChrGetCurr
0000                  (      romdefs.asm):01507         BasCloadMOffs                   EQU     CBasCloadMOffs
0000                  (      romdefs.asm):01508         BasCmdMode                      EQU     CBasCmdMode
0000                  (      romdefs.asm):01509         BasContLine                     EQU     CBasContLine
0000                  (      romdefs.asm):01510         BasCurrentLine                  EQU     CBasCurrentLine
0000                  (      romdefs.asm):01511         BasDelim1                       EQU     CBasDelim1
0000                  (      romdefs.asm):01512         BasDelim2                       EQU     CBasDelim2
0000                  (      romdefs.asm):01513         BasDirectTextPtr                EQU     CBasDirectTextPtr
0000                  (      romdefs.asm):01514         BasDisArraySearch               EQU     CBasDisArraySearch
0000                  (      romdefs.asm):01515         BasDNError                      EQU     CBasDNError
0000                  (      romdefs.asm):01516         BasDoDispatch                   EQU     CBasDoDispatch
0000                  (      romdefs.asm):01517         BasEditorLineLen                EQU     CBasEditorLineLen
0000                  (      romdefs.asm):01518         BasErrorCodeTable               EQU     CBasErrorCodeTable
0000                  (      romdefs.asm):01519         BasExecAddr                     EQU     CBasExecAddr
0000                  (      romdefs.asm):01520         BasFCError                      EQU     CBasFCError
0000                  (      romdefs.asm):01521         BasFindLineNo                   EQU     CBasFindLineNo
0000                  (      romdefs.asm):01522         BasFMError                      EQU     CBasFMError
0000                  (      romdefs.asm):01523         BasGarbageFlag                  EQU     CBasGarbageFlag
0000                  (      romdefs.asm):01524         BasGenCount                     EQU     CBasGenCount
0000                  (      romdefs.asm):01525         BasGetDevNo                     EQU     CBasGetDevNo
0000                  (      romdefs.asm):01526         BasGetLineNo                    EQU     CBasGetLineNo
0000                  (      romdefs.asm):01527         BasGetStrFirst                  EQU     CBasGetStrFirst
0000                  (      romdefs.asm):01528         BasGetStrLenAddr                EQU     CBasGetStrLenAddr
0000                  (      romdefs.asm):01529         BasicCassBitIn                  EQU     CBasicCassBitIn
0000                  (      romdefs.asm):01530         BasicCassByIn                   EQU     CBasicCassByIn
0000                  (      romdefs.asm):01531         BasicCassByOut                  EQU     CBasicCassByOut
0000                  (      romdefs.asm):01532         BasicCassOff                    EQU     CBasicCassOff
0000                  (      romdefs.asm):01533         BasicCassOn                     EQU     CBasicCassOn
0000                  (      romdefs.asm):01534         BasicCassOnRd                   EQU     CBasicCassOnRd
0000                  (      romdefs.asm):01535         BasicCursorB                    EQU     CBasicCursorB
0000                  (      romdefs.asm):01536         BasicHWInit                     EQU     CBasicHWInit
0000                  (      romdefs.asm):01537         BasicJoyIn                      EQU     CBasicJoyIn
0000                  (      romdefs.asm):01538         BasicKbdIn                      EQU     CBasicKbdIn
0000                  (      romdefs.asm):01539         BasicPrintOut                   EQU     CBasicPrintOut
0000                  (      romdefs.asm):01540         BasicScreenOut                  EQU     CBasicScreenOut
0000                  (      romdefs.asm):01541         BasicSerIn                      EQU     CBasicSerIn
0000                  (      romdefs.asm):01542         BasicSerOut                     EQU     CBasicSerOut
0000                  (      romdefs.asm):01543         BasicSetBaud                    EQU     CBasicSetBaud
0000                  (      romdefs.asm):01544         BasicSWInit                     EQU     CBasicSWInit
0000                  (      romdefs.asm):01545         BasicWriteLead                  EQU     CBasicWriteLead
0000                  (      romdefs.asm):01546         BasIDError                      EQU     CBasIDError
0000                  (      romdefs.asm):01547         BasIfCount                      EQU     CBasIfCount
0000                  (      romdefs.asm):01548         BasInBuffFromX                  EQU     CBasInBuffFromX
0000                  (      romdefs.asm):01549         BasInputFlag                    EQU     CBasInputFlag
0000                  (      romdefs.asm):01550         BasIOError                      EQU     CBasIOError
0000                  (      romdefs.asm):01551         BasIRQVec                       EQU     CBasIRQVec
0000                  (      romdefs.asm):01552         BasJoyVal0                      EQU     CBasJoyVal0
0000                  (      romdefs.asm):01553         BasJoyVal1                      EQU     CBasJoyVal1
0000                  (      romdefs.asm):01554         BasJoyVal2                      EQU     CBasJoyVal2
0000                  (      romdefs.asm):01555         BasJoyVal3                      EQU     CBasJoyVal3
0000                  (      romdefs.asm):01556         BasLineInputEntry               EQU     CBasLineInputEntry
0000                  (      romdefs.asm):01557         BasLinInpBuff                   EQU     CBasLinInpBuff
0000                  (      romdefs.asm):01558         BasLinInpHead                   EQU     CBasLinInpHead
0000                  (      romdefs.asm):01559         BasList                         EQU     CBasList
0000                  (      romdefs.asm):01560         BasListLine                     EQU     CBasListLine
0000                  (      romdefs.asm):01561         BasLocateScreen                 EQU     CBasLocateScreen
0000                  (      romdefs.asm):01562         BasLSError                      EQU     CBasLSError
0000                  (      romdefs.asm):01563         BasNEError                      EQU     CBasNEError
0000                  (      romdefs.asm):01564         BasNew                          EQU     CBasNew
0000                  (      romdefs.asm):01565         BasNOError                      EQU     CBasNOError
0000                  (      romdefs.asm):01566         BasNumCmds                      EQU     CBasNumCmds
0000                  (      romdefs.asm):01567         BasNumDskCmds                   EQU     CBasNumDskCmds
0000                  (      romdefs.asm):01568         BasNumDskFuncs                  EQU     CBasNumDskFuncs
0000                  (      romdefs.asm):01569         BasNumFuncs                     EQU     CBasNumFuncs
0000                  (      romdefs.asm):01570         BasOldInputPtr                  EQU     CBasOldInputPtr
0000                  (      romdefs.asm):01571         BasOMError                      EQU     CBasOMError
0000                  (      romdefs.asm):01572         BasOVError                      EQU     CBasOVError
0000                  (      romdefs.asm):01573         BasPollKeyboard                 EQU     CBasPollKeyboard
0000                  (      romdefs.asm):01574         BasRandom8                      EQU     CBasRandom8
0000                  (      romdefs.asm):01575         BasRandomSeed                   EQU     CBasRandomSeed
0000                  (      romdefs.asm):01576         BasRelateFlag                   EQU     CBasRelateFlag
0000                  (      romdefs.asm):01577         BasRenumStart                   EQU     CBasRenumStart
0000                  (      romdefs.asm):01578         BasRenumStartLine               EQU     CBasRenumStartLine
0000                  (      romdefs.asm):01579         BasRenumVal                     EQU     CBasRenumVal
0000                  (      romdefs.asm):01580         BasResetStack                   EQU     CBasResetStack
0000                  (      romdefs.asm):01581         BasResStr                       EQU     CBasResStr
0000                  (      romdefs.asm):01582         BasResStr2                      EQU     CBasResStr2
0000                  (      romdefs.asm):01583         BasRndData                      EQU     CBasRndData
0000                  (      romdefs.asm):01584         BasRun                          EQU     CBasRun
0000                  (      romdefs.asm):01585         BasSetProgPtrX                  EQU     CBasSetProgPtrX
0000                  (      romdefs.asm):01586         BasSignonMess                   EQU     CBasSignonMess
0000                  (      romdefs.asm):01587         BasSkipLineNo                   EQU     CBasSkipLineNo
0000                  (      romdefs.asm):01588         BasSNError                      EQU     CBasSNError
0000                  (      romdefs.asm):01589         BasStartProg                    EQU     CBasStartProg
0000                  (      romdefs.asm):01590         BasSTError                      EQU     CBasSTError
0000                  (      romdefs.asm):01591         BasStrDescStack                 EQU     CBasStrDescStack
0000                  (      romdefs.asm):01592         BasStrFirstFreeTemp             EQU     CBasStrFirstFreeTemp
0000                  (      romdefs.asm):01593         BasStrLastUsedTemp              EQU     CBasStrLastUsedTemp
0000                  (      romdefs.asm):01594         BasStrUtil                      EQU     CBasStrUtil
0000                  (      romdefs.asm):01595         BasStub0                        EQU     CBasStub0
0000                  (      romdefs.asm):01596         BasStub1                        EQU     CBasStub1
0000                  (      romdefs.asm):01597         BasStub2                        EQU     CBasStub2
0000                  (      romdefs.asm):01598         BasStub3                        EQU     CBasStub3
0000                  (      romdefs.asm):01599         BasTempFPA2                     EQU     CBasTempFPA2
0000                  (      romdefs.asm):01600         BasTempLine                     EQU     CBasTempLine
0000                  (      romdefs.asm):01601         BasTempPtr                      EQU     CBasTempPtr
0000                  (      romdefs.asm):01602         BasTempPtr1                     EQU     CBasTempPtr1
0000                  (      romdefs.asm):01603         BasTempRelateFlag               EQU     CBasTempRelateFlag
0000                  (      romdefs.asm):01604         BasTempVarDesc                  EQU     CBasTempVarDesc
0000                  (      romdefs.asm):01605         BasTMError                      EQU     CBasTMError
0000                  (      romdefs.asm):01606         BasTronFlag                     EQU     CBasTronFlag
0000                  (      romdefs.asm):01607         BasULError                      EQU     CBasULError
0000                  (      romdefs.asm):01608         BasUnused1                      EQU     CBasUnused1
0000                  (      romdefs.asm):01609         BasUSRTableAddr                 EQU     CBasUSRTableAddr
0000                  (      romdefs.asm):01610         BasUsrVecNoDisk                 EQU     CBasUsrVecNoDisk
0000                  (      romdefs.asm):01611         BasVarArrayAddr                 EQU     CBasVarArrayAddr
0000                  (      romdefs.asm):01612         BasVarAssign16                  EQU     CBasVarAssign16
0000                  (      romdefs.asm):01613         BasVarDataAddr                  EQU     CBasVarDataAddr
0000                  (      romdefs.asm):01614         BasVarDataLine                  EQU     CBasVarDataLine
0000                  (      romdefs.asm):01615         BasVarEnd                       EQU     CBasVarEnd
0000                  (      romdefs.asm):01616         BasVarFPAcc1                    EQU     CBasVarFPAcc1
0000                  (      romdefs.asm):01617         BasVarFPAcc2                    EQU     CBasVarFPAcc2
0000                  (      romdefs.asm):01618         BasVarFPAcc3                    EQU     CBasVarFPAcc3
0000                  (      romdefs.asm):01619         BasVarFPAcc4                    EQU     CBasVarFPAcc4
0000                  (      romdefs.asm):01620         BasVarFPAcc5                    EQU     CBasVarFPAcc5
0000                  (      romdefs.asm):01621         BasVarLastInUse                 EQU     CBasVarLastInUse
0000                  (      romdefs.asm):01622         BasVarPtrLast                   EQU     CBasVarPtrLast
0000                  (      romdefs.asm):01623         BasVarSimpleAddr                EQU     CBasVarSimpleAddr
0000                  (      romdefs.asm):01624         BasVarStringBase                EQU     CBasVarStringBase
0000                  (      romdefs.asm):01625         BasVarStrTop                    EQU     CBasVarStrTop
0000                  (      romdefs.asm):01626         BasVarType                      EQU     CBasVarType
0000                  (      romdefs.asm):01627         BasVect1                        EQU     CBasVect1
0000                  (      romdefs.asm):01628         BasVect1a                       EQU     CBasVect1a
0000                  (      romdefs.asm):01629         BasVect2                        EQU     CBasVect2
0000                  (      romdefs.asm):01630         BasZDError                      EQU     CBasZDError
0000                  (      romdefs.asm):01631         CasASCIIFlag                    EQU     CCasASCIIFlag
0000                  (      romdefs.asm):01632         CasAudioOff                     EQU     CCasAudioOff
0000                  (      romdefs.asm):01633         CasAudioOn                      EQU     CCasAudioOn
0000                  (      romdefs.asm):01634         CasBitCount                     EQU     CCasBitCount
0000                  (      romdefs.asm):01635         CasBitIn                        EQU     CCasBitIn
0000                  (      romdefs.asm):01636         CasBlockIn                      EQU     CCasBlockIn
0000                  (      romdefs.asm):01637         CasBlockLen                     EQU     CCasBlockLen
0000                  (      romdefs.asm):01638         CasBlockOut                     EQU     CCasBlockOut
0000                  (      romdefs.asm):01639         CasBlockType                    EQU     CCasBlockType
0000                  (      romdefs.asm):01640         CasByteIn                       EQU     CCasByteIn
0000                  (      romdefs.asm):01641         CasByteOut                      EQU     CCasByteOut
0000                  (      romdefs.asm):01642         CasCkSum                        EQU     CCasCkSum
0000                  (      romdefs.asm):01643         CasClosFiles                    EQU     CCasClosFiles
0000                  (      romdefs.asm):01644         CasEntryAddr                    EQU     CCasEntryAddr
0000                  (      romdefs.asm):01645         CasEOFFlag                      EQU     CCasEOFFlag
0000                  (      romdefs.asm):01646         CasFindFile                     EQU     CCasFindFile
0000                  (      romdefs.asm):01647         CasFName                        EQU     CCasFName
0000                  (      romdefs.asm):01648         CasFNameFound                   EQU     CCasFNameFound
0000                  (      romdefs.asm):01649         CasFNameLen                     EQU     CCasFNameLen
0000                  (      romdefs.asm):01650         CasFType                        EQU     CCasFType
0000                  (      romdefs.asm):01651         CasGapFlag                      EQU     CCasGapFlag
0000                  (      romdefs.asm):01652         CasHeadBuffAddr                 EQU     CCasHeadBuffAddr
0000                  (      romdefs.asm):01653         CasIOBuff                       EQU     CCasIOBuff
0000                  (      romdefs.asm):01654         CasIOBuffAddr                   EQU     CCasIOBuffAddr
0000                  (      romdefs.asm):01655         CasIOBuffSize                   EQU     CCasIOBuffSize
0000                  (      romdefs.asm):01656         CasIOErrorCode                  EQU     CCasIOErrorCode
0000                  (      romdefs.asm):01657         CasIOFlag                       EQU     CCasIOFlag
0000                  (      romdefs.asm):01658         CasLastSine                     EQU     CCasLastSine
0000                  (      romdefs.asm):01659         CasLeadCount                    EQU     CCasLeadCount
0000                  (      romdefs.asm):01660         CasLoadAddr                     EQU     CCasLoadAddr
0000                  (      romdefs.asm):01661         CasMax12                        EQU     CCasMax12
0000                  (      romdefs.asm):01662         CasMax24                        EQU     CCasMax24
0000                  (      romdefs.asm):01663         CasMotorDelay                   EQU     CCasMotorDelay
0000                  (      romdefs.asm):01664         CasMotorOff                     EQU     CCasMotorOff
0000                  (      romdefs.asm):01665         CasMotorOn                      EQU     CCasMotorOn
0000                  (      romdefs.asm):01666         CasPartrt                       EQU     CCasPartrt
0000                  (      romdefs.asm):01667         CasPhaseFlag                    EQU     CCasPhaseFlag
0000                  (      romdefs.asm):01668         CasReadBin                      EQU     CCasReadBin
0000                  (      romdefs.asm):01669         CasReadBlock1                   EQU     CCasReadBlock1
0000                  (      romdefs.asm):01670         CasReadLeader                   EQU     CCasReadLeader
0000                  (      romdefs.asm):01671         CasStatus                       EQU     CCasStatus
0000                  (      romdefs.asm):01672         CasTemp                         EQU     CCasTemp
0000                  (      romdefs.asm):01673         CasWriteBasic                   EQU     CCasWriteBasic
0000                  (      romdefs.asm):01674         CasWriteBin                     EQU     CCasWriteBin
0000                  (      romdefs.asm):01675         CasWriteBlock1                  EQU     CCasWriteBlock1
0000                  (      romdefs.asm):01676         CasWriteLeader                  EQU     CCasWriteLeader
0000                  (      romdefs.asm):01677         CmdABS                          EQU     CCmdABS
0000                  (      romdefs.asm):01678         CmdAND                          EQU     CCmdAND
0000                  (      romdefs.asm):01679         CmdASC                          EQU     CCmdASC
0000                  (      romdefs.asm):01680         CmdATN                          EQU     CCmdATN
0000                  (      romdefs.asm):01681         CmdAudio                        EQU     CCmdAudio
0000                  (      romdefs.asm):01682         CmdCHRS                         EQU     CCmdCHRS
0000                  (      romdefs.asm):01683         CmdCircle                       EQU     CCmdCircle
0000                  (      romdefs.asm):01684         CmdClear                        EQU     CCmdClear
0000                  (      romdefs.asm):01685         CmdCload                        EQU     CCmdCload
0000                  (      romdefs.asm):01686         CmdClose                        EQU     CCmdClose
0000                  (      romdefs.asm):01687         CmdCLS                          EQU     CCmdCLS
0000                  (      romdefs.asm):01688         CmdColor                        EQU     CCmdColor
0000                  (      romdefs.asm):01689         CmdCont                         EQU     CCmdCont
0000                  (      romdefs.asm):01690         CmdCOS                          EQU     CCmdCOS
0000                  (      romdefs.asm):01691         CmdCsave                        EQU     CCmdCsave
0000                  (      romdefs.asm):01692         CmdData                         EQU     CCmdData
0000                  (      romdefs.asm):01693         CmdDef                          EQU     CCmdDef
0000                  (      romdefs.asm):01694         CmdDelete                       EQU     CCmdDelete
0000                  (      romdefs.asm):01695         CmdDim                          EQU     CCmdDim
0000                  (      romdefs.asm):01696         CmdDivide                       EQU     CCmdDivide
0000                  (      romdefs.asm):01697         CmdDload                        EQU     CCmdDload
0000                  (      romdefs.asm):01698         CmdDraw                         EQU     CCmdDraw
0000                  (      romdefs.asm):01699         CmdEdit                         EQU     CCmdEdit
0000                  (      romdefs.asm):01700         CmdEnd                          EQU     CCmdEnd
0000                  (      romdefs.asm):01701         CmdEOF                          EQU     CCmdEOF
0000                  (      romdefs.asm):01702         CmdExec                         EQU     CCmdExec
0000                  (      romdefs.asm):01703         CmdEXP                          EQU     CCmdEXP
0000                  (      romdefs.asm):01704         CmdExponet                      EQU     CCmdExponet
0000                  (      romdefs.asm):01705         CmdFIX                          EQU     CCmdFIX
0000                  (      romdefs.asm):01706         CmdFor                          EQU     CCmdFor
0000                  (      romdefs.asm):01707         CmdGet                          EQU     CCmdGet
0000                  (      romdefs.asm):01708         CmdGo                           EQU     CCmdGo
0000                  (      romdefs.asm):01709         CmdHexS                         EQU     CCmdHexS
0000                  (      romdefs.asm):01710         CmdIF                           EQU     CCmdIF
0000                  (      romdefs.asm):01711         CmdInkeyS                       EQU     CCmdInkeyS
0000                  (      romdefs.asm):01712         CmdInput                        EQU     CCmdInput
0000                  (      romdefs.asm):01713         CmdInstr                        EQU     CCmdInstr
0000                  (      romdefs.asm):01714         CmdINT                          EQU     CCmdINT
0000                  (      romdefs.asm):01715         CmdJoystk                       EQU     CCmdJoystk
0000                  (      romdefs.asm):01716         CmdLeftS                        EQU     CCmdLeftS
0000                  (      romdefs.asm):01717         CmdLEN                          EQU     CCmdLEN
0000                  (      romdefs.asm):01718         CmdLet                          EQU     CCmdLet
0000                  (      romdefs.asm):01719         CmdLine                         EQU     CCmdLine
0000                  (      romdefs.asm):01720         CmdLineInput                    EQU     CCmdLineInput
0000                  (      romdefs.asm):01721         CmdList                         EQU     CCmdList
0000                  (      romdefs.asm):01722         CmdLList                        EQU     CCmdLList
0000                  (      romdefs.asm):01723         CmdLOG                          EQU     CCmdLOG
0000                  (      romdefs.asm):01724         CmdMEM                          EQU     CCmdMEM
0000                  (      romdefs.asm):01725         CmdMidS                         EQU     CCmdMidS
0000                  (      romdefs.asm):01726         CmdMinus                        EQU     CCmdMinus
0000                  (      romdefs.asm):01727         CmdMotor                        EQU     CCmdMotor
0000                  (      romdefs.asm):01728         CmdMultiply                     EQU     CCmdMultiply
0000                  (      romdefs.asm):01729         CmdNew                          EQU     CCmdNew
0000                  (      romdefs.asm):01730         CmdNext                         EQU     CCmdNext
0000                  (      romdefs.asm):01731         CmdON                           EQU     CCmdON
0000                  (      romdefs.asm):01732         CmdOpen                         EQU     CCmdOpen
0000                  (      romdefs.asm):01733         CmdOpenEntry                    EQU     CCmdOpenEntry
0000                  (      romdefs.asm):01734         CmdOR                           EQU     CCmdOR
0000                  (      romdefs.asm):01735         CmdPaint                        EQU     CCmdPaint
0000                  (      romdefs.asm):01736         CmdPClear                       EQU     CCmdPClear
0000                  (      romdefs.asm):01737         CmdPCls                         EQU     CCmdPCls
0000                  (      romdefs.asm):01738         CmdPcopy                        EQU     CCmdPcopy
0000                  (      romdefs.asm):01739         CmdPeek                         EQU     CCmdPeek
0000                  (      romdefs.asm):01740         CmdPlay                         EQU     CCmdPlay
0000                  (      romdefs.asm):01741         CmdPlus                         EQU     CCmdPlus
0000                  (      romdefs.asm):01742         CmdPmode                        EQU     CCmdPmode
0000                  (      romdefs.asm):01743         CmdPoint                        EQU     CCmdPoint
0000                  (      romdefs.asm):01744         CmdPoke                         EQU     CCmdPoke
0000                  (      romdefs.asm):01745         CmdPOS                          EQU     CCmdPOS
0000                  (      romdefs.asm):01746         CmdPPoint                       EQU     CCmdPPoint
0000                  (      romdefs.asm):01747         CmdPReset                       EQU     CCmdPReset
0000                  (      romdefs.asm):01748         CmdPrint                        EQU     CCmdPrint
0000                  (      romdefs.asm):01749         CmdPset                         EQU     CCmdPset
0000                  (      romdefs.asm):01750         CmdPut                          EQU     CCmdPut
0000                  (      romdefs.asm):01751         CmdRead                         EQU     CCmdRead
0000                  (      romdefs.asm):01752         CmdReadFromX                    EQU     CCmdReadFromX
0000                  (      romdefs.asm):01753         CmdREM                          EQU     CCmdREM
0000                  (      romdefs.asm):01754         CmdRenum                        EQU     CCmdRenum
0000                  (      romdefs.asm):01755         CmdReset                        EQU     CCmdReset
0000                  (      romdefs.asm):01756         CmdRestore                      EQU     CCmdRestore
0000                  (      romdefs.asm):01757         CmdReturn                       EQU     CCmdReturn
0000                  (      romdefs.asm):01758         CmdRightS                       EQU     CCmdRightS
0000                  (      romdefs.asm):01759         CmdRND                          EQU     CCmdRND
0000                  (      romdefs.asm):01760         CmdRun                          EQU     CCmdRun
0000                  (      romdefs.asm):01761         CmdScreen                       EQU     CCmdScreen
0000                  (      romdefs.asm):01762         CmdSet                          EQU     CCmdSet
0000                  (      romdefs.asm):01763         CmdSGN                          EQU     CCmdSGN
0000                  (      romdefs.asm):01764         CmdSIN                          EQU     CCmdSIN
0000                  (      romdefs.asm):01765         CmdSkipf                        EQU     CCmdSkipf
0000                  (      romdefs.asm):01766         CmdSound                        EQU     CCmdSound
0000                  (      romdefs.asm):01767         CmdSQR                          EQU     CCmdSQR
0000                  (      romdefs.asm):01768         CmdStop                         EQU     CCmdStop
0000                  (      romdefs.asm):01769         CmdStringS                      EQU     CCmdStringS
0000                  (      romdefs.asm):01770         CmdSTRS                         EQU     CCmdSTRS
0000                  (      romdefs.asm):01771         CmdTAN                          EQU     CCmdTAN
0000                  (      romdefs.asm):01772         CmdTimer                        EQU     CCmdTimer
0000                  (      romdefs.asm):01773         CmdTroff                        EQU     CCmdTroff
0000                  (      romdefs.asm):01774         CmdTron                         EQU     CCmdTron
0000                  (      romdefs.asm):01775         CmdUSR                          EQU     CCmdUSR
0000                  (      romdefs.asm):01776         CmdVAL                          EQU     CCmdVAL
0000                  (      romdefs.asm):01777         CmdVarptr                       EQU     CCmdVarptr
0000                  (      romdefs.asm):01778         GrBackground                    EQU     CGrBackground
0000                  (      romdefs.asm):01779         GrBytesPerLine                  EQU     CGrBytesPerLine
0000                  (      romdefs.asm):01780         GrCalcPixelPos                  EQU     CGrCalcPixelPos
0000                  (      romdefs.asm):01781         GrCircleRadius                  EQU     CGrCircleRadius
0000                  (      romdefs.asm):01782         GrCircleXCo                     EQU     CGrCircleXCo
0000                  (      romdefs.asm):01783         GrCircleYCo                     EQU     CGrCircleYCo
0000                  (      romdefs.asm):01784         GrClearGrScreen                 EQU     CGrClearGrScreen
0000                  (      romdefs.asm):01785         GrColourSet                     EQU     CGrColourSet
0000                  (      romdefs.asm):01786         GrColourTemp                    EQU     CGrColourTemp
0000                  (      romdefs.asm):01787         GrCurrColour                    EQU     CGrCurrColour
0000                  (      romdefs.asm):01788         GrCurrPmode                     EQU     CGrCurrPmode
0000                  (      romdefs.asm):01789         GrCurrX                         EQU     CGrCurrX
0000                  (      romdefs.asm):01790         GrCurrXCo                       EQU     CGrCurrXCo
0000                  (      romdefs.asm):01791         GrCurrY                         EQU     CGrCurrY
0000                  (      romdefs.asm):01792         GrCurrYCo                       EQU     CGrCurrYCo
0000                  (      romdefs.asm):01793         GrDirtyFlag                     EQU     CGrDirtyFlag
0000                  (      romdefs.asm):01794         GrDisplayStartAddr              EQU     CGrDisplayStartAddr
0000                  (      romdefs.asm):01795         GrDraw                          EQU     CGrDraw
0000                  (      romdefs.asm):01796         GrDrawAngle                     EQU     CGrDrawAngle
0000                  (      romdefs.asm):01797         GrDrawScale                     EQU     CGrDrawScale
0000                  (      romdefs.asm):01798         GrForeground                    EQU     CGrForeground
0000                  (      romdefs.asm):01799         GrLastDisplayAddr               EQU     CGrLastDisplayAddr
0000                  (      romdefs.asm):01800         GrPixelNoX                      EQU     CGrPixelNoX
0000                  (      romdefs.asm):01801         GrPixelNoY                      EQU     CGrPixelNoY
0000                  (      romdefs.asm):01802         GrPlotFlag                      EQU     CGrPlotFlag
0000                  (      romdefs.asm):01803         GrReserveGrRam                  EQU     CGrReserveGrRam
0000                  (      romdefs.asm):01804         GrResetLRGPixel                 EQU     CGrResetLRGPixel
0000                  (      romdefs.asm):01805         GrSelectColourSet               EQU     CGrSelectColourSet
0000                  (      romdefs.asm):01806         GrSelectDisplay                 EQU     CGrSelectDisplay
0000                  (      romdefs.asm):01807         GrSelectPage                    EQU     CGrSelectPage
0000                  (      romdefs.asm):01808         GrSelectVDGColSet               EQU     CGrSelectVDGColSet
0000                  (      romdefs.asm):01809         GrSetColours                    EQU     CGrSetColours
0000                  (      romdefs.asm):01810         GrSetLRGPixel                   EQU     CGrSetLRGPixel
0000                  (      romdefs.asm):01811         GrSetResetData                  EQU     CGrSetResetData
0000                  (      romdefs.asm):01812         GrSetVDGMode                    EQU     CGrSetVDGMode
0000                  (      romdefs.asm):01813         GrSetVDGOffset                  EQU     CGrSetVDGOffset
0000                  (      romdefs.asm):01814         GrStartPages                    EQU     CGrStartPages
0000                  (      romdefs.asm):01815         IndCasBlockIn                   EQU     CIndCasBlockIn
0000                  (      romdefs.asm):01816         IndCasBlockOut                  EQU     CIndCasBlockOut
0000                  (      romdefs.asm):01817         IndCasOnRead                    EQU     CIndCasOnRead
0000                  (      romdefs.asm):01818         IndCasWriteLead                 EQU     CIndCasWriteLead
0000                  (      romdefs.asm):01819         IndCharOutput                   EQU     CIndCharOutput
0000                  (      romdefs.asm):01820         IndJoystickIn                   EQU     CIndJoystickIn
0000                  (      romdefs.asm):01821         IndKeyInput                     EQU     CIndKeyInput
0000                  (      romdefs.asm):01822         IndVecReset                     EQU     CIndVecReset
0000                  (      romdefs.asm):01823         Misc16BitScratch                EQU     CMisc16BitScratch
0000                  (      romdefs.asm):01824         PixMaskTable2Col                EQU     CPixMaskTable2Col
0000                  (      romdefs.asm):01825         PixMaskTable4Col                EQU     CPixMaskTable4Col
0000                  (      romdefs.asm):01826         PrinterCRLF                     EQU     CPrinterCRLF
0000                  (      romdefs.asm):01827         PrinterDirOut                   EQU     CPrinterDirOut
0000                  (      romdefs.asm):01828         PrinterOut                      EQU     CPrinterOut
0000                  (      romdefs.asm):01829         SecVecFIRQ                      EQU     CSecVecFIRQ
0000                  (      romdefs.asm):01830         SecVecIRQ                       EQU     CSecVecIRQ
0000                  (      romdefs.asm):01831         SecVecNMI                       EQU     CSecVecNMI
0000                  (      romdefs.asm):01832         SecVecSWI                       EQU     CSecVecSWI
0000                  (      romdefs.asm):01833         SecVecSWI2                      EQU     CSecVecSWI2
0000                  (      romdefs.asm):01834         SecVecSWI3                      EQU     CSecVecSWI3
0000                  (      romdefs.asm):01835         SerDLBaud                       EQU     CSerDLBaud
0000                  (      romdefs.asm):01836         SerDLTimeout                    EQU     CSerDLTimeout
0000                  (      romdefs.asm):01837         SndBeep                         EQU     CSndBeep
0000                  (      romdefs.asm):01838         SndDisable                      EQU     CSndDisable
0000                  (      romdefs.asm):01839         SndDotNoteScale                 EQU     CSndDotNoteScale
0000                  (      romdefs.asm):01840         SndDTOAOn                       EQU     CSndDTOAOn
0000                  (      romdefs.asm):01841         SndEnable                       EQU     CSndEnable
0000                  (      romdefs.asm):01842         SndLength                       EQU     CSndLength
0000                  (      romdefs.asm):01843         SndNoteLen                      EQU     CSndNoteLen
0000                  (      romdefs.asm):01844         SndOctave                       EQU     CSndOctave
0000                  (      romdefs.asm):01845         SndPitch                        EQU     CSndPitch
0000                  (      romdefs.asm):01846         SndPlayNote                     EQU     CSndPlayNote
0000                  (      romdefs.asm):01847         SndTempo                        EQU     CSndTempo
0000                  (      romdefs.asm):01848         SndTimerPlay                    EQU     CSndTimerPlay
0000                  (      romdefs.asm):01849         SndVolume                       EQU     CSndVolume
0000                  (      romdefs.asm):01850         SysBoot64                       EQU     CSysBoot64
0000                  (      romdefs.asm):01851         SysErr                          EQU     CSysErr
0000                  (      romdefs.asm):01852         SysErr2                         EQU     CSysErr2
0000                  (      romdefs.asm):01853         SysReadJoystick                 EQU     CSysReadJoystick
0000                  (      romdefs.asm):01854         SysReset                        EQU     CSysReset
0000                  (      romdefs.asm):01855         SysResetDA                      EQU     CSysResetDA
0000                  (      romdefs.asm):01856         SysSelJoystick                  EQU     CSysSelJoystick
0000                  (      romdefs.asm):01857         SysTimeVal                      EQU     CSysTimeVal
0000                  (      romdefs.asm):01858         SysWriteDA                      EQU     CSysWriteDA
0000                  (      romdefs.asm):01859         TextCapsLock                    EQU     CTextCapsLock
0000                  (      romdefs.asm):01860         TextClearLine                   EQU     CTextClearLine
0000                  (      romdefs.asm):01861         TextCls                         EQU     CTextCls
0000                  (      romdefs.asm):01862         TextClsChar                     EQU     CTextClsChar
0000                  (      romdefs.asm):01863         TextCursFalshCnt                EQU     CTextCursFalshCnt
0000                  (      romdefs.asm):01864         TextDevN                        EQU     CTextDevN
0000                  (      romdefs.asm):01865         TextKbdBuffAddr                 EQU     CTextKbdBuffAddr
0000                  (      romdefs.asm):01866         TextKbdDelay                    EQU     CTextKbdDelay
0000                  (      romdefs.asm):01867         TextKbdRollover                 EQU     CTextKbdRollover
0000                  (      romdefs.asm):01868         TextLastKey                     EQU     CTextLastKey
0000                  (      romdefs.asm):01869         TextOutChar                     EQU     CTextOutChar
0000                  (      romdefs.asm):01870         TextOutCRLF                     EQU     CTextOutCRLF
0000                  (      romdefs.asm):01871         TextOutNum16                    EQU     CTextOutNum16
0000                  (      romdefs.asm):01872         TextOutNumFPA0                  EQU     CTextOutNumFPA0
0000                  (      romdefs.asm):01873         TextOutQuestion                 EQU     CTextOutQuestion
0000                  (      romdefs.asm):01874         TextOutSpace                    EQU     CTextOutSpace
0000                  (      romdefs.asm):01875         TextOutString                   EQU     CTextOutString
0000                  (      romdefs.asm):01876         TextPrnAutoCRLF                 EQU     CTextPrnAutoCRLF
0000                  (      romdefs.asm):01877         TextPrnCommaW                   EQU     CTextPrnCommaW
0000                  (      romdefs.asm):01878         TextPrnCurrCol                  EQU     CTextPrnCurrCol
0000                  (      romdefs.asm):01879         TextPrnEOLCnt                   EQU     CTextPrnEOLCnt
0000                  (      romdefs.asm):01880         TextPrnEOLSeq                   EQU     CTextPrnEOLSeq
0000                  (      romdefs.asm):01881         TextPrnLastComma                EQU     CTextPrnLastComma
0000                  (      romdefs.asm):01882         TextPrnLineW                    EQU     CTextPrnLineW
0000                  (      romdefs.asm):01883         TextPrnSelFlag                  EQU     CTextPrnSelFlag
0000                  (      romdefs.asm):01884         TextResetVDU                    EQU     CTextResetVDU
0000                  (      romdefs.asm):01885         TextScanKbd                     EQU     CTextScanKbd
0000                  (      romdefs.asm):01886         TextSerBaudRate                 EQU     CTextSerBaudRate
0000                  (      romdefs.asm):01887         TextSerEOLDelay                 EQU     CTextSerEOLDelay
0000                  (      romdefs.asm):01888         TextUpdateCurs                  EQU     CTextUpdateCurs
0000                  (      romdefs.asm):01889         TextVDUCommaW                   EQU     CTextVDUCommaW
0000                  (      romdefs.asm):01890         TextVDUCurrCol                  EQU     CTextVDUCurrCol
0000                  (      romdefs.asm):01891         TextVDUCursAddr                 EQU     CTextVDUCursAddr
0000                  (      romdefs.asm):01892         TextVDULastComma                EQU     CTextVDULastComma
0000                  (      romdefs.asm):01893         TextVDULineW                    EQU     CTextVDULineW
0000                  (      romdefs.asm):01894         TextVDUOut                      EQU     CTextVDUOut
0000                  (      romdefs.asm):01895         TextWaitKey                     EQU     CTextWaitKey
0000                  (      romdefs.asm):01896         TextWaitKeyCurs                 EQU     CTextWaitKeyCurs
0000                  (      romdefs.asm):01897         TextWaitKeyCurs2                EQU     CTextWaitKeyCurs2
0000                  (      romdefs.asm):01898         UtilCopyBXtoU                   EQU     CUtilCopyBXtoU
0000                  (      romdefs.asm):01899         VarAssign16Bit                  EQU     CVarAssign16Bit
0000                  (      romdefs.asm):01900         VarAssign16Bit2                 EQU     CVarAssign16Bit2
0000                  (      romdefs.asm):01901         VarAssign16BitB                 EQU     CVarAssign16BitB
0000                  (      romdefs.asm):01902         VarAssign8Bit                   EQU     CVarAssign8Bit
0000                  (      romdefs.asm):01903         VarCKChar                       EQU     CVarCKChar
0000                  (      romdefs.asm):01904         VarCKClBrac                     EQU     CVarCKClBrac
0000                  (      romdefs.asm):01905         VarCKComma                      EQU     CVarCKComma
0000                  (      romdefs.asm):01906         VarCKOpBrac                     EQU     CVarCKOpBrac
0000                  (      romdefs.asm):01907         VarDelVar                       EQU     CVarDelVar
0000                  (      romdefs.asm):01908         VarGarbageCollect               EQU     CVarGarbageCollect
0000                  (      romdefs.asm):01909         VarGet16Bit                     EQU     CVarGet16Bit
0000                  (      romdefs.asm):01910         VarGet8Bit                      EQU     CVarGet8Bit
0000                  (      romdefs.asm):01911         VarGetComma8                    EQU     CVarGetComma8
0000                  (      romdefs.asm):01912         VarGetExpr                      EQU     CVarGetExpr
0000                  (      romdefs.asm):01913         VarGetExprCC                    EQU     CVarGetExprCC
0000                  (      romdefs.asm):01914         VarGetStr                       EQU     CVarGetStr
0000                  (      romdefs.asm):01915         VarGetUsr                       EQU     CVarGetUsr
0000                  (      romdefs.asm):01916         VarGetVar                       EQU     CVarGetVar
0000                  (      romdefs.asm):01917         VarNormFPA0                     EQU     CVarNormFPA0
0000                  (      romdefs.asm):01918         VectAccessScreen                EQU     CVectAccessScreen
0000                  (      romdefs.asm):01919         VectAssignStr                   EQU     CVectAssignStr
0000                  (      romdefs.asm):01920         VectBase                        EQU     CVectBase
0000                  (      romdefs.asm):01921         VectCheckEOF                    EQU     CVectCheckEOF
0000                  (      romdefs.asm):01922         VectCheckKeys                   EQU     CVectCheckKeys
0000                  (      romdefs.asm):01923         VectCloseAllFiles               EQU     CVectCloseAllFiles
0000                  (      romdefs.asm):01924         VectCloseFile                   EQU     CVectCloseFile
0000                  (      romdefs.asm):01925         VectCloseFileCmd                EQU     CVectCloseFileCmd
0000                  (      romdefs.asm):01926         VectCmdInterp                   EQU     CVectCmdInterp
0000                  (      romdefs.asm):01927         VectDeTokenize                  EQU     CVectDeTokenize
0000                  (      romdefs.asm):01928         VectDevInit                     EQU     CVectDevInit
0000                  (      romdefs.asm):01929         VectDevNo                       EQU     CVectDevNo
0000                  (      romdefs.asm):01930         VectDevOpen                     EQU     CVectDevOpen
0000                  (      romdefs.asm):01931         VectEvaluateExpr                EQU     CVectEvaluateExpr
0000                  (      romdefs.asm):01932         VectGetNextCmd                  EQU     CVectGetNextCmd
0000                  (      romdefs.asm):01933         VectInChar                      EQU     CVectInChar
0000                  (      romdefs.asm):01934         VectInputFile                   EQU     CVectInputFile
0000                  (      romdefs.asm):01935         VectLineInputFile               EQU     CVectLineInputFile
0000                  (      romdefs.asm):01936         VectOutChar                     EQU     CVectOutChar
0000                  (      romdefs.asm):01937         VectOutputFile                  EQU     CVectOutputFile
0000                  (      romdefs.asm):01938         VectReReqestIn                  EQU     CVectReReqestIn
0000                  (      romdefs.asm):01939         VectResetBasMem                 EQU     CVectResetBasMem
0000                  (      romdefs.asm):01940         VectRunLink                     EQU     CVectRunLink
0000                  (      romdefs.asm):01941         VectSysError                    EQU     CVectSysError
0000                  (      romdefs.asm):01942         VectTokenize                    EQU     CVectTokenize
0000                  (      romdefs.asm):01943         VectUserError                   EQU     CVectUserError
0000                  (      romdefs.asm):01944         WarmStart                       EQU     CWarmStart
0000                  (      romdefs.asm):01945         WarmStartFlag                   EQU     CWarmStartFlag
                      (      romdefs.asm):01946         
                      (      romdefs.asm):01947                                 ENDC
                      (      romdefs.asm):01948                                 
     008A             (      romdefs.asm):01949         DBZero          EQU     Misc16BitScratch ; this is always set to Zero.
                      (      romdefs.asm):01950                                 
     003A             (      romdefs.asm):01951         StackBuf        equ     $3A             ; stack buffer size
     003D             (      romdefs.asm):01952         RelPTR          equ     $03D            ; Tempory arithmetic/logical table ptr
     00FA             (      romdefs.asm):01953         LineBufMax      equ     250             ; maximum line buffer length
                      (      romdefs.asm):01954         
                      (      romdefs.asm):01955         ; For compatibility with CoCo ROM listings
                      (      romdefs.asm):01956         ; first floating point accumulator
     004F             (      romdefs.asm):01957         FP0EXP          equ     BasVarFPAcc1    ; exponent
     0050             (      romdefs.asm):01958         FPA0            equ     BasVarFPAcc1+1  ; mantissa
     0054             (      romdefs.asm):01959         FP0SGN          equ     BasVarFPAcc1+5  ; sign
     0055             (      romdefs.asm):01960         COEFCT          equ     BasVarFPAcc1+6  ; polynomial coeficient counter
     0056             (      romdefs.asm):01961         StrDesc         equ     BasVarFPAcc1+7  ; tempory string descriptor (5 bytes)
                      (      romdefs.asm):01962         
                      (      romdefs.asm):01963         ; second floating point accumulator
     005C             (      romdefs.asm):01964         FP1EXP          equ     BasVarFPAcc2    ; exponent $5C
     005D             (      romdefs.asm):01965         FPA1            equ     BasVarFPAcc2+1  ; mantissa $5D
     0061             (      romdefs.asm):01966         FP1SGN          equ     BasVarFPAcc2+5  ; sign $61
     0062             (      romdefs.asm):01967         ResSGN          equ     BasVarFPAcc2+6  ; sign of result of FP operation $62
     0063             (      romdefs.asm):01968         FPSByte         equ     BasVarFPAcc2+7  ; floating point sub byte $63
     0064             (      romdefs.asm):01969         CoefPTR         equ     BasVarFPAcc2+8  ; Coeficient pointer
                      (      romdefs.asm):01970         
     005B             (      romdefs.asm):01971         FPCARY          equ     $005B   
                      (      romdefs.asm):01972         
     0013             (      romdefs.asm):01973         FPA2            equ     BasTempFPA2     ; FPA2
                      (      romdefs.asm):01974         
     00AB             (      romdefs.asm):01975         VarAB           equ     $00AB           ; temp vars / RND
     00AC             (      romdefs.asm):01976         VarAC           equ     $00AC           ; temp vars / RND
     00AD             (      romdefs.asm):01977         VarAD           equ     $00AD           ; temp vars / RND
     00AE             (      romdefs.asm):01978         VarAE           equ     $00AE           ; temp vars / RND
                      (      romdefs.asm):01979         
                      (      romdefs.asm):01980         ;
                      (      romdefs.asm):01981         ; Device numbers
                      (      romdefs.asm):01982         ;
                      (      romdefs.asm):01983         
     0000             (      romdefs.asm):01984         DevConsole      equ     0               ; console
     FFFF             (      romdefs.asm):01985         DevCasette      equ     -1              ; cassette
     FFFE             (      romdefs.asm):01986         DevPrinter      equ     -2              ; printer
                      (      romdefs.asm):01987                 
                      (      romdefs.asm):01988         ;
                      (      romdefs.asm):01989         ; Cassette file types
                      (      romdefs.asm):01990         ;
     0055             (      romdefs.asm):01991         SyncByte        equ     $55             ; Sync byte in cassete files
     003C             (      romdefs.asm):01992         BlockBegin      equ     $3C             ; Begining of block marker
                      (      romdefs.asm):01993         
                      (      romdefs.asm):01994         ;Block Types
     0000             (      romdefs.asm):01995         BtFileName      equ     $00             ; File name block
     0001             (      romdefs.asm):01996         BtData          equ     $01             ; Data block
     00FF             (      romdefs.asm):01997         BtEOF           equ     $FF             ; End of file block
                      (      romdefs.asm):01998         
     000F             (      romdefs.asm):01999         FNameBlockLen   equ     15              ; 15 bytes in header block
     0008             (      romdefs.asm):02000         CasFilenameLen  equ     8               ; Cassette filename length
     00FA             (      romdefs.asm):02001         DefBlockSize    equ     250             ; Default block size
                      (      romdefs.asm):02002         
                      (      romdefs.asm):02003         ;File Types, as stored in filename block
     0000             (      romdefs.asm):02004         FtBasic         equ     $00             ; Basic program
     0001             (      romdefs.asm):02005         FtDataFile      equ     $01             ; Data file
     0002             (      romdefs.asm):02006         FtMachineCode   equ     $02             ; Machine code program
     0003             (      romdefs.asm):02007         FtBinary        equ     $03             ; Binary file
     0088             (      romdefs.asm):02008         FtDream         equ     $88             ; Dream Assembler source file
     00FF             (      romdefs.asm):02009         FtHeaderless    equ     $FF             ; Headerless
                      (      romdefs.asm):02010         
                      (      romdefs.asm):02011         ;Ascii/Binary flag from filename block
     00FF             (      romdefs.asm):02012         AsAscii         equ     $FF             ; ASCII file
     0000             (      romdefs.asm):02013         AsBinary        equ     $00             ; Binary file (tokenised basic)
                      (      romdefs.asm):02014         
                      (      romdefs.asm):02015         ; Gap Flag from filename block
     0000             (      romdefs.asm):02016         GfUngapped      equ     $00             ; No gaps
     00FF             (      romdefs.asm):02017         GfGapped        equ     $FF             ; Gaps between blocks
                      (      romdefs.asm):02018         
                      (      romdefs.asm):02019         ; Cassette file IO types
     0001             (      romdefs.asm):02020         CasInputFile    equ     1               ; input file
     0002             (      romdefs.asm):02021         CasOutputFile   equ     2               ; output file
                      (      romdefs.asm):02022         
                      (      romdefs.asm):02023         ;
                      (      romdefs.asm):02024         ; Screen metrics.
                      (      romdefs.asm):02025         ;
     00FF             (      romdefs.asm):02026         GrMaxX          equ     255             ; Maximum X co-ordinate
     00BF             (      romdefs.asm):02027         GrMaxY          equ     191             ; Maximum Y co-ordinate
     0008             (      romdefs.asm):02028         GrMaxColour     equ     8               ; maximum colour number
     0004             (      romdefs.asm):02029         GrMaxPmode      equ     4               ; maximum pmode 
     0001             (      romdefs.asm):02030         GrMaxColourSet  equ     1               ; maximum colour set    
     0008             (      romdefs.asm):02031         GrMaxPages      equ     8               ; maximum PCLEAR pages
     0600             (      romdefs.asm):02032         GrPageSize      equ     $600            ; Graphic (pclear) page size in bytes
                      (      romdefs.asm):02033         
     0006             (      romdefs.asm):02034         GrStartPage     equ     $06             ; default start page for graphics memory $0600
     001E             (      romdefs.asm):02035         BasStartPage    equ     $1E             ; default start page for basic program $1E00
                      (      romdefs.asm):02036         
     0400             (      romdefs.asm):02037         TextScreenBase  equ     $0400           ; base of text screen
     0600             (      romdefs.asm):02038         GrScreenBase    equ     $0600           ; base of graphics pages
     0200             (      romdefs.asm):02039         TextScreenLen   equ     $0200           ; Length of text screen
     05FF             (      romdefs.asm):02040         TextScreenLast  equ     (TextScreenBase+TextScreenLen)-1        ; last character of text screen
                      (      romdefs.asm):02041         
                      (      romdefs.asm):02042         ;
                      (      romdefs.asm):02043         ; Lo-res colour masks
                      (      romdefs.asm):02044         ;
                      (      romdefs.asm):02045         
     0000             (      romdefs.asm):02046         MaskGreen       equ     $00             ; Green
     0010             (      romdefs.asm):02047         MaskYellow      equ     $10             ; Yellow
     0020             (      romdefs.asm):02048         MaskBlue        equ     $20             ; Blue
     0030             (      romdefs.asm):02049         MaskRed         equ     $30             ; red
     0040             (      romdefs.asm):02050         MaskBuff        equ     $40             ; buff / white
     0050             (      romdefs.asm):02051         MaskCyan        equ     $50             ; cyan
     0060             (      romdefs.asm):02052         MaskMagenta     equ     $60             ; magenta
     0070             (      romdefs.asm):02053         MaskOrange      equ     $70             ; orange
                      (      romdefs.asm):02054         
     0010             (      romdefs.asm):02055         LRGColourDiff   equ     $10             ; difference between colours    
                      (      romdefs.asm):02056         
                      (      romdefs.asm):02057         ;
                      (      romdefs.asm):02058         ; Lo-res pixel masks
                      (      romdefs.asm):02059         ;
     0008             (      romdefs.asm):02060         MaskUpR         equ     $08             ; upper right
     0004             (      romdefs.asm):02061         MaskUpL         equ     $04             ; upper left
     0002             (      romdefs.asm):02062         MaskLowR        equ     $02             ; lower right
     0001             (      romdefs.asm):02063         MaskLowL        equ     $01             ; lower left
     000F             (      romdefs.asm):02064         MaskAllOn       equ     (MaskUpR+MaskUpL+MaskLowR+MaskLowL)     ; all on
     0000             (      romdefs.asm):02065         MaskAllOff      equ     $00             ; all off
                      (      romdefs.asm):02066         
     0080             (      romdefs.asm):02067         MaskLRG         equ     $80             ; low res graphics
                      (      romdefs.asm):02068         
                      (      romdefs.asm):02069         ; 
                      (      romdefs.asm):02070         ; Lo-res (semigraphics) and text screen metrics.
                      (      romdefs.asm):02071         ;
                      (      romdefs.asm):02072         
     003F             (      romdefs.asm):02073         LoMaxX          equ     63              ; Maximum lo-res X co-ordinate
     001F             (      romdefs.asm):02074         LoMaxY          equ     31              ; Maximum lo-res Y co-ordinate
     0008             (      romdefs.asm):02075         LoMaxColour     equ     8               ; max lo-res colour
     0020             (      romdefs.asm):02076         TextCharsLine   equ     32              ; Text/Lo-res character cells per line
                      (      romdefs.asm):02077         
                      (      romdefs.asm):02078         ;
                      (      romdefs.asm):02079         ; Cartridge entry points
                      (      romdefs.asm):02080         ;
                      (      romdefs.asm):02081         
     C000             (      romdefs.asm):02082         CartBase        equ     $c000           ; cartridge area base
     C000             (      romdefs.asm):02083         CartEntryFIRQ   equ     CartBase        ; entry point when FIRQ generated
     C002             (      romdefs.asm):02084         CartEntryDOS    equ     CartBase+2      ; entry point when dos flag found 'DK' at $C000
     444B             (      romdefs.asm):02085         CartDOSFlag     equ     $444B           ; Dos flag word : 'DK' 
                      (      romdefs.asm):02086         
                      (      romdefs.asm):02087         ;
                      (      romdefs.asm):02088         ; Dragon 64 RAM basic stuff
                      (      romdefs.asm):02089         ;
                      (      romdefs.asm):02090         
     C000             (      romdefs.asm):02091         D64RAMBase      equ     $C000           ; Dragon 64 RAM basic starts at $c000
     FEFF             (      romdefs.asm):02092         D64RAMTop       equ     $FEFF           ; Dragon 64 RAM ends here 
                      (      romdefs.asm):02093         
                      (      romdefs.asm):02094         ;
                      (      romdefs.asm):02095         ; Firmware flag used by warm start and RAM basic boot
                      (      romdefs.asm):02096         ;
     0055             (      romdefs.asm):02097         FFlagTrue       equ     $55             ; flag initialised / true
     0012             (      romdefs.asm):02098         NOPFlag         equ     $12             ; op-code fro NOP, used to mark start of reset vector           
                      (      romdefs.asm):02099         
                      (      romdefs.asm):02100         ;
                      (      romdefs.asm):02101         ; General evaluation vars, multiple uses
                      (      romdefs.asm):02102         ;
                      (      romdefs.asm):02103         
     0037             (      romdefs.asm):02104         Eval37  equ     $37
     0038             (      romdefs.asm):02105         Eval38  equ     $38
     0039             (      romdefs.asm):02106         Eval39  equ     $39
     003A             (      romdefs.asm):02107         Eval3A  equ     $3A
     003B             (      romdefs.asm):02108         Eval3B  equ     $3B
     003C             (      romdefs.asm):02109         Eval3C  equ     $3C
     003E             (      romdefs.asm):02110         Eval3E  equ     $3E
     003F             (      romdefs.asm):02111         Eval3F  equ     $3F
                      (      romdefs.asm):02112         
     0040             (      romdefs.asm):02113         Eval40  equ     $40
     0041             (      romdefs.asm):02114         Eval41  equ     $41
     0042             (      romdefs.asm):02115         Eval42  equ     $42
     0043             (      romdefs.asm):02116         Eval43  equ     $43
     0044             (      romdefs.asm):02117         Eval44  equ     $44
     0045             (      romdefs.asm):02118         Eval45  equ     $45
     0046             (      romdefs.asm):02119         Eval46  equ     $46
     0047             (      romdefs.asm):02120         Eval47  equ     $47
     0048             (      romdefs.asm):02121         Eval48  equ     $48
     0049             (      romdefs.asm):02122         Eval49  equ     $49
     004A             (      romdefs.asm):02123         Eval4A  equ     $4A
     004B             (      romdefs.asm):02124         Eval4B  equ     $4B
     004C             (      romdefs.asm):02125         Eval4C  equ     $4C
     004D             (      romdefs.asm):02126         Eval4D  equ     $4D
     004E             (      romdefs.asm):02127         Eval4E  equ     $4E
                      (      romdefs.asm):02128         
     00CF             (      romdefs.asm):02129         EvalCF  equ     $CF
                      (      romdefs.asm):02130         
     00D1             (      romdefs.asm):02131         EvalD1  equ     $D1
     00D2             (      romdefs.asm):02132         EvalD2  equ     $D2
     00D3             (      romdefs.asm):02133         EvalD3  equ     $D3
     00D4             (      romdefs.asm):02134         EvalD4  equ     $D4
     00D5             (      romdefs.asm):02135         EvalD5  equ     $D5
     00D6             (      romdefs.asm):02136         EvalD6  equ     $D6
     00D7             (      romdefs.asm):02137         EvalD7  equ     $D7
     00D8             (      romdefs.asm):02138         EvalD8  equ     $D8
     00D9             (      romdefs.asm):02139         EvalD9  equ     $D9
     00DA             (      romdefs.asm):02140         EvalDA  equ     $DA
     00DB             (      romdefs.asm):02141         EvalDB  equ     $DB
     00DC             (      romdefs.asm):02142         EvalDC  equ     $DC     
                      (      romdefs.asm):02143         
     0047             (      romdefs.asm):02144         BasFoundLineNo  EQU     Eval47          ; Address of line number found by BasFindLineNo
                      (       ddos2f.asm):00010                         use     basictokens.asm
                      (  basictokens.asm):00001         ;
                      (  basictokens.asm):00002         ; BasicTokens.asm
                      (  basictokens.asm):00003         ;
                      (  basictokens.asm):00004         ; Values for Dragon and CoCo basic tokens.
                      (  basictokens.asm):00005         ;
                      (  basictokens.asm):00006         
                      (  basictokens.asm):00007         ;
                      (  basictokens.asm):00008         ; Dragon Commands
                      (  basictokens.asm):00009         ;
                      (  basictokens.asm):00010         
     0080             (  basictokens.asm):00011         DTokFOR         EQU     $80
     0081             (  basictokens.asm):00012         DTokGO          EQU     $81
     0082             (  basictokens.asm):00013         DTokREM         EQU     $82
     0083             (  basictokens.asm):00014         DTokREMComma    EQU     $83
     0084             (  basictokens.asm):00015         DTokELSE        EQU     $84
     0085             (  basictokens.asm):00016         DTokIF          EQU     $85
     0086             (  basictokens.asm):00017         DTokDATA        EQU     $86
     0087             (  basictokens.asm):00018         DTokPRINT       EQU     $87
     0088             (  basictokens.asm):00019         DTokON          EQU     $88
     0089             (  basictokens.asm):00020         DTokINPUT       EQU     $89
     008A             (  basictokens.asm):00021         DTokEND         EQU     $8A
     008B             (  basictokens.asm):00022         DTokNEXT        EQU     $8B
     008C             (  basictokens.asm):00023         DTokDIM         EQU     $8C
     008D             (  basictokens.asm):00024         DTokREAD        EQU     $8D
     008E             (  basictokens.asm):00025         DTokLET         EQU     $8E
     008F             (  basictokens.asm):00026         DTokRUN         EQU     $8F
     0090             (  basictokens.asm):00027         DTokRESTORE     EQU     $90
     0091             (  basictokens.asm):00028         DTokRETURN      EQU     $91
     0092             (  basictokens.asm):00029         DTokSTOP        EQU     $92
     0093             (  basictokens.asm):00030         DTokPOKE        EQU     $93
     0094             (  basictokens.asm):00031         DTokCONT        EQU     $94
     0095             (  basictokens.asm):00032         DTokLIST        EQU     $95
     0096             (  basictokens.asm):00033         DTokCLEAR       EQU     $96
     0097             (  basictokens.asm):00034         DTokNEW         EQU     $97
     0098             (  basictokens.asm):00035         DTokDEF         EQU     $98
     0099             (  basictokens.asm):00036         DTokCLOAD       EQU     $99
     009A             (  basictokens.asm):00037         DTokCSAVE       EQU     $9A
     009B             (  basictokens.asm):00038         DTokOPEN        EQU     $9B
     009C             (  basictokens.asm):00039         DTokCLOSE       EQU     $9C
     009D             (  basictokens.asm):00040         DTokLLIST       EQU     $9D
     009E             (  basictokens.asm):00041         DTokSET         EQU     $9E
     009F             (  basictokens.asm):00042         DTokRESET       EQU     $9F
     00A0             (  basictokens.asm):00043         DTokCLS         EQU     $A0
     00A1             (  basictokens.asm):00044         DTokMOTOR       EQU     $A1
     00A2             (  basictokens.asm):00045         DTokSOUND       EQU     $A2
     00A3             (  basictokens.asm):00046         DTokAUDIO       EQU     $A3
     00A4             (  basictokens.asm):00047         DTokEXEC        EQU     $A4
     00A5             (  basictokens.asm):00048         DTokSKIPF       EQU     $A5
     00A6             (  basictokens.asm):00049         DTokDELETE      EQU     $A6
     00A7             (  basictokens.asm):00050         DTokEDIT        EQU     $A7
     00A8             (  basictokens.asm):00051         DTokTRON        EQU     $A8
     00A9             (  basictokens.asm):00052         DTokTROFF       EQU     $A9
     00AA             (  basictokens.asm):00053         DTokLINE        EQU     $AA
     00AB             (  basictokens.asm):00054         DTokPCLS        EQU     $AB
     00AC             (  basictokens.asm):00055         DTokPSET        EQU     $AC
     00AD             (  basictokens.asm):00056         DTokPRESET      EQU     $AD
     00AE             (  basictokens.asm):00057         DTokSCREEN      EQU     $AE
     00AF             (  basictokens.asm):00058         DTokPCLEAR      EQU     $AF
     00B0             (  basictokens.asm):00059         DTokCOLOR       EQU     $B0
     00B1             (  basictokens.asm):00060         DTokCIRCLE      EQU     $B1
     00B2             (  basictokens.asm):00061         DTokPAINT       EQU     $B2
     00B3             (  basictokens.asm):00062         DTokGET         EQU     $B3
     00B4             (  basictokens.asm):00063         DTokPUT         EQU     $B4
     00B5             (  basictokens.asm):00064         DTokDRAW        EQU     $B5
     00B6             (  basictokens.asm):00065         DTokPCOPY       EQU     $B6
     00B7             (  basictokens.asm):00066         DTokPMODE       EQU     $B7
     00B8             (  basictokens.asm):00067         DTokPLAY        EQU     $B8
     00B9             (  basictokens.asm):00068         DTokDLOAD       EQU     $B9
     00BA             (  basictokens.asm):00069         DTokRENUM       EQU     $BA
     00BB             (  basictokens.asm):00070         DTokTAB         EQU     $BB
     00BC             (  basictokens.asm):00071         DTokTO          EQU     $BC
     00BD             (  basictokens.asm):00072         DTokSUB         EQU     $BD
     00BE             (  basictokens.asm):00073         DTokFN          EQU     $BE
     00BF             (  basictokens.asm):00074         DTokTHEN        EQU     $BF
     00C0             (  basictokens.asm):00075         DTokNOT         EQU     $C0
     00C1             (  basictokens.asm):00076         DTokSTEP        EQU     $C1
     00C2             (  basictokens.asm):00077         DTokOFF         EQU     $C2
     00C3             (  basictokens.asm):00078         DTokPLUS        EQU     $C3
     00C4             (  basictokens.asm):00079         DTokMINUS       EQU     $C4
     00C5             (  basictokens.asm):00080         DTokTIMES       EQU     $C5
     00C6             (  basictokens.asm):00081         DTokDIVIDE      EQU     $C6
     00C7             (  basictokens.asm):00082         DTokAT          EQU     $C7
     00C8             (  basictokens.asm):00083         DTokAND         EQU     $C8
     00C9             (  basictokens.asm):00084         DTokOR          EQU     $C9
     00CA             (  basictokens.asm):00085         DTokGREATER     EQU     $CA
     00CB             (  basictokens.asm):00086         DTokEQUAL       EQU     $CB
     00CC             (  basictokens.asm):00087         DTokLESS        EQU     $CC
     00CD             (  basictokens.asm):00088         DTokUSING       EQU     $CD
                      (  basictokens.asm):00089         
     0080             (  basictokens.asm):00090         DTokFirstC      EQU     DTokFOR
     00CD             (  basictokens.asm):00091         DTokLastC       EQU     DTokUSING
                      (  basictokens.asm):00092         
                      (  basictokens.asm):00093         ;
                      (  basictokens.asm):00094         ; Dragon Functions
                      (  basictokens.asm):00095         ; Tokens are preceeded by $FF
                      (  basictokens.asm):00096         ;
                      (  basictokens.asm):00097         
     0080             (  basictokens.asm):00098         DTokSGN         EQU     $80
     0081             (  basictokens.asm):00099         DTokINT         EQU     $81
     0082             (  basictokens.asm):00100         DTokABS         EQU     $82
     0083             (  basictokens.asm):00101         DTokPOS         EQU     $83
     0084             (  basictokens.asm):00102         DTokRND         EQU     $84
     0085             (  basictokens.asm):00103         DTokSQR         EQU     $85
     0086             (  basictokens.asm):00104         DTokLOG         EQU     $86
     0087             (  basictokens.asm):00105         DTokEXP         EQU     $87
     0088             (  basictokens.asm):00106         DTokSIN         EQU     $88
     0089             (  basictokens.asm):00107         DTokCOS         EQU     $89
     008A             (  basictokens.asm):00108         DTokTAN         EQU     $8A
     008B             (  basictokens.asm):00109         DTokATN         EQU     $8B
     008C             (  basictokens.asm):00110         DTokPEEK        EQU     $8C
     008D             (  basictokens.asm):00111         DTokLEN         EQU     $8D
     008E             (  basictokens.asm):00112         DTokSTRS        EQU     $8E
     008F             (  basictokens.asm):00113         DTokVAL         EQU     $8F
     0090             (  basictokens.asm):00114         DTokASC         EQU     $90
     0091             (  basictokens.asm):00115         DTokCHRS        EQU     $91
     0092             (  basictokens.asm):00116         DTokEOF         EQU     $92
     0093             (  basictokens.asm):00117         DTokJOYSTK      EQU     $93
     0094             (  basictokens.asm):00118         DTokFIX         EQU     $94
     0095             (  basictokens.asm):00119         DTokHEXS        EQU     $95
     0096             (  basictokens.asm):00120         DTokLEFTS       EQU     $96
     0097             (  basictokens.asm):00121         DTokRIGHTS      EQU     $97
     0098             (  basictokens.asm):00122         DTokMIDS        EQU     $98
     0099             (  basictokens.asm):00123         DTokPOINT       EQU     $99
     009A             (  basictokens.asm):00124         DTokINKEYS      EQU     $9A
     009B             (  basictokens.asm):00125         DTokMEM         EQU     $9B
     009C             (  basictokens.asm):00126         DTokVARPTR      EQU     $9C
     009D             (  basictokens.asm):00127         DTokINSTR       EQU     $9D
     009E             (  basictokens.asm):00128         DTokTIMER       EQU     $9E
     009F             (  basictokens.asm):00129         DTokPPOINT      EQU     $9F
     00A0             (  basictokens.asm):00130         DTokSTRINGS     EQU     $A0
     00A1             (  basictokens.asm):00131         DTokUSR         EQU     $A1
                      (  basictokens.asm):00132         
     0080             (  basictokens.asm):00133         DTokFirstF      EQU     DTokSGN
     00A1             (  basictokens.asm):00134         DTokLastF       EQU     DTokUSR
     0021             (  basictokens.asm):00135         DTokCountF      EQU     (DTokLastF-DTokFirstF)
                      (  basictokens.asm):00136         
                      (  basictokens.asm):00137         ;
                      (  basictokens.asm):00138         ; DragonDOS / SuperDOS command tokens
                      (  basictokens.asm):00139         ;
     00CE             (  basictokens.asm):00140         DDTokAUTO       EQU     $CE     
     00CE             (  basictokens.asm):00141         DDTokBACKUP     EQU     $CE
     00D0             (  basictokens.asm):00142         DDTokBEEP       EQU     $D0
     00D1             (  basictokens.asm):00143         DDTokBOOT       EQU     $D1
     00D2             (  basictokens.asm):00144         DDTokCHAIN      EQU     $D2
     00D3             (  basictokens.asm):00145         DDTokCOPY       EQU     $D3
     00D4             (  basictokens.asm):00146         DDTokCREATE     EQU     $D4
     00D5             (  basictokens.asm):00147         DDTokDIR        EQU     $D5
     00D6             (  basictokens.asm):00148         DDTokDRIVE      EQU     $D6
     00D7             (  basictokens.asm):00149         DDTokDSKINIT    EQU     $D7
     00D8             (  basictokens.asm):00150         DDTokFREAD      EQU     $D8
     00D9             (  basictokens.asm):00151         DDTokFWRITE     EQU     $D9
     00DA             (  basictokens.asm):00152         DDTokERROR      EQU     $DA
     00DB             (  basictokens.asm):00153         DDTokKILL       EQU     $DB
     00DC             (  basictokens.asm):00154         DDTokLOAD       EQU     $DC
     00DD             (  basictokens.asm):00155         DDTokMERGE      EQU     $DD
     00DE             (  basictokens.asm):00156         DDTokPROTECT    EQU     $DE
     00DF             (  basictokens.asm):00157         DDTokWAIT       EQU     $DF
     00E0             (  basictokens.asm):00158         DDTokRENAME     EQU     $E0
     00E1             (  basictokens.asm):00159         DDTokSAVE       EQU     $E1
     00E2             (  basictokens.asm):00160         DDTokSREAD      EQU     $E2
     00E3             (  basictokens.asm):00161         DDTokSWRITE     EQU     $E3
     00E4             (  basictokens.asm):00162         DDTokVERIFY     EQU     $E4
     00E5             (  basictokens.asm):00163         DDTokFROM       EQU     $E5
     00E6             (  basictokens.asm):00164         DDTokFLREAD     EQU     $E6
     00E7             (  basictokens.asm):00165         DDTokSWAP       EQU     $E7
                      (  basictokens.asm):00166         
     00CE             (  basictokens.asm):00167         DDTokFirstC     EQU     DDTokAUTO       ; First + Last Dragondos command Token
     00E7             (  basictokens.asm):00168         DDTokLastC      EQU     DDTokSWAP
     001A             (  basictokens.asm):00169         DDTokCountC     EQU     (DDTokLastC-DDTokFirstC)+1
                      (  basictokens.asm):00170         ;
                      (  basictokens.asm):00171         ; DragonDOS / SuperDOS function tokens
                      (  basictokens.asm):00172         ;
                      (  basictokens.asm):00173         
     00A2             (  basictokens.asm):00174         DDTokLOF        EQU     $A2
     00A3             (  basictokens.asm):00175         DDTokFREE       EQU     $A3
     00A4             (  basictokens.asm):00176         DDTokERL        EQU     $A4
     00A5             (  basictokens.asm):00177         DDTokERR        EQU     $A5
     00A6             (  basictokens.asm):00178         DDTokHIMEM      EQU     $A6
     00A7             (  basictokens.asm):00179         DDTokLOC        EQU     $A7
     00A8             (  basictokens.asm):00180         DDTokFRES       EQU     $A8
                      (  basictokens.asm):00181         
     00A2             (  basictokens.asm):00182         DDTokFirstF     EQU     DDTokLOF        ; First + Last Dragondos function Token
     00A8             (  basictokens.asm):00183         DDTokLastF      EQU     DDTokFRES
     0007             (  basictokens.asm):00184         DDTokCountF     EQU     (DDTokLastF-DDTokFirstF)+1
                      (  basictokens.asm):00185         
                      (  basictokens.asm):00186         ; CoCo 1/2 Commands
                      (  basictokens.asm):00187         ;
                      (  basictokens.asm):00188         
     0080             (  basictokens.asm):00189         CTokFOR         EQU     $80
     0081             (  basictokens.asm):00190         CTokGO          EQU     $81
     0082             (  basictokens.asm):00191         CTokREM         EQU     $82
     0083             (  basictokens.asm):00192         CTokREMComma    EQU     $83
     0084             (  basictokens.asm):00193         CTokELSE        EQU     $84
     0085             (  basictokens.asm):00194         CTokIF          EQU     $85
     0086             (  basictokens.asm):00195         CTokDATA        EQU     $86
     0087             (  basictokens.asm):00196         CTokPRINT       EQU     $87
     0088             (  basictokens.asm):00197         CTokON          EQU     $88
     0089             (  basictokens.asm):00198         CTokINPUT       EQU     $89
     008A             (  basictokens.asm):00199         CTokEND         EQU     $8A
     008B             (  basictokens.asm):00200         CTokNEXT        EQU     $8B
     008C             (  basictokens.asm):00201         CTokDIM         EQU     $8C
     008D             (  basictokens.asm):00202         CTokREAD        EQU     $8D
     00BA             (  basictokens.asm):00203         CTokLET         EQU     $BA
     008E             (  basictokens.asm):00204         CTokRUN         EQU     $8E
     008F             (  basictokens.asm):00205         CTokRESTORE     EQU     $8F
     0090             (  basictokens.asm):00206         CTokRETURN      EQU     $90
     0091             (  basictokens.asm):00207         CTokSTOP        EQU     $91
     0092             (  basictokens.asm):00208         CTokPOKE        EQU     $92
     0093             (  basictokens.asm):00209         CTokCONT        EQU     $93
     0094             (  basictokens.asm):00210         CTokLIST        EQU     $94
     0095             (  basictokens.asm):00211         CTokCLEAR       EQU     $95
     0096             (  basictokens.asm):00212         CTokNEW         EQU     $96
     00B9             (  basictokens.asm):00213         CTokDEF         EQU     $B9
     0097             (  basictokens.asm):00214         CTokCLOAD       EQU     $97
     0098             (  basictokens.asm):00215         CTokCSAVE       EQU     $98
     0099             (  basictokens.asm):00216         CTokOPEN        EQU     $99
     009A             (  basictokens.asm):00217         CTokCLOSE       EQU     $9A
     009B             (  basictokens.asm):00218         CTokLLIST       EQU     $9B
     009C             (  basictokens.asm):00219         CTokSET         EQU     $9C
     009D             (  basictokens.asm):00220         CTokRESET       EQU     $9D
     009E             (  basictokens.asm):00221         CTokCLS         EQU     $9E
     009F             (  basictokens.asm):00222         CTokMOTOR       EQU     $9F
     00A0             (  basictokens.asm):00223         CTokSOUND       EQU     $A0
     00A1             (  basictokens.asm):00224         CTokAUDIO       EQU     $A1
     00A2             (  basictokens.asm):00225         CTokEXEC        EQU     $A2
     00A3             (  basictokens.asm):00226         CTokSKIPF       EQU     $A3
     00B5             (  basictokens.asm):00227         CTokDELETE      EQU     $B5
     00B6             (  basictokens.asm):00228         CTokEDIT        EQU     $B6
     00B7             (  basictokens.asm):00229         CTokTRON        EQU     $B7
     00B8             (  basictokens.asm):00230         CTokTROFF       EQU     $B8
     00BB             (  basictokens.asm):00231         CTokLINE        EQU     $BB
     00BC             (  basictokens.asm):00232         CTokPCLS        EQU     $BC
     00BD             (  basictokens.asm):00233         CTokPSET        EQU     $BD
     00BE             (  basictokens.asm):00234         CTokPRESET      EQU     $BE
     00BF             (  basictokens.asm):00235         CTokSCREEN      EQU     $BF
     00C0             (  basictokens.asm):00236         CTokPCLEAR      EQU     $C0
     00C1             (  basictokens.asm):00237         CTokCOLOR       EQU     $C1
     00C2             (  basictokens.asm):00238         CTokCIRCLE      EQU     $C2
     00C3             (  basictokens.asm):00239         CTokPAINT       EQU     $C3
     00C4             (  basictokens.asm):00240         CTokGET         EQU     $C4
     00C5             (  basictokens.asm):00241         CTokPUT         EQU     $C5
     00C6             (  basictokens.asm):00242         CTokDRAW        EQU     $C6
     00C7             (  basictokens.asm):00243         CTokPCOPY       EQU     $C7
     00C8             (  basictokens.asm):00244         CTokPMODE       EQU     $C8
     00C9             (  basictokens.asm):00245         CTokPLAY        EQU     $C9
     00CA             (  basictokens.asm):00246         CTokDLOAD       EQU     $CA
     00CB             (  basictokens.asm):00247         CTokRENUM       EQU     $CB
     00A4             (  basictokens.asm):00248         CTokTAB         EQU     $A4
     00A5             (  basictokens.asm):00249         CTokTO          EQU     $A5
     00A6             (  basictokens.asm):00250         CTokSUB         EQU     $A6
     00CC             (  basictokens.asm):00251         CTokFN          EQU     $CC
     00A7             (  basictokens.asm):00252         CTokTHEN        EQU     $A7
     00A8             (  basictokens.asm):00253         CTokNOT         EQU     $A8
     00A9             (  basictokens.asm):00254         CTokSTEP        EQU     $A9
     00AA             (  basictokens.asm):00255         CTokOFF         EQU     $AA
     00AB             (  basictokens.asm):00256         CTokPLUS        EQU     $AB
     00AC             (  basictokens.asm):00257         CTokMINUS       EQU     $AC
     00AD             (  basictokens.asm):00258         CTokTIMES       EQU     $AD
     00AE             (  basictokens.asm):00259         CTokDIVIDE      EQU     $AE
     00AF             (  basictokens.asm):00260         CTokAT          EQU     $AF
     00B0             (  basictokens.asm):00261         CTokAND         EQU     $B0
     00B1             (  basictokens.asm):00262         CTokOR          EQU     $B1
     00B2             (  basictokens.asm):00263         CTokGREATER     EQU     $B2
     00B3             (  basictokens.asm):00264         CTokEQUAL       EQU     $B3
     00B4             (  basictokens.asm):00265         CTokLESS        EQU     $B4
     00CD             (  basictokens.asm):00266         CTokUSING       EQU     $CD
                      (  basictokens.asm):00267         
     0080             (  basictokens.asm):00268         CTokFirstC      EQU     CTokFOR
     ????             (  basictokens.asm):00269         CtokLastC       EQU     CTokUsing
                      (  basictokens.asm):00270         
                      (  basictokens.asm):00271         ;
                      (  basictokens.asm):00272         ; CoCo 1/2 Functions
                      (  basictokens.asm):00273         ; Tokens are preceeded by $FF
                      (  basictokens.asm):00274         ;
                      (  basictokens.asm):00275         
     0080             (  basictokens.asm):00276         CTokSGN         EQU     $80
     0081             (  basictokens.asm):00277         CTokINT         EQU     $81
     0082             (  basictokens.asm):00278         CTokABS         EQU     $82
     009A             (  basictokens.asm):00279         CTokPOS         EQU     $9A
     0084             (  basictokens.asm):00280         CTokRND         EQU     $84
     009B             (  basictokens.asm):00281         CTokSQR         EQU     $9B
     0099             (  basictokens.asm):00282         CTokLOG         EQU     $99
     0097             (  basictokens.asm):00283         CTokEXP         EQU     $97
     0085             (  basictokens.asm):00284         CTokSIN         EQU     $85
     0095             (  basictokens.asm):00285         CTokCOS         EQU     $95
     0096             (  basictokens.asm):00286         CTokTAN         EQU     $96
     0094             (  basictokens.asm):00287         CTokATN         EQU     $94
     0086             (  basictokens.asm):00288         CTokPEEK        EQU     $86
     0087             (  basictokens.asm):00289         CTokLEN         EQU     $87
     0088             (  basictokens.asm):00290         CTokSTRS        EQU     $88
     0089             (  basictokens.asm):00291         CTokVAL         EQU     $89
     008A             (  basictokens.asm):00292         CTokASC         EQU     $8A
     008B             (  basictokens.asm):00293         CTokCHRS        EQU     $8B
     008C             (  basictokens.asm):00294         CTokEOF         EQU     $8C
     008D             (  basictokens.asm):00295         CTokJOYSTK      EQU     $8D
     0098             (  basictokens.asm):00296         CTokFIX         EQU     $98
     009C             (  basictokens.asm):00297         CTokHEXS        EQU     $9C
     008E             (  basictokens.asm):00298         CTokLEFTS       EQU     $8E
     008F             (  basictokens.asm):00299         CTokRIGHTS      EQU     $8F
     0090             (  basictokens.asm):00300         CTokMIDS        EQU     $90
     0091             (  basictokens.asm):00301         CTokPOINT       EQU     $91
     0092             (  basictokens.asm):00302         CTokINKEYS      EQU     $92
     0093             (  basictokens.asm):00303         CTokMEM         EQU     $93
     009D             (  basictokens.asm):00304         CTokVARPTR      EQU     $9D
     009E             (  basictokens.asm):00305         CTokINSTR       EQU     $9E
     009F             (  basictokens.asm):00306         CTokTIMER       EQU     $9F
     00A0             (  basictokens.asm):00307         CTokPPOINT      EQU     $A0
     00A1             (  basictokens.asm):00308         CTokSTRINGS     EQU     $A1
     0083             (  basictokens.asm):00309         CTokUSR         EQU     $83
                      (  basictokens.asm):00310         
     0080             (  basictokens.asm):00311         CTokFirstF      EQU     CTokSGN
     00A1             (  basictokens.asm):00312         CTokLastF       EQU     CTokSTRINGS
                      (  basictokens.asm):00313         
                      (  basictokens.asm):00314         
                      (  basictokens.asm):00315         ;
                      (  basictokens.asm):00316         ; CoCo RS-DOS command tokens
                      (  basictokens.asm):00317         ;
                      (  basictokens.asm):00318         
     00CE             (  basictokens.asm):00319         CDTokDIR        EQU     $CE
     00CF             (  basictokens.asm):00320         CDTokDRIVE      EQU     $CF
     00D0             (  basictokens.asm):00321         CDTokFIELD      EQU     $D0
     00D1             (  basictokens.asm):00322         CDTokFILES      EQU     $D1
     00D2             (  basictokens.asm):00323         CDTokKILL       EQU     $D2
     00D3             (  basictokens.asm):00324         CDTokLOAD       EQU     $D3
     00D4             (  basictokens.asm):00325         CDTokLSET       EQU     $D4
     00D5             (  basictokens.asm):00326         CDTokMERGE      EQU     $D5
     00D6             (  basictokens.asm):00327         CDTokRENAME     EQU     $D6
     00D7             (  basictokens.asm):00328         CDTokRSET       EQU     $D7
     00D8             (  basictokens.asm):00329         CDTokSAVE       EQU     $D8
     00D9             (  basictokens.asm):00330         CDTokWRITE      EQU     $D9
     00DA             (  basictokens.asm):00331         CDTokVERIFY     EQU     $DA
     00DB             (  basictokens.asm):00332         CDTokUNLOAD     EQU     $DB
     00DC             (  basictokens.asm):00333         CDTokDSKINI     EQU     $DC
     00DD             (  basictokens.asm):00334         CDTokBACKUP     EQU     $DD
     00DE             (  basictokens.asm):00335         CDTokCOPY       EQU     $DE
     00DF             (  basictokens.asm):00336         CDTokDISKIS     EQU     $DF
     00E0             (  basictokens.asm):00337         CDTokDISKOS     EQU     $E0
                      (  basictokens.asm):00338         
     00CE             (  basictokens.asm):00339         CDTokFirstC     EQU     CDTokDIR        ; First RS-DOS command Token
     00E0             (  basictokens.asm):00340         CDTokLastC      EQU     CDTokDISKOS
     0013             (  basictokens.asm):00341         CDTokCountC     EQU     (CDTokLastC-CDTokFirstC)+1
                      (  basictokens.asm):00342         
                      (  basictokens.asm):00343         ;
                      (  basictokens.asm):00344         ; CoCo RS-DOS function tokens
                      (  basictokens.asm):00345         ;
                      (  basictokens.asm):00346         
     00A2             (  basictokens.asm):00347         CDTokCVN        EQU     $A2
     00A3             (  basictokens.asm):00348         CDTokFREE       EQU     $A3
     00A4             (  basictokens.asm):00349         CDTokLOC        EQU     $A4
     00A5             (  basictokens.asm):00350         CDTokLOF        EQU     $A5
     00A6             (  basictokens.asm):00351         CDTokMKNS       EQU     $A6
                      (  basictokens.asm):00352         
     00A2             (  basictokens.asm):00353         CDTokFirstF     EQU     CDTokCVN        ; First RS-DOS function Token
     00A6             (  basictokens.asm):00354         CDTokLastF      EQU     CDTokMKNS
     0005             (  basictokens.asm):00355         CDTokCountF     EQU     (CDTokLastF-CDTokFirstF)+1
                      (  basictokens.asm):00356         
                      (  basictokens.asm):00357         
     0005             (  basictokens.asm):00358         CmdTableSize    equ     5               ; 5 bytes in command table
     0005             (  basictokens.asm):00359         FuncTableSize   equ     5               ; 5 bytes in function table
     000A             (  basictokens.asm):00360         BasTableSize    equ     (CmdTableSize+FuncTableSize)
                      (  basictokens.asm):00361         
                      (  basictokens.asm):00362         ; offsets in command / function table stubs
     0000             (  basictokens.asm):00363         BasTableCount   equ     0               ; No of commands
     0001             (  basictokens.asm):00364         BasTableWords   equ     1               ; address of reserved word list
     0003             (  basictokens.asm):00365         BasTableAddrs   equ     3               ; address of dispatch address table
                      (  basictokens.asm):00366         
                      (  basictokens.asm):00367                         ifdef   Dragon
                      (  basictokens.asm):00368         
     00CE             (  basictokens.asm):00369         DOSTokFirstC    EQU     DDTokFirstC
     00E7             (  basictokens.asm):00370         DOSTokLastC     EQU     DDTokLastC
     001A             (  basictokens.asm):00371         DOSTokCountC    EQU     DDTokCountC
                      (  basictokens.asm):00372         
     00A2             (  basictokens.asm):00373         DOSTokFirstF    EQU     DDTokFirstF
     00A8             (  basictokens.asm):00374         DOSTokLastF     EQU     DDTokLastF
     0007             (  basictokens.asm):00375         DOSTokCountF    EQU     DDTokCountF
                      (  basictokens.asm):00376                         else
                      (  basictokens.asm):00377         
0000                  (  basictokens.asm):00378         DOSTokFirstC    EQU     CDTokFirstC
0000                  (  basictokens.asm):00379         DOSTokLastC     EQU     CDTokLastC
0000                  (  basictokens.asm):00380         DOSTokCountC    EQU     CDTokCountC
                      (  basictokens.asm):00381         
0000                  (  basictokens.asm):00382         DOSTokFirstF    EQU     CDTokFirstF
0000                  (  basictokens.asm):00383         DOSTokLastF     EQU     CDTokLastF
0000                  (  basictokens.asm):00384         DOSTokCountF    EQU     CDTokCountF
                      (  basictokens.asm):00385                         endc
                      (  basictokens.asm):00386         
                      (       ddos2f.asm):00011                         use     basicdefs.asm
                      (    basicdefs.asm):00001         ;
                      (    basicdefs.asm):00002         ; BasicDefs.asm : definitions for Dragon / CoCo BASIC.
                      (    basicdefs.asm):00003         ;
                      (    basicdefs.asm):00004         
     F9FF             (    basicdefs.asm):00005         BasMaxLineNo    EQU     $F9FF   ; Maximum allowable line number.
                      (    basicdefs.asm):00006         
                      (    basicdefs.asm):00007         ;
                      (    basicdefs.asm):00008         ; Dragon Basic Error codes
                      (    basicdefs.asm):00009         ; 
     0000             (    basicdefs.asm):00010         DBErrNF         EQU     $00             ; Next without for              
     0002             (    basicdefs.asm):00011         DBErrSN         EQU     $02             ; Syntax
     0004             (    basicdefs.asm):00012         DBErrRG         EQU     $04             ; Return without GOSUB
     0006             (    basicdefs.asm):00013         DBErrOD         EQU     $06             ; Out of Data
     0008             (    basicdefs.asm):00014         DBErrFC         EQU     $08             ; Function Call
     000A             (    basicdefs.asm):00015         DBErrOV         EQU     $0A             ; OVerflow
     000C             (    basicdefs.asm):00016         DBErrOM         EQU     $0C             ; Out of Memory
     000E             (    basicdefs.asm):00017         DBErrUL         EQU     $0E             ; Undefined Line
     0010             (    basicdefs.asm):00018         DBErrBS         EQU     $10             ; Bad Subscript
     0012             (    basicdefs.asm):00019         DBErrDD         EQU     $12             ; Direct Dimension
     0014             (    basicdefs.asm):00020         DBErrZD         EQU     $14             ; Zero Divide
     0016             (    basicdefs.asm):00021         DBErrID         EQU     $16             ; Illegal Direct
     0018             (    basicdefs.asm):00022         DBErrTM         EQU     $18             ; Type Mismatch
     001A             (    basicdefs.asm):00023         DBErrOS         EQU     $1A             ; Out of String space
     001C             (    basicdefs.asm):00024         DBErrLS         EQU     $1C             ; Long String (len > 255)
     001E             (    basicdefs.asm):00025         DBErrST         EQU     $1E             ; String formula Too complex
     0020             (    basicdefs.asm):00026         DBErrCN         EQU     $20             ; Can't coNtinue
     0022             (    basicdefs.asm):00027         DBErrUF         EQU     $22             ; Undefined Function
     0024             (    basicdefs.asm):00028         DBErrFD         EQU     $24             ; bad File Data
     0026             (    basicdefs.asm):00029         DBErrAO         EQU     $26             ; Already Open
     0028             (    basicdefs.asm):00030         DBErrDN         EQU     $28             ; Device Number
     002A             (    basicdefs.asm):00031         DBErrIO         EQU     $2A             ; Input Output
     002C             (    basicdefs.asm):00032         DBErrFM         EQU     $2C             ; File Mismatch
     002E             (    basicdefs.asm):00033         DBErrNO         EQU     $2E             ; file Not Open
     0030             (    basicdefs.asm):00034         DBErrIE         EQU     $30             ; Input past End of file
     0032             (    basicdefs.asm):00035         DBErrDS         EQU     $32             ; Direct Statement
     0034             (    basicdefs.asm):00036         DBErrNE         EQU     $34             ; file does Not Exist
                      (    basicdefs.asm):00037         
                      (    basicdefs.asm):00038         ;
                      (    basicdefs.asm):00039         ; CoCo Basic Error codes.
                      (    basicdefs.asm):00040         ;
                      (    basicdefs.asm):00041         
     0000             (    basicdefs.asm):00042         CBErrNF         EQU     $00             ; Next without for              
     0002             (    basicdefs.asm):00043         CBErrSN         EQU     $02             ; Syntax
     0004             (    basicdefs.asm):00044         CBErrRG         EQU     $04             ; Return without GOSUB
     0006             (    basicdefs.asm):00045         CBErrOD         EQU     $06             ; Out of Data
     0008             (    basicdefs.asm):00046         CBErrFC         EQU     $08             ; Function Call
     000A             (    basicdefs.asm):00047         CBErrOV         EQU     $0A             ; OVerflow
     000C             (    basicdefs.asm):00048         CBErrOM         EQU     $0C             ; Out of Memory
     000E             (    basicdefs.asm):00049         CBErrUL         EQU     $0E             ; Undefined Line
     0010             (    basicdefs.asm):00050         CBErrBS         EQU     $10             ; Bad Subscript
     0012             (    basicdefs.asm):00051         CBErrDD         EQU     $12             ; Direct Dimension
     0014             (    basicdefs.asm):00052         CBErrZD         EQU     $14             ; Zero Divide
     0016             (    basicdefs.asm):00053         CBErrID         EQU     $16             ; Illegal Direct
     0018             (    basicdefs.asm):00054         CBErrTM         EQU     $18             ; Type Mismatch
     001A             (    basicdefs.asm):00055         CBErrOS         EQU     $1A             ; Out of String space
     001C             (    basicdefs.asm):00056         CBErrLS         EQU     $1C             ; Long String (len > 255)
     001E             (    basicdefs.asm):00057         CBErrST         EQU     $1E             ; String formula Too complex
     0020             (    basicdefs.asm):00058         CBErrCN         EQU     $20             ; Can't coNtinue
                      (    basicdefs.asm):00059         
     0022             (    basicdefs.asm):00060         CBErrFD         EQU     $22             ; bad File Data
     0024             (    basicdefs.asm):00061         CBErrAO         EQU     $24             ; Already Open
     0026             (    basicdefs.asm):00062         CBErrDN         EQU     $26             ; Device Number
     0028             (    basicdefs.asm):00063         CBErrIO         EQU     $28             ; Input Output
     002A             (    basicdefs.asm):00064         CBErrFM         EQU     $2A             ; File Mismatch
     002C             (    basicdefs.asm):00065         CBErrNO         EQU     $2C             ; file Not Open
     002E             (    basicdefs.asm):00066         CBErrIE         EQU     $2E             ; Input past End of file
     0030             (    basicdefs.asm):00067         CBErrDS         EQU     $30             ; Direct Statement
                      (    basicdefs.asm):00068         
                      (    basicdefs.asm):00069         ;
                      (    basicdefs.asm):00070         ; CoCo Extended basic error codes
                      (    basicdefs.asm):00071         ;
                      (    basicdefs.asm):00072         
     0032             (    basicdefs.asm):00073         CBErrUF         EQU     $32             ; Undefined Function
     0034             (    basicdefs.asm):00074         CBErrNE         EQU     $34             ; file does Not Exist
                      (    basicdefs.asm):00075         
                      (    basicdefs.asm):00076                 ifdef   Dragon
     0000             (    basicdefs.asm):00077         BErrNF          EQU     DBErrNF         ; Next without for              
     0002             (    basicdefs.asm):00078         BErrSN          EQU     DBErrSN         ; Syntax
     0004             (    basicdefs.asm):00079         BErrRG          EQU     DBErrRG         ; Return without GOSUB
     0006             (    basicdefs.asm):00080         BErrOD          EQU     DBErrOD         ; Out of Data
     0008             (    basicdefs.asm):00081         BErrFC          EQU     DBErrFC         ; Function Call
     000A             (    basicdefs.asm):00082         BErrOV          EQU     DBErrOV         ; OVerflow
     000C             (    basicdefs.asm):00083         BErrOM          EQU     DBErrOM         ; Out of Memory
     000E             (    basicdefs.asm):00084         BErrUL          EQU     DBErrUL         ; Undefined Line
     0010             (    basicdefs.asm):00085         BErrBS          EQU     DBErrBS         ; Bad Subscript
     0012             (    basicdefs.asm):00086         BErrDD          EQU     DBErrDD         ; Direct Dimension
     0014             (    basicdefs.asm):00087         BErrZD          EQU     DBErrZD         ; Zero Divide
     0016             (    basicdefs.asm):00088         BErrID          EQU     DBErrID         ; Illegal Direct
     0018             (    basicdefs.asm):00089         BErrTM          EQU     DBErrTM         ; Type Mismatch
     001A             (    basicdefs.asm):00090         BErrOS          EQU     DBErrOS         ; Out of String space
     001C             (    basicdefs.asm):00091         BErrLS          EQU     DBErrLS         ; Long String (len > 255)
     001E             (    basicdefs.asm):00092         BErrST          EQU     DBErrST         ; String formula Too complex
     0020             (    basicdefs.asm):00093         BErrCN          EQU     DBErrCN         ; Can't coNtinue
     0022             (    basicdefs.asm):00094         BErrUF          EQU     DBErrUF         ; Undefined Function
     0024             (    basicdefs.asm):00095         BErrFD          EQU     DBErrFD         ; bad File Data
     0026             (    basicdefs.asm):00096         BErrAO          EQU     DBErrAO         ; Already Open
     0028             (    basicdefs.asm):00097         BErrDN          EQU     DBErrDN         ; Device Number
     002A             (    basicdefs.asm):00098         BErrIO          EQU     DBErrIO         ; Input Output
     002C             (    basicdefs.asm):00099         BErrFM          EQU     DBErrFM         ; File Mismatch
     002E             (    basicdefs.asm):00100         BErrNO          EQU     DBErrNO         ; file Not Open
     0030             (    basicdefs.asm):00101         BErrIE          EQU     DBErrIE         ; Input past End of file
     0032             (    basicdefs.asm):00102         BErrDS          EQU     DBErrDS         ; Direct Statement
     0034             (    basicdefs.asm):00103         BErrNE          EQU     DBErrNE         ; file does Not Exist
                      (    basicdefs.asm):00104                 else
0000                  (    basicdefs.asm):00105         BErrNF          EQU     CBErrNF         ; Next without for              
0000                  (    basicdefs.asm):00106         BErrSN          EQU     CBErrSN         ; Syntax
0000                  (    basicdefs.asm):00107         BErrRG          EQU     CBErrRG         ; Return without GOSUB
0000                  (    basicdefs.asm):00108         BErrOD          EQU     CBErrOD         ; Out of Data
0000                  (    basicdefs.asm):00109         BErrFC          EQU     CBErrFC         ; Function Call
0000                  (    basicdefs.asm):00110         BErrOV          EQU     CBErrOV         ; OVerflow
0000                  (    basicdefs.asm):00111         BErrOM          EQU     CBErrOM         ; Out of Memory
0000                  (    basicdefs.asm):00112         BErrUL          EQU     CBErrUL         ; Undefined Line
0000                  (    basicdefs.asm):00113         BErrBS          EQU     CBErrBS         ; Bad Subscript
0000                  (    basicdefs.asm):00114         BErrDD          EQU     CBErrDD         ; Direct Dimension
0000                  (    basicdefs.asm):00115         BErrZD          EQU     CBErrZD         ; Zero Divide
0000                  (    basicdefs.asm):00116         BErrID          EQU     CBErrID         ; Illegal Direct
0000                  (    basicdefs.asm):00117         BErrTM          EQU     CBErrTM         ; Type Mismatch
0000                  (    basicdefs.asm):00118         BErrOS          EQU     CBErrOS         ; Out of String space
0000                  (    basicdefs.asm):00119         BErrLS          EQU     CBErrLS         ; Long String (len > 255)
0000                  (    basicdefs.asm):00120         BErrST          EQU     CBErrST         ; String formula Too complex
0000                  (    basicdefs.asm):00121         BErrCN          EQU     CBErrCN         ; Can't coNtinue
0000                  (    basicdefs.asm):00122         BErrUF          EQU     CBErrUF         ; Undefined Function
0000                  (    basicdefs.asm):00123         BErrFD          EQU     CBErrFD         ; bad File Data
0000                  (    basicdefs.asm):00124         BErrAO          EQU     CBErrAO         ; Already Open
0000                  (    basicdefs.asm):00125         BErrDN          EQU     CBErrDN         ; Device Number
0000                  (    basicdefs.asm):00126         BErrIO          EQU     CBErrIO         ; Input Output
0000                  (    basicdefs.asm):00127         BErrFM          EQU     CBErrFM         ; File Mismatch
0000                  (    basicdefs.asm):00128         BErrNO          EQU     CBErrNO         ; file Not Open
0000                  (    basicdefs.asm):00129         BErrIE          EQU     CBErrIE         ; Input past End of file
0000                  (    basicdefs.asm):00130         BErrDS          EQU     CBErrDS         ; Direct Statement
0000                  (    basicdefs.asm):00131         BErrNE          EQU     CBErrNE         ; file does Not Exist
                      (    basicdefs.asm):00132                 endc
                      (       ddos2f.asm):00012                         use     samdefs.asm
                      (      samdefs.asm):00001         ;
                      (      samdefs.asm):00002         ; SAM Defs.
                      (      samdefs.asm):00003         ;
                      (      samdefs.asm):00004         
     FFE0             (      samdefs.asm):00005         SAMVectors      equ             $FFE0                   ; SAM vector block at top of memory map
     0020             (      samdefs.asm):00006         SAMVecSize      equ             $20                             ; SAM vector block size
                      (      samdefs.asm):00007         
     FFC0             (      samdefs.asm):00008         SAMBase         equ             $FFC0                   ; Base of SAM bits
                      (      samdefs.asm):00009         
                      (      samdefs.asm):00010         ; V2 V1 V0      Mode(s)
                      (      samdefs.asm):00011         ;  0  0  0      AL, AE, S4, S6
                      (      samdefs.asm):00012         ;  0  0  1      G1C, G1R
                      (      samdefs.asm):00013         ;  0  1  0      G2C
                      (      samdefs.asm):00014         ;  0  1  1      G2R
                      (      samdefs.asm):00015         ;  1  0  0      G3C
                      (      samdefs.asm):00016         ;  1  0  1      G3R
                      (      samdefs.asm):00017         ;  1  1  0      G6C, G6R
                      (      samdefs.asm):00018         ;  1  1  1      DMA
                      (      samdefs.asm):00019         
     FFC0             (      samdefs.asm):00020         SAMCV0          equ             $FFC0                   ; Video mode bits
     FFC1             (      samdefs.asm):00021         SAMSV0          equ             $FFC1
     FFC2             (      samdefs.asm):00022         SAMCV1          equ             $FFC2
     FFC3             (      samdefs.asm):00023         SAMSV1          equ             $FFC3
     FFC4             (      samdefs.asm):00024         SAMCV2          equ             $FFC4
     FFC5             (      samdefs.asm):00025         SAMSV2          equ             $FFC5
                      (      samdefs.asm):00026         
                      (      samdefs.asm):00027         ;
                      (      samdefs.asm):00028         ; Binary offset from $0000, in 512 byte pages.
                      (      samdefs.asm):00029         ;
                      (      samdefs.asm):00030         
     FFC6             (      samdefs.asm):00031         SAMCF0          equ             $FFC6                   ; Display offset
     FFC7             (      samdefs.asm):00032         SAMSF0          equ             $FFC7
     FFC8             (      samdefs.asm):00033         SAMCF1          equ             $FFC8
     FFC9             (      samdefs.asm):00034         SAMSF1          equ             $FFC9
     FFCA             (      samdefs.asm):00035         SAMCF2          equ             $FFCA
     FFCB             (      samdefs.asm):00036         SAMSF2          equ             $FFCB
     FFCC             (      samdefs.asm):00037         SAMCF3          equ             $FFCC
     FFCD             (      samdefs.asm):00038         SAMSF3          equ             $FFCD
     FFCE             (      samdefs.asm):00039         SAMCF4          equ             $FFCE
     FFCF             (      samdefs.asm):00040         SAMSF4          equ             $FFCF
     FFD0             (      samdefs.asm):00041         SAMCF5          equ             $FFD0
     FFD1             (      samdefs.asm):00042         SAMSF5          equ             $FFD1
     FFD2             (      samdefs.asm):00043         SAMCF6          equ             $FFD2
     FFD3             (      samdefs.asm):00044         SAMSF6          equ             $FFD3
                      (      samdefs.asm):00045         
                      (      samdefs.asm):00046         ; Maps 2 pages of 32K into $0000-$7FFF, requires 64K RAM.
                      (      samdefs.asm):00047         
     FFD4             (      samdefs.asm):00048         SAMCP1          equ             $FFD4                   ; Page #1
     FFD5             (      samdefs.asm):00049         SAMSP1          equ             $FFD5
                      (      samdefs.asm):00050         
                      (      samdefs.asm):00051         ; R1 R0
                      (      samdefs.asm):00052         ;  0  0         Slow, 0.89MHz 
                      (      samdefs.asm):00053         ;  0  1         Address dependent 1.7MHz / 0.89MHz
                      (      samdefs.asm):00054         ;  1  0         Fast
                      (      samdefs.asm):00055         ;  1  1         Fast
                      (      samdefs.asm):00056         
     FFD6             (      samdefs.asm):00057         SAMCR0          equ             $FFD6                   ; CPU Rate
     FFD7             (      samdefs.asm):00058         SAMSR0          equ             $FFD7
     FFD8             (      samdefs.asm):00059         SAMCR1          equ             $FFD8
     FFD9             (      samdefs.asm):00060         SAMSR2          equ             $FFD9
                      (      samdefs.asm):00061         
                      (      samdefs.asm):00062         ; M1 M0
                      (      samdefs.asm):00063         ;  0  0          4K dynamic
                      (      samdefs.asm):00064         ;  0  1         16K dynamic
                      (      samdefs.asm):00065         ;  1  0         64K dynamic
                      (      samdefs.asm):00066         ;  1  1         64K static
                      (      samdefs.asm):00067         
     FFDA             (      samdefs.asm):00068         SAMCM0          equ             $FFDA                   ; Memory type
     FFDB             (      samdefs.asm):00069         SAMSM0          equ             $FFDB
     FFDC             (      samdefs.asm):00070         SAMCM1          equ             $FFDC
     FFDD             (      samdefs.asm):00071         SAMSM1          equ             $FFDD
                      (      samdefs.asm):00072         
                      (      samdefs.asm):00073         ; 0= RAM below 32K, ROM above, 1=RAM for entire map 
                      (      samdefs.asm):00074         ; In both map types top 256 bytes reserved for I/O space
                      (      samdefs.asm):00075         
     FFDE             (      samdefs.asm):00076         SAMCTY          equ             $FFDE                   ; Map type
     FFDF             (      samdefs.asm):00077         SAMSTY          equ             $FFDF
                      (      samdefs.asm):00078         
                      (      samdefs.asm):00079         
                      (      samdefs.asm):00080         
                      (      samdefs.asm):00081         
                      (       ddos2f.asm):00013                         use     wddefs.asm
                      (       wddefs.asm):00001         ;
                      (       wddefs.asm):00002         ; WD17xx / WD27xx defines.
                      (       wddefs.asm):00003         ;
                      (       wddefs.asm):00004                         ifdef   Tandy
                      (       wddefs.asm):00005         ; Disk command codes WD1793, WD1773, RSDos FDC carts.
0000                  (       wddefs.asm):00006         WDCmdRestore    EQU     $00             ; Restore to track 0
0000                  (       wddefs.asm):00007         WDCmdSeek       EQU     $10             ; Seek to track command
0000                  (       wddefs.asm):00008         WDCmdReadSec    EQU     $80             ; Read sector command
0000                  (       wddefs.asm):00009         WDCmdWriteSec   EQU     $A0             ; Write sector command
0000                  (       wddefs.asm):00010         WDCmdReadAddr   EQU     $C0             ; Read address mark
0000                  (       wddefs.asm):00011         WDCmdForceInt   EQU     $D0             ; Force inturrupt
0000                  (       wddefs.asm):00012         WDCmdWriteTrack EQU     $F4             ; Write (format) track  
                      (       wddefs.asm):00013                         else
                      (       wddefs.asm):00014         ; Disk command codes WD2797, Dragon Dos, Cumana Dos, Dragon Alpha/Professional, Dragon Beta
     0000             (       wddefs.asm):00015         WDCmdRestore    EQU     $00             ; Restore to track 0
     0010             (       wddefs.asm):00016         WDCmdSeek       EQU     $10             ; Seek to track command
     0088             (       wddefs.asm):00017         WDCmdReadSec    EQU     $88             ; Read sector command
     00A8             (       wddefs.asm):00018         WDCmdWriteSec   EQU     $A8             ; Write sector command
     00C0             (       wddefs.asm):00019         WDCmdReadAddr   EQU     $C0             ; Read address mark
     00D0             (       wddefs.asm):00020         WDCmdForceInt   EQU     $D0             ; Force inturrupt
     00F4             (       wddefs.asm):00021         WDCmdWriteTrack EQU     $F4             ; Write (format) track
                      (       wddefs.asm):00022                         endc
                      (       wddefs.asm):00023         ;
                      (       wddefs.asm):00024         ; Step rates.
                      (       wddefs.asm):00025         ;
                      (       wddefs.asm):00026         
     0000             (       wddefs.asm):00027         StepRate6ms     EQU     $00             ;  6ms step rate
     0001             (       wddefs.asm):00028         StepRate12ms    EQU     $01             ; 12ms step rate
     0002             (       wddefs.asm):00029         StepRate20ms    EQU     $02             ; 20ms step rate
     0003             (       wddefs.asm):00030         StepRate30ms    EQU     $03             ; 30ms step rate
                      (       wddefs.asm):00031         
     0002             (       wddefs.asm):00032         StepRateDefault EQU     StepRate20ms    ; Default
                      (       wddefs.asm):00033         
                      (       wddefs.asm):00034         ;
                      (       wddefs.asm):00035         ; WD Error flag / status bits
                      (       wddefs.asm):00036         ;
                      (       wddefs.asm):00037         
     0080             (       wddefs.asm):00038         WDErrNotReady   EQU     $80             ; Not ready
     0040             (       wddefs.asm):00039         WDErrWriteProt  EQU     $40             ; Write protect
     0020             (       wddefs.asm):00040         WDErrHeadLoaded EQU     $20             ; Head loaded, type 1
     0020             (       wddefs.asm):00041         WDErrRecType    EQU     $20             ; Record type, read sec
     0010             (       wddefs.asm):00042         WDErrSeek       EQU     $10             ; Seek error, type 1
     0010             (       wddefs.asm):00043         WDErrRNF        EQU     $10             ; Record not found, read address, sector write sector
     0008             (       wddefs.asm):00044         WDErrCRC        EQU     $08             ; CRC error all but read/write track
     0004             (       wddefs.asm):00045         WDErrTrack0     EQU     $04             ; Head on track 0, type 1
     0004             (       wddefs.asm):00046         WDErrLostData   EQU     $04             ; Lost data 
     0002             (       wddefs.asm):00047         WDErrIndex      EQU     $02             ; Index pulse, type 1
     0002             (       wddefs.asm):00048         WDErrDRQ        EQU     $02             ; Data request
     0001             (       wddefs.asm):00049         WDErrBusy       EQU     $01             ; Busy
                      (       wddefs.asm):00050         
     000F             (       wddefs.asm):00051         WDErrMask0F     EQU     WDErrCRC+WDErrLostData+WDErrDRQ+WDErrBusy
     005F             (       wddefs.asm):00052         WDErrMask5F     EQU     WDErrWriteProt+WDErrRNF+WDErrMask0F
     00DF             (       wddefs.asm):00053         WDErrMaskDF     EQU     WDErrNotReady+WDErrMask5F
     0047             (       wddefs.asm):00054         WDErrMaskFormat EQU     WDErrWriteProt+WDErrLostData+WDErrDRQ+WDErrBusy
     003F             (       wddefs.asm):00055         WDDefErrMask    EQU     WDErrRecType+WDErrSeek+WDErrMask0F
     007C             (       wddefs.asm):00056         WDErrMaskRW     EQU     WDErrWriteProt+WDErrRecType+WDErrRNF+WDErrCRC+WDErrLostData
                      (       wddefs.asm):00057         
                      (       wddefs.asm):00058         
                      (       ddos2f.asm):00014                                         
                      (       ddos2f.asm):00015         * Dragon Alpha has a third PIA at FF24, this is used for
                      (       ddos2f.asm):00016         * Drive select / motor control, and provides FIRQ from the
                      (       ddos2f.asm):00017         * disk controler.
                      (       ddos2f.asm):00018         
     0024             (       ddos2f.asm):00019         DPPIADA         EQU     DPPIA2DA
     0025             (       ddos2f.asm):00020         DPPIACRA        EQU     DPPIA2CRA               
     0026             (       ddos2f.asm):00021         DPPIADB         EQU     DPPIA2DB                
     0027             (       ddos2f.asm):00022         DPPIACRB        EQU     DPPIA2CRB
                      (       ddos2f.asm):00023         
     FF24             (       ddos2f.asm):00024         PIADA           EQU     DPPIADA+IO      ; Side A Data/DDR
     FF25             (       ddos2f.asm):00025         PIACRA          EQU     DPPIACRA+IO     ; Side A Control.
     FF26             (       ddos2f.asm):00026         PIADB           EQU     DPPIADB+IO      ; Side A Data/DDR
     FF27             (       ddos2f.asm):00027         PIACRB          EQU     DPPIACRB+IO     ; Side A Control.
                      (       ddos2f.asm):00028         
                      (       ddos2f.asm):00029         ;WD2797 Floppy disk controler, used in Alpha Note registers in reverse order !
     002F             (       ddos2f.asm):00030         DPCmdReg        EQU     DPCmdRegA       ; command/status                        
     002E             (       ddos2f.asm):00031         DPTrkReg        EQU     DPTrkRegA       ; Track register
     002D             (       ddos2f.asm):00032         DPSecReg        EQU     DPSecRegA       ; Sector register
     002C             (       ddos2f.asm):00033         DPDataReg       EQU     DPDataRegA      ; Data register
                      (       ddos2f.asm):00034         
     FF2F             (       ddos2f.asm):00035         CmdReg          EQU     DPCmdReg+IO     ; command/status                        
     FF2E             (       ddos2f.asm):00036         TrkReg          EQU     DPTrkReg+IO     ; Track register
     FF2D             (       ddos2f.asm):00037         SecReg          EQU     DPSecReg+IO     ; Sector register
     FF2C             (       ddos2f.asm):00038         DataReg         EQU     DPDataReg+IO    ; Data register
                      (       ddos2f.asm):00039         
     0137             (       ddos2f.asm):00040         NextResJump     EQU     BasStub2+StubResJumpOfs         ; Jump to reserved word handler of user table
     013C             (       ddos2f.asm):00041         NextFuncsJump   EQU     BasStub2+StubFuncsJumpOfs       ; Jump to functions handler of user table
                      (       ddos2f.asm):00042         
                      (       ddos2f.asm):00043                 org     $C000
                      (       ddos2f.asm):00044         
                      (       ddos2f.asm):00045         ; Disk controler ID, if a cartrage starts with the chars 'DK', then the basic rom routines
                      (       ddos2f.asm):00046         ; will do a JMP to $C002 to init the cartrage.
                      (       ddos2f.asm):00047         
C000                  (       ddos2f.asm):00048         DosBegin
C000 444B             (       ddos2f.asm):00049                 FCC     /DK/            ; Disk cartrage auto-init identifier.
                      (       ddos2f.asm):00050         
C002 2026             (       ddos2f.asm):00051         LC002   BRA     DosInit
                      (       ddos2f.asm):00052         
                      (       ddos2f.asm):00053         ; Indirect jump table, these are probably the official DragonData entry
                      (       ddos2f.asm):00054         ; points to be called with jsr [entry]
                      (       ddos2f.asm):00055         
C004 C169             (       ddos2f.asm):00056                 FDB     DOSLowLevel             ; Low Level disk IO routine
C006 00EA             (       ddos2f.asm):00057                 FDB     DosCommand              ; Address of data table for low level command
C008 C845             (       ddos2f.asm):00058                 FDB     DOSValidFilename        ; Validate filename & copy to disk block.
C00A C906             (       ddos2f.asm):00059                 FDB     DOSOpenFile             ; Open A file.
C00C CF98             (       ddos2f.asm):00060                 FDB     DOSCreateFile           ; Create file (make backup)
C00E CEFD             (       ddos2f.asm):00061                 FDB     DOSGetFLen              ; Get file length
C010 CF3F             (       ddos2f.asm):00062                 FDB     DOSCloseAll             ; Close all open files
C012 CF55             (       ddos2f.asm):00063                 FDB     DOSCloseFile            ; Close file
C014 CA1B             (       ddos2f.asm):00064                 FDB     DOSFRead                ; Read data from file
C016 CBDD             (       ddos2f.asm):00065                 FDB     DOSFWrite               ; Write data to file
C018 D1D0             (       ddos2f.asm):00066                 FDB     DOSGetFree              ; Get free space on a disk
C01A D03A             (       ddos2f.asm):00067                 FDB     DOSDeleteFile           ; Delete a file
                      (       ddos2f.asm):00068         
                      (       ddos2f.asm):00069                 ifdef PGSFix
                      (       ddos2f.asm):00070                 FDB     DOSProtectMC            ; Protect/unprotect file
                      (       ddos2f.asm):00071                 FDB     DOSRenameMC             ; Rename a file 
                      (       ddos2f.asm):00072                 else
C01C D120             (       ddos2f.asm):00073                 FDB     DOSProtectMC            ; Protect/unprotect file
C01E D152             (       ddos2f.asm):00074                 FDB     DOSRename               ; Rename a file 
                      (       ddos2f.asm):00075                 endc
                      (       ddos2f.asm):00076                 
C020 D257             (       ddos2f.asm):00077                 FDB     DOSGetDirEntry          ; Get a directory entry
C022 D2CA             (       ddos2f.asm):00078                 FDB     DOSFindAndRead          ; Find free buffer and read sector
C024 C7BB             (       ddos2f.asm):00079                 FDB     DOSSyncDir              ; Copy updated sectors from track 20 to 16 (sync direcories)
C026 D38D             (       ddos2f.asm):00080                 FDB     DOSReadAbsSector        ; Read absolute sector
C028 D37D             (       ddos2f.asm):00081                 FDB     DOSWriteAbsSector       ; Write absolute sector (no verify)
                      (       ddos2f.asm):00082         
                      (       ddos2f.asm):00083         ;
                      (       ddos2f.asm):00084         ; Init Dos
                      (       ddos2f.asm):00085         ; 
                      (       ddos2f.asm):00086         
C02A 8E0600           (       ddos2f.asm):00087         DosInit LDX     #DosAreaStart           ; Point to bottom of dos vars area      
C02D 1F12             (       ddos2f.asm):00088                 TFR     X,Y             
C02F 6F80             (       ddos2f.asm):00089         LC02F   CLR     ,X+                     ; Clear a byte, increment X
C031 313F             (       ddos2f.asm):00090                 LEAY    -1,Y                    ; decrement counter
C033 26FA             (       ddos2f.asm):00091                 BNE     LC02F                   ; loop again if more to do
                      (       ddos2f.asm):00092                 
                      (       ddos2f.asm):00093         ; X now points to the top of the dos variable area
                      (       ddos2f.asm):00094         
C035 1F10             (       ddos2f.asm):00095                 TFR     X,D
C037 1F89             (       ddos2f.asm):00096                 TFR     A,B
C039 CB18             (       ddos2f.asm):00097                 ADDB    #$18
C03B D719             (       ddos2f.asm):00098                 STB     <BasStartProg           ; Setup new begining of basic
C03D BDAA87           (       ddos2f.asm):00099                 JSR     >BasLocateScreen
C040 96BA             (       ddos2f.asm):00100                 LDA     <GrDisplayStartAddr     ; Adjust graphics ram pages
C042 8B06             (       ddos2f.asm):00101                 ADDA    #$06
C044 97B7             (       ddos2f.asm):00102                 STA     <GrLastDisplayAddr
                      (       ddos2f.asm):00103         
                      (       ddos2f.asm):00104         ;
                      (       ddos2f.asm):00105         ; Init various low ram stuff, interrupt vectors, basic stub etc
                      (       ddos2f.asm):00106         ; 
                      (       ddos2f.asm):00107         
C046 8EDE3B           (       ddos2f.asm):00108                 LDX     #NewVectorTable         ; Point to rom copy of data to copy
C049 E680             (       ddos2f.asm):00109         LC049   LDB     ,X+                     ; Get byte count byte
C04B 2707             (       ddos2f.asm):00110                 BEQ     LC054                   ; zero= end of table, exit copy
C04D EE81             (       ddos2f.asm):00111                 LDU     ,X++                    ; Get destination address
C04F BDB7CC           (       ddos2f.asm):00112                 JSR     >UtilCopyBXtoU          ; do copy
C052 20F5             (       ddos2f.asm):00113                 BRA     LC049                   ; do next
                      (       ddos2f.asm):00114         
                      (       ddos2f.asm):00115         
C054 C600             (       ddos2f.asm):00116         LC054   LDB     #$00                    ; Set hardware control mask
                      (       ddos2f.asm):00117                                                 ; Was $20 for DDv1
C056 F70607           (       ddos2f.asm):00118                 STB     DosHWMaskFF48
C059 730608           (       ddos2f.asm):00119                 COM     DosVerifyFlag           ; function unknown 
                      (       ddos2f.asm):00120                
C05C 8E0683           (       ddos2f.asm):00121                 LDX     #DosNewUSRTable         ; Adjust usr vector base
C05F 9FB0             (       ddos2f.asm):00122                 STX     <BasUSRTableAddr        
C061 CE8B8D           (       ddos2f.asm):00123                 LDU     #BasFCError             ; Setup the 10 usr vectors to point to BasFCError
C064 C60A             (       ddos2f.asm):00124                 LDB     #$0A                    ; do 10
                      (       ddos2f.asm):00125         
C066 EF81             (       ddos2f.asm):00126         LC066   STU     ,X++                    ; setup vector
C068 5A               (       ddos2f.asm):00127                 DECB                            ; decrement count
C069 26FB             (       ddos2f.asm):00128                 BNE     LC066                   ; loop again if more to do
                      (       ddos2f.asm):00129                 
C06B 7C060A           (       ddos2f.asm):00130                 INC     DosDefDriveNo   
C06E 8D48             (       ddos2f.asm):00131                 BSR     DosReset
                      (       ddos2f.asm):00132                 
C070 8E015E           (       ddos2f.asm):00133                 LDX     #VectBase               ; Point to ram hooks
C073 108EDEB2         (       ddos2f.asm):00134                 LDY     #RamHookTable           ; Point to ram hook table in rom
C077 CC137E           (       ddos2f.asm):00135                 LDD     #$137E                  ; load A with number of vectors B with opcode for JMP
C07A E780             (       ddos2f.asm):00136         LC07A   STB     ,X+                     ; setup jump
C07C EEA1             (       ddos2f.asm):00137                 LDU     ,Y++                    ; setup vector
C07E EF81             (       ddos2f.asm):00138                 STU     ,X++
C080 4A               (       ddos2f.asm):00139                 DECA                            ; decrement counter
C081 26F7             (       ddos2f.asm):00140                 BNE     LC07A                   ; Loop again if more to do
                      (       ddos2f.asm):00141                 
C083 8E4549           (       ddos2f.asm):00142                 LDX     #$4549                  ; Look for DK at $E000
C086 BCE000           (       ddos2f.asm):00143                 CMPX    $E000
C089 10271F75         (       ddos2f.asm):00144                 LBEQ    $E002                   ; Found it, call it's init routine
                      (       ddos2f.asm):00145                 
C08D 8EC763           (       ddos2f.asm):00146         EIEND   LDX     #ResetVector            ; Setup new reset vector
C090 9F72             (       ddos2f.asm):00147                 STX     <IndVecReset
C092 8655             (       ddos2f.asm):00148                 LDA     #$55
C094 9771             (       ddos2f.asm):00149                 STA     <WarmStartFlag
C096 1CAF             (       ddos2f.asm):00150                 andcc   #~(FlagIRQ+FlagFIRQ)    ; reenable inturrupts
                      (       ddos2f.asm):00151                 
C098 8EB4B2           (       ddos2f.asm):00152                 LDX     #BasSignonMess          ; Print staandard Basic signon message
C09B BD90E5           (       ddos2f.asm):00153                 JSR     >TextOutString
C09E 0CEB             (       ddos2f.asm):00154                 INC     <DosDriveNo
                      (       ddos2f.asm):00155                 
C0A0 8E8000           (       ddos2f.asm):00156                 LDX     #$8000                  ; delay counter
C0A3 4F               (       ddos2f.asm):00157                 CLRA                            
C0A4 3D               (       ddos2f.asm):00158         LC0A4   MUL                             ; take some time....
C0A5 301F             (       ddos2f.asm):00159                 LEAX    -1,X                    ; decrement count
C0A7 26FB             (       ddos2f.asm):00160                 BNE     LC0A4                   ; loop again....
                      (       ddos2f.asm):00161                 
C0A9 BDC165           (       ddos2f.asm):00162                 JSR     >DosDoRestore
C0AC BDBA77           (       ddos2f.asm):00163                 JSR     >TextCls                ; clear screen
                      (       ddos2f.asm):00164                 
C0AF 8EDFDA           (       ddos2f.asm):00165                 LDX     #DosSignonMess-1        ; Print dos signon message
C0B2 BD90E5           (       ddos2f.asm):00166                 JSR     >TextOutString  
C0B5 7E8371           (       ddos2f.asm):00167                 JMP     >BasCmdMode             ; Jump to normal basic command mode
                      (       ddos2f.asm):00168         
C0B8                  (       ddos2f.asm):00169         DosReset
C0B8 86D0             (       ddos2f.asm):00170                 LDA     #WDCmdForceInt          ; Force WD2797 to interrupt & reset
C0BA B7FF2F           (       ddos2f.asm):00171                 STA     CmdReg
                      (       ddos2f.asm):00172                 
                      (       ddos2f.asm):00173                 ifdef   PGSFix
                      (       ddos2f.asm):00174                 LDX     #DosD0Online            ; Clear drive online flags 
                      (       ddos2f.asm):00175                 else
C0BD 8E0696           (       ddos2f.asm):00176                 LDX     #DosD0Online-1          ; Clear drive online flags 
                      (       ddos2f.asm):00177                 endc
                      (       ddos2f.asm):00178                 
C0C0 6F84             (       ddos2f.asm):00179                 CLR     ,X                      ; initialize drive info tables
C0C2 6F01             (       ddos2f.asm):00180                 CLR     1,X
C0C4 6F02             (       ddos2f.asm):00181                 CLR     2,X
C0C6 6F03             (       ddos2f.asm):00182                 CLR     3,X
                      (       ddos2f.asm):00183                 
C0C8 8E0621           (       ddos2f.asm):00184                 LDX     #Drv0Details+DrvDetUseCnt       ; Clear drive in use counts
C0CB 6F84             (       ddos2f.asm):00185                 CLR     ,X
C0CD 6F06             (       ddos2f.asm):00186                 CLR     6,X
C0CF 6F0C             (       ddos2f.asm):00187                 CLR     12,X
C0D1 6F8812           (       ddos2f.asm):00188                 CLR     $12,X
                      (       ddos2f.asm):00189                 
C0D4 0FF6             (       ddos2f.asm):00190                 CLR     <DosIOInProgress        ; Flag to check for timeout
                      (       ddos2f.asm):00191                 
C0D6 8E06AB           (       ddos2f.asm):00192                 LDX     #DosDirSecStatus        ; Clear Dirctory status, FCBs etc
C0D9 6F80             (       ddos2f.asm):00193         LC0D9   CLR     ,X+
C0DB 8C07F3           (       ddos2f.asm):00194                 CMPX    #DosFCBEnd
C0DE 26F9             (       ddos2f.asm):00195                 BNE     LC0D9
                      (       ddos2f.asm):00196                 
C0E0 C604             (       ddos2f.asm):00197                 LDB     #$04                    ; Count of buffers to process
C0E2 8E0634           (       ddos2f.asm):00198                 LDX     #Buff1Details           ; Setup disk buffer initial values
C0E5 CE0800           (       ddos2f.asm):00199                 LDU     #$0800                  ; addr of buffer
C0E8 6F02             (       ddos2f.asm):00200         LC0E8   CLR     2,X
C0EA E704             (       ddos2f.asm):00201                 STB     4,X
C0EC EF05             (       ddos2f.asm):00202                 STU     5,X
C0EE 33C90100         (       ddos2f.asm):00203                 LEAU    $0100,U                 ; Increment addr for next buffer
C0F2 3007             (       ddos2f.asm):00204                 LEAX    7,X                     ; do next buffer
C0F4 5A               (       ddos2f.asm):00205                 DECB                            ; done all ?
C0F5 26F1             (       ddos2f.asm):00206                 BNE     LC0E8                   ; no : do next
C0F7 39               (       ddos2f.asm):00207                 RTS
                      (       ddos2f.asm):00208         
                      (       ddos2f.asm):00209         ;
                      (       ddos2f.asm):00210         ; The following code is quite clever, there are actually multiple code paths.
                      (       ddos2f.asm):00211         ; This involves having a 2 byte instruction encoded as the oprand to a 3
                      (       ddos2f.asm):00212         ; byte instruction eg :-
                      (       ddos2f.asm):00213         ;
                      (       ddos2f.asm):00214         ; L00FA CMPX    #$C605
                      (       ddos2f.asm):00215         ;
                      (       ddos2f.asm):00216         ; CMPX is one byte long, so a jump to L00DB, will execute the oprand to the
                      (       ddos2f.asm):00217         ; CMPX, which decodes as LDB #$05 this saves a few bytes by not having LDB #xx,
                      (       ddos2f.asm):00218         ; BRA label.
                      (       ddos2f.asm):00219         ;
                      (       ddos2f.asm):00220         ; There are several examples of this in the Dos ROM !
                      (       ddos2f.asm):00221         ;
                      (       ddos2f.asm):00222                 
C0F8                  (       ddos2f.asm):00223         DosDoReadAddr   
C0F8 C606             (       ddos2f.asm):00224                 LDB     #DosFnReadAddr          ; Read address
C0FA 8C               (       ddos2f.asm):00225                 FCB     Skip2   
                      (       ddos2f.asm):00226         
C0FB                  (       ddos2f.asm):00227         DosDoWriteTrack   
C0FB C605             (       ddos2f.asm):00228                 LDB     #DosFnWriteTrack        ; Write track
C0FD 8C               (       ddos2f.asm):00229                 FCB     Skip2   
                      (       ddos2f.asm):00230         
C0FE                  (       ddos2f.asm):00231         DosDoWriteSecN   
C0FE C604             (       ddos2f.asm):00232                 LDB     #DosFnWriteSecN         ; Write sector no verify 
C100 8C               (       ddos2f.asm):00233                 FCB     Skip2           
                      (       ddos2f.asm):00234         
C101                  (       ddos2f.asm):00235         DosDoWriteSecV   
C101 C603             (       ddos2f.asm):00236                 LDB     #DosFnWriteSecV         ; Write sector verify
C103 8C               (       ddos2f.asm):00237                 FCB     Skip2           
                      (       ddos2f.asm):00238         
C104                  (       ddos2f.asm):00239         DosDoReadSec   
C104 C602             (       ddos2f.asm):00240                 LDB     #DosFnReadSec           ; Read sector
                      (       ddos2f.asm):00241         
C106                  (       ddos2f.asm):00242         DosDoFuncinB   
C106 3402             (       ddos2f.asm):00243                         PSHS    A
C108 327E             (       ddos2f.asm):00244                 LEAS    -2,S                    ; Make room on stack
C10A 7F0600           (       ddos2f.asm):00245                 CLR     Thrash                  ; clear work byte               
C10D 8603             (       ddos2f.asm):00246         LC10D   LDA     #$03                    ; retry count ?
C10F EDE4             (       ddos2f.asm):00247                 STD     ,S                              ; save on stack
                      (       ddos2f.asm):00248         
C111 8D4F             (       ddos2f.asm):00249         LC111   BSR     DosDoSeek               ; Try to seek to track
C113 2509             (       ddos2f.asm):00250                 BCS     LC11E                   ; Error ?
                      (       ddos2f.asm):00251                 
C115 E661             (       ddos2f.asm):00252                 LDB     1,S                     ; No error, get dos op code
C117 D7EA             (       ddos2f.asm):00253                 STB     <DosCommand             ; Save operation to perform
C119 BDC169           (       ddos2f.asm):00254                 JSR     >DOSLowLevel
C11C 243C             (       ddos2f.asm):00255                 BCC     LC15A                   ; No error
                      (       ddos2f.asm):00256                 
C11E C184             (       ddos2f.asm):00257         LC11E   CMPB    #ErrWP          ; Write protect ?, no point in retrying !
C120 2727             (       ddos2f.asm):00258                 BEQ     LC149
                      (       ddos2f.asm):00259                 
C122 6AE4             (       ddos2f.asm):00260                 DEC     ,S                      ; Dec retry count
C124 2715             (       ddos2f.asm):00261                 BEQ     LC13B                   ; Any retries left ?
C126 E6E4             (       ddos2f.asm):00262                 LDB     ,S                      ; get retry count
C128 54               (       ddos2f.asm):00263                 LSRB                            ; gety lsbit
C129 2408             (       ddos2f.asm):00264                 BCC     LC133                   ; on even numbered retry, do recal
C12B 0CEC             (       ddos2f.asm):00265                 INC     <DskTrackNo             ; step out a track
C12D 8D33             (       ddos2f.asm):00266                 BSR     DosDoSeek
C12F 0AEC             (       ddos2f.asm):00267                 DEC     <DskTrackNo             ; step back in when retrying 
C131 20DE             (       ddos2f.asm):00268                 BRA     LC111
                      (       ddos2f.asm):00269         
C133 96EC             (       ddos2f.asm):00270         LC133   LDA     <DskTrackNo             ; Save Track no whilst doing restore
C135 8D2E             (       ddos2f.asm):00271                 BSR     DosDoRestore            ; Restore & Recalibrate
C137 97EC             (       ddos2f.asm):00272                 STA     <DskTrackNo             ; Put track no back
C139 20D6             (       ddos2f.asm):00273                 BRA     LC111                   ; Try again
                      (       ddos2f.asm):00274         
                      (       ddos2f.asm):00275         ; We come here when all reties exhausted
C13B C180             (       ddos2f.asm):00276         LC13B   CMPB    #ErrNR          ; Not ready ?
C13D 2618             (       ddos2f.asm):00277                 BNE     LC157
                      (       ddos2f.asm):00278         
C13F 7D0600           (       ddos2f.asm):00279                 TST     DosAreaStart
C142 2613             (       ddos2f.asm):00280                 BNE     LC157
                      (       ddos2f.asm):00281         
C144 730600           (       ddos2f.asm):00282                 COM     DosAreaStart
C147 200A             (       ddos2f.asm):00283                 BRA     LC153
                      (       ddos2f.asm):00284         
                      (       ddos2f.asm):00285         ; Something to do with dir track ? Make sure same op done to both copies of Dir
C149 96EC             (       ddos2f.asm):00286         LC149   LDA     <DskTrackNo             ; Get track number
C14B 8114             (       ddos2f.asm):00287                 CMPA    #DirPrimary             ; Track 20 ?
C14D 2608             (       ddos2f.asm):00288                 BNE     LC157                   ; no : error
C14F 8610             (       ddos2f.asm):00289                 LDA     #DirBackup              ; set track to 16
C151 97EC             (       ddos2f.asm):00290                 STA     <DskTrackNo
C153 E661             (       ddos2f.asm):00291         LC153   LDB     1,S                     ; Get Dos op code
C155 20B6             (       ddos2f.asm):00292                 BRA     LC10D                   ; So same to track 16
                      (       ddos2f.asm):00293         
C157 1A01             (       ddos2f.asm):00294         LC157   ORCC    #FlagCarry              ; Flag error
C159 21               (       ddos2f.asm):00295                 FCB     Skip1                   ; opcocode for BRN
C15A 5F               (       ddos2f.asm):00296         LC15A   CLRB                            ; Flag no error
C15B 3262             (       ddos2f.asm):00297                 LEAS    2,S                     ; Drop bytes from stack
C15D 3582             (       ddos2f.asm):00298                 PULS    A,PC                    ; restore & return
                      (       ddos2f.asm):00299         
                      (       ddos2f.asm):00300         ;
                      (       ddos2f.asm):00301         ; Another LDB, enbeded in CMPX sequence....
                      (       ddos2f.asm):00302         ; 
                      (       ddos2f.asm):00303         
C15F                  (       ddos2f.asm):00304         DosDoReadSec2
C15F C607             (       ddos2f.asm):00305                 LDB     #DosFnReadSec2          ; Read sector 2 (just first 2 chars)
C161 8C               (       ddos2f.asm):00306                 FCB     Skip2           
                      (       ddos2f.asm):00307         
C162                  (       ddos2f.asm):00308         DosDoSeek       
C162 C601             (       ddos2f.asm):00309                 LDB     #DosFnSeek
C164 8C               (       ddos2f.asm):00310                 FCB     Skip2                   ; Seek to a track
                      (       ddos2f.asm):00311         
C165                  (       ddos2f.asm):00312         DosDoRestore   
C165 C600             (       ddos2f.asm):00313                 LDB     #DosFnRestore           ; Restore to track 0
C167 D7EA             (       ddos2f.asm):00314                 STB     <DosCommand             ; save in hardware byte
                      (       ddos2f.asm):00315         
                      (       ddos2f.asm):00316         ;
                      (       ddos2f.asm):00317         ; Disk I/O.
                      (       ddos2f.asm):00318         ;
                      (       ddos2f.asm):00319         ; This is the main Disk I/O entry point. 
                      (       ddos2f.asm):00320         ; All registers are preserved except the condition codes and B on the
                      (       ddos2f.asm):00321         ; return. (error code).
                      (       ddos2f.asm):00322         ;
                      (       ddos2f.asm):00323         ; Call :
                      (       ddos2f.asm):00324         ;       DosDriveNo      = drive number
                      (       ddos2f.asm):00325         ;       DskSectorNo     = sector number
                      (       ddos2f.asm):00326         ;       DskTrackNo      = track number
                      (       ddos2f.asm):00327         ;       DiskBuffPtr     = buffer pointer
                      (       ddos2f.asm):00328         ;       DosCommand      = Dos function to execute (see below)
                      (       ddos2f.asm):00329         ;
                      (       ddos2f.asm):00330         ;               DosFnRestore    ($00), Restore to track 0
                      (       ddos2f.asm):00331         ;               DosFnSeek       ($01), Seek to a track
                      (       ddos2f.asm):00332         ;               DosFnReadSec    ($02), Read a sector
                      (       ddos2f.asm):00333         ;               DosFnWriteSecV  ($03), Write a sector with verify
                      (       ddos2f.asm):00334         ;               DosFnWriteSecN  ($04), Write a sector no verify
                      (       ddos2f.asm):00335         ;               DosFnWriteTrack ($05), Write (format) track
                      (       ddos2f.asm):00336         ;               DosFnReadAddr   ($06), Read address mark
                      (       ddos2f.asm):00337         ;               DosFnReadSec2   ($07), Read first two bytes of a sector
                      (       ddos2f.asm):00338         ;
                      (       ddos2f.asm):00339         ; Exit conditions :
                      (       ddos2f.asm):00340         ;       
                      (       ddos2f.asm):00341         ;       DosDiskError    = WD2797 status register, or zero if no error.                  
                      (       ddos2f.asm):00342         ;       B               = error code for basic or zero if no error.
                      (       ddos2f.asm):00343         ;       CC.carry        = 0 if no error, 1 if error.
                      (       ddos2f.asm):00344         ;
                      (       ddos2f.asm):00345         
C169                  (       ddos2f.asm):00346         DOSLowLevel
C169 347B             (       ddos2f.asm):00347                 PSHS    CC,A,DP,X,Y,U
C16B 1A50             (       ddos2f.asm):00348                 ORCC    #(FlagIRQ+FlagFIRQ)     ; Disable interrupts    
C16D 66E4             (       ddos2f.asm):00349                 ROR     ,S
C16F 0FF0             (       ddos2f.asm):00350                 CLR     <DosDiskError           ; Flag no disk error
C171 96EA             (       ddos2f.asm):00351                 LDA     <DosCommand             ; get HW byte
C173 8107             (       ddos2f.asm):00352                 CMPA    #$07                    ; Valid op
                      (       ddos2f.asm):00353                 
C175 2302             (       ddos2f.asm):00354                 BLS     LC179                   ; yes : do it !
C177 2008             (       ddos2f.asm):00355                 BRA     LC181                   ; No: error
                      (       ddos2f.asm):00356         
C179 BDC28B           (       ddos2f.asm):00357         LC179   JSR     >ResetAndStartDrive
C17C 240E             (       ddos2f.asm):00358                 BCC     LC18C                   ; Error ?
C17E C6FD             (       ddos2f.asm):00359                 LDB     #$FD                    ; yes flag error
                      (       ddos2f.asm):00360         
C180 8C               (       ddos2f.asm):00361                 FCB     Skip2                   ; Andothe CMPX saving.....
                      (       ddos2f.asm):00362         
C181 C6FC             (       ddos2f.asm):00363         LC181   LDB     #$FC                    ; Set error code
C183 1A01             (       ddos2f.asm):00364                 ORCC    #FlagCarry              ; and carry bit
C185 69E4             (       ddos2f.asm):00365                 ROL     ,S
C187 D7F0             (       ddos2f.asm):00366                 STB     <DosDiskError           ; Flag disk error
C189 1600C2           (       ddos2f.asm):00367                 LBRA    LC230
                      (       ddos2f.asm):00368         
C18C 8EFF01           (       ddos2f.asm):00369         LC18C   LDX     #PIA0CRA                ; Point to PIA CR A             
                      (       ddos2f.asm):00370         
                      (       ddos2f.asm):00371         ; roughly equivilent to SetPIA in DDv1
                      (       ddos2f.asm):00372         ; gets the control registers of PIA0 and PIA1, saves them on the stack
                      (       ddos2f.asm):00373         ; and then disables interrupts from those PIAs, to prevent them interfereing
                      (       ddos2f.asm):00374         ; with the disk system.
                      (       ddos2f.asm):00375          
C18F                  (       ddos2f.asm):00376         SavePIAs   
C18F A684             (       ddos2f.asm):00377                 LDA     ,X                      ; get PIA control register
C191 3402             (       ddos2f.asm):00378                 PSHS    A                       ; save it on the stack 
C193 84FC             (       ddos2f.asm):00379                 ANDA    #$FC                    ; disable interrupts from PIAxA
C195 A781             (       ddos2f.asm):00380                 STA     ,X++                    ; save it, move to CRB
C197 A684             (       ddos2f.asm):00381                 LDA     ,X                      ; get CRB
C199 3402             (       ddos2f.asm):00382                 PSHS    A                       ; save on stack
C19B 84FC             (       ddos2f.asm):00383                 ANDA    #$FC                    ; disable interrupts from PIAxB
C19D A784             (       ddos2f.asm):00384                 STA     ,X                      ; save it
C19F 30881E           (       ddos2f.asm):00385                 LEAX    30,X                    ; move to next PIA
C1A2 8CFF23           (       ddos2f.asm):00386                 CMPX    #$FF23                  ; reached PIA2 yet?
C1A5 25E8             (       ddos2f.asm):00387                 BLO     SavePIAs                ; nope, keep going
                      (       ddos2f.asm):00388         
C1A7 B6FF27           (       ddos2f.asm):00389                 LDA     PIA2CRB                 ; get control register B of PIA2 
C1AA 8A03             (       ddos2f.asm):00390                 ORA     #$03                    ; enable interrupt, rishing edge
C1AC B7FF27           (       ddos2f.asm):00391                 STA     PIA2CRB                 ; save back to PIA
                      (       ddos2f.asm):00392         
                      (       ddos2f.asm):00393         
C1AF 8603             (       ddos2f.asm):00394                 LDA     #$03
C1B1 3402             (       ddos2f.asm):00395                 PSHS    A
                      (       ddos2f.asm):00396                 
C1B3 96ED             (       ddos2f.asm):00397                 LDA     <DskSectorNo            ; Get disk sector no
C1B5 8112             (       ddos2f.asm):00398                 CMPA    #SectorsPerTrack        ; >$12, therefore on second side
C1B7 230A             (       ddos2f.asm):00399                 BLS     LC1B5                   ; no: don't adjust
                      (       ddos2f.asm):00400                 
C1B9 8012             (       ddos2f.asm):00401                 SUBA    #SectorsPerTrack        ; Calculate sector number on second side
                      (       ddos2f.asm):00402         
C1BB C602             (       ddos2f.asm):00403                 LDB     #$02                    ; Flag as side 2 (Dragon WD2797 only)
C1BD FA0606           (       ddos2f.asm):00404                 ORB     DosHWMaskFF40   
C1C0 F70606           (       ddos2f.asm):00405                 STB     DosHWMaskFF40
                      (       ddos2f.asm):00406         
C1C3 B7FF2D           (       ddos2f.asm):00407         LC1B5   STA     SecReg
C1C6 97F8             (       ddos2f.asm):00408                 STA     <DosSectorSeek
                      (       ddos2f.asm):00409         
C1C8 109E8A           (       ddos2f.asm):00410         LC1B8   LDY     <DBZero
C1CB 9EEE             (       ddos2f.asm):00411                 LDX     <DiskBuffPtr            ; Point to buffer
C1CD D6EA             (       ddos2f.asm):00412                 LDB     <DosCommand             ; Get hardware byte (function code)
C1CF 58               (       ddos2f.asm):00413                 LSLB                            ; Calculate offset in table
                      (       ddos2f.asm):00414                 
C1D0 CEDDF1           (       ddos2f.asm):00415                 LDU     #DosFunctionTable       ; Point to function dispatch table
C1D3 96F8             (       ddos2f.asm):00416                 LDA     <DosSectorSeek          ; get sector seeking to
                      (       ddos2f.asm):00417         
C1D5 B1FF2D           (       ddos2f.asm):00418                 CMPA    SecRegA                 ; Compare to sector register
C1D8 26E9             (       ddos2f.asm):00419                 BNE     LC1B5                   ; not same write again                  
                      (       ddos2f.asm):00420         
C1DA 86FF             (       ddos2f.asm):00421                 LDA     #$FF                    ; Set DP=$FF, to make IO quicker
C1DC 1F8B             (       ddos2f.asm):00422                 TFR     A,DP
C1DE ADD5             (       ddos2f.asm):00423                 JSR     [B,U]                   ; Jump to function handler
                      (       ddos2f.asm):00424                 
C1E0 97F0             (       ddos2f.asm):00425                 STA     <DosDiskError           ; Save error code
C1E2 2402             (       ddos2f.asm):00426                 BCC     LC1E6                   ; No error : check verify
C1E4 202E             (       ddos2f.asm):00427                 BRA     LC214
                      (       ddos2f.asm):00428         
C1E6 B40609           (       ddos2f.asm):00429         LC1E6   ANDA    DosErrorMask            ; Mask out error bits we are not interested in
C1E9 97F0             (       ddos2f.asm):00430                 STA     <DosDiskError           ; save errors for later use
C1EB 270E             (       ddos2f.asm):00431                 BEQ     LC1FB                   
                      (       ddos2f.asm):00432         
C1ED 96EA             (       ddos2f.asm):00433                 LDA     <DosCommand             ; Get operation code
C1EF 8107             (       ddos2f.asm):00434                 CMPA    #DosFnReadSec2          ; ReadSec2 command ?            
C1F1 2704             (       ddos2f.asm):00435                 BEQ     LC1F7                   ; yes 
                      (       ddos2f.asm):00436         
C1F3 6AE4             (       ddos2f.asm):00437                 DEC     ,S                      ; Dec retry count
C1F5 26D1             (       ddos2f.asm):00438                 BNE     LC1B8                   ; retry, if tries remaining
                      (       ddos2f.asm):00439         
C1F7 1A01             (       ddos2f.asm):00440         LC1F7   ORCC    #FlagCarry              ; Flag error
C1F9 2019             (       ddos2f.asm):00441                 BRA     LC214
                      (       ddos2f.asm):00442         
C1FB 7D0609           (       ddos2f.asm):00443         LC1FB   TST     DosErrorMask            ; is this write sector ?
C1FE 2A14             (       ddos2f.asm):00444                 BPL     LC214                   ; no : jump ahead
                      (       ddos2f.asm):00445         
C200 96EC             (       ddos2f.asm):00446                 LDA     <DskTrackNo             ; Get track number
C202 8114             (       ddos2f.asm):00447                 CMPA    #DirPrimary             ; Primary Dir track ?
C204 270B             (       ddos2f.asm):00448                 BEQ     LC211                   ; yep 
                      (       ddos2f.asm):00449         
C206 8110             (       ddos2f.asm):00450                 CMPA    #DirBackup              ; Secondary dir track ?
C208 2707             (       ddos2f.asm):00451                 BEQ     LC211
                      (       ddos2f.asm):00452         
C20A 7D0608           (       ddos2f.asm):00453                 TST     DosVerifyFlag           ; should we verify?
C20D 1CFE             (       ddos2f.asm):00454                 ANDCC   #~(FlagCarry)           ; Flag no carry
C20F 2A03             (       ddos2f.asm):00455                 BPL     LC214                   ; no, skip ahead
                      (       ddos2f.asm):00456         
C211 17FF4B           (       ddos2f.asm):00457         LC211   LBSR    DosDoReadSec2           ; verify the write
C214 3261             (       ddos2f.asm):00458         LC214   LEAS    1,S
C216 6964             (       ddos2f.asm):00459                 ROL     4,S
C218 8E069A           (       ddos2f.asm):00460                 LDX     #DosD0Track-1           ; Point to drive track table
C21B D6EB             (       ddos2f.asm):00461                 LDB     <DosDriveNo             ; Get last used drive
C21D 3A               (       ddos2f.asm):00462                 ABX                             ; get pointer to track for current drive
C21E B6FF2E           (       ddos2f.asm):00463                 LDA     TrkReg                  ; Get current track number from WD
C221 91EC             (       ddos2f.asm):00464                 CMPA    <DskTrackNo             ; Same as current track no ?
C223 2711             (       ddos2f.asm):00465                 BEQ     LC236
                      (       ddos2f.asm):00466         
C225 F60609           (       ddos2f.asm):00467                 LDB     DosErrorMask            ; is this a seek ?
C228 C119             (       ddos2f.asm):00468                 CMPB    #$19
C22A 260A             (       ddos2f.asm):00469                 BNE     LC236
                      (       ddos2f.asm):00470         
C22C C6FF             (       ddos2f.asm):00471                 LDB     #ErrSFF         ; Error code : no error
C22E D7F0             (       ddos2f.asm):00472                 STB     <DosDiskError
C230 6664             (       ddos2f.asm):00473                 ROR     4,S
C232 1A01             (       ddos2f.asm):00474                 ORCC    #FlagCarry              ; flag error
C234 6964             (       ddos2f.asm):00475                 ROL     4,S
                      (       ddos2f.asm):00476         
C236 A784             (       ddos2f.asm):00477         LC236   STA     ,X                      ; update track table
                      (       ddos2f.asm):00478         
                      (       ddos2f.asm):00479         ; Restore PIA control registers saved in SavePIAs above.
                      (       ddos2f.asm):00480         
C238 8EFF23           (       ddos2f.asm):00481                 LDX     #$FF23                  ; point at PIA1 CRB
C23B 3502             (       ddos2f.asm):00482         LC23B   PULS    A                       ; get CRB value
C23D A784             (       ddos2f.asm):00483                 STA     ,X                      ; write it to PIA
C23F 3502             (       ddos2f.asm):00484                 PULS    A                       ; get CRA value
C241 A783             (       ddos2f.asm):00485                 STA     ,--X                    ; write it to PIA, move pointer
C243 3088E2           (       ddos2f.asm):00486                 LEAX    -30,X                   ; point to previous PIA
C246 8CFF01           (       ddos2f.asm):00487                 CMPX    #$FF01                  ; done all ?
C249 22F0             (       ddos2f.asm):00488                 BHI     LC23B                   ; nope loop again
                      (       ddos2f.asm):00489         
C24B 7F0606           (       ddos2f.asm):00490                 CLR     DosHWMaskFF40           ; Clear hardware mask
C24E                  (       ddos2f.asm):00491         LC24E
C24E 5F               (       ddos2f.asm):00492         LC230   CLRB                            ; Flag no error
C24F 357B             (       ddos2f.asm):00493                 PULS    CC,A,DP,X,Y,U           ; Restore regs
C251 2437             (       ddos2f.asm):00494                 BHS     LC28A                   ; no error, exit
                      (       ddos2f.asm):00495         
C253 D6F0             (       ddos2f.asm):00496                 LDB     <DosDiskError           ; get last error code
C255 2733             (       ddos2f.asm):00497                 BEQ     LC28A                   ; no error, exit
                      (       ddos2f.asm):00498         
C257 2A20             (       ddos2f.asm):00499                 BPL     LC279
                      (       ddos2f.asm):00500         ;
                      (       ddos2f.asm):00501         ; Work out the dragon error code that coresponds to the hardware
                      (       ddos2f.asm):00502         ; error reported by WD.
                      (       ddos2f.asm):00503         ;        
                      (       ddos2f.asm):00504         
C259 C1FC             (       ddos2f.asm):00505                 CMPB    #$FC
C25B 2604             (       ddos2f.asm):00506                 BNE     LC261
                      (       ddos2f.asm):00507         
C25D C6A4             (       ddos2f.asm):00508                 LDB     #ErrPR          ; parameter
C25F 2027             (       ddos2f.asm):00509                 BRA     LC288
                      (       ddos2f.asm):00510         
C261                  (       ddos2f.asm):00511         LC261
C261 C1FD             (       ddos2f.asm):00512                 CMPB    #$FD
C263 2604             (       ddos2f.asm):00513                 BNE     LC269
                      (       ddos2f.asm):00514         
C265 C628             (       ddos2f.asm):00515                 LDB     #BErrDN                 ; Device Number 
C267 201F             (       ddos2f.asm):00516                 BRA     LC288
                      (       ddos2f.asm):00517         
C269                  (       ddos2f.asm):00518         LC269
C269 C1FE             (       ddos2f.asm):00519                 CMPB    #$FE
C26B 2604             (       ddos2f.asm):00520                 BNE     LC271
                      (       ddos2f.asm):00521         
C26D C680             (       ddos2f.asm):00522                 LDB     #ErrNR          ; not ready
C26F 2017             (       ddos2f.asm):00523                 BRA     LC288
                      (       ddos2f.asm):00524         
C271                  (       ddos2f.asm):00525         LC271
C271 C1FF             (       ddos2f.asm):00526                 CMPB    #$FF
C273 2611             (       ddos2f.asm):00527                 BNE     LC286
                      (       ddos2f.asm):00528         
C275 C682             (       ddos2f.asm):00529                 LDB     #ErrSK          ; seek
C277 200F             (       ddos2f.asm):00530                 BRA     LC288
                      (       ddos2f.asm):00531         
C279 1F98             (       ddos2f.asm):00532         LC279   TFR     B,A
C27B C682             (       ddos2f.asm):00533                 LDB     #$82
C27D 49               (       ddos2f.asm):00534                 ROLA
C27E CB02             (       ddos2f.asm):00535         LC27E   ADDB    #$02
C280 49               (       ddos2f.asm):00536                 ROLA
C281 4D               (       ddos2f.asm):00537                 TSTA
C282 2504             (       ddos2f.asm):00538                 BLO     LC288
C284 26F8             (       ddos2f.asm):00539                 BNE     LC27E
                      (       ddos2f.asm):00540         
C286 C6A6             (       ddos2f.asm):00541         LC286   LDB     #ErrUD          ; undefined
C288 1A01             (       ddos2f.asm):00542         LC288   ORCC    #FlagCarry
C28A 39               (       ddos2f.asm):00543         LC28A   RTS
                      (       ddos2f.asm):00544         
                      (       ddos2f.asm):00545         ;
                      (       ddos2f.asm):00546         ; Reset controler chip, and spin up drive.
                      (       ddos2f.asm):00547         ;
                      (       ddos2f.asm):00548         
C28B                  (       ddos2f.asm):00549         ResetAndStartDrive   
C28B 86D0             (       ddos2f.asm):00550                 LDA     #WDCmdForceInt          ; Force interrupt
C28D B7FF2F           (       ddos2f.asm):00551                 STA     CmdReg
C290 96EB             (       ddos2f.asm):00552                 LDA     <DosDriveNo             ; Get last active drive no
C292 2704             (       ddos2f.asm):00553                 BEQ     LC27C
                      (       ddos2f.asm):00554                 
C294 8104             (       ddos2f.asm):00555                 CMPA    #$04                    ; Drive valid ?
C296 2303             (       ddos2f.asm):00556                 BLS     LC29B
C298 1A01             (       ddos2f.asm):00557         LC27C   ORCC    #FlagCarry              ; Flag error
C29A                  (       ddos2f.asm):00558         DosHookRetDevParam   
C29A 39               (       ddos2f.asm):00559                 RTS
                      (       ddos2f.asm):00560         
                      (       ddos2f.asm):00561         ; Generate Alpha drive mask from drive number, do drive no
                      (       ddos2f.asm):00562         ; left shifts to get the correct mask
                      (       ddos2f.asm):00563         
C29B C601             (       ddos2f.asm):00564         LC29B   LDB     #$01                    ; initialize mask at 1
C29D 58               (       ddos2f.asm):00565         LC29D   LSLB                            ; shift it left
C29E 4A               (       ddos2f.asm):00566                 DECA                            ; decrement drive no
C29F 26FC             (       ddos2f.asm):00567                 BNE     LC29D                   ; keep going until zero
                      (       ddos2f.asm):00568         
C2A1 54               (       ddos2f.asm):00569                 LSRB                            ; compensate for one shift too many
C2A2 CA10             (       ddos2f.asm):00570                 ORB     #MotorOnA               ; turn on motor
C2A4 3404             (       ddos2f.asm):00571                 PSHS    B                       ; save it
C2A6 B60607           (       ddos2f.asm):00572                 LDA     DosHWMaskFF48           ; get saved hw mask
C2A9 84F0             (       ddos2f.asm):00573                 ANDA    #~DriveMaskA            ; mask drives off in HW mask    
C2AB AAE0             (       ddos2f.asm):00574                 ORA     ,S+                     ; combine with drive we want
C2AD B70607           (       ddos2f.asm):00575                 STA     DosHWMaskFF48           ; re-save hardware mask
C2B0 17198C           (       ddos2f.asm):00576                 LBSR    AlphaDskCtl             ; send it to AY-8912, turn on drives etc
                      (       ddos2f.asm):00577         
C2B3 B6FF25           (       ddos2f.asm):00578                 LDA     PIA2CRA                 ; get control register of PIA2 side A
C2B6 8A38             (       ddos2f.asm):00579                 ORA     #$38                    ; set CA2 high  (enable NMI?)           
C2B8 B7FF25           (       ddos2f.asm):00580                 STA     PIA2CRA                 ; 
                      (       ddos2f.asm):00581                 
C2BB 8E069A           (       ddos2f.asm):00582                 LDX     #DosD0Track-1           ; Point to current track table
C2BE 96EB             (       ddos2f.asm):00583                 LDA     <DosDriveNo             ; Get active drive
C2C0 A686             (       ddos2f.asm):00584                 LDA     A,X                     ; Get drive current track
C2C2 B7FF2E           (       ddos2f.asm):00585                 STA     TrkReg                  ; Write to controler
C2C5 86D2             (       ddos2f.asm):00586                 LDA     #$D2                    ; set timeout           
C2C7 B70605           (       ddos2f.asm):00587                 STA     DosTimeout
C2CA 5F               (       ddos2f.asm):00588                 CLRB                            ; no error ?
C2CB 39               (       ddos2f.asm):00589                 RTS
                      (       ddos2f.asm):00590         
                      (       ddos2f.asm):00591         ;
                      (       ddos2f.asm):00592         ; Dos function 0 restore
                      (       ddos2f.asm):00593         ;
                      (       ddos2f.asm):00594         
C2CC                  (       ddos2f.asm):00595         DosFunctionRestore   
C2CC 4F               (       ddos2f.asm):00596                 CLRA                            ; zero track no
C2CD B700EC           (       ddos2f.asm):00597                 STA     >DskTrackNo             ; Save Track number
C2D0 2012             (       ddos2f.asm):00598                 BRA     LC2B9
                      (       ddos2f.asm):00599         
                      (       ddos2f.asm):00600         ;
                      (       ddos2f.asm):00601         ; Dos function 1 seek
                      (       ddos2f.asm):00602         ; 
                      (       ddos2f.asm):00603         
C2D2                  (       ddos2f.asm):00604         DosFunctionSeek
C2D2 B600EC           (       ddos2f.asm):00605                 LDA     >DskTrackNo             ; Get current track no
C2D5 912E             (       ddos2f.asm):00606                 CMPA    DPTrkReg                ; Are we over it ?
C2D7 2607             (       ddos2f.asm):00607                 BNE     SeekTrackinA            ; no : seek to it
C2D9 4F               (       ddos2f.asm):00608                 CLRA
C2DA B70609           (       ddos2f.asm):00609                 STA     DosErrorMask            ; Turn off verify
C2DD 1F8B             (       ddos2f.asm):00610                 TFR     A,DP                    ; Reset DP
C2DF 39               (       ddos2f.asm):00611                 RTS
                      (       ddos2f.asm):00612         ;
                      (       ddos2f.asm):00613         ; Seek to a track, routine will exit either with an error, or via NMI.
                      (       ddos2f.asm):00614         ; On entry A contains track to seek to.
                      (       ddos2f.asm):00615         ;
                      (       ddos2f.asm):00616         
C2E0                  (       ddos2f.asm):00617         SeekTrackinA
C2E0 972C             (       ddos2f.asm):00618                 STA     <DPDataReg              ; <Eval43 ;DataReg              
C2E2 8610             (       ddos2f.asm):00619                 LDA     #WDCmdSeek              ; Seek command
                      (       ddos2f.asm):00620                 
C2E4 C619             (       ddos2f.asm):00621         LC2B9   LDB     #$19
C2E6 F70609           (       ddos2f.asm):00622                 STB     DosErrorMask
C2E9 8E069E           (       ddos2f.asm):00623                 LDX     #DosD0StepRate-1        ; Point to step rate table
C2EC F600EB           (       ddos2f.asm):00624                 LDB     >DosDriveNo             ; Get active drive
C2EF AA85             (       ddos2f.asm):00625                 ORA     B,X                     ; Mask in that drive's step rate
C2F1 972F             (       ddos2f.asm):00626                 STA     DPCmdReg                ; save in command reg
C2F3 3D               (       ddos2f.asm):00627         LC2C8   MUL                             ; burn up CPU time waiting....
C2F4 3D               (       ddos2f.asm):00628                 MUL                             ; NMI will exit this loop
C2F5 313F             (       ddos2f.asm):00629                 LEAY    -1,Y                    ; decrement timeout counter
C2F7 26FA             (       ddos2f.asm):00630                 BNE     LC2C8                   ; count exhausted ? : no keep going
C2F9 204B             (       ddos2f.asm):00631                 BRA     DosHWError              ; yes : error
                      (       ddos2f.asm):00632         
                      (       ddos2f.asm):00633         ;
                      (       ddos2f.asm):00634         ; Dos function 6 : Read address mark (Dragon)
                      (       ddos2f.asm):00635         ; 
                      (       ddos2f.asm):00636         
C2FB                  (       ddos2f.asm):00637         DosFunctionReadAddr   
C2FB 86C0             (       ddos2f.asm):00638                 LDA     #WDCmdReadAddr          ; Read address mark
C2FD 8C               (       ddos2f.asm):00639                 FCB     Skip2                   ; CMPX again :)
                      (       ddos2f.asm):00640         ;
                      (       ddos2f.asm):00641         ; Dos function 2 : Read sector (Dragon/Cumana)
                      (       ddos2f.asm):00642         ; 
C2FE                  (       ddos2f.asm):00643         DosFunctionReadSec
C2FE 8688             (       ddos2f.asm):00644                 LDA     #WDCmdReadSec           ; Read a sector
C300 C63F             (       ddos2f.asm):00645                 LDB     #WDDefErrMask           ; set error mask
C302 F70609           (       ddos2f.asm):00646                 STB     DosErrorMask
                      (       ddos2f.asm):00647         
C305 C605             (       ddos2f.asm):00648                 LDB     #$05                    ; try 5x$FFFF for timeout
C307 BA0606           (       ddos2f.asm):00649                 ORA     DosHWMaskFF40           ; Mask in side etc
C30A 972F             (       ddos2f.asm):00650                 STA     DPCmdReg
C30C                  (       ddos2f.asm):00651         LC2E1   
C30C 9627             (       ddos2f.asm):00652                 LDA     DPPIACRB                ; Check for INT from WD
C30E 2B0E             (       ddos2f.asm):00653                 BMI     LC2F3                   ; yes : start reading bytes
C310 313F             (       ddos2f.asm):00654                 LEAY    -1,Y                    ; decrement timeout count
C312 26F8             (       ddos2f.asm):00655                 BNE     LC2E1                   ; check for int again, if no timeout
                      (       ddos2f.asm):00656                 
C314 9626             (       ddos2f.asm):00657                 LDA     DPPIADB
                      (       ddos2f.asm):00658                 ifdef   PGSFix
                      (       ddos2f.asm):00659                 BRN     LC2F2
                      (       ddos2f.asm):00660                 else
C316 2B05             (       ddos2f.asm):00661                 BMI     LC2F2
                      (       ddos2f.asm):00662                 endc
C318 5A               (       ddos2f.asm):00663                 DECB                            ; decrement retry wait count
C319 26F1             (       ddos2f.asm):00664                 BNE     LC2E1                   ; count=0 ?, no continue waiting
C31B 2029             (       ddos2f.asm):00665                 BRA     DosHWError              ; yes : error and exit
                      (       ddos2f.asm):00666         
                      (       ddos2f.asm):00667         ;
                      (       ddos2f.asm):00668         ; Read sector/address mark loop, exits with NMI.
                      (       ddos2f.asm):00669         ;
                      (       ddos2f.asm):00670         
C31D 13               (       ddos2f.asm):00671         LC2F2   SYNC
C31E D626             (       ddos2f.asm):00672         LC2F3   LDB     DPPIADB                 ; clear interrupt
C320 962C             (       ddos2f.asm):00673                 LDA     DPDataReg               ; read byte from WD
C322 A780             (       ddos2f.asm):00674                 STA     ,X+                     ; save in buffer
C324 20F7             (       ddos2f.asm):00675                 BRA     LC2F2                   ; do next byte
                      (       ddos2f.asm):00676         
                      (       ddos2f.asm):00677         ;
                      (       ddos2f.asm):00678         ; Dos function 7 read first two bytes of a sector, used by BOOT command.
                      (       ddos2f.asm):00679         ;
                      (       ddos2f.asm):00680         
C326                  (       ddos2f.asm):00681         DosFunctionReadSec2   
C326 8E004F           (       ddos2f.asm):00682                 LDX     #$004F                  
C329 863F             (       ddos2f.asm):00683                 LDA     #WDDefErrMask           ; Set error mask
C32B B70609           (       ddos2f.asm):00684                 STA     DosErrorMask
                      (       ddos2f.asm):00685         
                      (       ddos2f.asm):00686         ;
                      (       ddos2f.asm):00687         ; Code to wait for DRQ when using Dragon/Cumana controlers.
                      (       ddos2f.asm):00688         ;
C32E C605             (       ddos2f.asm):00689                 LDB     #$05                    ; Wait 5x$FFFF 
C330 8688             (       ddos2f.asm):00690                 LDA     #WDCmdReadSec           ; Read sector command
C332 BA0606           (       ddos2f.asm):00691                 ORA     DosHWMaskFF40           ; mask in heads etc
C335 972F             (       ddos2f.asm):00692                 STA     DPCmdReg                ; write it to WD
C337                  (       ddos2f.asm):00693         LC30C   
C337 9627             (       ddos2f.asm):00694                 LDA     DPPIACRB                ; Check for Int from WD
C339 2B17             (       ddos2f.asm):00695                 BMI     LC327                   ; yes : start reading
C33B 313F             (       ddos2f.asm):00696                 LEAY    -1,Y                    ; decrement timeout
C33D 26F8             (       ddos2f.asm):00697                 BNE     LC30C                   ; check again
C33F 9626             (       ddos2f.asm):00698                 LDA     DPPIADB                 ; try clearing int
                      (       ddos2f.asm):00699                 
                      (       ddos2f.asm):00700                 ifdef   PGSFix
                      (       ddos2f.asm):00701                 BRN     LC327
                      (       ddos2f.asm):00702                 else
C341 2B0F             (       ddos2f.asm):00703                 BMI     LC327
                      (       ddos2f.asm):00704                 endc
                      (       ddos2f.asm):00705                 
C343 5A               (       ddos2f.asm):00706                 DECB                            ; decrement outer count
C344 26F1             (       ddos2f.asm):00707                 BNE     LC30C
                      (       ddos2f.asm):00708         
C346                  (       ddos2f.asm):00709         DosHWError   
C346 86D0             (       ddos2f.asm):00710                 LDA     #WDCmdForceInt          ; Force the WD to abort
C348 972F             (       ddos2f.asm):00711                 STA     DPCmdReg
C34A 4F               (       ddos2f.asm):00712                 CLRA                            ; Reset DP to page 0
C34B 1F8B             (       ddos2f.asm):00713                 TFR     A,DP
C34D 86FE             (       ddos2f.asm):00714                 LDA     #$FE                    ; return error
C34F 1A01             (       ddos2f.asm):00715                 ORCC    #FlagCarry
C351 39               (       ddos2f.asm):00716                 RTS
                      (       ddos2f.asm):00717         
                      (       ddos2f.asm):00718         ;
                      (       ddos2f.asm):00719         ; Read data from WD, as normal exited with NMI
                      (       ddos2f.asm):00720         ;
                      (       ddos2f.asm):00721         ; Read bytes code when using Dragon/Cumana controlers.
                      (       ddos2f.asm):00722         ;
                      (       ddos2f.asm):00723         
C352 962C             (       ddos2f.asm):00724         LC327   LDA     DPDataReg               ; read byte from WD
C354 0D26             (       ddos2f.asm):00725                 TST     DPPIADB                 ; clear interrupt
C356 A780             (       ddos2f.asm):00726                 STA     ,X+                     ; save in memory
                      (       ddos2f.asm):00727                 
C358 13               (       ddos2f.asm):00728                 SYNC                            ; wait for next
                      (       ddos2f.asm):00729                 
C359 962C             (       ddos2f.asm):00730                 LDA     DPDataReg               ; get next byte
C35B 0D26             (       ddos2f.asm):00731                 TST     DPPIADB                 ; clear interrupt
C35D A784             (       ddos2f.asm):00732                 STA     ,X                      ; save byte
                      (       ddos2f.asm):00733         
C35F 13               (       ddos2f.asm):00734         LC334   SYNC
C360 0D26             (       ddos2f.asm):00735                 TST     DPPIADB                 ; clear interrupt
C362 962C             (       ddos2f.asm):00736                 LDA     DPDataReg               ; read byte
C364 20F9             (       ddos2f.asm):00737                 BRA     LC334
                      (       ddos2f.asm):00738                 
                      (       ddos2f.asm):00739         
                      (       ddos2f.asm):00740         ;
                      (       ddos2f.asm):00741         ; Dos function 4 Write sector no verify
                      (       ddos2f.asm):00742         ;
                      (       ddos2f.asm):00743         
C366                  (       ddos2f.asm):00744         DosFunctionWriteSec2
C366 865F             (       ddos2f.asm):00745                 LDA     #WDErrMask5F            ; set error mask
C368 8C               (       ddos2f.asm):00746                 FCB     Skip2
                      (       ddos2f.asm):00747         
                      (       ddos2f.asm):00748         ;
                      (       ddos2f.asm):00749         ; Dos function 3 Write sector with verify
                      (       ddos2f.asm):00750         ;
                      (       ddos2f.asm):00751         
C369                  (       ddos2f.asm):00752         DosFunctionWriteSec
C369 86DF             (       ddos2f.asm):00753                 LDA     #WDErrMaskDF            ; set error mask
C36B B70609           (       ddos2f.asm):00754                 STA     DosErrorMask
C36E 8D3D             (       ddos2f.asm):00755                 BSR     DosSetPrecomp           ; Setup write precomp
                      (       ddos2f.asm):00756         
                      (       ddos2f.asm):00757         ;
                      (       ddos2f.asm):00758         ; Write sector for Dragon/Cumana controlers.
                      (       ddos2f.asm):00759         ;
C370 86A8             (       ddos2f.asm):00760                 LDA     #WDCmdWriteSec          ; Write sector
C372 BA0606           (       ddos2f.asm):00761                 ORA     DosHWMaskFF40           ; Mask in side etc
C375 972F             (       ddos2f.asm):00762                 STA     DPCmdReg                ; write to WD
                      (       ddos2f.asm):00763         
C377 A680             (       ddos2f.asm):00764                 LDA     ,X+                     ; fetch first byte to write
C379                  (       ddos2f.asm):00765         LC34E   
C379 D627             (       ddos2f.asm):00766                 LDB     DPPIACRB                ; Int from WD ?
C37B 2B09             (       ddos2f.asm):00767                 BMI     LC35B                   ; yes : start writing
                      (       ddos2f.asm):00768                 
C37D 313F             (       ddos2f.asm):00769                 LEAY    -1,Y                    ; decrement timeout
C37F 26F8             (       ddos2f.asm):00770                 BNE     LC34E                   ; if not timed out continue waiting
C381 20C3             (       ddos2f.asm):00771                 BRA     DosHWError                      ; timout, abort, and return error
                      (       ddos2f.asm):00772         
                      (       ddos2f.asm):00773         ; Write sector loop, NMI breaks out of here
                      (       ddos2f.asm):00774         
C383 A680             (       ddos2f.asm):00775         LC358   LDA     ,X+                     ; get byte to write
C385 13               (       ddos2f.asm):00776                 SYNC                            ; wait for WD
                      (       ddos2f.asm):00777                 
C386 972C             (       ddos2f.asm):00778         LC35B   STA     DPDataReg               ; write byte to WD
C388 9626             (       ddos2f.asm):00779                 LDA     DPPIADB                 ; clear interrupt
C38A 20F7             (       ddos2f.asm):00780                 BRA     LC358
                      (       ddos2f.asm):00781         
                      (       ddos2f.asm):00782         ;
                      (       ddos2f.asm):00783         ; Dos function 5 write track.
                      (       ddos2f.asm):00784         ;
                      (       ddos2f.asm):00785         ; Will return WTErr if N.F.G.
                      (       ddos2f.asm):00786         ;
                      (       ddos2f.asm):00787         ; The format of the write buffer is somewhat strange for this routine.
                      (       ddos2f.asm):00788         ; The reason for this is so that we can format a diskette without hosing 
                      (       ddos2f.asm):00789         ; the poor user's basic program.
                      (       ddos2f.asm):00790         ; The method of run length coding only requires $22B bytes instead of 
                      (       ddos2f.asm):00791         ; the normale $0000 bytes.
                      (       ddos2f.asm):00792         ;
                      (       ddos2f.asm):00793         
C38C                  (       ddos2f.asm):00794         DosFunctionWriteTrack   
C38C 8647             (       ddos2f.asm):00795                 LDA     #WDErrMaskFormat        ; set error mask        
C38E B70609           (       ddos2f.asm):00796                 STA     DosErrorMask
C391 8D1A             (       ddos2f.asm):00797                 BSR     DosSetPrecomp           ; Set write precomp
                      (       ddos2f.asm):00798         
C393 86F4             (       ddos2f.asm):00799                 LDA     #WDCmdWriteTrack        ; Write (format) track                  
C395 BA0606           (       ddos2f.asm):00800                 ORA     DosHWMaskFF40           ; Mask in head etc
C398 972F             (       ddos2f.asm):00801                 STA     DPCmdReg
                      (       ddos2f.asm):00802                 
C39A EC81             (       ddos2f.asm):00803         LC36F   LDD     ,X++                    ; Get bytes to write A=count, B=byte
C39C 13               (       ddos2f.asm):00804         LC371   SYNC                            ; Wait for WD
                      (       ddos2f.asm):00805         
C39D 9126             (       ddos2f.asm):00806                 CMPA    DPPIADB                 ; Clear interrupt
C39F D72C             (       ddos2f.asm):00807                 STB     DPDataReg               ; Write a byte on track
C3A1 4A               (       ddos2f.asm):00808                 DECA                            ; decrement byte count
C3A2 26F8             (       ddos2f.asm):00809                 BNE     LC371                   ; continue until count=0
                      (       ddos2f.asm):00810         
C3A4 A680             (       ddos2f.asm):00811                 LDA     ,X+                     ; get next 
C3A6 13               (       ddos2f.asm):00812                 SYNC
                      (       ddos2f.asm):00813                 
C3A7 9126             (       ddos2f.asm):00814                 CMPA    DPPIADB                 ; Clear int
C3A9 972C             (       ddos2f.asm):00815                 STA     DPDataReg               ; write to wd
C3AB 20ED             (       ddos2f.asm):00816                 BRA     LC36F
                      (       ddos2f.asm):00817         
                      (       ddos2f.asm):00818         ;
                      (       ddos2f.asm):00819         ; Set write precompensation based on track
                      (       ddos2f.asm):00820         ;
                      (       ddos2f.asm):00821         
C3AD                  (       ddos2f.asm):00822         DosSetPrecomp
C3AD 962E             (       ddos2f.asm):00823                 LDA     DPTrkReg                ; Get track 
C3AF 8110             (       ddos2f.asm):00824                 CMPA    #TrackPrecomp           ; track < 16
C3B1 2307             (       ddos2f.asm):00825                 BLS     LC38F                   ; no : no write precomp
                      (       ddos2f.asm):00826                 
C3B3 B60607           (       ddos2f.asm):00827                 LDA     DosHWMaskFF48           ; Enable precomp
C3B6 8A40             (       ddos2f.asm):00828                 ORA     #WPCEnA
C3B8 2005             (       ddos2f.asm):00829                 BRA     LC394
                      (       ddos2f.asm):00830         
C3BA B60607           (       ddos2f.asm):00831         LC38F   LDA     DosHWMaskFF48           ; Turn off precomp
C3BD 84BF             (       ddos2f.asm):00832                 ANDA    #~WPCEnA        ;#$EF
C3BF                  (       ddos2f.asm):00833         LC394 
C3BF 17187D           (       ddos2f.asm):00834                 LBSR    AlphaDskCtl             ; Write control reg
C3C2 39               (       ddos2f.asm):00835                 RTS
                      (       ddos2f.asm):00836                 ENDC
                      (       ddos2f.asm):00837         
                      (       ddos2f.asm):00838         ;
                      (       ddos2f.asm):00839         ; BOOTDSK dispatch routine
                      (       ddos2f.asm):00840         ; 
                      (       ddos2f.asm):00841         ; Syntax is the same as for DSKINIT below.
                      (       ddos2f.asm):00842         ;
                      (       ddos2f.asm):00843                 
C3C3                  (       ddos2f.asm):00844         CmdBootdsk
C3C3 3401             (       ddos2f.asm):00845                 PSHS    CC                      ; save flags
C3C5 0AF7             (       ddos2f.asm):00846                 DEC     <DosMakeSysDsk          ; flag that we are making a system disk
C3C7 3501             (       ddos2f.asm):00847                 PULS    CC                      ; recover flags fall through to DSKINIT 
                      (       ddos2f.asm):00848         ;
                      (       ddos2f.asm):00849         ; Dskinit dispatch routine
                      (       ddos2f.asm):00850         ;
                      (       ddos2f.asm):00851         ; Syntax :
                      (       ddos2f.asm):00852         ;       DSKINIT                         (default drive,sides,tracks)
                      (       ddos2f.asm):00853         ;       DSKINIT drive                   (specified drive, default sides,tracks) 
                      (       ddos2f.asm):00854         ;       DSKINIT drive,sides             (specified drive,sides default tracks) 
                      (       ddos2f.asm):00855         ;       DSKINIT drive,sides,tracks      (specified drive,sides,tracks)
                      (       ddos2f.asm):00856         ;
                      (       ddos2f.asm):00857                         
C3C9                  (       ddos2f.asm):00858         CmdDskInit   
C3C9 2723             (       ddos2f.asm):00859                 BEQ     LC3BC                   ; No parameters : use defaults
C3CB BDC710           (       ddos2f.asm):00860                 JSR     >GetDriveNoInB          ; Get drive no
C3CE D7EB             (       ddos2f.asm):00861                 STB     <DosDriveNo             ; save it
C3D0 BDC597           (       ddos2f.asm):00862                 JSR     >GetCommaThen8Bit       ; Get comma, and then no of sides
C3D3 271E             (       ddos2f.asm):00863                 BEQ     LC3C1                   ; Error, use default sides & tracks
                      (       ddos2f.asm):00864                 
C3D5 5A               (       ddos2f.asm):00865                 DECB                            ; Convert sides to zero base
C3D6 C101             (       ddos2f.asm):00866                 CMPB    #$01                    ; > 1 sides specified : error & exit
C3D8 2211             (       ddos2f.asm):00867                 BHI     LC3B9                   ; Error : use default tracks
                      (       ddos2f.asm):00868                 
C3DA D7F4             (       ddos2f.asm):00869                 STB     <DosRecLenFlag          ; Save sides
C3DC BDC597           (       ddos2f.asm):00870                 JSR     >GetCommaThen8Bit       ; Get comman, then tracks
C3DF 2714             (       ddos2f.asm):00871                 BEQ     LC3C3                   ; Error : use default tracks
                      (       ddos2f.asm):00872                 
C3E1 C128             (       ddos2f.asm):00873                 CMPB    #$28                    ; 40 tracks ?
C3E3 2712             (       ddos2f.asm):00874                 BEQ     LC3C5                   ; Yes skip on
                      (       ddos2f.asm):00875                 
C3E5 00F4             (       ddos2f.asm):00876                 NEG     <DosRecLenFlag
C3E7 C150             (       ddos2f.asm):00877                 CMPB    #$50                    ; 80 tracks ?
C3E9 270C             (       ddos2f.asm):00878                 BEQ     LC3C5                   ; yes, skip on
C3EB 7EC71D           (       ddos2f.asm):00879         LC3B9   JMP     >DosPRError
                      (       ddos2f.asm):00880         
                      (       ddos2f.asm):00881         ;
                      (       ddos2f.asm):00882         ; Set defaults for format : disk=1,sides=1,tracks=40
                      (       ddos2f.asm):00883         ;
                      (       ddos2f.asm):00884         
C3EE F6060A           (       ddos2f.asm):00885         LC3BC   LDB     DosDefDriveNo           ; use default drive
C3F1 D7EB             (       ddos2f.asm):00886                 STB     <DosDriveNo             ; save in last used
C3F3 0FF4             (       ddos2f.asm):00887         LC3C1   CLR     <DosRecLenFlag          
C3F5 C650             (       ddos2f.asm):00888         LC3C3   LDB     #FmtDefTracksA          ; no of tracks to format by default
C3F7 D7F2             (       ddos2f.asm):00889         LC3C5   STB     <DosDSKINITraks
                      (       ddos2f.asm):00890              
                      (       ddos2f.asm):00891         ;
                      (       ddos2f.asm):00892         ; <DosDSKINITraks = tracks to format
                      (       ddos2f.asm):00893         ; <DosRecLenFlag  = sides-1 so singlesided = 0, double sided = 1
                      (       ddos2f.asm):00894         ;
                      (       ddos2f.asm):00895            
C3F9 BDD749           (       ddos2f.asm):00896                 JSR     >DosCloseAllFiles       ; close all files error if can't
C3FC 10260086         (       ddos2f.asm):00897                 LBNE    DosJmpToSysError
                      (       ddos2f.asm):00898                 
C400 8E0800           (       ddos2f.asm):00899                 LDX     #DosDiskBuffBase        ; Point to the buffer base
C403 9FEE             (       ddos2f.asm):00900                 STX     <DiskBuffPtr
C405 BDC165           (       ddos2f.asm):00901                 JSR     >DosDoRestore           ; Restore to track 0
C408 267C             (       ddos2f.asm):00902                 BNE     DosJmpToSysError        ; error : exit
                      (       ddos2f.asm):00903                 
C40A 8601             (       ddos2f.asm):00904                 LDA     #$01                    ; start at sector 1
C40C 97ED             (       ddos2f.asm):00905                 STA     <DskSectorNo            
C40E BDC15F           (       ddos2f.asm):00906                 JSR     >DosDoReadSec2          ; try reading it
C411 C180             (       ddos2f.asm):00907                 CMPB    #$80                    
C413 2771             (       ddos2f.asm):00908                 BEQ     DosJmpToSysError
                      (       ddos2f.asm):00909                 
C415 0FF3             (       ddos2f.asm):00910         LC3E5   CLR     <DosDSKINIHead          ; do head 0
C417 0FED             (       ddos2f.asm):00911                 CLR     <DskSectorNo            ; start at sector 0
                      (       ddos2f.asm):00912                 
C419 BDC566           (       ddos2f.asm):00913                 JSR     >SetupTrackLayout       ; setup track layout in ram
C41C BDC0FB           (       ddos2f.asm):00914                 JSR     >DosDoWriteTrack        ; write the track
C41F 2565             (       ddos2f.asm):00915                 BCS     DosJmpToSysError        ; error : exit
                      (       ddos2f.asm):00916                 
C421 0DF4             (       ddos2f.asm):00917                 TST     <DosRecLenFlag          ; is this a double sided disk ? 
C423 270F             (       ddos2f.asm):00918                 BEQ     LC404                   ; nope skip
C425 8601             (       ddos2f.asm):00919                 LDA     #$01                    ; do side 1
C427 97F3             (       ddos2f.asm):00920                 STA     <DosDSKINIHead
C429 40               (       ddos2f.asm):00921                 NEGA
C42A 97ED             (       ddos2f.asm):00922                 STA     <DskSectorNo
                      (       ddos2f.asm):00923         
C42C BDC566           (       ddos2f.asm):00924                 JSR     >SetupTrackLayout       ; setup track layout in ram
C42F BDC0FB           (       ddos2f.asm):00925                 JSR     >DosDoWriteTrack        ; write the track
C432 2552             (       ddos2f.asm):00926                 BCS     DosJmpToSysError        ; error : exit
                      (       ddos2f.asm):00927         
C434 0CEC             (       ddos2f.asm):00928         LC404   INC     <DskTrackNo             ; increment track 
C436 96EC             (       ddos2f.asm):00929                 LDA     <DskTrackNo             
C438 91F2             (       ddos2f.asm):00930                 CMPA    <DosDSKINITraks         ; have we done all yet ?
C43A 25D9             (       ddos2f.asm):00931                 BCS     LC3E5                   ; nope do next track
                      (       ddos2f.asm):00932                 
C43C BDC165           (       ddos2f.asm):00933                 JSR     >DosDoRestore           ; finished formatting, restore to track 0
C43F 2545             (       ddos2f.asm):00934                 BCS     DosJmpToSysError
                      (       ddos2f.asm):00935                 
C441 BDC162           (       ddos2f.asm):00936         LC411   JSR     >DosDoSeek              ; seek to track 
C444 2540             (       ddos2f.asm):00937                 BCS     DosJmpToSysError        ; error : exit
                      (       ddos2f.asm):00938                 
C446 4F               (       ddos2f.asm):00939                 CLRA
C447 BDC54F           (       ddos2f.asm):00940                 JSR     >CmdDskInitVerifyTrack  ; verify current track
C44A 0CEC             (       ddos2f.asm):00941                 INC     <DskTrackNo             ; move to next track
C44C 96EC             (       ddos2f.asm):00942                 LDA     <DskTrackNo
C44E 91F2             (       ddos2f.asm):00943                 CMPA    <DosDSKINITraks         ; done all ?    
C450 25EF             (       ddos2f.asm):00944                 BCS     LC411                   ; nope : do next track
                      (       ddos2f.asm):00945                 
C452 9EEE             (       ddos2f.asm):00946                 LDX     <DiskBuffPtr            ; point at disk buffer
C454 DC8A             (       ddos2f.asm):00947                 LDD     <DBZero ; d=0
C456 ED81             (       ddos2f.asm):00948         LC426   STD     ,X++                    ; fill buffer with zeros
C458 8C0B00           (       ddos2f.asm):00949                 CMPX    #DskInitBuffer+(3*256)  ; end of buffer?
C45B 26F9             (       ddos2f.asm):00950                 BNE     LC426                   ; nope keep filling
                      (       ddos2f.asm):00951                 
C45D 8601             (       ddos2f.asm):00952                 LDA     #$01                    ; sector 0 
C45F 97ED             (       ddos2f.asm):00953                 STA     <DskSectorNo
C461 8614             (       ddos2f.asm):00954                 LDA     #DirPrimary             ; Directory track
C463 8D0A             (       ddos2f.asm):00955                 BSR     BuildAndWriteBAM        ; build and write BAM 
                      (       ddos2f.asm):00956         
C465 0AED             (       ddos2f.asm):00957                 DEC     <DskSectorNo            ; Point back at first BAM block 
C467 0AEE             (       ddos2f.asm):00958                 DEC     <DiskBuffPtr
C469 8610             (       ddos2f.asm):00959                 LDA     #DirBackup              ; Directory backup track
C46B 8D08             (       ddos2f.asm):00960                 BSR     WriteBAM                ; Write BAM sectors
C46D 201D             (       ddos2f.asm):00961                 BRA     MakeBlankDir
                      (       ddos2f.asm):00962         
C46F                  (       ddos2f.asm):00963         BuildAndWriteBAM   
C46F 3402             (       ddos2f.asm):00964                 PSHS    A
C471 8D73             (       ddos2f.asm):00965                 BSR     BuildBAM                ; Build BAM and geometry info
C473 3502             (       ddos2f.asm):00966                 PULS    A
                      (       ddos2f.asm):00967         
C475                  (       ddos2f.asm):00968         WriteBAM
C475 97EC             (       ddos2f.asm):00969                 STA     <DskTrackNo             ; Write sector to track
C477 BDC101           (       ddos2f.asm):00970                 JSR     >DosDoWriteSecV
C47A 250A             (       ddos2f.asm):00971                 BCS     DosJmpToSysError        ; error : exit
                      (       ddos2f.asm):00972                 
C47C 0CED             (       ddos2f.asm):00973                 INC     <DskSectorNo            ; do sector 2
C47E 0CEE             (       ddos2f.asm):00974                 INC     <DiskBuffPtr
C480 BDC101           (       ddos2f.asm):00975                 JSR     >DosDoWriteSecV         ; Write sector to track
C483 2501             (       ddos2f.asm):00976                 BCS     DosJmpToSysError        ; error : exit
C485 39               (       ddos2f.asm):00977                 RTS
                      (       ddos2f.asm):00978                 
                      (       ddos2f.asm):00979         ;
                      (       ddos2f.asm):00980         ; Exit with error, allow basic to handle it.
                      (       ddos2f.asm):00981         ;
                      (       ddos2f.asm):00982         
C486                  (       ddos2f.asm):00983         DosJmpToSysError           
C486 7F00F7           (       ddos2f.asm):00984                 CLR     >DosMakeSysDsk
C489 7EC71F           (       ddos2f.asm):00985                 JMP     >DosHookSysError        ; Jump to basic error handler
                      (       ddos2f.asm):00986         
                      (       ddos2f.asm):00987         ; Fill in a blank directory sector, setting default attributes.
                      (       ddos2f.asm):00988         ; Bug : this seems to only fill in the backup track, as the call 
                      (       ddos2f.asm):00989         ; to Lc489 will never return !
C48C                  (       ddos2f.asm):00990         MakeBlankDir   
C48C 0CEE             (       ddos2f.asm):00991                 INC     <DiskBuffPtr            ; Increment buff pointer by 1 page
C48E 9EEE             (       ddos2f.asm):00992                 LDX     <DiskBuffPtr                    
C490 CC890A           (       ddos2f.asm):00993                 LDD     #(AttrAtFormat*256)+DirEntPerSec        ; Get default attribute & number of entries                     
C493 A784             (       ddos2f.asm):00994         LC460   STA     ,X                      ; Fill in attributes
C495 308819           (       ddos2f.asm):00995                 LEAX    DirEntryLen,X           ; move to next entry
C498 5A               (       ddos2f.asm):00996                 DECB                            ; any more : continue
C499 26F8             (       ddos2f.asm):00997                 BNE     LC460                   
                      (       ddos2f.asm):00998                 
C49B 8D37             (       ddos2f.asm):00999                 BSR     WriteNewDir             
                      (       ddos2f.asm):01000                 
C49D 8614             (       ddos2f.asm):01001                 LDA     #DirPrimary             ; Do primary dir track
C49F 97EC             (       ddos2f.asm):01002                 STA     <DskTrackNo
C4A1 8D31             (       ddos2f.asm):01003                 BSR     WriteNewDir
                      (       ddos2f.asm):01004                 
C4A3 0DF7             (       ddos2f.asm):01005                 TST     <DosMakeSysDsk          ; are we making system disk?
C4A5 2729             (       ddos2f.asm):01006                 BEQ     LC4D0                   ; nope exit
                      (       ddos2f.asm):01007         
C4A7 BDC165           (       ddos2f.asm):01008                 JSR     DosDoRestore            ; restore to track 0
C4AA 25DA             (       ddos2f.asm):01009                 BLO     DosJmpToSysError        ; error exit    
                      (       ddos2f.asm):01010         
C4AC 8EC000           (       ddos2f.asm):01011                 LDX     #DosBegin               ; point to beginning of dos
C4AF C603             (       ddos2f.asm):01012                 LDB     #BootFirstSector        ; first sector of boot area                     
C4B1                  (       ddos2f.asm):01013         LC4B1
C4B1 D7ED             (       ddos2f.asm):01014                 STB     <DskSectorNo            ; set sector
C4B3 9FEE             (       ddos2f.asm):01015                 STX     <DiskBuffPtr            ; point at dos
C4B5 BDC101           (       ddos2f.asm):01016                 JSR     DosDoWriteSecV          ; write the sector
C4B8 25CC             (       ddos2f.asm):01017                 BLO     DosJmpToSysError        ; error exit
                      (       ddos2f.asm):01018         
C4BA 30890100         (       ddos2f.asm):01019                 LEAX    256,X                   ; move up one sector's worth
C4BE 8CE000           (       ddos2f.asm):01020                 CMPX    #DosEnd                 ; beyond end of Dos
C4C1 270D             (       ddos2f.asm):01021                 BEQ     LC4D0                   ; yep, exit 
                      (       ddos2f.asm):01022         
C4C3 D6ED             (       ddos2f.asm):01023                 LDB     <DskSectorNo            ; increment sector number
C4C5 5C               (       ddos2f.asm):01024                 INCB
C4C6 C113             (       ddos2f.asm):01025                 CMPB    #BootLastSector+1       ; done all sectors?
C4C8 26E7             (       ddos2f.asm):01026                 BNE     LC4B1                   ; no loop again
                      (       ddos2f.asm):01027         
C4CA 0CEC             (       ddos2f.asm):01028                 INC     <DskTrackNo             ; increment track number
C4CC C601             (       ddos2f.asm):01029                 LDB     #$01                    ; reset to sector 1
C4CE 20E1             (       ddos2f.asm):01030                 BRA     LC4B1                   ; loop again
                      (       ddos2f.asm):01031         
C4D0                  (       ddos2f.asm):01032         LC4D0
C4D0 7F00F7           (       ddos2f.asm):01033                 CLR     >DosMakeSysDsk          ; flag not making system disk
C4D3 39               (       ddos2f.asm):01034                 RTS
                      (       ddos2f.asm):01035         
C4D4                  (       ddos2f.asm):01036         WriteNewDir
C4D4 CC1003           (       ddos2f.asm):01037                 LDD     #$1003                  ; Process 16 sectors starting at sector 3
C4D7 D7ED             (       ddos2f.asm):01038                 STB     <DskSectorNo
C4D9 BDC101           (       ddos2f.asm):01039         LC473   JSR     >DosDoWriteSecV         ; go write the sector
C4DC 25A8             (       ddos2f.asm):01040                 BCS     DosJmpToSysError        ; error : exit
                      (       ddos2f.asm):01041                 
C4DE 0CED             (       ddos2f.asm):01042                 INC     <DskSectorNo            ; do next sector
C4E0 4A               (       ddos2f.asm):01043                 DECA                            ; decrement count
C4E1 26F6             (       ddos2f.asm):01044                 BNE     LC473                   ; keep going if more
                      (       ddos2f.asm):01045         
C4E3 7EC0B8           (       ddos2f.asm):01046                 JMP     >DosReset               ; reset dos
                      (       ddos2f.asm):01047         
                      (       ddos2f.asm):01048         ;
                      (       ddos2f.asm):01049         ; Build the block availability bitmap in sectors 1 and 2 of directory track
                      (       ddos2f.asm):01050         ; this does 3 things.
                      (       ddos2f.asm):01051         ; 1) Marks all physical sectors as available, adjusting for DS/SS & 40/80 tracks
                      (       ddos2f.asm):01052         ; 2) Marks all directory track sectors as being in use, ajusting for DS/SS disks.
                      (       ddos2f.asm):01053         ; 3) Fills in disk geometry bytes in the first BAM sector.
                      (       ddos2f.asm):01054         ;
C4E6                  (       ddos2f.asm):01055         BuildBAM   
C4E6 97EC             (       ddos2f.asm):01056                 STA     <DskTrackNo
C4E8 8612             (       ddos2f.asm):01057                 LDA     #SectorsPerTrack
C4EA C65A             (       ddos2f.asm):01058                 LDB     #BAMEntries40SS         ; used to calculate number of needed BAM entries
C4EC 0DF4             (       ddos2f.asm):01059                 TST     <DosRecLenFlag          ; Double sided ?
C4EE 2702             (       ddos2f.asm):01060                 BEQ     LC48C
                      (       ddos2f.asm):01061                 
C4F0 58               (       ddos2f.asm):01062                 LSLB                            ; Double number of sectors as DS
C4F1 48               (       ddos2f.asm):01063                 LSLA                            ; Double number of BAM entries as DS
C4F2 B708FD           (       ddos2f.asm):01064         LC48C   STA     DskInitBuffer+DirSecPerTrk      ; save sectors / track
C4F5 43               (       ddos2f.asm):01065                 COMA
C4F6 B708FF           (       ddos2f.asm):01066                 STA     DskInitBuffer+DirSecPerTrk1s    ; save complement for error check
                      (       ddos2f.asm):01067         
C4F9 96F2             (       ddos2f.asm):01068                 LDA     <DosDSKINITraks         ; Get number of tracks
C4FB B708FC           (       ddos2f.asm):01069                 STA     DskInitBuffer+DirTracks ; Save no of tracks
                      (       ddos2f.asm):01070         
C4FE 0DF4             (       ddos2f.asm):01071                 TST     <DosRecLenFlag          ; double sided ?        
C500 2605             (       ddos2f.asm):01072                 BNE     LC507                   ; no.....
                      (       ddos2f.asm):01073         
C502 8150             (       ddos2f.asm):01074                 CMPA    #$50                    ; 80 track drive?
C504 2601             (       ddos2f.asm):01075                 BNE     LC507                   ; no.....
                      (       ddos2f.asm):01076         
C506 58               (       ddos2f.asm):01077                 LSLB                            ; double number of BAM entries as 80 track
C507                  (       ddos2f.asm):01078         LC507
C507 43               (       ddos2f.asm):01079                 COMA                            ; Complement for error check
C508 B708FE           (       ddos2f.asm):01080                 STA     DskInitBuffer+DirTracks1s       ; Save no of tracks check
                      (       ddos2f.asm):01081                 
C50B 9EEE             (       ddos2f.asm):01082                 LDX     <DiskBuffPtr
C50D CE0900           (       ddos2f.asm):01083                 LDU     #DskInitBuffer+(256*1)  ; 1 sector into buffer
                      (       ddos2f.asm):01084                 
                      (       ddos2f.asm):01085                 
C510 0DF7             (       ddos2f.asm):01086                 TST     <DosMakeSysDsk          ; are we making a system disk?
C512 270E             (       ddos2f.asm):01087                 BEQ     LC522                   ; no 
                      (       ddos2f.asm):01088         
C514 96EB             (       ddos2f.asm):01089                 LDA     <DosDriveNo             ; get last active drive
C516 8102             (       ddos2f.asm):01090                 CMPA    #$02                    ; external drive?
C518 2208             (       ddos2f.asm):01091                 BHI     LC522                   ; yes.....
                      (       ddos2f.asm):01092         
C51A C005             (       ddos2f.asm):01093                 SUBB    #$05                    ; reserve second half of boot file
C51C 3004             (       ddos2f.asm):01094                 LEAX    4,X                     ; in BAM
C51E 86FC             (       ddos2f.asm):01095                 LDA     #$FC
C520 A780             (       ddos2f.asm):01096                 STA     ,X+
C522                  (       ddos2f.asm):01097         LC522
C522 86FF             (       ddos2f.asm):01098                 LDA     #$FF                    ; Mark a block of sectors free
C524 A780             (       ddos2f.asm):01099         LC4A3   STA     ,X+
C526 5A               (       ddos2f.asm):01100                 DECB                            ; Any more BAM groups ?
C527 26FB             (       ddos2f.asm):01101                 BNE     LC4A3
                      (       ddos2f.asm):01102         
C529 CC242D           (       ddos2f.asm):01103                 LDD     #(BAMOffDirBakSS*256)+BAMOffDirPriSS ; get offsets in BAM of dir sectors SS     
C52C 0DF4             (       ddos2f.asm):01104                 TST     <DosRecLenFlag          ; double sided ?
C52E 270D             (       ddos2f.asm):01105                 BEQ     LC4BC
C530 2A08             (       ddos2f.asm):01106                 BPL     LC4B9
                      (       ddos2f.asm):01107                 
C532 CCB4FF           (       ddos2f.asm):01108                 LDD     #$B4FF
C535 E7C0             (       ddos2f.asm):01109         LC4B4   STB     ,U+
C537 4A               (       ddos2f.asm):01110                 DECA
C538 26FB             (       ddos2f.asm):01111                 BNE     LC4B4
                      (       ddos2f.asm):01112         
C53A CC485A           (       ddos2f.asm):01113         LC4B9   LDD     #(BAMOffDirBakDS*256)+BAMOffDirPriDS ; get offsets in BAM of dir sectors DS 
                      (       ddos2f.asm):01114         
C53D DE8A             (       ddos2f.asm):01115         LC4BC   LDU     <DBZero ; U=0
C53F 3402             (       ddos2f.asm):01116                 PSHS    A                       ; Mark track 20 dir in use
C541 8D02             (       ddos2f.asm):01117                 BSR     LC4C4
C543 3504             (       ddos2f.asm):01118                 PULS    B                       ; mark track 16 dir in use
                      (       ddos2f.asm):01119         
C545 9EEE             (       ddos2f.asm):01120         LC4C4   LDX     <DiskBuffPtr            ; get pointer to BAM
C547 3A               (       ddos2f.asm):01121                 ABX                             ; calculate offset
C548 86FC             (       ddos2f.asm):01122                 LDA     #$FC                    ; mask for last 2 sectors
C54A EF81             (       ddos2f.asm):01123                 STU     ,X++                    ; mark dir sectors in use
C54C A784             (       ddos2f.asm):01124                 STA     ,X
C54E 39               (       ddos2f.asm):01125                 RTS
                      (       ddos2f.asm):01126         
C54F                  (       ddos2f.asm):01127         CmdDskInitVerifyTrack   
C54F 0FED             (       ddos2f.asm):01128                 CLR     <DskSectorNo            ; Sector 0
C551 0DF4             (       ddos2f.asm):01129                 TST     <DosRecLenFlag          ; is it DS ?
C553 2702             (       ddos2f.asm):01130                 BEQ     LC4D6                   ; nope just do side 0
C555 8D00             (       ddos2f.asm):01131                 BSR     LC4D6                   ; do side 0 then 1
                      (       ddos2f.asm):01132                 
C557 8612             (       ddos2f.asm):01133         LC4D6   LDA     #SectorsPerTrack        ; Sector counter
C559 0CED             (       ddos2f.asm):01134         LC4D8   INC     <DskSectorNo            ; next sector
C55B BDC15F           (       ddos2f.asm):01135                 JSR     >DosDoReadSec2          ; go read it
C55E 1025FF24         (       ddos2f.asm):01136                 LBCS    DosJmpToSysError        ; error : exit
C562 4A               (       ddos2f.asm):01137                 DECA                            ; decrement count
C563 26F4             (       ddos2f.asm):01138                 BNE     LC4D8                   ; loop again if more
C565 39               (       ddos2f.asm):01139         LC4E4   RTS
                      (       ddos2f.asm):01140         
                      (       ddos2f.asm):01141         ;
                      (       ddos2f.asm):01142         ; Setup format block for write track
                      (       ddos2f.asm):01143         ;
                      (       ddos2f.asm):01144         ; The track format used by write track is made up of records of 3 bytes :
                      (       ddos2f.asm):01145         ;
                      (       ddos2f.asm):01146         ; byte 0        repeat count
                      (       ddos2f.asm):01147         ; byte 1        data byte
                      (       ddos2f.asm):01148         ; byte 2        terminator byte
                      (       ddos2f.asm):01149         ; 
                      (       ddos2f.asm):01150         ; The low level write track then takes the byte counts and outputs the repeated 
                      (       ddos2f.asm):01151         ; bytes for us. This is slightly more complex than the systems used on other 
                      (       ddos2f.asm):01152         ; systems (e.g. Nascom, Atom, BBC) where the entire track is laid out in memory
                      (       ddos2f.asm):01153         ; raw. However this has the major advantage of needing much less memory, meaning
                      (       ddos2f.asm):01154         ; the track layout can be kept within the disk buffers. This means that (unlike 
                      (       ddos2f.asm):01155         ; the Atom and BBC DFS) formatting a disk does not corrupt any of the non DOS 
                      (       ddos2f.asm):01156         ; related memory - neat.
                      (       ddos2f.asm):01157         ;
                      (       ddos2f.asm):01158         
C566                  (       ddos2f.asm):01159         SetupTrackLayout   
C566 DEEE             (       ddos2f.asm):01160                 LDU     <DiskBuffPtr            ; Point to disk buffer
C568 8EDE14           (       ddos2f.asm):01161                 LDX     #TrackHeaderTable
C56B 108EDE01         (       ddos2f.asm):01162                 LDY     #SectorIDTable          ; Table of sector IDs with required interleave          
                      (       ddos2f.asm):01163                 
                      (       ddos2f.asm):01164         ; Write track header
C56F C60C             (       ddos2f.asm):01165                 LDB     #TrackHeaderSize        ; Count
C571 8D21             (       ddos2f.asm):01166                 BSR     DosUtilCopyBXtoU        ; copy bytes
                      (       ddos2f.asm):01167                 
                      (       ddos2f.asm):01168         ; Write sector ID       
C573 8EDE20           (       ddos2f.asm):01169         LC4F2   LDX     #SectorIDLayout         ; first part of sector ID
C576 C606             (       ddos2f.asm):01170                 LDB     #SectorIDP1Len          ; count 
C578 8D1A             (       ddos2f.asm):01171                 BSR     DosUtilCopyBXtoU        ; copy bytes
                      (       ddos2f.asm):01172                 
                      (       ddos2f.asm):01173         ; now fill in the C,H,R,N values for the sector 
C57A 8601             (       ddos2f.asm):01174                 LDA     #$01                    ; repeat count 1 byte   
C57C D6EC             (       ddos2f.asm):01175                 LDB     <DskTrackNo             ; get Cylinder number 
C57E EDC1             (       ddos2f.asm):01176                 STD     ,U++                    ; save in buffer
C580 D6F3             (       ddos2f.asm):01177                 LDB     <DosDSKINIHead          ; get Head 
C582 E7C0             (       ddos2f.asm):01178                 STB     ,U+                     ; save in buffer (as term byte)
C584 E6A0             (       ddos2f.asm):01179                 LDB     ,Y+                     ; get sector (Record) number 
C586 EDC1             (       ddos2f.asm):01180                 STD     ,U++                    ; save count of 1 plus sector number
C588 A7C0             (       ddos2f.asm):01181                 STA     ,U+                     ; save sector size of 1 (N=256)
                      (       ddos2f.asm):01182                 
                      (       ddos2f.asm):01183         ; Write end of sector ID + Sector data area
C58A C612             (       ddos2f.asm):01184                 LDB     #SectorIDP2Len          ; count of bytes in rest of sector ID and sectro data
C58C 8D06             (       ddos2f.asm):01185                 BSR     DosUtilCopyBXtoU        ; coopy bytes
                      (       ddos2f.asm):01186                 
C58E 6DA4             (       ddos2f.asm):01187                 TST     ,Y                      ; done all sectors?
C590 26E1             (       ddos2f.asm):01188                 BNE     LC4F2                   ; nope loop again
                      (       ddos2f.asm):01189         
                      (       ddos2f.asm):01190         ; Write track filler bytes
C592 C603             (       ddos2f.asm):01191                 LDB     #TrackFillerLen         ; no of bytes at end of track
                      (       ddos2f.asm):01192         
C594                  (       ddos2f.asm):01193         DosUtilCopyBXtoU   
C594 7EB7CC           (       ddos2f.asm):01194                 JMP     >UtilCopyBXtoU
                      (       ddos2f.asm):01195         
                      (       ddos2f.asm):01196         ;
                      (       ddos2f.asm):01197         ; GetCommaThen8Bit, scan for comma, error if not found, then fetch 8 bit that follows (or error). 
                      (       ddos2f.asm):01198         ;
                      (       ddos2f.asm):01199         
C597                  (       ddos2f.asm):01200         GetCommaThen8Bit
C597 9DA5             (       ddos2f.asm):01201                 JSR     <BasChrGetCurr          ; Get current basic char
C599 27CA             (       ddos2f.asm):01202                 BEQ     LC4E4                   ; Any left no: return 
C59B BD89AA           (       ddos2f.asm):01203                 JSR     >VarCKComma             ; check for comma
C59E 7EC6C0           (       ddos2f.asm):01204                 JMP     >Get8BitorError         ; go get it
                      (       ddos2f.asm):01205         
                      (       ddos2f.asm):01206         ;
                      (       ddos2f.asm):01207         ; Basic BACKUP command
                      (       ddos2f.asm):01208         ;
                      (       ddos2f.asm):01209         ; BACKUP src_drv TO dest_drv[,s][,t]
                      (       ddos2f.asm):01210         ;       src_drv         = source drive no 1..4
                      (       ddos2f.asm):01211         ;       dest_drv        = destination drive no 1..4
                      (       ddos2f.asm):01212         ;       s               = number of sides 1 or 2
                      (       ddos2f.asm):01213         ;       t               = number of tracks 40 or 80
                      (       ddos2f.asm):01214         ;
                      (       ddos2f.asm):01215         ; Stack frame
                      (       ddos2f.asm):01216         ;       $0015   Ram buffer size in sectors
                      (       ddos2f.asm):01217         ;       $0014   Sectors / tracks
                      (       ddos2f.asm):01218         ;
                      (       ddos2f.asm):01219         ;  Destination Drive ---------------------------        
                      (       ddos2f.asm):01220         ;
                      (       ddos2f.asm):01221         ;       $0012   Ram pointer
                      (       ddos2f.asm):01222         ;       $0010   String pointer
                      (       ddos2f.asm):01223         ;       $0009   Sector
                      (       ddos2f.asm):01224         ;       $0008   Track
                      (       ddos2f.asm):01225         ;       $0007   Drive
                      (       ddos2f.asm):01226         ;
                      (       ddos2f.asm):01227         ;  Source drive --------------------------------
                      (       ddos2f.asm):01228         ;       
                      (       ddos2f.asm):01229         ;       $0005   Ram pointer
                      (       ddos2f.asm):01230         ;       $0003   String pointer
                      (       ddos2f.asm):01231         ;       $0002   Sector
                      (       ddos2f.asm):01232         ;       $0001   Track
                      (       ddos2f.asm):01233         ;       $0000   Drive
                      (       ddos2f.asm):01234         ;  U->
                      (       ddos2f.asm):01235         ;
                      (       ddos2f.asm):01236         ; U is used as a pointer to the beginning of the stack frame. 
                      (       ddos2f.asm):01237         ; Below this is the stack usage for the subroutines within the backup.
                      (       ddos2f.asm):01238         ;
                      (       ddos2f.asm):01239         ;
                      (       ddos2f.asm):01240         
                      (       ddos2f.asm):01241         
C5A1                  (       ddos2f.asm):01242         CmdBackup   
C5A1 3270             (       ddos2f.asm):01243                 LEAS    -BupStackFrame,S        ; Make tempory space on stack
C5A3 1F43             (       ddos2f.asm):01244                 TFR     S,U                     ; Point U at base of tempory space (Like OS-9 !)
C5A5 1F30             (       ddos2f.asm):01245                 TFR     U,D             
C5A7 830040           (       ddos2f.asm):01246                 SUBD    #$0040                  ; reserve room for working stack
C5AA 931F             (       ddos2f.asm):01247                 SUBD    <BasVarEnd              ; Check that we have suficient memory available
C5AC 102BBD92         (       ddos2f.asm):01248                 LBMI    BasOMError              ; NO: report ?OM error
                      (       ddos2f.asm):01249                 
C5B0 8101             (       ddos2f.asm):01250                 CMPA    #$01                    ; At least 1 sector's worth of ram (256 bytes) available
C5B2 102DBD8C         (       ddos2f.asm):01251                 LBLT    BasOMError              ; NO: report ?OM error
C5B6 A74F             (       ddos2f.asm):01252                 STA     BupAvailPages,U         ; Store memory page count of avaiable RAM
C5B8 8612             (       ddos2f.asm):01253                 LDA     #SectorsPerTrack        ; Sectors per track, initially 18 for SS disk
C5BA A74E             (       ddos2f.asm):01254                 STA     BupSecTrk,U
C5BC DC1F             (       ddos2f.asm):01255                 LDD     <BasVarEnd              ; Get end of RAM in use by basic
C5BE ED45             (       ddos2f.asm):01256                 STD     BupSrcBuff,U            ; save in buffer pointers for source and dest
C5C0 ED4C             (       ddos2f.asm):01257                 STD     BupDestBuff,U
                      (       ddos2f.asm):01258         
C5C2 CCDF74           (       ddos2f.asm):01259                 LDD     #MessInsertSource-1     ; Insert source and destination message pointers
C5C5 ED43             (       ddos2f.asm):01260                 STD     BupSrcMess,U
C5C7 CCDF83           (       ddos2f.asm):01261                 LDD     #MessInsertDest-1
C5CA ED4A             (       ddos2f.asm):01262                 STD     BupDestMess,U
                      (       ddos2f.asm):01263                 
C5CC CC0001           (       ddos2f.asm):01264                 LDD     #$0001                  ; Set source and dest track and sector to 0 & 1
C5CF ED41             (       ddos2f.asm):01265                 STD     BupSrcTrk,U
C5D1 ED48             (       ddos2f.asm):01266                 STD     BupDestTrk,U
C5D3 B6060A           (       ddos2f.asm):01267                 LDA     DosDefDriveNo           ; Get default drive no
C5D6 A7C4             (       ddos2f.asm):01268                 STA     ,U                      ; save in source drive
C5D8 A747             (       ddos2f.asm):01269                 STA     BupDestDrive,U          ; and dest
C5DA 108E02D0         (       ddos2f.asm):01270                 LDY     #(SectorsPerTrack*40)   ; sector count 720 sectors=ss40 disk
                      (       ddos2f.asm):01271         
C5DE 9DA5             (       ddos2f.asm):01272                 JSR     <BasChrGetCurr
C5E0 274A             (       ddos2f.asm):01273                 BEQ     DoCmdBackup             ; No params backup from default drive to default 
C5E2 BDC6C0           (       ddos2f.asm):01274                 JSR     >Get8BitorError
C5E5 C104             (       ddos2f.asm):01275                 CMPB    #MaxDriveNo             ; greater than Max drive (4)?
C5E7 1022012F         (       ddos2f.asm):01276                 LBHI    DosDNError
                      (       ddos2f.asm):01277         
C5EB E7C4             (       ddos2f.asm):01278                 STB     ,U                      ; Save source drive
C5ED E747             (       ddos2f.asm):01279                 STB     BupDestDrive,U          ; and default dest to same drive
                      (       ddos2f.asm):01280         
C5EF 9DA5             (       ddos2f.asm):01281                 JSR     <BasChrGetCurr          ; Get current character from basic
C5F1 2739             (       ddos2f.asm):01282                 BEQ     DoCmdBackup             ; end of line : yes do backup
                      (       ddos2f.asm):01283         
C5F3 81BC             (       ddos2f.asm):01284                 CMPA    #DTokTO                 ; is this the "TO" token ?
C5F5 2619             (       ddos2f.asm):01285                 BNE     CmdBackupErrorExit
                      (       ddos2f.asm):01286         
C5F7 9D9F             (       ddos2f.asm):01287                 JSR     <BasChrGet              ; Get next char, skip over "TO"
C5F9 BDC6C0           (       ddos2f.asm):01288                 JSR     >Get8BitorError         ; Get dest drive in B
C5FC C104             (       ddos2f.asm):01289                 CMPB    #MaxDriveNo             ; greater than Max drive (4)?
C5FE 10220118         (       ddos2f.asm):01290                 LBHI    DosDNError
                      (       ddos2f.asm):01291         
C602 E747             (       ddos2f.asm):01292                 STB     BupDestDrive,U          ; Save in Dest driveno
                      (       ddos2f.asm):01293         
C604 8D91             (       ddos2f.asm):01294                 BSR     GetCommaThen8Bit        ; Skip comma, and get next param
C606 2724             (       ddos2f.asm):01295                 BEQ     DoCmdBackup             ; nothing : do backup
                      (       ddos2f.asm):01296         
C608 C102             (       ddos2f.asm):01297                 CMPB    #$02                    ; 2 sided disk specified ?
C60A 2707             (       ddos2f.asm):01298                 BEQ     BackupDS                ; yes backup double sided
C60C C101             (       ddos2f.asm):01299                 CMPB    #$01                    ; 1 sided disk specified ?
C60E 2709             (       ddos2f.asm):01300                 BEQ     BackupSS                ; yes backup single sided
                      (       ddos2f.asm):01301         
                      (       ddos2f.asm):01302         
C610                  (       ddos2f.asm):01303         CmdBackupErrorExit   
C610 7E89B4           (       ddos2f.asm):01304                 JMP     >BasSNError             ; error : exit
                      (       ddos2f.asm):01305         
C613                  (       ddos2f.asm):01306         BackupDS   
C613 1F20             (       ddos2f.asm):01307                 TFR     Y,D                     ; Double sector count if double sided
C615 31AB             (       ddos2f.asm):01308                 LEAY    D,Y
C617 684E             (       ddos2f.asm):01309                 ASL     BupSecTrk,U             ; Set sectors per track for DS disk
                      (       ddos2f.asm):01310         
C619                  (       ddos2f.asm):01311         BackupSS   
C619 BDC597           (       ddos2f.asm):01312                 JSR     >GetCommaThen8Bit       ; Get next param (if any)
C61C 270E             (       ddos2f.asm):01313                 BEQ     DoCmdBackup             ; none: continue
C61E C150             (       ddos2f.asm):01314                 CMPB    #$50                    ; Do 80 tracks ?
C620 2706             (       ddos2f.asm):01315                 BEQ     Backup80
C622 C128             (       ddos2f.asm):01316                 CMPB    #$28                    ; Do 40 tracks ?
C624 2706             (       ddos2f.asm):01317                 BEQ     DoCmdBackup
C626 20E8             (       ddos2f.asm):01318                 BRA     CmdBackupErrorExit      ; neither : error
                      (       ddos2f.asm):01319         
C628                  (       ddos2f.asm):01320         Backup80
C628 1F20             (       ddos2f.asm):01321                 TFR     Y,D                     ; Double sector count if 80 track
C62A 31AB             (       ddos2f.asm):01322                 LEAY    D,Y
                      (       ddos2f.asm):01323         
C62C                  (       ddos2f.asm):01324         DoCmdBackup   
C62C 4F               (       ddos2f.asm):01325                 CLRA
C62D                  (       ddos2f.asm):01326         BupReadFromSrc   
C62D 3121             (       ddos2f.asm):01327                 LEAY    1,Y                     ; Get sector count
C62F 30C4             (       ddos2f.asm):01328                 LEAX    ,U                      ; point to source drive on stack frame
C631 8D6D             (       ddos2f.asm):01329                 BSR     BupCheckPrompt          ; Check if drives are same & prompt if so
                      (       ddos2f.asm):01330                 
C633 313F             (       ddos2f.asm):01331         LC5B2   LEAY    -1,Y                    ; decrement sector count
C635 2606             (       ddos2f.asm):01332                 BNE     LC5BC                   ; if more sectors, do next
C637 8D1D             (       ddos2f.asm):01333                 BSR     BupWriteToDest
C639 32C810           (       ddos2f.asm):01334                 LEAS    BupStackFrame,U         ; Clear stack frame
C63C 39               (       ddos2f.asm):01335         LC5BB   RTS
                      (       ddos2f.asm):01336         
C63D A14F             (       ddos2f.asm):01337         LC5BC   CMPA    BupAvailPages,U         ; Filled all available RAM pages ?      
C63F 260E             (       ddos2f.asm):01338                 BNE     LC5CE                   ; no : do next sector
C641 8D13             (       ddos2f.asm):01339                 BSR     BupWriteToDest          ; Yes : write to destination
C643 3406             (       ddos2f.asm):01340                 PSHS    D
C645 DC1F             (       ddos2f.asm):01341                 LDD     <BasVarEnd              ; Get end of basic storage
C647 ED4C             (       ddos2f.asm):01342                 STD     BupDestBuff,U           ; Save in source and dest buffer pointers
C649 ED45             (       ddos2f.asm):01343                 STD     BupSrcBuff,U
C64B 3506             (       ddos2f.asm):01344                 PULS    D
C64D 20DE             (       ddos2f.asm):01345                 BRA     BupReadFromSrc          ; Do next sector
                      (       ddos2f.asm):01346         
C64F C602             (       ddos2f.asm):01347         LC5CE   LDB     #DosFnReadSec           ; Read the sectors
C651 8D12             (       ddos2f.asm):01348                 BSR     LC5E4                   ; go do it
C653 4C               (       ddos2f.asm):01349                 INCA                            
C654 20DD             (       ddos2f.asm):01350                 BRA     LC5B2
                      (       ddos2f.asm):01351         
C656                  (       ddos2f.asm):01352         BupWriteToDest   
C656 4D               (       ddos2f.asm):01353                 TSTA
C657 27E3             (       ddos2f.asm):01354                 BEQ     LC5BB
C659 3047             (       ddos2f.asm):01355                 LEAX    BupDestDrive,U          ; Point to dest drive vars
C65B 8D43             (       ddos2f.asm):01356                 BSR     BupCheckPrompt          ; Check if drives are same & prompt if so
C65D C603             (       ddos2f.asm):01357                 LDB     #DosFnWriteSecV         ; write sectors to destination
C65F 8D04             (       ddos2f.asm):01358         LC5DE   BSR     LC5E4                   ; go do it
C661 4A               (       ddos2f.asm):01359                 DECA                            ; decrement sector count
C662 26FB             (       ddos2f.asm):01360                 BNE     LC5DE                   ; if more go again
C664 39               (       ddos2f.asm):01361         LC5E3   RTS
                      (       ddos2f.asm):01362         
C665 3406             (       ddos2f.asm):01363         LC5E4   PSHS    D
C667 A684             (       ddos2f.asm):01364                 LDA     ,X                      ; Get source drive
C669 97EB             (       ddos2f.asm):01365                 STA     <DosDriveNo             ; make source drive the current drive
                      (       ddos2f.asm):01366         
C66B EC05             (       ddos2f.asm):01367                 LDD     BupSrcBuff,X            ; point to source buffer
C66D DDEE             (       ddos2f.asm):01368                 STD     <DiskBuffPtr
C66F EC01             (       ddos2f.asm):01369                 LDD     BupSrcTrk,X             ; get source track and sector
C671 DDEC             (       ddos2f.asm):01370                 STD     <DskTrackNo             ; set them
C673 E661             (       ddos2f.asm):01371                 LDB     1,S                     ; get the function code read or write
C675 BDC106           (       ddos2f.asm):01372                 JSR     >DosDoFuncinB           ; Ask dos to do it !
C678 2414             (       ddos2f.asm):01373                 BCC     LC60D                   ; no error, skip on
C67A F70603           (       ddos2f.asm):01374                 STB     DosErrorCode            ; save error code
                      (       ddos2f.asm):01375         
C67D A661             (       ddos2f.asm):01376                 LDA     1,S                     ; Get function, read or write
C67F 8102             (       ddos2f.asm):01377                 CMPA    #DosFnReadSec           ; Read ?
C681 2605             (       ddos2f.asm):01378                 BNE     LC607
C683 3516             (       ddos2f.asm):01379                 PULS    D,X
                      (       ddos2f.asm):01380         
C685 BDC656           (       ddos2f.asm):01381                 JSR     >BupWriteToDest
C688 F60603           (       ddos2f.asm):01382         LC607   LDB     DosErrorCode            ; Retrieve error code
C68B 7EC71F           (       ddos2f.asm):01383                 JMP     >DosHookSysError
                      (       ddos2f.asm):01384         
C68E 6C02             (       ddos2f.asm):01385         LC60D   INC     BupSrcSec,X             ; Move to next source sector
C690 A602             (       ddos2f.asm):01386                 LDA     BupSrcSec,X
C692 A14E             (       ddos2f.asm):01387                 CMPA    BupSecTrk,U             ; still sectors on this track to read ?
C694 2306             (       ddos2f.asm):01388                 BLS     LC61B                   ; yep : keep going
                      (       ddos2f.asm):01389                 
C696 8601             (       ddos2f.asm):01390                 LDA     #$01
C698 A702             (       ddos2f.asm):01391                 STA     BupSrcSec,X             ; set source sec to 1
C69A 6C01             (       ddos2f.asm):01392                 INC     BupSrcTrk,X             ; increment source track
C69C 6C05             (       ddos2f.asm):01393         LC61B   INC     BupSrcBuff,X            ; move to next memorty page
C69E 3586             (       ddos2f.asm):01394                 PULS    D,PC
                      (       ddos2f.asm):01395         
                      (       ddos2f.asm):01396         ;
                      (       ddos2f.asm):01397         ; Check if source and dest drives are the same and if so prompt to swap disks.
                      (       ddos2f.asm):01398         ;
                      (       ddos2f.asm):01399         
C6A0                  (       ddos2f.asm):01400         BupCheckPrompt   
C6A0 E6C4             (       ddos2f.asm):01401                 LDB     ,U                      ; get source drive
C6A2 E147             (       ddos2f.asm):01402                 CMPB    7,U                     ; same as dest drive ?
C6A4 26BE             (       ddos2f.asm):01403                 BNE     LC5E3                   ; no : continue
                      (       ddos2f.asm):01404                 
C6A6 3472             (       ddos2f.asm):01405                 PSHS    A,X,Y,U
C6A8 BDBA77           (       ddos2f.asm):01406                 JSR     >TextCls                ; clear screen
C6AB AE61             (       ddos2f.asm):01407                 LDX     1,S                     ; get message pointer
C6AD AE03             (       ddos2f.asm):01408                 LDX     3,X
C6AF BD90E5           (       ddos2f.asm):01409                 JSR     >TextOutString          ; Print message (insert source/insert dest)
C6B2 8EDF97           (       ddos2f.asm):01410                 LDX     #MessPressAnyKey-1
C6B5 BD90E5           (       ddos2f.asm):01411                 JSR     >TextOutString          ; Print press any key
C6B8 BDB505           (       ddos2f.asm):01412                 JSR     >TextWaitKeyCurs2       ; Wait for a kepress
C6BB BDBA77           (       ddos2f.asm):01413                 JSR     >TextCls
C6BE 35F2             (       ddos2f.asm):01414                 PULS    A,X,Y,U,PC
                      (       ddos2f.asm):01415         
                      (       ddos2f.asm):01416         ;
                      (       ddos2f.asm):01417         ; Get8BitorError, get non zero 8 bit value in B, or generate error
                      (       ddos2f.asm):01418         ;
C6C0                  (       ddos2f.asm):01419         Get8BitorError
C6C0 3460             (       ddos2f.asm):01420                 PSHS    Y,U
C6C2 BD8E51           (       ddos2f.asm):01421                 JSR     >VarGet8Bit             ; Get 8 bit value into B
C6C5 5D               (       ddos2f.asm):01422                 TSTB                            ; B non zero ?
C6C6 2603             (       ddos2f.asm):01423                 BNE     LC64A
C6C8 7E8B8D           (       ddos2f.asm):01424                 JMP     >BasFCError             ; No : error
                      (       ddos2f.asm):01425                 
C6CB 35E0             (       ddos2f.asm):01426         LC64A   PULS    Y,U,PC                  ; Restore and return
                      (       ddos2f.asm):01427                 
C6CD                  (       ddos2f.asm):01428         DosCmdDispatch   
C6CD 81FF             (       ddos2f.asm):01429                 CMPA    #$FF                    ; Invalid token ?
C6CF 1027C2E1         (       ddos2f.asm):01430                 LBEQ    BasSNError
C6D3 80CE             (       ddos2f.asm):01431                 SUBA    #DDTokFirstC            ; Make token number zero based
C6D5 2A03             (       ddos2f.asm):01432                 BPL     LC659                   ; valid token : yep continue
                      (       ddos2f.asm):01433                 
C6D7 7E89B4           (       ddos2f.asm):01434         LC656   JMP     >BasSNError             ; nope SNError
                      (       ddos2f.asm):01435         
C6DA 811A             (       ddos2f.asm):01436         LC659   CMPA    #DDTokCountC            ; check token in range
C6DC 2406             (       ddos2f.asm):01437                 BCC     LC663                   ; Nope, continue to next jump table
C6DE 8EDE70           (       ddos2f.asm):01438                 LDX     #CommandDispatchTable   ; Point to command address table
C6E1 7E84ED           (       ddos2f.asm):01439                 JMP     >BasDoDispatch          ; go do it !
                      (       ddos2f.asm):01440                 
C6E4 6E9F0137         (       ddos2f.asm):01441         LC663   JMP     [>NextResJump]          ; Jump to user reserved word handler >$0137
                      (       ddos2f.asm):01442         
C6E8                  (       ddos2f.asm):01443         DosFuncDispatch   
C6E8 C044             (       ddos2f.asm):01444                 SUBB    #$44
C6EA 2A02             (       ddos2f.asm):01445                 BPL     LC66D                   ; Check token in range, skip if ok
C6EC 20E9             (       ddos2f.asm):01446                 BRA     LC656                   ; else ?SN Error
                      (       ddos2f.asm):01447         
C6EE C10E             (       ddos2f.asm):01448         LC66D   CMPB    #(DDTokCountF*2)        ; check token in range
C6F0 2408             (       ddos2f.asm):01449                 BCC     LC679                   ; nope : skip to next handler
C6F2 8EDEA4           (       ddos2f.asm):01450                 LDX     #FunctionDipatchTable   ; point to function table
C6F5 AD95             (       ddos2f.asm):01451                 JSR     [B,X]                   ; jump to function
C6F7 7E8874           (       ddos2f.asm):01452                 JMP     >VarGetExprCC           ; return value to basic
                      (       ddos2f.asm):01453         
C6FA 6E9F013C         (       ddos2f.asm):01454         LC679   JMP     [>NextFuncsJump]        ; Jump to user function handler >$013C
                      (       ddos2f.asm):01455         
                      (       ddos2f.asm):01456         ; test and flush all buffers
                      (       ddos2f.asm):01457         
C6FE                  (       ddos2f.asm):01458         TestAndFlushAll   
C6FE 8E0634           (       ddos2f.asm):01459                 LDX     #Buff1Details           ; Point to first buffer
C701 BDD337           (       ddos2f.asm):01460         LC680   JSR     >TestAndFlushBuffer     ; Flush if needed
C704 2619             (       ddos2f.asm):01461                 BNE     DosHookSysError         ; error : exit
                      (       ddos2f.asm):01462                 
C706 6F02             (       ddos2f.asm):01463                 CLR     BuffFlag,X              ; mark buffer free
C708 3007             (       ddos2f.asm):01464                 LEAX    BuffDetailSize,X        ; move to next buffer
C70A 8C0650           (       ddos2f.asm):01465                 CMPX    #(Buff1Details+(BuffCount*BuffDetailSize))      
                      (       ddos2f.asm):01466                 
C70D 25F2             (       ddos2f.asm):01467                 BCS     LC680                   ; done all : no loop again
C70F 39               (       ddos2f.asm):01468         LC68E   RTS
                      (       ddos2f.asm):01469         
                      (       ddos2f.asm):01470         ;
                      (       ddos2f.asm):01471         ; Get drive no in B, returns drive no (from command) in B,
                      (       ddos2f.asm):01472         ; or causes error if (drive < 0 ) or (drive > 4)
                      (       ddos2f.asm):01473         ;
                      (       ddos2f.asm):01474         
C710                  (       ddos2f.asm):01475         GetDriveNoInB   
C710 BD8E51           (       ddos2f.asm):01476                 JSR     >VarGet8Bit             ; Get 8 bit var
C713 5D               (       ddos2f.asm):01477                 TSTB
C714 2704             (       ddos2f.asm):01478                 BEQ     DosDNError
C716 C104             (       ddos2f.asm):01479                 CMPB    #$04                    ; Valid < 4 ?
C718 23F5             (       ddos2f.asm):01480                 BLS     LC68E                   ; yes : skip
                      (       ddos2f.asm):01481                  
C71A                  (       ddos2f.asm):01482         DosDNError   
C71A C628             (       ddos2f.asm):01483                 LDB     #BErrDN                 ; Device no error
C71C 8C               (       ddos2f.asm):01484                 FCB     Skip2           
                      (       ddos2f.asm):01485         
C71D                  (       ddos2f.asm):01486         DosPRError
C71D C6A4             (       ddos2f.asm):01487                 LDB     #ErrPR          ; Parameter error
                      (       ddos2f.asm):01488         
C71F                  (       ddos2f.asm):01489         DosHookSysError   
C71F F70619           (       ddos2f.asm):01490                 STB     DosErrLast              ; save last error code
C722 9E68             (       ddos2f.asm):01491                 LDX     <BasCurrentLine         ; Get current line no
C724 BF0617           (       ddos2f.asm):01492                 STX     DosErrLineNo            ; save for ERR routine
C727 BD8434           (       ddos2f.asm):01493                 JSR     >BasResetStack          ; reset basic stack
C72A 0FF6             (       ddos2f.asm):01494                 CLR     <DosIOInProgress        ; Flag no IO in progress
C72C BDBDDC           (       ddos2f.asm):01495                 JSR     >CasMotorOff            ; turn off tape motor
C72F BDBAC3           (       ddos2f.asm):01496                 JSR     >SndDisable             ; disable sound
C732 0F6F             (       ddos2f.asm):01497                 CLR     <TextDevN               ; Set device no back to console
                      (       ddos2f.asm):01498                 
C734 7D0614           (       ddos2f.asm):01499                 TST     DosErrGotoFlag          ; Do we have an error handler ?
C737 2A09             (       ddos2f.asm):01500                 BPL     LC6C1                   ; Yes, handle errors
C739 9E68             (       ddos2f.asm):01501                 LDX     <BasCurrentLine         ; Get current line no
C73B 3001             (       ddos2f.asm):01502                 LEAX    1,X
C73D 2614             (       ddos2f.asm):01503                 BNE     LC6D2
                      (       ddos2f.asm):01504         
C73F BD90A1           (       ddos2f.asm):01505                 JSR     >TextOutCRLF            ; output EOL
                      (       ddos2f.asm):01506         
C742 BD90F8           (       ddos2f.asm):01507         LC6C1   JSR     >TextOutQuestion        ; output '?'
C745 8E82A9           (       ddos2f.asm):01508                 LDX     #BasErrorCodeTable      ; Point to error code table $82A9
C748 F60619           (       ddos2f.asm):01509                 LDB     DosErrLast              ; Get last error code
C74B 2A03             (       ddos2f.asm):01510                 BPL     LC6CF
                      (       ddos2f.asm):01511                 
C74D 8EDF33           (       ddos2f.asm):01512                 LDX     #(DosErrorCodeTable-DDFirstError)       ; Get pointer to error table !
C750 7E835E           (       ddos2f.asm):01513         LC6CF   JMP     >SysErr2                ; Jump to basic Error handler
                      (       ddos2f.asm):01514         
C753 8E84DA           (       ddos2f.asm):01515         LC6D2   LDX     #BasBRARun              ; Go back to main interpreter loop $84DA
C756 3410             (       ddos2f.asm):01516                 PSHS    X                       ; push X as return address
C758 7F0614           (       ddos2f.asm):01517                 CLR     DosErrGotoFlag          ; clear error goto flag
C75B FC0615           (       ddos2f.asm):01518                 LDD     DosErrDestLine          ; get on error goto line
C75E DD2B             (       ddos2f.asm):01519                 STD     <BasTempLine            ; save it in temp line
C760 7E85E7           (       ddos2f.asm):01520                 JMP     >BasSkipLineNo          ; jump to it.
                      (       ddos2f.asm):01521         
                      (       ddos2f.asm):01522         ;
                      (       ddos2f.asm):01523         ; New reset vector
                      (       ddos2f.asm):01524         ;
                      (       ddos2f.asm):01525         
C763                  (       ddos2f.asm):01526         ResetVector
C763 12               (       ddos2f.asm):01527                 NOP                             ; Main ROM checks for reset->NOP
C764 4F               (       ddos2f.asm):01528                 CLRA                            ; Reset DP=0
C765 1F8B             (       ddos2f.asm):01529                 TFR     A,DP            
C767 BDC0B8           (       ddos2f.asm):01530                 JSR     >DosReset               ; Reset WD, and various Dos vars.
C76A 7F0609           (       ddos2f.asm):01531                 CLR     DosErrorMask            ; reset various flags
C76D 7F0605           (       ddos2f.asm):01532                 CLR     DosTimeout
C770 7F0613           (       ddos2f.asm):01533                 CLR     DosAutoFlag
C773 8635             (       ddos2f.asm):01534                 LDA     #$35                    ; Re-enable NMI
C775 B7FF03           (       ddos2f.asm):01535                 STA     PIA0CRB
C778 7EB44F           (       ddos2f.asm):01536                 JMP     >WarmStart              ; Jump back to Main ROM reset routine
                      (       ddos2f.asm):01537         
                      (       ddos2f.asm):01538         ;
                      (       ddos2f.asm):01539         ; NMI vector, called to break out of read & write loops between 6809 & WD
                      (       ddos2f.asm):01540         ; This allows the IO routines to handle sectors of all lengths.
                      (       ddos2f.asm):01541         ;
                      (       ddos2f.asm):01542         
C77B                  (       ddos2f.asm):01543         NMISrv   
C77B 962F             (       ddos2f.asm):01544                 LDA     DPCmdReg                ; Read status register.
C77D 5F               (       ddos2f.asm):01545                 CLRB                            ; Reset DP=0
C77E 1F9B             (       ddos2f.asm):01546                 TFR     B,DP
C780 326C             (       ddos2f.asm):01547                 LEAS    12,S                    ; Drop registers from stack
C782 4D               (       ddos2f.asm):01548                 TSTA                            ; Setup CC
                      (       ddos2f.asm):01549         
C783 39               (       ddos2f.asm):01550         LC6FF   RTS
                      (       ddos2f.asm):01551         
                      (       ddos2f.asm):01552         ;
                      (       ddos2f.asm):01553         ; New IRQ vector, used to count down and shut off drives.
                      (       ddos2f.asm):01554         ;
                      (       ddos2f.asm):01555         ; Note PGS fixes to IRQSrv could be re-arranged to avoid all the jumping around.
                      (       ddos2f.asm):01556         ; but for now applying them unmodified.
C784                  (       ddos2f.asm):01557         IRQSrv  
C784 4F               (       ddos2f.asm):01558                 CLRA                            ; Make sure DP is set to 0
C785 1F8B             (       ddos2f.asm):01559                 TFR     A,DP
C787 0DF6             (       ddos2f.asm):01560                 TST     <DosIOInProgress        ; Doing IO ?
                      (       ddos2f.asm):01561                 
C789                  (       ddos2f.asm):01562         IRQSrv2
C789 261A             (       ddos2f.asm):01563                 BNE     LC71E                   ; Yes: don't time out
C78B B60605           (       ddos2f.asm):01564                 LDA     DosTimeout              ; Get timeout byte 
C78E 2715             (       ddos2f.asm):01565                 BEQ     LC71E                   ; Already timed out : exit
                      (       ddos2f.asm):01566          
C790 4A               (       ddos2f.asm):01567                 DECA                            ; Decrement timeout count
C791 B70605           (       ddos2f.asm):01568                 STA     DosTimeout      
                      (       ddos2f.asm):01569         
C794 260F             (       ddos2f.asm):01570                 BNE     LC71E                   ; not zero, don't timeout yet
C796 8D23             (       ddos2f.asm):01571                 BSR     DOSSyncDir              ; syncronsise directory
C798 260E             (       ddos2f.asm):01572                 BNE     LC721                   ; Error : report it
C79A B60607           (       ddos2f.asm):01573                 LDA     DosHWMaskFF48           ; turn off motor / deselect drives in hw byte
C79D 8400             (       ddos2f.asm):01574                 ANDA    #0                              
C79F B70607           (       ddos2f.asm):01575                 STA     DosHWMaskFF48           ; Just turn off drives on Dragon
C7A2 17149A           (       ddos2f.asm):01576                 LBSR    AlphaDskCtl             ; Actually turn off motor
C7A5                  (       ddos2f.asm):01577         LC71E   
C7A5 7E9D3D           (       ddos2f.asm):01578                 JMP     >BasIRQVec              ; Jump to BASIC IRQ
                      (       ddos2f.asm):01579         
C7A8 7EC71F           (       ddos2f.asm):01580         LC721   JMP     >DosHookSysError
                      (       ddos2f.asm):01581         
                      (       ddos2f.asm):01582         ;
                      (       ddos2f.asm):01583         ; This code seems unused ! but checks for at least a free page of memory
                      (       ddos2f.asm):01584         ; between the top of the basic vars and the bottom of the stack.
                      (       ddos2f.asm):01585         ; 
                      (       ddos2f.asm):01586         
C7AB 1F40             (       ddos2f.asm):01587         Unknown TFR     S,D                     ; Get stack pointer in D
C7AD 830100           (       ddos2f.asm):01588                 SUBD    #$0100                  ; move down a page
C7B0 931F             (       ddos2f.asm):01589                 SUBD    <BasVarEnd              ; Subtract end of bas vars                      
C7B2 2B04             (       ddos2f.asm):01590                 BMI     LC731                   ; -ve so out of memory
C7B4 5F               (       ddos2f.asm):01591                 CLRB                            ; clear LSB of new stack
C7B5 4D               (       ddos2f.asm):01592                 TSTA                            ; At least a page free ?
C7B6 26CB             (       ddos2f.asm):01593                 BNE     LC6FF                   ; yep : return
C7B8 7E8342           (       ddos2f.asm):01594         LC731   JMP     >BasOMError
                      (       ddos2f.asm):01595         
                      (       ddos2f.asm):01596         ;
                      (       ddos2f.asm):01597         ; Copy updated track 20 to track 16
                      (       ddos2f.asm):01598         ;
                      (       ddos2f.asm):01599         ; Backup the directory to the alternate directory.
                      (       ddos2f.asm):01600         ;
                      (       ddos2f.asm):01601         ; No calling arguments.
                      (       ddos2f.asm):01602         ;
                      (       ddos2f.asm):01603         ; Stack frame.
                      (       ddos2f.asm):01604         ;       $0008   Sector number
                      (       ddos2f.asm):01605         ;       $0007   Sector number
                      (       ddos2f.asm):01606         ;       $0006   Sector number
                      (       ddos2f.asm):01607         ;       $0005   Sector number
                      (       ddos2f.asm):01608         ;       $0004   Number of full buffers
                      (       ddos2f.asm):01609         ;       $0003   Current sector number
                      (       ddos2f.asm):01610         ;       $0002   User's drive number
                      (       ddos2f.asm):01611         ;       $0001   Last error
                      (       ddos2f.asm):01612         ;       $0000   bitmask for 'DTYDIR'
                      (       ddos2f.asm):01613         ;
                      (       ddos2f.asm):01614         
C7BB                  (       ddos2f.asm):01615         DOSSyncDir   
C7BB BDC6FE           (       ddos2f.asm):01616                 JSR     >TestAndFlushAll        ; Flush all buffers if needed
C7BE 3278             (       ddos2f.asm):01617                 LEAS    -8,S                    ; Make room on stack
C7C0 33E4             (       ddos2f.asm):01618                 LEAU    ,S                      ; Point U at stack frame
C7C2 3144             (       ddos2f.asm):01619                 LEAY    SyncSectors,U           ; point Y at sync sector table
                      (       ddos2f.asm):01620                 
C7C4 8E0800           (       ddos2f.asm):01621                 LDX     #DosDiskBuffBase        ; Point at tempory buffer area
C7C7 9FEE             (       ddos2f.asm):01622                 STX     <DiskBuffPtr
C7C9 6F42             (       ddos2f.asm):01623                 CLR     SyncBufferNo,U          ; clear buffer no counter
C7CB D6EB             (       ddos2f.asm):01624                 LDB     <DosDriveNo             ; Get last accessed drive
C7CD E741             (       ddos2f.asm):01625                 STB     SyncDrive,U             ; Save it
C7CF C601             (       ddos2f.asm):01626                 LDB     #$01                    ; Drive counter shifted left to count
C7D1 E7C4             (       ddos2f.asm):01627                 STB     ,U
C7D3 0FEB             (       ddos2f.asm):01628                 CLR     <DosDriveNo
C7D5 8E06AA           (       ddos2f.asm):01629                 LDX     #DosDirSecStatus-1      ; $06AA
                      (       ddos2f.asm):01630                 
C7D8 C612             (       ddos2f.asm):01631         LC751   LDB     #SectorsPerTrack        ; Sector count
C7DA E743             (       ddos2f.asm):01632                 STB     SyncSecNo,U
C7DC 0CEB             (       ddos2f.asm):01633                 INC     <DosDriveNo
                      (       ddos2f.asm):01634         
C7DE E643             (       ddos2f.asm):01635         LC757   LDB     SyncSecNo,U             ; get sector no
C7E0 A685             (       ddos2f.asm):01636                 LDA     B,X                     ; get it's status byte
C7E2 A5C4             (       ddos2f.asm):01637                 BITA    ,U                      ; test it
C7E4 271E             (       ddos2f.asm):01638                 BEQ     LC77D
                      (       ddos2f.asm):01639                 
C7E6 43               (       ddos2f.asm):01640                 COMA
C7E7 A485             (       ddos2f.asm):01641                 ANDA    B,X
C7E9 A785             (       ddos2f.asm):01642                 STA     B,X
C7EB 6C42             (       ddos2f.asm):01643                 INC     SyncBufferNo,U          ; move to next buffer
C7ED D7ED             (       ddos2f.asm):01644                 STB     <DskSectorNo
C7EF E7A0             (       ddos2f.asm):01645                 STB     ,Y+
C7F1 C614             (       ddos2f.asm):01646                 LDB     #DirPrimary             ; Track 20
C7F3 D7EC             (       ddos2f.asm):01647                 STB     <DskTrackNo             
C7F5 BDC104           (       ddos2f.asm):01648                 JSR     >DosDoReadSec           ; Go read sector
                      (       ddos2f.asm):01649                 
C7F8 2623             (       ddos2f.asm):01650                 BNE     LC81D                   ; Error !
                      (       ddos2f.asm):01651                 
C7FA 0CEE             (       ddos2f.asm):01652                 INC     <DiskBuffPtr            ; use next disk buffer
C7FC E642             (       ddos2f.asm):01653                 LDB     SyncBufferNo,U          ; Check to see if we have filled all buffers
C7FE C104             (       ddos2f.asm):01654                 CMPB    #$04                    
C800 2502             (       ddos2f.asm):01655                 BCS     LC77D                   ; nope keep going
C802 8D1A             (       ddos2f.asm):01656                 BSR     LC797                   ; flush them
                      (       ddos2f.asm):01657                 
C804 6A43             (       ddos2f.asm):01658         LC77D   DEC     SyncSecNo,U             ; decrement sector no
C806 26D6             (       ddos2f.asm):01659                 BNE     LC757                   ; keep going if more sectors
                      (       ddos2f.asm):01660                 
C808 6D42             (       ddos2f.asm):01661                 TST     SyncBufferNo,U          ; any buffers in use ?, so sectors still waiting to be flushed ?
C80A 2702             (       ddos2f.asm):01662                 BEQ     LC787                   ; no  skip
C80C 8D10             (       ddos2f.asm):01663                 BSR     LC797                   ; yes : flush them
                      (       ddos2f.asm):01664                 
C80E 68C4             (       ddos2f.asm):01665         LC787   ASL     ,U                      ; move to next drive                    
C810 A6C4             (       ddos2f.asm):01666                 LDA     ,U                              
C812 8108             (       ddos2f.asm):01667                 CMPA    #$08                    ; done all drives ?     
C814 23C2             (       ddos2f.asm):01668                 BLS     LC751                   ; nope do next
                      (       ddos2f.asm):01669                         
C816 A641             (       ddos2f.asm):01670                 LDA     SyncDrive,U             ; Restore last used drive
C818 97EB             (       ddos2f.asm):01671                 STA     <DosDriveNo
                      (       ddos2f.asm):01672                 
C81A 3248             (       ddos2f.asm):01673         LC81A   LEAS    8,U                     ; Drop stack frame
C81C 5F               (       ddos2f.asm):01674                 CLRB                            ; Flag no error
C81D 39               (       ddos2f.asm):01675         LC81D   RTS
                      (       ddos2f.asm):01676         
C81E 8610             (       ddos2f.asm):01677         LC797   LDA     #DirBackup              ; Backup track no
C820 97EC             (       ddos2f.asm):01678                 STA     <DskTrackNo
C822 0AEE             (       ddos2f.asm):01679         LC79B   DEC     <DiskBuffPtr            ; Move to previous buffer
C824 313F             (       ddos2f.asm):01680                 LEAY    -1,Y
C826 A6A4             (       ddos2f.asm):01681                 LDA     ,Y
C828 97ED             (       ddos2f.asm):01682                 STA     <DskSectorNo            ; Pickup sector no
C82A BDC101           (       ddos2f.asm):01683                 JSR     >DosDoWriteSecV         ; Go write it
C82D 2703             (       ddos2f.asm):01684                 BEQ     LC7AB
                      (       ddos2f.asm):01685                 
                      (       ddos2f.asm):01686                 ifdef   PGSFix
                      (       ddos2f.asm):01687                 LEAS    8,U
                      (       ddos2f.asm):01688                 else
C82F 3262             (       ddos2f.asm):01689                 LEAS    2,S
                      (       ddos2f.asm):01690                 endc
C831 39               (       ddos2f.asm):01691                 RTS
                      (       ddos2f.asm):01692         
C832 6A42             (       ddos2f.asm):01693         LC7AB   DEC     SyncBufferNo,U          ; move to previous disk buffer
C834 26EC             (       ddos2f.asm):01694                 BNE     LC79B
C836 39               (       ddos2f.asm):01695         LC7AF   RTS
                      (       ddos2f.asm):01696         
                      (       ddos2f.asm):01697         
C837                  (       ddos2f.asm):01698         FIRQSrv
C837 7DFF26           (       ddos2f.asm):01699                 TST     PIA2DB                  ; Clear interrupt conditions 
C83A 7DFF24           (       ddos2f.asm):01700                 TST     PIA2DA
C83D 3B               (       ddos2f.asm):01701                 RTI                             ; and return
                      (       ddos2f.asm):01702         
                      (       ddos2f.asm):01703         ;
                      (       ddos2f.asm):01704         ; Validate and open a file.
                      (       ddos2f.asm):01705         ;
                      (       ddos2f.asm):01706         ; Entry conditions are as for DOSValidFilename (below).
                      (       ddos2f.asm):01707         ; Exit conditions are as for DOSOpenFile if carry clear, else
                      (       ddos2f.asm):01708         ; error code in B if carry set.
                      (       ddos2f.asm):01709         ;
                      (       ddos2f.asm):01710         
C83E                  (       ddos2f.asm):01711         DosValidateAndOpen
C83E 8D05             (       ddos2f.asm):01712                 BSR     DOSValidFilename        ; Validate filename
C840 2673             (       ddos2f.asm):01713                 BNE     LC8B5                   ; Error : exit
C842 7EC906           (       ddos2f.asm):01714                 JMP     >DOSOpenFile            ; Open file if valid
                      (       ddos2f.asm):01715         
                      (       ddos2f.asm):01716         ;
                      (       ddos2f.asm):01717         ; Validate filename and copy to current drive block
                      (       ddos2f.asm):01718         ;
                      (       ddos2f.asm):01719         ;       On entry:
                      (       ddos2f.asm):01720         ;         X points to filename e.g. '3:FILENAME.EXT'
                      (       ddos2f.asm):01721         ;         B length of filename e.g. 0x0e
                      (       ddos2f.asm):01722         ;         Y points to default extension to use if none is given e.g. 'DAT'.
                      (       ddos2f.asm):01723         ;           Use '   ' for no default extension
                      (       ddos2f.asm):01724         ;       
                      (       ddos2f.asm):01725         ;       If no drive given default drive (DosDriveNo) is used.                   
                      (       ddos2f.asm):01726         ;               
                      (       ddos2f.asm):01727         ;       On Return:
                      (       ddos2f.asm):01728         ;         Filename appears at $0650-$065a (DosCurFilename)
                      (       ddos2f.asm):01729         ;         Current drive (DosCurDriveNo) is set
                      (       ddos2f.asm):01730         ;         CC.Z clear on error
                      (       ddos2f.asm):01731         ;         B contains error code
                      (       ddos2f.asm):01732         ;         U $065b always (SuperDosE6)
                      (       ddos2f.asm):01733         ;
                      (       ddos2f.asm):01734         ; Filenames can be of the following formats :
                      (       ddos2f.asm):01735         ;       "d:filename.ext"
                      (       ddos2f.asm):01736         ;       "filename.ext:d"
                      (       ddos2f.asm):01737         ;       "d:filename"
                      (       ddos2f.asm):01738         ;       "filename:d"
                      (       ddos2f.asm):01739         ;       "filename"
                      (       ddos2f.asm):01740         ;       "filename.ext"
                      (       ddos2f.asm):01741         ;
                      (       ddos2f.asm):01742         
C845                  (       ddos2f.asm):01743         DOSValidFilename   
                      (       ddos2f.asm):01744                 ifdef   PGSFix
                      (       ddos2f.asm):01745                 JSR     LDFF3                   ; prevent null / invalid filenames
                      (       ddos2f.asm):01746                 else
C845 B6060A           (       ddos2f.asm):01747                 LDA     DosDefDriveNo
                      (       ddos2f.asm):01748                 endc
                      (       ddos2f.asm):01749                 
C848 B7065B           (       ddos2f.asm):01750         LC7C1   STA     DosCurDriveNo           ; Set current drive number, default if non specified
C84B 7F0660           (       ddos2f.asm):01751                 CLR     DosCurCount
C84E CE0650           (       ddos2f.asm):01752                 LDU     #DosCurDriveInfo        ; Point at current drive info
                      (       ddos2f.asm):01753         
C851 8607             (       ddos2f.asm):01754                 LDA     #$07                    ; Zero out first 8 bytes (filename)     
C853 6FC6             (       ddos2f.asm):01755         LC7CC   CLR     A,U
C855 4A               (       ddos2f.asm):01756                 DECA
C856 2AFB             (       ddos2f.asm):01757                 BPL     LC7CC
                      (       ddos2f.asm):01758                 
C858 A622             (       ddos2f.asm):01759                 LDA     2,Y                     ; Transfer extension into current details
C85A B7065A           (       ddos2f.asm):01760                 STA     DosCurExtension+2       ; $065A
C85D A621             (       ddos2f.asm):01761                 LDA     1,Y
C85F B70659           (       ddos2f.asm):01762                 STA     DosCurExtension+1       ; $0659
C862 A6A4             (       ddos2f.asm):01763                 LDA     ,Y
C864 B70658           (       ddos2f.asm):01764                 STA     DosCurExtension         ; $0658
                      (       ddos2f.asm):01765         
C867 C10E             (       ddos2f.asm):01766                 CMPB    #MaxFilenameLen         ; Filename too long ?
C869 2248             (       ddos2f.asm):01767                 BHI     LC829                   ; Yep : error
                      (       ddos2f.asm):01768                 
C86B 5D               (       ddos2f.asm):01769                 TSTB                            ; null filename length?
C86C 2745             (       ddos2f.asm):01770                 BEQ     LC829                   ; Yep : error
                      (       ddos2f.asm):01771                 
C86E C103             (       ddos2f.asm):01772                 CMPB    #$03                    ; Long enough to contain drive no ?
C870 2529             (       ddos2f.asm):01773                 BCS     LC811                   ; nope : skip on
                      (       ddos2f.asm):01774                 
                      (       ddos2f.asm):01775         ; Because of the order of compare a drive letter at the END of the filename always
                      (       ddos2f.asm):01776         ; takes presedence, this would only be siginificant if the filename where something like
                      (       ddos2f.asm):01777         ; '1:2' which would access a file called '1' on drive 2, and NOT 2 on drive 1
                      (       ddos2f.asm):01778                 
C872 C002             (       ddos2f.asm):01779                 SUBB    #$02                    ; Look for drive no at end of filename
C874 A685             (       ddos2f.asm):01780                 LDA     B,X
C876 813A             (       ddos2f.asm):01781                 CMPA    #':'                    ; Seperator present ? $3A
C878 2606             (       ddos2f.asm):01782                 BNE     LC7F6                   ; No skip on
C87A 5C               (       ddos2f.asm):01783                 INCB
C87B A685             (       ddos2f.asm):01784                 LDA     B,X                     ; Get drive no
C87D 5C               (       ddos2f.asm):01785                 INCB
C87E 200A             (       ddos2f.asm):01786                 BRA     LC800
                      (       ddos2f.asm):01787         
C880 CB02             (       ddos2f.asm):01788         LC7F6   ADDB    #$02                    ; Check for drive at begining of path
C882 A601             (       ddos2f.asm):01789                 LDA     1,X
C884 813A             (       ddos2f.asm):01790                 CMPA    #':'                    ; Seperator present ? $3A
C886 2613             (       ddos2f.asm):01791                 BNE     LC811                   ; nope, use default drive
                      (       ddos2f.asm):01792                 
C888 A681             (       ddos2f.asm):01793                 LDA     ,X++                    ; Get ascii drive no
C88A 8030             (       ddos2f.asm):01794         LC800   SUBA    #$30                    ; Work out drive number
                      (       ddos2f.asm):01795                 
                      (       ddos2f.asm):01796                 ifdef   PGSFix
                      (       ddos2f.asm):01797                 BLS     LC808
                      (       ddos2f.asm):01798                 CMPA    #MaxDriveNo             ; Drive valid ?
                      (       ddos2f.asm):01799                 BLS     LC810
C88C                  (       ddos2f.asm):01800         LC808   LDB     #$28
                      (       ddos2f.asm):01801                 RTS
                      (       ddos2f.asm):01802                 NOP                             ; nop for resync of assembled file
                      (       ddos2f.asm):01803                 else
C88C 1023FE8A         (       ddos2f.asm):01804                 LBLS    DosDNError              ; error if -ve
                      (       ddos2f.asm):01805                 
C890 8104             (       ddos2f.asm):01806                 CMPA    #MaxDriveNo             ; Drive valid ?
C892 1022FE84         (       ddos2f.asm):01807                 LBHI    DosDNError              ; error if too big
                      (       ddos2f.asm):01808                 endc
                      (       ddos2f.asm):01809                 
C896 B7065B           (       ddos2f.asm):01810                 STA     DosCurDriveNo           ; Set current drive if specified
C899 C002             (       ddos2f.asm):01811                 SUBB    #$02
                      (       ddos2f.asm):01812         
                      (       ddos2f.asm):01813         ; Parse filename looking for extension seperator
                      (       ddos2f.asm):01814                 
C89B A680             (       ddos2f.asm):01815         LC811   LDA     ,X+                     ; Get next char
C89D 5A               (       ddos2f.asm):01816         LC810   DECB                            ; Decrement path count
C89E 2B64             (       ddos2f.asm):01817                 BMI     LC87A                   ; Reached end : yes skip
                      (       ddos2f.asm):01818                 
C8A0 812F             (       ddos2f.asm):01819                 CMPA    #'/'                    ; Check for slash $2F
C8A2 2704             (       ddos2f.asm):01820                 BEQ     LC81E
                      (       ddos2f.asm):01821         
C8A4 812E             (       ddos2f.asm):01822                 CMPA    #'.'                    ; Check for period $2E
C8A6 261C             (       ddos2f.asm):01823                 BNE     LC83A
                      (       ddos2f.asm):01824         
C8A8 11830650         (       ddos2f.asm):01825         LC81E   CMPU    #DosCurDriveInfo        ; $0650
C8AC 2705             (       ddos2f.asm):01826                 BEQ     LC829
                      (       ddos2f.asm):01827                 
C8AE 7D0660           (       ddos2f.asm):01828                 TST     DosCurCount             ; First pass ?
C8B1 2703             (       ddos2f.asm):01829                 BEQ     LC82C                   ; yes : skip on
                      (       ddos2f.asm):01830         
C8B3 C696             (       ddos2f.asm):01831         LC829   LDB     #ErrFS          ; Error : bad filespec 
C8B5 39               (       ddos2f.asm):01832         LC8B5   RTS
                      (       ddos2f.asm):01833         
C8B6 7C0660           (       ddos2f.asm):01834         LC82C   INC     DosCurCount             ; Mark second pass
C8B9 CE0658           (       ddos2f.asm):01835                 LDU     #DosCurExtension        ; $0658
C8BC 6FC4             (       ddos2f.asm):01836                 CLR     ,U                      ; Zero out extension
C8BE 6F41             (       ddos2f.asm):01837                 CLR     1,U
C8C0 6F42             (       ddos2f.asm):01838                 CLR     2,U
C8C2 20D7             (       ddos2f.asm):01839                 BRA     LC811
                      (       ddos2f.asm):01840         
                      (       ddos2f.asm):01841         ; Validate filename chars
                      (       ddos2f.asm):01842         
C8C4 8141             (       ddos2f.asm):01843         LC83A   CMPA    #'A'                    ; $41
C8C6 2510             (       ddos2f.asm):01844                 BCS     LC84E                   ; Below, check if still valid
                      (       ddos2f.asm):01845                 
C8C8 815A             (       ddos2f.asm):01846                 CMPA    #'Z'                    ; $5A
C8CA 2318             (       ddos2f.asm):01847                 BLS     LC85A                   ; valid, skip on
                      (       ddos2f.asm):01848                 
C8CC 8020             (       ddos2f.asm):01849                 SUBA    #$20                    ; Convert to lower case if upper
C8CE 8141             (       ddos2f.asm):01850                 CMPA    #'A'                    ; $41
C8D0 25E1             (       ddos2f.asm):01851                 BCS     LC829                   ; Invalid, return error
                      (       ddos2f.asm):01852                 
C8D2 815A             (       ddos2f.asm):01853                 CMPA    #'Z'                    ; $5A
C8D4 230E             (       ddos2f.asm):01854                 BLS     LC85A                   ; Valid: skip on
C8D6 20DB             (       ddos2f.asm):01855                 BRA     LC829
                      (       ddos2f.asm):01856         
C8D8 812D             (       ddos2f.asm):01857         LC84E   CMPA    #'-'                    ; $2D
C8DA 2708             (       ddos2f.asm):01858                 BEQ     LC85A                   ; Valid skip on
                      (       ddos2f.asm):01859                 
C8DC 8130             (       ddos2f.asm):01860                 CMPA    #'0'                    ; $30
C8DE 25D3             (       ddos2f.asm):01861                 BCS     LC829                   ; Invalid : error
                      (       ddos2f.asm):01862                 
C8E0 8139             (       ddos2f.asm):01863                 CMPA    #'9'                    ; $39
C8E2 22CF             (       ddos2f.asm):01864                 BHI     LC829                   ; Invalid : error
                      (       ddos2f.asm):01865                 
C8E4 A7C0             (       ddos2f.asm):01866         LC85A   STA     ,U+                     ; Save char in path
C8E6 1183065B         (       ddos2f.asm):01867                 CMPU    #DosCurDriveNo          ; Path full ?
C8EA 2605             (       ddos2f.asm):01868                 BNE     LC867                   ; nope : skip
                      (       ddos2f.asm):01869                 
C8EC 5D               (       ddos2f.asm):01870                 TSTB                            ; Done all path chars ?
C8ED 26C4             (       ddos2f.asm):01871                 BNE     LC829                   ; nope : error !
C8EF 2013             (       ddos2f.asm):01872                 BRA     LC87A
                      (       ddos2f.asm):01873         
C8F1 11830658         (       ddos2f.asm):01874         LC867   CMPU    #DosCurExtension        ; Reached extension ? $0658
C8F5 26A4             (       ddos2f.asm):01875                 BNE     LC811
                      (       ddos2f.asm):01876                 
C8F7 A680             (       ddos2f.asm):01877                 LDA     ,X+                     ; Get next 
C8F9 5A               (       ddos2f.asm):01878                 DECB                            ; Dec count
C8FA 2B08             (       ddos2f.asm):01879                 BMI     LC87A                   ; Done, return
                      (       ddos2f.asm):01880                 
C8FC 812E             (       ddos2f.asm):01881                 CMPA    #'.'                    ; Check for seperator $2E
C8FE 27A8             (       ddos2f.asm):01882                 BEQ     LC81E                   ; yep loop back
                      (       ddos2f.asm):01883                 
C900 812F             (       ddos2f.asm):01884                 CMPA    #'/'                    ; Check for seperator $2F
C902 27A4             (       ddos2f.asm):01885                 BEQ     LC81E                   ; Yep loop back
                      (       ddos2f.asm):01886                 
C904 5F               (       ddos2f.asm):01887         LC87A   CLRB
C905 39               (       ddos2f.asm):01888                 RTS
                      (       ddos2f.asm):01889         
                      (       ddos2f.asm):01890         ;
                      (       ddos2f.asm):01891         ; Open a file and copy dir entry into FCB.
                      (       ddos2f.asm):01892         ;
                      (       ddos2f.asm):01893         ; The name in DosCurFilename is searched for in the FIBs, if found then
                      (       ddos2f.asm):01894         ; the FIB number is returned in A. If not found a FIB is created and the
                      (       ddos2f.asm):01895         ; disk is searched for the filaname. If not file is found ErrNE is returned
                      (       ddos2f.asm):01896         ; in B.
                      (       ddos2f.asm):01897         ;
                      (       ddos2f.asm):01898         ;  On entry:
                      (       ddos2f.asm):01899         ;           Filename at DosCurFilename
                      (       ddos2f.asm):01900         ;           Drive no at DosCurDriveNo   
                      (       ddos2f.asm):01901         ;         Returns:
                      (       ddos2f.asm):01902         ;           CC.Z clear on error
                      (       ddos2f.asm):01903         ;           A FIB number (0-9)
                      (       ddos2f.asm):01904         ;           B contains error code
                      (       ddos2f.asm):01905         ;
C906                  (       ddos2f.asm):01906         DOSOpenFile   
C906 8E06BD           (       ddos2f.asm):01907                 LDX     #DosFCB0Addr            ; Point to first FCB
C909 0FF1             (       ddos2f.asm):01908                 CLR     <DosCurrCtrlBlk
C90B FC0650           (       ddos2f.asm):01909                 LDD     DosCurDriveInfo         ; Get first 2 bytes of current drive info
C90E 10A384           (       ddos2f.asm):01910         LC884   CMPD    ,X                      ; Does this FCB point to it ?
C911 2616             (       ddos2f.asm):01911                 BNE     LC89F                   ; Nope : check next
                      (       ddos2f.asm):01912                 
                      (       ddos2f.asm):01913         ; Found matching first 2 bytes of name in an FCB
                      (       ddos2f.asm):01914                 
C913 CE0652           (       ddos2f.asm):01915                 LDU     #DosCurDriveInfo+2      ; Check bytes 2..end of filename
C916 3102             (       ddos2f.asm):01916                 LEAY    2,X                     ; Compare from byte 2 of FCB
C918 C60A             (       ddos2f.asm):01917                 LDB     #$0A                    ; Do 10 bytes, rest of filename + ext
C91A A6C0             (       ddos2f.asm):01918         LC890   LDA     ,U+                     ; Get a byte from current
C91C A1A0             (       ddos2f.asm):01919                 CMPA    ,Y+                     ; compare to FCB
C91E 2606             (       ddos2f.asm):01920                 BNE     LC89C                   ; Don't match : exit check
C920 5A               (       ddos2f.asm):01921                 DECB                            ; Decrement counter
C921 26F7             (       ddos2f.asm):01922                 BNE     LC890                   ; Not at end : do next
C923 1600AB           (       ddos2f.asm):01923                 LBRA    LC947
                      (       ddos2f.asm):01924         
                      (       ddos2f.asm):01925         
                      (       ddos2f.asm):01926         ; Move to check next FCB
                      (       ddos2f.asm):01927         
C926 FC0650           (       ddos2f.asm):01928         LC89C   LDD     DosCurDriveInfo         ; Re-get first 2 chars of current filaname
C929 30881F           (       ddos2f.asm):01929         LC89F   LEAX    DosFCBLength,X          ; Skip to next FCB
C92C 0CF1             (       ddos2f.asm):01930                 INC     <DosCurrCtrlBlk         ; Set current control block
C92E 8C07F3           (       ddos2f.asm):01931                 CMPX    #DosFCBEnd              ; End of blocks ?
C931 25DB             (       ddos2f.asm):01932                 BCS     LC884                   ; No, loop back and check this block
                      (       ddos2f.asm):01933                 
C933 0FF1             (       ddos2f.asm):01934                 CLR     <DosCurrCtrlBlk         ; Set current block to zero
C935 8E06BD           (       ddos2f.asm):01935                 LDX     #DosFCB0Addr            ; Point at first FCB
                      (       ddos2f.asm):01936         
C938 6D84             (       ddos2f.asm):01937         LC8AE   TST     ,X                      ; FCB in use ?
C93A 270D             (       ddos2f.asm):01938                 BEQ     LC8BF                   ; No : skip on
                      (       ddos2f.asm):01939                 
C93C 30881F           (       ddos2f.asm):01940                 LEAX    DosFCBLength,X          ; Check next FCB
C93F 0CF1             (       ddos2f.asm):01941                 INC     <DosCurrCtrlBlk         
C941 8C07F3           (       ddos2f.asm):01942                 CMPX    #DosFCBEnd              ; Done all FCBs
C944 25F2             (       ddos2f.asm):01943                 BCS     LC8AE                   ; No : check next, yes error, can't open file, no free FCBS
C946 C6A2             (       ddos2f.asm):01944                 LDB     #ErrTF          ; error : too many files open
C948 39               (       ddos2f.asm):01945         LC8BE   RTS
                      (       ddos2f.asm):01946         
C949 C60C             (       ddos2f.asm):01947         LC8BF   LDB     #$0C                    ; Copy 12 characters of filename
C94B 1F12             (       ddos2f.asm):01948                 TFR     X,Y                     ; Point Y at selected FCB
C94D CE0650           (       ddos2f.asm):01949                 LDU     #DosCurDriveInfo        ; Point at current info
C950 A6C0             (       ddos2f.asm):01950         LC8C6   LDA     ,U+                     ; Copy filename
C952 A7A0             (       ddos2f.asm):01951                 STA     ,Y+
C954 5A               (       ddos2f.asm):01952                 DECB                            ; Dec count
C955 26F9             (       ddos2f.asm):01953                 BNE     LC8C6                   ; if not all done : do next
                      (       ddos2f.asm):01954                 
C957 97EB             (       ddos2f.asm):01955                 STA     <DosDriveNo             ; Save current drive
                      (       ddos2f.asm):01956         
                      (       ddos2f.asm):01957         ; Note in disassembled superdos source, the following was LDU #$0616, which is part of the error line !
                      (       ddos2f.asm):01958         ; This makes no sense, and is Drv0Details, in DragonDos source, I think I just fixed a 20 year old
                      (       ddos2f.asm):01959         ; bug !!!!!!
                      (       ddos2f.asm):01960         
C959 CE061C           (       ddos2f.asm):01961                 LDU     #Drv0Details            ; Get drive details      
C95C C606             (       ddos2f.asm):01962                 LDB     #DrvDeatailLen          ; 6 bytes/drive
C95E 3D               (       ddos2f.asm):01963                 MUL
C95F 33CB             (       ddos2f.asm):01964                 LEAU    D,U                     ; Point at drive detail block
C961 6C45             (       ddos2f.asm):01965                 INC     DrvDetUseCnt,U          ; Increment usage/open file count       
                      (       ddos2f.asm):01966                 
C963 C613             (       ddos2f.asm):01967                 LDB     #$13                    ; Clear rest of FCB
C965 6FA0             (       ddos2f.asm):01968         LC8DB   CLR     ,Y+
C967 5A               (       ddos2f.asm):01969                 DECB                            ; Dec counter
C968 26FB             (       ddos2f.asm):01970                 BNE     LC8DB                   ; Loop if more
                      (       ddos2f.asm):01971                 
C96A 8680             (       ddos2f.asm):01972                 LDA     #AttrDeleted            ; Flag file as deleted by default
C96C A70F             (       ddos2f.asm):01973                 STA     FCBDirFlags,X
                      (       ddos2f.asm):01974                 
C96E 7F0681           (       ddos2f.asm):01975                 CLR     DosTempFileNo           ; start temp fileno at 0
C971 BDD200           (       ddos2f.asm):01976                 JSR     >DosGetDiskGeometry     ; get disk geometry
C974 26D2             (       ddos2f.asm):01977                 BNE     LC8BE                   ; error : exit
                      (       ddos2f.asm):01978                 
C976 10AE84           (       ddos2f.asm):01979                 LDY     ,X                      ; get LSN number from buffer                    
C979 3122             (       ddos2f.asm):01980                 LEAY    2,Y                     ; add 2
C97B 8610             (       ddos2f.asm):01981                 LDA     #DIRSecCount            ; set number of sectors to scan
C97D B70660           (       ddos2f.asm):01982                 STA     DosCurCount
                      (       ddos2f.asm):01983         
C980 10BF065C         (       ddos2f.asm):01984         LC8F6   STY     DosLSNCounter           ; save LSN
C984 BDD2CA           (       ddos2f.asm):01985                 JSR     >DOSFindAndRead         ; go read it
C987 26BF             (       ddos2f.asm):01986                 BNE     LC8BE                   ; error
                      (       ddos2f.asm):01987                 
C989 AE05             (       ddos2f.asm):01988                 LDX     BuffAddr,X              ; get address of data buffer
C98B 338900FA         (       ddos2f.asm):01989                 LEAU    DirLastByte,X           ; point U at first byte after last entry
C98F FF065E           (       ddos2f.asm):01990                 STU     DosSaveBuffAddr         ; save buff addr
                      (       ddos2f.asm):01991         
C992 A684             (       ddos2f.asm):01992         LC908   LDA     ,X                      ; get first data byte (attribute)
C994 8581             (       ddos2f.asm):01993                 BITA    #(AttrDeleted+AttrIsCont) ; is this a deleted or continuation entry ?   
C996 261A             (       ddos2f.asm):01994                 BNE     LC928
                      (       ddos2f.asm):01995         
C998 FC0650           (       ddos2f.asm):01996                 LDD     DosCurFilename          ; get first 2 characters of filename
C99B 10A301           (       ddos2f.asm):01997                 CMPD    DirEntFilename,X        ; compare to directory entry
C99E 2612             (       ddos2f.asm):01998                 BNE     LC928                   ; not the same, skip to next
                      (       ddos2f.asm):01999         
C9A0 CE0652           (       ddos2f.asm):02000                 LDU     #DosCurFilename+2       ; check the rest of the name
C9A3 3103             (       ddos2f.asm):02001                 LEAY    DirEntFilename+2,X      ; point to name[2] in entry             
C9A5 C609             (       ddos2f.asm):02002                 LDB     #$09                    ; check 9 characters, 6 left from name + 3 from extension
C9A7 A6C0             (       ddos2f.asm):02003         LC91D   LDA     ,U+                     ; get character from name
C9A9 A1A0             (       ddos2f.asm):02004                 CMPA    ,Y+                     ; compare to dir entry
C9AB 2605             (       ddos2f.asm):02005                 BNE     LC928                   ; not equal : give up
                      (       ddos2f.asm):02006                 
C9AD 5A               (       ddos2f.asm):02007                 DECB                            ; decrement character count
C9AE 26F7             (       ddos2f.asm):02008                 BNE     LC91D                   ; keep going if more to compare
                      (       ddos2f.asm):02009                 
C9B0 202C             (       ddos2f.asm):02010                 BRA     LC954                   ; if we get here then we have a match
                      (       ddos2f.asm):02011         
C9B2 A684             (       ddos2f.asm):02012         LC928   LDA     ,X                      ; get first data byte (attribute)
C9B4 8508             (       ddos2f.asm):02013                 BITA    #AttrEndOfDir           ; end of directory ?
C9B6 2616             (       ddos2f.asm):02014                 BNE     LC944                   ; yep 
                      (       ddos2f.asm):02015                 
C9B8 7C0681           (       ddos2f.asm):02016                 INC     DosTempFileNo           ; Move to next fileno
C9BB 308819           (       ddos2f.asm):02017                 LEAX    DirEntryLen,X           ; move to next dir entry in sector
C9BE BC065E           (       ddos2f.asm):02018                 CMPX    DosSaveBuffAddr         ; beyond last entry ?
C9C1 25CF             (       ddos2f.asm):02019                 BCS     LC908                   ; nope process next entry
                      (       ddos2f.asm):02020                 
C9C3 10BE065C         (       ddos2f.asm):02021                 LDY     DosLSNCounter           ; get current DIR LSN
C9C7 3121             (       ddos2f.asm):02022                 LEAY    1,Y                     ; increment it
C9C9 7A0660           (       ddos2f.asm):02023                 DEC     DosCurCount             ; decrement directory sector count
C9CC 26B2             (       ddos2f.asm):02024                 BNE     LC8F6                   ; if any left loop again
                      (       ddos2f.asm):02025                 
C9CE BDCF30           (       ddos2f.asm):02026         LC944   JSR     >DosFCBNoToAddr         ; get FCB address
C9D1 5F               (       ddos2f.asm):02027         LC947   CLRB
C9D2 6D0F             (       ddos2f.asm):02028                 TST     FCBDirFlags,X           ; check flags
C9D4 2A02             (       ddos2f.asm):02029                 BPL     LC94E                   ; not a deleted file
                      (       ddos2f.asm):02030                 
C9D6 C6A0             (       ddos2f.asm):02031                 LDB     #ErrNE          ; flag file does not exist
C9D8 300C             (       ddos2f.asm):02032         LC94E   LEAX    FCBFilePointer,X        ; point to file pointer !!!
C9DA 96F1             (       ddos2f.asm):02033                 LDA     <DosCurrCtrlBlk
C9DC 5D               (       ddos2f.asm):02034                 TSTB                            ; set CC.Z on error
C9DD 39               (       ddos2f.asm):02035                 RTS
                      (       ddos2f.asm):02036         
C9DE 3410             (       ddos2f.asm):02037         LC954   PSHS    X                       ; save dir entry pointer
C9E0 BDCF30           (       ddos2f.asm):02038                 JSR     >DosFCBNoToAddr         ; get FCB address
C9E3 3520             (       ddos2f.asm):02039                 PULS    Y                       ; recover dir entry pointer
C9E5 B60681           (       ddos2f.asm):02040                 LDA     DosTempFileNo           ; get file no
                      (       ddos2f.asm):02041                 
                      (       ddos2f.asm):02042         ; Fill in FCB
                      (       ddos2f.asm):02043         
C9E8 A7881D           (       ddos2f.asm):02044                 STA     FCBDiskFileNo,X         ; fill in fileno
C9EB A6A4             (       ddos2f.asm):02045                 LDA     ,Y
C9ED A70F             (       ddos2f.asm):02046                 STA     FCBDirFlags,X           ; attribute
                      (       ddos2f.asm):02047                 
C9EF EC2C             (       ddos2f.asm):02048                 LDD     DirEntFnBlock1,Y
C9F1 ED8815           (       ddos2f.asm):02049                 STD     FCBLSNExtent1,X         ; LSN of extent 1
                      (       ddos2f.asm):02050                 
C9F4 A62E             (       ddos2f.asm):02051                 LDA     DirEntFnBlock1+2,Y
C9F6 A78817           (       ddos2f.asm):02052                 STA     FCBSecExtent1,X         ; sector count of extent 1
C9F9 A78819           (       ddos2f.asm):02053                 STA     FCBFSNExtent2+1,X
                      (       ddos2f.asm):02054                 
C9FC 6F8818           (       ddos2f.asm):02055                 CLR     FCBFSNExtent2,X
C9FF 6F8813           (       ddos2f.asm):02056                 CLR     FCBFSNExtent1,X         ; Clear FSN 
CA02 6F8814           (       ddos2f.asm):02057                 CLR     FCBFSNExtent1+1,X
                      (       ddos2f.asm):02058                 
CA05 EC2F             (       ddos2f.asm):02059                 LDD     DirEntFnBlock2,Y        ; LSN of extent 2
CA07 ED881A           (       ddos2f.asm):02060                 STD     FCBLSNExtent2,X
                      (       ddos2f.asm):02061                 
CA0A A6A811           (       ddos2f.asm):02062                 LDA     DirEntFnBlock2+2,Y      ; sector count of extent 2
CA0D A7881C           (       ddos2f.asm):02063                 STA     FCBSecExtent2,X
                      (       ddos2f.asm):02064                 
CA10 CCFFFF           (       ddos2f.asm):02065                 LDD     #$FFFF                  ; set file len to -1
CA13 ED8810           (       ddos2f.asm):02066                 STD     FCBFileLen,X            
CA16 A78812           (       ddos2f.asm):02067                 STA     FCBFileLen+2,X
CA19 20B6             (       ddos2f.asm):02068                 BRA     LC947
                      (       ddos2f.asm):02069         
                      (       ddos2f.asm):02070         ;
                      (       ddos2f.asm):02071         ; Read from a file.
                      (       ddos2f.asm):02072         ;
                      (       ddos2f.asm):02073         ; Entry :
                      (       ddos2f.asm):02074         ;       A = FCB no
                      (       ddos2f.asm):02075         ;       X = pointer to buffer to receive data
                      (       ddos2f.asm):02076         ;       Y = no of bytes to read
                      (       ddos2f.asm):02077         ;       U = MSW of file offset (FSN sector no).
                      (       ddos2f.asm):02078         ;       B = LSB of file offset (byte within sector).
                      (       ddos2f.asm):02079         ;               U:B is effectivly the filepointer.
                      (       ddos2f.asm):02080         ; Exit:
                      (       ddos2f.asm):02081         ;       B = Error code
                      (       ddos2f.asm):02082         ;       X = no of bytes *NOT* read if error = EOF
                      (       ddos2f.asm):02083         ;
                      (       ddos2f.asm):02084         ; Secondary entry points :
                      (       ddos2f.asm):02085         ;       RWrite  called by DOSFWrite
                      (       ddos2f.asm):02086         ;       Verify  called by DOSFWrite
                      (       ddos2f.asm):02087         ;
                      (       ddos2f.asm):02088         
CA1B                  (       ddos2f.asm):02089         DOSFRead   
CA1B 0FF5             (       ddos2f.asm):02090                 CLR     <DosRWFlag              ; Flag this is a read
CA1D 97F1             (       ddos2f.asm):02091                 STA     <DosCurrCtrlBlk         ; set control block
CA1F 2007             (       ddos2f.asm):02092                 BRA     LC99E                   ; skip ahead
                      (       ddos2f.asm):02093         
CA21                  (       ddos2f.asm):02094         RWrite   
CA21 8601             (       ddos2f.asm):02095                 LDA     #FileOpWrite            ; Flag this is a write
CA23 8C               (       ddos2f.asm):02096                 FCB     CSkip2
                      (       ddos2f.asm):02097         
CA24                  (       ddos2f.asm):02098         Verify   
CA24 86FF             (       ddos2f.asm):02099                 LDA     #FileOpVerify           ; Flag this is a verify
CA26 97F5             (       ddos2f.asm):02100                 STA     <DosRWFlag
                      (       ddos2f.asm):02101                 
CA28 10BF0661         (       ddos2f.asm):02102         LC99E   STY     DosBytesRead            ; save byte count
CA2C 102700DE         (       ddos2f.asm):02103                 LBEQ    DosFReadExit            ; no bytes : exit
                      (       ddos2f.asm):02104                 
CA30 FF0669           (       ddos2f.asm):02105                 STU     DosCurrSector           ; save file pointer
CA33 F70663           (       ddos2f.asm):02106                 STB     DosSecOffset
CA36 3410             (       ddos2f.asm):02107                 PSHS    X                       ; save buffer pointer
                      (       ddos2f.asm):02108                 
CA38 BDCF30           (       ddos2f.asm):02109                 JSR     >DosFCBNoToAddr         ; convert FCB no to address in X
                      (       ddos2f.asm):02110                 
CA3B A60B             (       ddos2f.asm):02111                 LDA     FCBDrive,X              ; get drive number
CA3D 97EB             (       ddos2f.asm):02112                 STA     <DosDriveNo
                      (       ddos2f.asm):02113                 
CA3F 0DF5             (       ddos2f.asm):02114                 TST     <DosRWFlag              ; Is this a read or write ?
CA41 260B             (       ddos2f.asm):02115                 BNE     LC9C4                   ; if write skip on
                      (       ddos2f.asm):02116                 
CA43 FC0661           (       ddos2f.asm):02117                 LDD     DosBytesRead            ; get bytes read so far
CA46 E30D             (       ddos2f.asm):02118                 ADDD    FCBFilePointer+1,X      ; add LSW of fileptr
CA48 2402             (       ddos2f.asm):02119                 BCC     LC9C2                   ; any carry ?
                      (       ddos2f.asm):02120                 
CA4A 6C0C             (       ddos2f.asm):02121                 INC     FCBFilePointer,X        ; carry to MSB
CA4C ED0D             (       ddos2f.asm):02122         LC9C2   STD     FCBFilePointer+1,X      ; update fileptr
                      (       ddos2f.asm):02123         
CA4E 3510             (       ddos2f.asm):02124         LC9C4   PULS    X                       ; recover data buffer ptr       
                      (       ddos2f.asm):02125         
CA50 F60663           (       ddos2f.asm):02126                 LDB     DosSecOffset            ; get offset into last sector
CA53 4F               (       ddos2f.asm):02127         LC9C9   CLRA            
CA54 50               (       ddos2f.asm):02128                 NEGB                            ; distance to end of sector             
CA55 2601             (       ddos2f.asm):02129                 BNE     LC9CE                   ; not zero, skip
                      (       ddos2f.asm):02130                 
CA57 4C               (       ddos2f.asm):02131                 INCA                            ; increment MSB
CA58 10B30661         (       ddos2f.asm):02132         LC9CE   CMPD    DosBytesRead            ; read all bytes yet ?
CA5C 2303             (       ddos2f.asm):02133                 BLS     LC9D7                   ; nope 
                      (       ddos2f.asm):02134                 
CA5E FC0661           (       ddos2f.asm):02135                 LDD     DosBytesRead            ; get bytes read
CA61 3416             (       ddos2f.asm):02136         LC9D7   PSHS    D,X                     ; save 
CA63 FE0669           (       ddos2f.asm):02137                 LDU     DosCurrSector           ; get current FSN
CA66 BDCB10           (       ddos2f.asm):02138                 JSR     >FSNtoLSN               ; convert to LSN
CA69 260E             (       ddos2f.asm):02139                 BNE     DosFReadErrorExit       ; error, tydy up stack and return
                      (       ddos2f.asm):02140                 
CA6B 1F02             (       ddos2f.asm):02141                 TFR     D,Y                     ; transfer LSN to Y
                      (       ddos2f.asm):02142                 
CA6D A60F             (       ddos2f.asm):02143                 LDA     FCBDirFlags,X           ; get directory flags from FIB
CA6F 8502             (       ddos2f.asm):02144                 BITA    #AttrWriteProt          ; is the file protected?
CA71 2709             (       ddos2f.asm):02145                 BEQ     LC9F2                   ; no skip
                      (       ddos2f.asm):02146                 
CA73 0DF5             (       ddos2f.asm):02147                 TST     <DosRWFlag              ; are we reading or writing?
CA75 2705             (       ddos2f.asm):02148                 BEQ     LC9F2                   ; writing, and protected!
CA77 C698             (       ddos2f.asm):02149                 LDB     #ErrPT                  ; protected error
CA79                  (       ddos2f.asm):02150         DosFReadErrorExit   
CA79 3264             (       ddos2f.asm):02151                 LEAS    4,S                     ; clean up stack
CA7B 39               (       ddos2f.asm):02152                 RTS                             ; return
                      (       ddos2f.asm):02153         
CA7C AE62             (       ddos2f.asm):02154         LC9F2   LDX     2,S                     ; get pointer to buffer                 
CA7E 6D61             (       ddos2f.asm):02155                 TST     1,S                     ; test MSB of length
CA80 262A             (       ddos2f.asm):02156                 BNE     LCA22                   ; skip ahead if nonzero
                      (       ddos2f.asm):02157                 
CA82 0DF5             (       ddos2f.asm):02158                 TST     <DosRWFlag              ; are we reading or writing?
CA84 2707             (       ddos2f.asm):02159                 BEQ     LCA03                   ; reading, do it
                      (       ddos2f.asm):02160                 
CA86 2A0A             (       ddos2f.asm):02161                 BPL     LCA08                   ; writing, do it
CA88 BDD386           (       ddos2f.asm):02162                 JSR     >DosVerifyAbsSector     ; else go verify it
CA8B 2008             (       ddos2f.asm):02163                 BRA     LCA0B                   ; skip on
                      (       ddos2f.asm):02164         
CA8D BDD38D           (       ddos2f.asm):02165         LCA03   JSR     >DOSReadAbsSector       ; read the sector
CA90 2003             (       ddos2f.asm):02166                 BRA     LCA0B                   ; skip on
                      (       ddos2f.asm):02167         
CA92 BDD37D           (       ddos2f.asm):02168         LCA08   JSR     >DOSWriteAbsSector      ; write the sector
CA95 26E2             (       ddos2f.asm):02169         LCA0B   BNE     DosFReadErrorExit       ; error clean up stack and exit
                      (       ddos2f.asm):02170         
CA97 6C62             (       ddos2f.asm):02171                 INC     2,S                     ; increment MSB of buffer
CA99 BE0669           (       ddos2f.asm):02172                 LDX     DosCurrSector           ; increment current sector
CA9C 3001             (       ddos2f.asm):02173                 LEAX    1,X
CA9E BF0669           (       ddos2f.asm):02174                 STX     DosCurrSector           ; and save it back
CAA1 7A0661           (       ddos2f.asm):02175                 DEC     DosBytesRead            ; decrement MSB of length
CAA4 FC0661           (       ddos2f.asm):02176                 LDD     DosBytesRead            ; get length
CAA7 3516             (       ddos2f.asm):02177                 PULS    D,X                     ; restore length & pointer (flags unchanged)
CAA9 26A8             (       ddos2f.asm):02178                 BNE     LC9C9                   ; keep going if more to do      
CAAB 39               (       ddos2f.asm):02179                 RTS                             ; otherwise return to caller
                      (       ddos2f.asm):02180         
CAAC 0DF5             (       ddos2f.asm):02181         LCA22   TST     <DosRWFlag              ; skip this part on verify
CAAE 2B41             (       ddos2f.asm):02182                 BMI     RWNext                  
                      (       ddos2f.asm):02183                 
CAB0 BDD2CA           (       ddos2f.asm):02184                 JSR     >DOSFindAndRead         ; read next sector to buffer
CAB3 26C4             (       ddos2f.asm):02185                 BNE     DosFReadErrorExit       ; error, exit
                      (       ddos2f.asm):02186                 
CAB5 BF0667           (       ddos2f.asm):02187                 STX     DosPageBufAddr          ; save page buffer pointer
CAB8 10AE62           (       ddos2f.asm):02188                 LDY     2,S                     ; get user buffer ptr
CABB F60663           (       ddos2f.asm):02189                 LDB     DosSecOffset            ; get offset into the sector 
CABE 0DF5             (       ddos2f.asm):02190                 TST     <DosRWFlag              ; reading or writing?
CAC0 2723             (       ddos2f.asm):02191                 BEQ     LCA60                   ; branch if reading
                      (       ddos2f.asm):02192         
                      (       ddos2f.asm):02193         ; This code is used if we are writing   
CAC2 86FF             (       ddos2f.asm):02194                 LDA     #BuffDirty              ; mark buffer dirty                                     
CAC4 A702             (       ddos2f.asm):02195                 STA     BuffFlag,X
CAC6 AE05             (       ddos2f.asm):02196                 LDX     BuffAddr,X              ; get address of data in buffer 
CAC8 3A               (       ddos2f.asm):02197                 ABX                             ; add offset within sector
                      (       ddos2f.asm):02198                 
CAC9 E661             (       ddos2f.asm):02199         LCA44   LDB     1,S                     ; get byte count
CACB A6A0             (       ddos2f.asm):02200         LCA46   LDA     ,Y+                     ; get data from user's buffer
CACD A780             (       ddos2f.asm):02201                 STA     ,X+                     ; put in disk read buffer
CACF 5A               (       ddos2f.asm):02202                 DECB                            ; decrement count
CAD0 26F9             (       ddos2f.asm):02203                 BNE     LCA46                   ; keep going until all done
                      (       ddos2f.asm):02204                 
CAD2 1F10             (       ddos2f.asm):02205                 TFR     X,D                     ; get disk buffer pointer into d
CAD4 5D               (       ddos2f.asm):02206                 TSTB                            ; reached end of buffer?
CAD5 261A             (       ddos2f.asm):02207                 BNE     RWNext                  ; nope
                      (       ddos2f.asm):02208                 
CAD7 BE0667           (       ddos2f.asm):02209                 LDX     DosPageBufAddr          ; get Page buffer address in X
CADA 3420             (       ddos2f.asm):02210                 PSHS    Y                       ; save Y
CADC BDD337           (       ddos2f.asm):02211                 JSR     >TestAndFlushBuffer     ; flush the buffer to disk
CADF 3520             (       ddos2f.asm):02212                 PULS    Y                       ; restore Y
CAE1 2696             (       ddos2f.asm):02213                 BNE     DosFReadErrorExit       ; error, exit
CAE3 200C             (       ddos2f.asm):02214                 BRA     RWNext                  ; keep going
                      (       ddos2f.asm):02215         
                      (       ddos2f.asm):02216         ; this code is used if we are reading
CAE5 AE05             (       ddos2f.asm):02217         LCA60   LDX     BuffAddr,X              ; get address of data in buffer 
CAE7 3A               (       ddos2f.asm):02218                 ABX                             ; add offset within buffer
CAE8 E661             (       ddos2f.asm):02219                 LDB     1,S                     ; lsb of length of data
CAEA A680             (       ddos2f.asm):02220         LCA65   LDA     ,X+                     ; fetch a byte from disk buffer
CAEC A7A0             (       ddos2f.asm):02221                 STA     ,Y+                     ; write a byte to user's buffer
CAEE 5A               (       ddos2f.asm):02222                 DECB                            ; decrement byte count
CAEF 26F9             (       ddos2f.asm):02223                 BNE     LCA65                   ; keep going until all done
                      (       ddos2f.asm):02224         
CAF1 BE0669           (       ddos2f.asm):02225         RWNext  LDX     DosCurrSector           ; move to the next LSN
CAF4 3001             (       ddos2f.asm):02226                 LEAX    1,X
CAF6 BF0669           (       ddos2f.asm):02227                 STX     DosCurrSector           ; save it back
CAF9 1F21             (       ddos2f.asm):02228                 TFR     Y,X                     ; user's buffer to X    
CAFB FC0661           (       ddos2f.asm):02229                 LDD     DosBytesRead            ; get bytes read
CAFE A3E1             (       ddos2f.asm):02230                 SUBD    ,S++                    ; subtract bytes transferred
CB00 FD0661           (       ddos2f.asm):02231                 STD     DosBytesRead            ; save it back
CB03 3262             (       ddos2f.asm):02232                 LEAS    2,S                     ; drop pointer from stack
CB05 2707             (       ddos2f.asm):02233                 BEQ     DosFReadExit            ; branch if done all
CB07 7F0663           (       ddos2f.asm):02234                 CLR     DosSecOffset            ; clear sector offset, so we start 
CB0A 5F               (       ddos2f.asm):02235                 CLRB                            ; at beginning of next sector
CB0B 7ECA53           (       ddos2f.asm):02236                 JMP     >LC9C9                  ; loop again
                      (       ddos2f.asm):02237         
CB0E                  (       ddos2f.asm):02238         DosFReadExit   
CB0E 5F               (       ddos2f.asm):02239                 CLRB                            ; no error
CB0F 39               (       ddos2f.asm):02240                 RTS
                      (       ddos2f.asm):02241         
                      (       ddos2f.asm):02242         ; 
                      (       ddos2f.asm):02243         ; Convert a file sector number to a logical sector number.
                      (       ddos2f.asm):02244         ;
                      (       ddos2f.asm):02245         ; On entry 
                      (       ddos2f.asm):02246         ;  U                    FSN that we want
                      (       ddos2f.asm):02247         ;  DosCurrCtrlBlk       Current FIB no.
                      (       ddos2f.asm):02248         ;
                      (       ddos2f.asm):02249         ; Returns:
                      (       ddos2f.asm):02250         ;  D                    Logical sector number
                      (       ddos2f.asm):02251         ;  X                    FIB entry
                      (       ddos2f.asm):02252         ;  U                    FSN (preserved).
                      (       ddos2f.asm):02253         
CB10                  (       ddos2f.asm):02254         FSNtoLSN   
CB10 BDCF30           (       ddos2f.asm):02255                 JSR     >DosFCBNoToAddr         ; get FCB addr in X
CB13 1F30             (       ddos2f.asm):02256         LCA8E   TFR     U,D                     ; get FSN in D
CB15 A38813           (       ddos2f.asm):02257                 SUBD    FCBFSNExtent1,X         ; test to see where extent block is in file
CB18 250D             (       ddos2f.asm):02258                 BCS     LCAA2                   ; if -ve then this block is after the one we want
                      (       ddos2f.asm):02259         
                      (       ddos2f.asm):02260         ; check to see if required sector is within this group of sectors
                      (       ddos2f.asm):02261         
CB1A 4D               (       ddos2f.asm):02262                 TSTA                            ; If MSB is not 0 then it is not
CB1B 260A             (       ddos2f.asm):02263                 BNE     LCAA2                   
                      (       ddos2f.asm):02264                 
CB1D E18817           (       ddos2f.asm):02265                 CMPB    FCBSecExtent1,X         
CB20 2405             (       ddos2f.asm):02266                 BCC     LCAA2
                      (       ddos2f.asm):02267         
CB22 E38815           (       ddos2f.asm):02268                 ADDD    FCBLSNExtent1,X
CB25 2012             (       ddos2f.asm):02269                 BRA     LCAB4
                      (       ddos2f.asm):02270         
                      (       ddos2f.asm):02271         ; check extent 2
                      (       ddos2f.asm):02272         
CB27 1F30             (       ddos2f.asm):02273         LCAA2   TFR     U,D                     ; get FSN in D
CB29 A38818           (       ddos2f.asm):02274                 SUBD    FCBFSNExtent2,X         ; test to see where extent block is in file
CB2C 250E             (       ddos2f.asm):02275                 BCS     LCAB7                   ; if -ve then this block is after the one we want
                      (       ddos2f.asm):02276           
                      (       ddos2f.asm):02277         ; check to see if required sector is within this group of sectors
                      (       ddos2f.asm):02278         
CB2E 4D               (       ddos2f.asm):02279                 TSTA                            ; If MSB is not 0 then it is not
CB2F 260B             (       ddos2f.asm):02280                 BNE     LCAB7
                      (       ddos2f.asm):02281           
CB31 E1881C           (       ddos2f.asm):02282                 CMPB    FCBSecExtent2,X
CB34 2406             (       ddos2f.asm):02283                 BCC     LCAB7
                      (       ddos2f.asm):02284                 
CB36 E3881A           (       ddos2f.asm):02285                 ADDD    FCBLSNExtent2,X
                      (       ddos2f.asm):02286         
CB39 1A04             (       ddos2f.asm):02287         LCAB4   ORCC    #FlagZero               ; Found the block we want flag it
CB3B 39               (       ddos2f.asm):02288                 RTS
                      (       ddos2f.asm):02289         
                      (       ddos2f.asm):02290         ; Wanted FSN not in extent 1 or 2
                      (       ddos2f.asm):02291         
CB3C 3440             (       ddos2f.asm):02292         LCAB7   PSHS    U                       ; save FSN
CB3E 8D3E             (       ddos2f.asm):02293                 BSR     FindFSNinU              ; scan extents
CB40 260B             (       ddos2f.asm):02294                 BNE     LCAC8                   ; error exit
                      (       ddos2f.asm):02295                 
CB42 FC066B           (       ddos2f.asm):02296                 LDD     DosTotalSFound          ; how many scanned?
CB45 10B3066D         (       ddos2f.asm):02297                 CMPD    DosFSNToFind            ; Have we found it?
CB49 2204             (       ddos2f.asm):02298                 BHI     LCACA                   ; branch if so
                      (       ddos2f.asm):02299                 
CB4B C69A             (       ddos2f.asm):02300                 LDB     #ErrPE          ; else past EOF error
CB4D 35C0             (       ddos2f.asm):02301         LCAC8   PULS    U,PC                    ; restore & return
                      (       ddos2f.asm):02302         
                      (       ddos2f.asm):02303         ; At this point Y points to allocation extent block in directory entry.
                      (       ddos2f.asm):02304         
CB4F E022             (       ddos2f.asm):02305         LCACA   SUBB    AllocCount,Y            ; length of extent
CB51 8200             (       ddos2f.asm):02306                 SBCA    #$00                    ; propogate carry       
CB53 ED8813           (       ddos2f.asm):02307                 STD     FCBFSNExtent1,X         ; start of this extent
                      (       ddos2f.asm):02308                 
CB56 A622             (       ddos2f.asm):02309                 LDA     AllocCount,Y            ; get allocation sector count
CB58 A78817           (       ddos2f.asm):02310                 STA     FCBSecExtent1,X         ; save it in extent
CB5B ECA4             (       ddos2f.asm):02311                 LDD     ,Y                      ; get allocation LSN
CB5D ED8815           (       ddos2f.asm):02312                 STD     FCBLSNExtent1,X         ; save in extent
                      (       ddos2f.asm):02313                 
CB60 1F20             (       ddos2f.asm):02314                 TFR     Y,D                     ; transfer start LSN to D
CB62 3440             (       ddos2f.asm):02315                 PSHS    U                       ; save FSN
CB64 A3E1             (       ddos2f.asm):02316                 SUBD    ,S++                    ; subtract from LSN
CB66 3540             (       ddos2f.asm):02317                 PULS    U                       ; restore FSN
                      (       ddos2f.asm):02318                 
CB68 C113             (       ddos2f.asm):02319                 CMPB    #DirEntryLen-6          ; end of entry?
CB6A 2410             (       ddos2f.asm):02320                 BCC     LCAF7                   ; yep, no more extents
                      (       ddos2f.asm):02321                 
CB6C A625             (       ddos2f.asm):02322                 LDA     5,Y                     ; length of next extent
CB6E A7881C           (       ddos2f.asm):02323                 STA     FCBSecExtent2,X
CB71 EC23             (       ddos2f.asm):02324                 LDD     3,Y                     ; LSN of next extent
CB73 ED881A           (       ddos2f.asm):02325                 STD     $1A,X
CB76 FC066B           (       ddos2f.asm):02326                 LDD     DosTotalSFound
CB79 ED8818           (       ddos2f.asm):02327                 STD     FCBFSNExtent2,X
CB7C 2095             (       ddos2f.asm):02328         LCAF7   BRA     LCA8E                   ; loop again
                      (       ddos2f.asm):02329         
                      (       ddos2f.asm):02330         ;
                      (       ddos2f.asm):02331         ; Scan extents
                      (       ddos2f.asm):02332         ;
                      (       ddos2f.asm):02333         ; Entry : 
                      (       ddos2f.asm):02334         ;       X       Address of a FCB
                      (       ddos2f.asm):02335         ;       U       FSN to find (File Sector Number)
                      (       ddos2f.asm):02336         ;       B       File number (on disk), also in $1d,X
                      (       ddos2f.asm):02337         ;
                      (       ddos2f.asm):02338         ; Returns with:
                      (       ddos2f.asm):02339         ;       DosTotalSFound  number of sectors scanned
                      (       ddos2f.asm):02340         ;       DosFSNToFind    Original U 
                      (       ddos2f.asm):02341         ;       Y               Extent entry in dir sector.
                      (       ddos2f.asm):02342         ;
                      (       ddos2f.asm):02343         
CB7E                  (       ddos2f.asm):02344         FindFSNinU   
CB7E 3410             (       ddos2f.asm):02345                 PSHS    X
CB80 7F066C           (       ddos2f.asm):02346                 CLR     DosTotalSFound+1
CB83 7F066B           (       ddos2f.asm):02347                 CLR     DosTotalSFound
CB86 FF066D           (       ddos2f.asm):02348                 STU     DosFSNToFind            ; set FSN to find 
CB89 E6881D           (       ddos2f.asm):02349                 LDB     FCBDiskFileNo,X         ; set current file to be FCB file
CB8C F70682           (       ddos2f.asm):02350                 STB     DosCurFileNo
CB8F BDD257           (       ddos2f.asm):02351                 JSR     >DOSGetDirEntry         ; Go get directory entry
CB92 2646             (       ddos2f.asm):02352                 BNE     LCB56                   ; Error : exit
                      (       ddos2f.asm):02353                 
CB94 1F13             (       ddos2f.asm):02354                 TFR     X,U                     ; point u at dir entry
CB96 3510             (       ddos2f.asm):02355                 PULS    X                       ; recover FCB pointer
                      (       ddos2f.asm):02356                 
CB98 314C             (       ddos2f.asm):02357                 LEAY    DirEntFnBlock1,U        ; point Y at first allocation block
CB9A C604             (       ddos2f.asm):02358                 LDB     #$04                    ; entry counter
CB9C A6C4             (       ddos2f.asm):02359         LCB17   LDA     ,U                      ; get attributes 
CB9E 8420             (       ddos2f.asm):02360                 ANDA    #AttrContinued          ; extract continuation flag     
CBA0 2703             (       ddos2f.asm):02361                 BEQ     LCB20                   ; not a continuation block, skip
                      (       ddos2f.asm):02362                 
CBA2 A6C818           (       ddos2f.asm):02363                 LDA     DirEntFlag,U            ; get dir entry flag
                      (       ddos2f.asm):02364         
CBA5 3406             (       ddos2f.asm):02365         LCB20   PSHS    D
CBA7 FC066B           (       ddos2f.asm):02366         LCB22   LDD     DosTotalSFound          ; get total sectors found so far
CBAA EB22             (       ddos2f.asm):02367                 ADDB    2,Y                     ; add sector count for this allocation block to total
CBAC 8900             (       ddos2f.asm):02368                 ADCA    #$00                    ; carry from b to a if neeeded
CBAE FD066B           (       ddos2f.asm):02369                 STD     DosTotalSFound          ; update total found
CBB1 10B3066D         (       ddos2f.asm):02370                 CMPD    DosFSNToFind            ; found the sector we need yet ?
CBB5 2222             (       ddos2f.asm):02371                 BHI     LCB55                   ; yep : exit
                      (       ddos2f.asm):02372                 
CBB7 3123             (       ddos2f.asm):02373                 LEAY    AllocEntrySize,Y        ; move to next allocation entry                 
CBB9 6A61             (       ddos2f.asm):02374                 DEC     1,S                     ; decrement entry counter
CBBB 26EA             (       ddos2f.asm):02375                 BNE     LCB22                   ; if more to do loop again
                      (       ddos2f.asm):02376         
CBBD E6E4             (       ddos2f.asm):02377                 LDB     ,S                      ; recover DirEntFlag or AttrContinued   
CBBF 2716             (       ddos2f.asm):02378                 BEQ     LCB53                   ; if it's 0
                      (       ddos2f.asm):02379                 
CBC1 3262             (       ddos2f.asm):02380                 LEAS    2,S                     ; drop stack frame
CBC3 F70682           (       ddos2f.asm):02381                 STB     DosCurFileNo            
                      (       ddos2f.asm):02382         
CBC6 3410             (       ddos2f.asm):02383                 PSHS    X                       ; save FCB pointer      
CBC8 BDD257           (       ddos2f.asm):02384                 JSR     >DOSGetDirEntry         ; get next entry
CBCB 1F13             (       ddos2f.asm):02385                 TFR     X,U                     ; make u point to dir entry
CBCD 3510             (       ddos2f.asm):02386                 PULS    X                       ; recover FCB pointer
CBCF 260B             (       ddos2f.asm):02387                 BNE     LCBDC
                      (       ddos2f.asm):02388         
CBD1 3141             (       ddos2f.asm):02389         LCB4D   LEAY    DirEntCntBlock1,U       ; point at first extension entry                        
CBD3 C607             (       ddos2f.asm):02390                 LDB     #$07                    ; 7 entries in a continuation block
CBD5 20C5             (       ddos2f.asm):02391                 BRA     LCB17
                      (       ddos2f.asm):02392         
CBD7 313D             (       ddos2f.asm):02393         LCB53   LEAY    -3,Y
CBD9 5F               (       ddos2f.asm):02394         LCB55   CLRB                            ; flag no error
                      (       ddos2f.asm):02395         
CBDA 3262             (       ddos2f.asm):02396         LCB56   LEAS    2,S                     ; Drop stack frame
CBDC 39               (       ddos2f.asm):02397         LCBDC   RTS                             ; Return
                      (       ddos2f.asm):02398         
                      (       ddos2f.asm):02399         ;
                      (       ddos2f.asm):02400         ; Write to a file.
                      (       ddos2f.asm):02401         ;
                      (       ddos2f.asm):02402         ; Entry :
                      (       ddos2f.asm):02403         ;       A = FCB no
                      (       ddos2f.asm):02404         ;       X = pointer to buffer to receive data
                      (       ddos2f.asm):02405         ;       U = no of bytes to read
                      (       ddos2f.asm):02406         ;       Y = MSW of file offset (FSN sector no).
                      (       ddos2f.asm):02407         ;       B = LSB of file offset (byte within sector).
                      (       ddos2f.asm):02408         ;               Y:B is effectivly the filepointer.
                      (       ddos2f.asm):02409         ; Exit:
                      (       ddos2f.asm):02410         ;       B = Error code
                      (       ddos2f.asm):02411         ;
                      (       ddos2f.asm):02412         
CBDD                  (       ddos2f.asm):02413         DOSFWrite   
CBDD 97F1             (       ddos2f.asm):02414                 STA     <DosCurrCtrlBlk         ; Set FCB to be current
CBDF BF0671           (       ddos2f.asm):02415                 STX     DosFWBufPtr             ; save params for later
CBE2 FF0673           (       ddos2f.asm):02416                 STU     DosFWByteCount
CBE5 10BF0675         (       ddos2f.asm):02417                 STY     DosFWFPoint
CBE9 F70677           (       ddos2f.asm):02418                 STB     DosFWFPoint+2
                      (       ddos2f.asm):02419                 
CBEC BDCF30           (       ddos2f.asm):02420                 JSR     >DosFCBNoToAddr         ; Get address of FCB
                      (       ddos2f.asm):02421         
CBEF E60B             (       ddos2f.asm):02422                 LDB     FCBDrive,X              ; set drive from FCB
CBF1 D7EB             (       ddos2f.asm):02423                 STB     <DosDriveNo
                      (       ddos2f.asm):02424                 
CBF3 BDCEFD           (       ddos2f.asm):02425         LCB6F   JSR     >DOSGetFLen             ; get the file length in U:A
CBF6 270E             (       ddos2f.asm):02426                 BEQ     LCB82                   ; no error : skip
                      (       ddos2f.asm):02427                 
CBF8 C19C             (       ddos2f.asm):02428                 CMPB    #ErrFF          ; File not found ?
CBFA 2701             (       ddos2f.asm):02429                 BEQ     LCB79                   ; yep : create the file
CBFC 39               (       ddos2f.asm):02430         LCB78   RTS
                      (       ddos2f.asm):02431         
CBFD 96F1             (       ddos2f.asm):02432         LCB79   LDA     <DosCurrCtrlBlk         ; Get current FCB
CBFF BDCF98           (       ddos2f.asm):02433                 JSR     >DOSCreateFile          ; Create the file
CC02 26D8             (       ddos2f.asm):02434                 BNE     LCBDC                   ; error : exit
CC04 20ED             (       ddos2f.asm):02435                 BRA     LCB6F                   ; success : check file length
                      (       ddos2f.asm):02436         
                      (       ddos2f.asm):02437         ; If we come here we have successfuly got the file len
                      (       ddos2f.asm):02438         
CC06 11B30675         (       ddos2f.asm):02439         LCB82   CMPU    DosFWFPoint             ; is file pointer beyond EOF ?  
CC0A 220A             (       ddos2f.asm):02440                 BHI     LCB92                   ; no : continue
CC0C 2505             (       ddos2f.asm):02441                 BCS     LCB8F                   ; yes : error
                      (       ddos2f.asm):02442                 
CC0E B10677           (       ddos2f.asm):02443                 CMPA    DosFWFPoint+2           ; check LSB, if MSW equal
CC11 2403             (       ddos2f.asm):02444                 BCC     LCB92                   ; not past end : continue
                      (       ddos2f.asm):02445                 
CC13 C69A             (       ddos2f.asm):02446         LCB8F   LDB     #ErrPE          ; error : past end
CC15 39               (       ddos2f.asm):02447         LCB91   RTS
                      (       ddos2f.asm):02448         
CC16 3402             (       ddos2f.asm):02449         LCB92   PSHS    A                       ; save LSB of length    
CC18 FC0673           (       ddos2f.asm):02450                 LDD     DosFWByteCount          ; get no of bytes to write      
CC1B FB0677           (       ddos2f.asm):02451                 ADDB    DosFWFPoint+2           ; add current filepointer, 
CC1E B90676           (       ddos2f.asm):02452                 ADCA    DosFWFPoint+1
CC21 3404             (       ddos2f.asm):02453                 PSHS    B                       ; save LSB of len+FP
CC23 1F89             (       ddos2f.asm):02454                 TFR     A,B                     
CC25 B60675           (       ddos2f.asm):02455                 LDA     DosFWFPoint             ; get MSB
CC28 8900             (       ddos2f.asm):02456                 ADCA    #$00                    ; deal with carry from LSW to MSB
                      (       ddos2f.asm):02457                 
CC2A 3440             (       ddos2f.asm):02458                 PSHS    U                       
CC2C A3E1             (       ddos2f.asm):02459                 SUBD    ,S++                    ; Subtract no of sectors in file from MSW of new filesize 
CC2E 1F98             (       ddos2f.asm):02460                 TFR     B,A
CC30 3504             (       ddos2f.asm):02461                 PULS    B                       ; recover LSB of len+FP
CC32 2208             (       ddos2f.asm):02462                 BHI     LCBB8                   ; new filesize higher extend file
CC34 250E             (       ddos2f.asm):02463                 BCS     LCBC0                   ; new filesize lower do write
                      (       ddos2f.asm):02464                 
CC36 E0E4             (       ddos2f.asm):02465                 SUBB    ,S                      ; MSW is equal check LSB
CC38 2406             (       ddos2f.asm):02466                 BCC     LCBBC                   ; new filesize higher extend file
CC3A 2008             (       ddos2f.asm):02467                 BRA     LCBC0                   ; new filesize lower or equal do write
                      (       ddos2f.asm):02468         
CC3C E0E4             (       ddos2f.asm):02469         LCBB8   SUBB    ,S
CC3E 8200             (       ddos2f.asm):02470                 SBCA    #$00
CC40 8D2E             (       ddos2f.asm):02471         LCBBC   BSR     ExtendFile              ; extend the file ?
CC42 2629             (       ddos2f.asm):02472                 BNE     LCBE9                   ; error :  return
                      (       ddos2f.asm):02473                 
CC44 3261             (       ddos2f.asm):02474         LCBC0   LEAS    1,S                     ; drop saved byte
CC46 F60677           (       ddos2f.asm):02475                 LDB     DosFWFPoint+2           ; recover file pointer LSB
CC49 BE0671           (       ddos2f.asm):02476                 LDX     DosFWBufPtr             ; and buffer
CC4C 10BE0673         (       ddos2f.asm):02477                 LDY     DosFWByteCount          ; and count
CC50 FE0675           (       ddos2f.asm):02478                 LDU     DosFWFPoint             ; and FP MSB
                      (       ddos2f.asm):02479                 
CC53 BDCA21           (       ddos2f.asm):02480                 JSR     >RWrite                 ; entry point for write
CC56 26BD             (       ddos2f.asm):02481                 BNE     LCB91                   ; error : exit
                      (       ddos2f.asm):02482                 
CC58 7D0608           (       ddos2f.asm):02483                 TST     DosVerifyFlag           ; verify written data ?
CC5B 27B8             (       ddos2f.asm):02484                 BEQ     LCB91                   ; nope : return
                      (       ddos2f.asm):02485                 
CC5D F60677           (       ddos2f.asm):02486                 LDB     DosFWFPoint+2           ; recover file pointer LSB
CC60 BE0671           (       ddos2f.asm):02487                 LDX     DosFWBufPtr             ; and buffer
CC63 10BE0673         (       ddos2f.asm):02488                 LDY     DosFWByteCount          ; and count
CC67 FE0675           (       ddos2f.asm):02489                 LDU     DosFWFPoint             ; and FP MSB
CC6A 16FDB7           (       ddos2f.asm):02490                 LBRA    Verify                  ; go verify  it 
                      (       ddos2f.asm):02491         
CC6D 3261             (       ddos2f.asm):02492         LCBE9   LEAS    1,S                     ; clean up stack
CC6F 39               (       ddos2f.asm):02493                 RTS                             ; return 
                      (       ddos2f.asm):02494         
                      (       ddos2f.asm):02495         ; 
                      (       ddos2f.asm):02496         ; Extend a file, called by DOSFWrite
                      (       ddos2f.asm):02497         ;
                      (       ddos2f.asm):02498         ; Entry :
                      (       ddos2f.asm):02499         ;       DosCurrCtrlBlk  = Fileno
                      (       ddos2f.asm):02500         ;       DosDriveNo      = drive number
                      (       ddos2f.asm):02501         ;       D               = number of bytes to extend file
                      (       ddos2f.asm):02502         ;
                      (       ddos2f.asm):02503         ; Returns:
                      (       ddos2f.asm):02504         ;       B               = error code
                      (       ddos2f.asm):02505         ;
                      (       ddos2f.asm):02506         ; The data on the disk is not preset / initialized.
                      (       ddos2f.asm):02507         ;
                      (       ddos2f.asm):02508         ; Procedure:
                      (       ddos2f.asm):02509         ; The number of bytes that can be allocated to the last sector allready
                      (       ddos2f.asm):02510         ; allocated to the file is detected.
                      (       ddos2f.asm):02511         ; Get a free extent, if contiguous add it to the currently allocated 
                      (       ddos2f.asm):02512         ; extent, otherwise make a new one.
                      (       ddos2f.asm):02513         ; Decrease free extent by number of sectors needed (or all),
                      (       ddos2f.asm):02514         ; If more sectors needed, loop.
                      (       ddos2f.asm):02515         ; Figure number of bytes used in last sector and store in DIR.
                      (       ddos2f.asm):02516         ;
                      (       ddos2f.asm):02517         ; Update length of file and last sector.
                      (       ddos2f.asm):02518         ;
                      (       ddos2f.asm):02519         
                      (       ddos2f.asm):02520         ; stack frame offsets
     0000             (       ddos2f.asm):02521         ExtBytes        EQU     0               ; number of bytes to extend**
     0002             (       ddos2f.asm):02522         ExtExtentPtr    EQU     2               ; Extent pointer
     0004             (       ddos2f.asm):02523         ExtEntry        EQU     4               ; Entry pointer
     0006             (       ddos2f.asm):02524         ExtWant         EQU     6               ; Best LSN block found
     0008             (       ddos2f.asm):02525         ExtDiskPtr      EQU     8               ; pointer to drive table (DrvDet* consts)
     000A             (       ddos2f.asm):02526         ExtSaveExd      EQU     10              ; ?
                      (       ddos2f.asm):02527         
     000C             (       ddos2f.asm):02528         ExtendFrameSize EQU     $0C             ; stack frame size
                      (       ddos2f.asm):02529         
                      (       ddos2f.asm):02530         ; ** Since disk sectors are 256 bytes, and the 6809 stores the MSB in the 16 bit 
                      (       ddos2f.asm):02531         ; registers pushed onto the stack with MSB at the lowest address (smallest offset 
                      (       ddos2f.asm):02532         ; from S), ExBytes,S will access the MSB of ExBytes, which will be the number of 
                      (       ddos2f.asm):02533         ; whole sectors requested.
                      (       ddos2f.asm):02534         
CC70                  (       ddos2f.asm):02535         ExtendFile   
CC70 3274             (       ddos2f.asm):02536                 LEAS    -ExtendFrameSize,S      ; make room on stack
CC72 EDE4             (       ddos2f.asm):02537                 STD     ExtBytes,S              ; save number of bytes
CC74 ED6A             (       ddos2f.asm):02538                 STD     ExtSaveExd,S
                      (       ddos2f.asm):02539                 
CC76 8601             (       ddos2f.asm):02540                 LDA     #$01                    ; Flag that we are working....
CC78 97F6             (       ddos2f.asm):02541                 STA     <DosIOInProgress
CC7A BDD200           (       ddos2f.asm):02542                 JSR     >DosGetDiskGeometry     ; get disk geometry
CC7D 102600E5         (       ddos2f.asm):02543                 LBNE    ExtendFileExit          ; error exit
                      (       ddos2f.asm):02544                 
CC81 AF68             (       ddos2f.asm):02545                 STX     ExtDiskPtr,S            ; save pointer to geometry buffer
CC83 BDCF30           (       ddos2f.asm):02546                 JSR     >DosFCBNoToAddr         ; get address of FCB
CC86 E6881E           (       ddos2f.asm):02547                 LDB     FCBDirNoLast,X          ; get directory index of last file segment
CC89 BDD257           (       ddos2f.asm):02548                 JSR     >DOSGetDirEntry         ; go get it
CC8C 102600D6         (       ddos2f.asm):02549                 LBNE    ExtendFileExit          ; error : exit
                      (       ddos2f.asm):02550                 
CC90 AF64             (       ddos2f.asm):02551                 STX     ExtEntry,S              ; save directory pointer                        
CC92 FE067F           (       ddos2f.asm):02552                 LDU     DosCurDirBuff           ; get def block for dir sector
CC95 86FF             (       ddos2f.asm):02553                 LDA     #-1                     ; flag it dirty
CC97 A742             (       ddos2f.asm):02554                 STA     BuffFlag,U
                      (       ddos2f.asm):02555         
                      (       ddos2f.asm):02556         ; Work out the number of whole sectors we need to extend the file by.
                      (       ddos2f.asm):02557         ; Round up if ammount to extend / sector size has a remainer.
                      (       ddos2f.asm):02558         ; number of whole sectors will be in A and remainder in B
                      (       ddos2f.asm):02559         
CC99 4F               (       ddos2f.asm):02560                 CLRA                            
CC9A E68818           (       ddos2f.asm):02561                 LDB     DirEntLastBytes,X       ; no bytes in last sector
CC9D 2601             (       ddos2f.asm):02562                 BNE     LCC1C                   ; zero, skip
                      (       ddos2f.asm):02563                 
CC9F 4C               (       ddos2f.asm):02564                 INCA                            ; inc MSB
CCA0 E3E4             (       ddos2f.asm):02565         LCC1C   ADDD    ,S                      ; add to number of bytes to extend      
CCA2 5D               (       ddos2f.asm):02566                 TSTB                            ; remainder = 0
CCA3 2601             (       ddos2f.asm):02567                 BNE     LCC22                   ; no.....
                      (       ddos2f.asm):02568                 
CCA5 4A               (       ddos2f.asm):02569                 DECA                            ; decrement MSB
CCA6 EDE4             (       ddos2f.asm):02570         LCC22   STD     ,S                      ; resave amount to extend.      
CCA8 4D               (       ddos2f.asm):02571                 TSTA                            ; more than space in last sector?
CCA9 102700A1         (       ddos2f.asm):02572                 LBEQ    LCCCA                   ; nope, no allocation change needed
                      (       ddos2f.asm):02573                 
CCAD C604             (       ddos2f.asm):02574                 LDB     #DirEntExts             ; 4 allocation blocks in directory entry
CCAF 310C             (       ddos2f.asm):02575                 LEAY    DirEntFnBlock1,X        ; point to first allocation block in dir
CCB1 A684             (       ddos2f.asm):02576                 LDA     DirEntAttr,X            ; get flags of directory entry
CCB3 8501             (       ddos2f.asm):02577                 BITA    #AttrIsCont             ; Continuation block?
CCB5 2704             (       ddos2f.asm):02578                 BEQ     LCC37                   ; no, read filename block extents 
                      (       ddos2f.asm):02579                 
CCB7 3101             (       ddos2f.asm):02580                 LEAY    DirEntCntBlock1,X       ; point at first continuation block extent
CCB9 C607             (       ddos2f.asm):02581                 LDB     #DirEntCntExts          ; get the extent count for continuation block (7)
                      (       ddos2f.asm):02582         
CCBB 6D22             (       ddos2f.asm):02583         LCC37   TST     AllocCount,Y            ; any sectors allocated?
CCBD 2614             (       ddos2f.asm):02584                 BNE     LCC4F                   ; yes, skip, find last one
                      (       ddos2f.asm):02585                 
CCBF CCFFFF           (       ddos2f.asm):02586                 LDD     #-1                     ; max possible allocation....
CCC2 ED66             (       ddos2f.asm):02587                 STD     ExtWant,S               ; save it on stack
CCC4 313D             (       ddos2f.asm):02588                 LEAY    -AllocLen,Y
CCC6 10AF62           (       ddos2f.asm):02589                 STY     ExtExtentPtr,S          ; save extent pointer on stack
CCC9 AE68             (       ddos2f.asm):02590                 LDX     ExtDiskPtr,S            ; get drive table pointer
CCCB 6D02             (       ddos2f.asm):02591                 TST     DrvDetFreeLen,X         ; check to see if we have free space on disk
CCCD 1026009B         (       ddos2f.asm):02592                 LBNE    LCCE8
CCD1 203E             (       ddos2f.asm):02593                 BRA     LCC8D
                      (       ddos2f.asm):02594         
                      (       ddos2f.asm):02595         ; find last used allocation block in current directory / continuation block
CCD3 6D22             (       ddos2f.asm):02596         LCC4F   TST     AllocCount,Y            ; any sectors allocated?
CCD5 2705             (       ddos2f.asm):02597                 BEQ     LCC58                   ; no.....
                      (       ddos2f.asm):02598                 
CCD7 3123             (       ddos2f.asm):02599                 LEAY    AllocLen,Y              ; move to next alloc block
CCD9 5A               (       ddos2f.asm):02600                 DECB                            ; decrement alloc block count
CCDA 26F7             (       ddos2f.asm):02601                 BNE     LCC4F                   ; loop if more to do
                      (       ddos2f.asm):02602                 
CCDC 313D             (       ddos2f.asm):02603         LCC58   LEAY    -AllocLen,Y             ; point at previous alloc block
CCDE ECA4             (       ddos2f.asm):02604                 LDD     AllocLSN,Y              ; Get LSN of block
CCE0 EB22             (       ddos2f.asm):02605                 ADDB    AllocCount,Y            ; add count to LSN
CCE2 8900             (       ddos2f.asm):02606                 ADCA    #$00                    ; propagate carry
CCE4 ED66             (       ddos2f.asm):02607                 STD     ExtWant,S               ; Save LSN of 1 block past this allocation
CCE6 10AF62           (       ddos2f.asm):02608                 STY     ExtExtentPtr,S          ; save dir extent pointer
CCE9 AE68             (       ddos2f.asm):02609                 LDX     ExtDiskPtr,S            ; get disk pointer
CCEB 6D02             (       ddos2f.asm):02610                 TST     DrvDetFreeLen,X         ; Test disk free length
CCED 2722             (       ddos2f.asm):02611                 BEQ     LCC8D                                   
                      (       ddos2f.asm):02612                 
CCEF EC66             (       ddos2f.asm):02613                 LDD     ExtWant,S               ; get starting LSN for search                           
CCF1 A303             (       ddos2f.asm):02614                 SUBD    DrvDetFreeEPtr,X        ; get free extent pointer
CCF3 272C             (       ddos2f.asm):02615                 BEQ     LCC9D                   ; branch if same
                      (       ddos2f.asm):02616                 
CCF5 BDCDB5           (       ddos2f.asm):02617                 JSR     >GetFreeExtent          ; else get a free extent
CCF8 2706             (       ddos2f.asm):02618                 BEQ     LCC7C                   ; branch if OK
                      (       ddos2f.asm):02619                 
CCFA C194             (       ddos2f.asm):02620                 CMPB    #ErrDF          ; Disk full?
CCFC 2668             (       ddos2f.asm):02621                 BNE     ExtendFileExit          ; no extend the extent
CCFE 206C             (       ddos2f.asm):02622                 BRA     LCCE8                   ; skip ahead
                      (       ddos2f.asm):02623         
                      (       ddos2f.asm):02624         ; replace old extent
CD00 AE68             (       ddos2f.asm):02625         LCC7C   LDX     ExtDiskPtr,S            
CD02 3442             (       ddos2f.asm):02626                 PSHS    A,U                     ; save regs
CD04 E602             (       ddos2f.asm):02627                 LDB     DrvDetFreeLen,X         ; get length of free block              
CD06 AE03             (       ddos2f.asm):02628                 LDX     DrvDetFreeEPtr,X        ; get extent pointer for block
CD08 BDD096           (       ddos2f.asm):02629                 JSR     >DeleteExtent           ; go and delete it
CD0B 3542             (       ddos2f.asm):02630                 PULS    A,U                     ; restore regs
CD0D 2657             (       ddos2f.asm):02631                 BNE     ExtendFileExit          ; error, exit
CD0F 2005             (       ddos2f.asm):02632                 BRA     LCC92
                      (       ddos2f.asm):02633         
CD11 BDCDB5           (       ddos2f.asm):02634         LCC8D   JSR     >GetFreeExtent          ; go get free extent
CD14 2650             (       ddos2f.asm):02635                 BNE     ExtendFileExit          ; error exit
                      (       ddos2f.asm):02636         
CD16 AE68             (       ddos2f.asm):02637         LCC92   LDX     ExtDiskPtr,S            ; point to disk table
CD18 EF03             (       ddos2f.asm):02638                 STU     DrvDetFreeEPtr,X        ; save LSN of free block
CD1A A702             (       ddos2f.asm):02639                 STA     DrvDetFreeLen,X         ; save no of sectors free
CD1C 11A366           (       ddos2f.asm):02640                 CMPU    ExtWant,S               ; compare free pointer to want pointer
CD1F 264B             (       ddos2f.asm):02641                 BNE     LCCE8                   ; skip if not same, new extent
                      (       ddos2f.asm):02642         
                      (       ddos2f.asm):02643         ; check if the available space, has enough sectors for the ammount requested.
                      (       ddos2f.asm):02644         ; see note at begining of ExtendFile, about ExtBytes :) 
CD21 A6E4             (       ddos2f.asm):02645         LCC9D   LDA     ExtBytes,S              ; MSB of wanted bytes (number of whole sectors)         
CD23 A102             (       ddos2f.asm):02646                 CMPA    DrvDetFreeLen,X         ; free len
CD25 2502             (       ddos2f.asm):02647                 BCS     LCCA5                   ; branch if free len lower
                      (       ddos2f.asm):02648         
CD27 A602             (       ddos2f.asm):02649                 LDA     DrvDetFreeLen,X         ; number of sectors free
CD29 10AE62           (       ddos2f.asm):02650         LCCA5   LDY     ExtExtentPtr,S          ; get pointer to extent
CD2C 3402             (       ddos2f.asm):02651                 PSHS    A                       ; free sector count
CD2E AB22             (       ddos2f.asm):02652                 ADDA    AllocCount,Y            ; add allocation count 
CD30 2404             (       ddos2f.asm):02653                 BCC     LCCB2                   ; branch if no overflow....             
                      (       ddos2f.asm):02654         
CD32 3502             (       ddos2f.asm):02655                 PULS    A                       ; restore sector count
CD34 2036             (       ddos2f.asm):02656                 BRA     LCCE8                   ; branch....
                      (       ddos2f.asm):02657         
                      (       ddos2f.asm):02658         ; Sector count in A still stacked
CD36 A722             (       ddos2f.asm):02659         LCCB2   STA     AllocCount,Y            ; update count  
CD38 A602             (       ddos2f.asm):02660                 LDA     DrvDetFreeLen,X         ; get free len
CD3A A0E4             (       ddos2f.asm):02661                 SUBA    ,S                      ; subtract number of sectors allocated
CD3C A702             (       ddos2f.asm):02662                 STA     DrvDetFreeLen,X         ; resave it
CD3E EC03             (       ddos2f.asm):02663                 LDD     DrvDetFreeEPtr,X        ; get LSN of beginning of free block
CD40 EBE4             (       ddos2f.asm):02664                 ADDB    ,S                      ; and number of complete sectors
CD42 8900             (       ddos2f.asm):02665                 ADCA    #$00                    ; propagate carry
CD44 ED03             (       ddos2f.asm):02666                 STD     DrvDetFreeEPtr,X        ; resave it
                      (       ddos2f.asm):02667                 
CD46 A661             (       ddos2f.asm):02668                 LDA     ExtBytes+1,S            ; get number of sectors wanted
CD48 A0E0             (       ddos2f.asm):02669                 SUBA    ,S+                     ; subtract no of sectors allocated
CD4A A7E4             (       ddos2f.asm):02670                 STA     ,S                      ; resave
CD4C 26C3             (       ddos2f.asm):02671                 BNE     LCC8D                   ; if not zero loop again, to allocate more!
                      (       ddos2f.asm):02672         
CD4E AE64             (       ddos2f.asm):02673         LCCCA   LDX     ExtEntry,S              ; get entry pointer
CD50 1F13             (       ddos2f.asm):02674                 TFR     X,U                     ; save in U
CD52 BDCF30           (       ddos2f.asm):02675                 JSR     >DosFCBNoToAddr         ; get FCB address
CD55 EC6A             (       ddos2f.asm):02676                 LDD     ExtSaveExd,S            ; get original bytes requested
CD57 E38811           (       ddos2f.asm):02677                 ADDD    FCBFileLen+1,X          ; add LSW of current file len
CD5A 2403             (       ddos2f.asm):02678                 BCC     LCCDB                   ; branch if no carry
                      (       ddos2f.asm):02679         
CD5C 6C8810           (       ddos2f.asm):02680                 INC     FCBFileLen,X            ; increment MSB if carry to poroagate it
CD5F ED8811           (       ddos2f.asm):02681         LCCDB   STD     FCBFileLen+1,X          ; save new file length
CD62 E7C818           (       ddos2f.asm):02682                 STB     DirEntLastBytes,U       ; update bytes in last sector
CD65 5F               (       ddos2f.asm):02683                 CLRB
                      (       ddos2f.asm):02684         
CD66                  (       ddos2f.asm):02685         ExtendFileExit   
CD66 326C             (       ddos2f.asm):02686                 LEAS    ExtendFrameSize,S       ; drop stack frame
CD68 0FF6             (       ddos2f.asm):02687                 CLR     <DosIOInProgress        ; clear IO flag
CD6A 5D               (       ddos2f.asm):02688                 TSTB                            ; set error
CD6B 39               (       ddos2f.asm):02689                 RTS
                      (       ddos2f.asm):02690         
CD6C EC62             (       ddos2f.asm):02691         LCCE8   LDD     ExtExtentPtr,S          ; get extent pointer
CD6E 1F02             (       ddos2f.asm):02692                 TFR     D,Y                     ; save it in Y
CD70 A364             (       ddos2f.asm):02693                 SUBD    ExtEntry,S              
CD72 C113             (       ddos2f.asm):02694                 CMPB    #$13                    ; room for another entry in dir block
CD74 240B             (       ddos2f.asm):02695                 BHS     NewDir                  ; no....make a new continuation block
                      (       ddos2f.asm):02696                 
CD76 3123             (       ddos2f.asm):02697                 LEAY    AllocEntrySize,Y        ; move to next allocation entry
CD78 10AF62           (       ddos2f.asm):02698                 STY     ExtExtentPtr,S          ; save allocation pointer
CD7B EC03             (       ddos2f.asm):02699         LCCF7   LDD     DrvDetFreeEPtr,X        ; get pointer to free block of sectors
CD7D EDA4             (       ddos2f.asm):02700                 STD     AllocLSN,Y              ; save it in entry
CD7F 20A0             (       ddos2f.asm):02701                 BRA     LCC9D                   ; loop to check all extending done
                      (       ddos2f.asm):02702         
                      (       ddos2f.asm):02703         ; add a new continuation block to the directory                 
CD81 8601             (       ddos2f.asm):02704         NewDir  LDA     #$01                    ; flag continuation type entry
CD83 BDD17F           (       ddos2f.asm):02705                 JSR     >FindEmptyDir           ; find empty directory entry block
CD86 26DE             (       ddos2f.asm):02706                 BNE     ExtendFileExit          ; error exit
                      (       ddos2f.asm):02707                 
CD88 10AE64           (       ddos2f.asm):02708                 LDY     ExtEntry,S              ; get extent pointer
CD8B A7A818           (       ddos2f.asm):02709                 STA     DirEntFlag,Y            ; flag continuation entry
CD8E E6A4             (       ddos2f.asm):02710                 LDB     DirEntAttr,Y            ; get entry attributes
CD90 CA20             (       ddos2f.asm):02711                 ORB     #AttrContinued          ; flag it as a continuation block
CD92 E7A4             (       ddos2f.asm):02712                 STB     DirEntAttr,Y            ; save it back
                      (       ddos2f.asm):02713                 
CD94 C6FF             (       ddos2f.asm):02714                 LDB     #BuffDirty              ; mark disk buffer dirty
CD96 E702             (       ddos2f.asm):02715                 STB     BuffFlag,X
                      (       ddos2f.asm):02716                 
CD98 C601             (       ddos2f.asm):02717                 LDB     #AttrIsCont             ; mark as continuation
CD9A E7C4             (       ddos2f.asm):02718                 STB     DirEntAttr,U
CD9C EF64             (       ddos2f.asm):02719                 STU     ExtEntry,S
                      (       ddos2f.asm):02720                 
CD9E BDCF30           (       ddos2f.asm):02721                 JSR     >DosFCBNoToAddr         ; get FCB address in X
CDA1 A7881E           (       ddos2f.asm):02722                 STA     FCBDirNoLast,X
                      (       ddos2f.asm):02723                 
CDA4 31C819           (       ddos2f.asm):02724                 LEAY    DirEntryLen,U
CDA7 C618             (       ddos2f.asm):02725                 LDB     #DirEntryLen-1          ; zero continuation block to initialize
CDA9 6FA2             (       ddos2f.asm):02726         LCD25   CLR     ,-Y                     ; clear a byte poiubter back
CDAB 5A               (       ddos2f.asm):02727                 DECB                            ; decrement count
CDAC 26FB             (       ddos2f.asm):02728                 BNE     LCD25                   ; loop again if not all done
                      (       ddos2f.asm):02729                 
CDAE 10AF62           (       ddos2f.asm):02730                 STY     ExtExtentPtr,S          ; save pointer to first extent in block
CDB1 AE68             (       ddos2f.asm):02731                 LDX     ExtDiskPtr,S            ; get disk pointer
CDB3 20C6             (       ddos2f.asm):02732                 BRA     LCCF7                   ; loop to allocate 
                      (       ddos2f.asm):02733         
                      (       ddos2f.asm):02734         ;
                      (       ddos2f.asm):02735         ; Get free extent
                      (       ddos2f.asm):02736         ;
                      (       ddos2f.asm):02737         ; This must be called by ExtendFile and allocates one extent from the
                      (       ddos2f.asm):02738         ; free list.
                      (       ddos2f.asm):02739         ;
                      (       ddos2f.asm):02740         ; In order of prefference it will find a sector:
                      (       ddos2f.asm):02741         ;       At the LSN specified. 
                      (       ddos2f.asm):02742         ;       At the start of a pair of tracks.
                      (       ddos2f.asm):02743         ;       Outside of the directory track.
                      (       ddos2f.asm):02744         ;       At the start of the track outside of the directory.
                      (       ddos2f.asm):02745         ;       At the start of the track inside of the directory.
                      (       ddos2f.asm):02746         ;       Any free sector at the start of a contiguous block.
                      (       ddos2f.asm):02747         ;
                      (       ddos2f.asm):02748         ; Entry:
                      (       ddos2f.asm):02749         ;       ExtWant,S       = LSN preffered, of $FFFF.
                      (       ddos2f.asm):02750         ;       DosDriveNo      = drive number
                      (       ddos2f.asm):02751         ;
                      (       ddos2f.asm):02752         ; Returns: 
                      (       ddos2f.asm):02753         ;       U               = LSN
                      (       ddos2f.asm):02754         ;       A               = length of extent.
                      (       ddos2f.asm):02755         ;       B               = error code (if any).
                      (       ddos2f.asm):02756         ;
                      (       ddos2f.asm):02757         
     0000             (       ddos2f.asm):02758         GFTry           EQU     0
     0002             (       ddos2f.asm):02759         GFPointBuff     EQU     2       ; buffer pointer?
     0004             (       ddos2f.asm):02760         GFlag           EQU     4       ; flags?
     0005             (       ddos2f.asm):02761         TempLSN         EQU     5       ; Temporary LSN
     0007             (       ddos2f.asm):02762         TempCount       EQU     7       ; Tempory count
     0008             (       ddos2f.asm):02763         BTCount         EQU     8
                      (       ddos2f.asm):02764         
     0009             (       ddos2f.asm):02765         GFFrameSize     EQU     9       ; Stack frame size
                      (       ddos2f.asm):02766         
CDB5                  (       ddos2f.asm):02767         GetFreeExtent   
CDB5 10FF0601         (       ddos2f.asm):02768                 STS     Temps1                  ; save old stack pointer
CDB9 3277             (       ddos2f.asm):02769                 LEAS    -GFFrameSize,S          ; make room for our stack frame
CDBB 6F64             (       ddos2f.asm):02770                 CLR     GFlag,S                 ; zero flags                    
CDBD BDD200           (       ddos2f.asm):02771                 JSR     >DosGetDiskGeometry     ; get disk geometry
CDC0 102600F4         (       ddos2f.asm):02772                 LBNE    GetFreeExtentExit       ; error, exit
                      (       ddos2f.asm):02773                 
CDC4 10AE84           (       ddos2f.asm):02774                 LDY     DrvDetDirLSN,X          ; get LSN of directory
CDC7 EEE811           (       ddos2f.asm):02775                 LDU     (ExtWant+GFFrameSize+2),S       ; get ammount we want (note +2 for PC)
CDCA EF65             (       ddos2f.asm):02776                 STU     TempLSN,S               ; save it in temp
CDCC 3041             (       ddos2f.asm):02777                 LEAX    1,U                     ; is requested LSN = $FFFF 
CDCE 270F             (       ddos2f.asm):02778                 BEQ     LCD5B                   ; yes, an use any block
                      (       ddos2f.asm):02779         
                      (       ddos2f.asm):02780         ; test to see if the supplied LSN is in use     
CDD0 8D3E             (       ddos2f.asm):02781                 BSR     GoGetBit                ; go get bitmap for requested LSN (U)
CDD2 2639             (       ddos2f.asm):02782                 BNE     GoFoundFree             ; branch if LSN not in use
                      (       ddos2f.asm):02783                 
CDD4 118305A0         (       ddos2f.asm):02784                 CMPU    #BAMLSNPerSec           ; LSN < 1440
CDD8 2505             (       ddos2f.asm):02785                 BCS     LCD5B                   ; yes, try stepping in
                      (       ddos2f.asm):02786                 
CDDA CE058E           (       ddos2f.asm):02787                 LDU     #1422                   ; Try this LSN (+ 1 track) next
CDDD 2021             (       ddos2f.asm):02788                 BRA     LCD7C                   ; else try stepping out
                      (       ddos2f.asm):02789         
CDDF 33A4             (       ddos2f.asm):02790         LCD5B   LEAU    ,Y                      ; U=LSN of directory
CDE1 86FF             (       ddos2f.asm):02791         LCD5D   LDA     #$FF                    ; flag GFTry invalid (-ve)
CDE3 A7E4             (       ddos2f.asm):02792                 STA     GFTry,S
                      (       ddos2f.asm):02793         
                      (       ddos2f.asm):02794         ; Try the start of each track until we find a free sector on two consecutive
                      (       ddos2f.asm):02795         ; tracks, or reach the beginning of the disk.
                      (       ddos2f.asm):02796                 
CDE5 33C8EE           (       ddos2f.asm):02797         LCD61   LEAU    -SecTrkSS,U             ; Decrement LSN by one complete track
CDE8 EF7E             (       ddos2f.asm):02798                 STU     -2,S                    ; TSTU :)
CDEA 2B0C             (       ddos2f.asm):02799                 BMI     LCD74                   ; branch if LSN < 0
                      (       ddos2f.asm):02800                         
CDEC 8D22             (       ddos2f.asm):02801                 BSR     GoGetBit                ; get bitmask for LSN
CDEE 27F1             (       ddos2f.asm):02802                 BEQ     LCD5D                   ; branch if LSN in use, try another
                      (       ddos2f.asm):02803                 
CDF0 6DE4             (       ddos2f.asm):02804                 TST     GFTry,S                 ; is GFtry valid?
CDF2 2A19             (       ddos2f.asm):02805                 BPL     GoFoundFree             ; yep we found a valid block    
                      (       ddos2f.asm):02806                 
CDF4 EFE4             (       ddos2f.asm):02807                 STU     GFTry,S                 ; save current sector, as current try
CDF6 20ED             (       ddos2f.asm):02808                 BRA     LCD61                   ; look on previous track
                      (       ddos2f.asm):02809         
CDF8 EEE4             (       ddos2f.asm):02810         LCD74   LDU     GFTry,S
CDFA EF7E             (       ddos2f.asm):02811                 STU     -2,S                    ; TSTU :)
CDFC 2A0F             (       ddos2f.asm):02812                 BPL     GoFoundFree             ; LSN for try is +ve, test it
                      (       ddos2f.asm):02813                 
CDFE 33A4             (       ddos2f.asm):02814                 LEAU    ,Y                      ; U=LSN of directory, try track after dir
                      (       ddos2f.asm):02815                 
CE00 33C812           (       ddos2f.asm):02816         LCD7C   LEAU    SecTrkSS,U              ; Increment LSN by one complete track
CE03 11830B40         (       ddos2f.asm):02817                 CMPU    #MaxLSN                 ; beyond max LSN?
CE07 220A             (       ddos2f.asm):02818                 BHI     LCD8F                   ; yes try next test
                      (       ddos2f.asm):02819                 
CE09 8D05             (       ddos2f.asm):02820                 BSR     GoGetBit                ; get bitmask for LSN
CE0B 27F3             (       ddos2f.asm):02821                 BEQ     LCD7C                   ; branch if LSN in use, try next track out
                      (       ddos2f.asm):02822         
CE0D                  (       ddos2f.asm):02823         GoFoundFree
CE0D 160082           (       ddos2f.asm):02824                 LBRA    FoundFree               ; we've found a free block, go use it
                      (       ddos2f.asm):02825         
CE10                  (       ddos2f.asm):02826         GoGetBit
CE10 1600AB           (       ddos2f.asm):02827                 LBRA    GetBit                  ; jump that alows us to short jump.....                 
                      (       ddos2f.asm):02828         
CE13 86FF             (       ddos2f.asm):02829         LCD8F   LDA     #$FF                    ; Temp  count = -1
CE15 A767             (       ddos2f.asm):02830                 STA     TempCount,S
                      (       ddos2f.asm):02831                 
CE17 A664             (       ddos2f.asm):02832                 LDA     GFlag,S                 ; get flag
CE19 DE8A             (       ddos2f.asm):02833         LCD95   LDU     <DBZero                 ; U = zero
CE1B 44               (       ddos2f.asm):02834                 LSRA                            ; bottom buffer?
CE1C 2503             (       ddos2f.asm):02835                 BCS     LCD9D                   ; yes.....
                      (       ddos2f.asm):02836                 
CE1E CE05A0           (       ddos2f.asm):02837                 LDU     #BAMLSNPerSec           ; no go get other buffer
CE21 8DED             (       ddos2f.asm):02838         LCD9D   BSR     GoGetBit
                      (       ddos2f.asm):02839         
CE23 C6B4             (       ddos2f.asm):02840                 LDB     #BAMEntriesSec          ; 180 BAM entries per sector....
CE25 A680             (       ddos2f.asm):02841         LCDA1   LDA     ,X+                     ; get next byte from BAM 
CE27 2607             (       ddos2f.asm):02842                 BNE     LCDAC                   ; branch if next 8 sectors all free
                      (       ddos2f.asm):02843                 
CE29 3348             (       ddos2f.asm):02844                 LEAU    8,U                     ; increment LSN by 8 (8 LSNs per BAM entry)
CE2B 5A               (       ddos2f.asm):02845                 DECB                            ; decrement entry counter
CE2C 26F7             (       ddos2f.asm):02846                 BNE     LCDA1                   ; look again if entry counter nonzero
CE2E 2041             (       ddos2f.asm):02847                 BRA     LCDED                   ; counter zero skip ahead
                      (       ddos2f.asm):02848         
                      (       ddos2f.asm):02849         ; look for the bigest block of free LSNs....
                      (       ddos2f.asm):02850         
CE30 5F               (       ddos2f.asm):02851         LCDAC   CLRB                            ; Zero BTCount
CE31 E768             (       ddos2f.asm):02852                 STB     BTCount,S
                      (       ddos2f.asm):02853                 
CE33 3440             (       ddos2f.asm):02854                 PSHS    U                       ; save LSN (stack offsets +2 because of push)
CE35 5C               (       ddos2f.asm):02855         LCDB1   INCB                            ; increment counter
CE36 A680             (       ddos2f.asm):02856                 LDA     ,X+                     ; get byte from BAM 
CE38 4C               (       ddos2f.asm):02857                 INCA                            ; is it $FF?
CE39 27FA             (       ddos2f.asm):02858                 BEQ     LCDB1                   ; yes occupied loop again
                      (       ddos2f.asm):02859                 
CE3B E16A             (       ddos2f.asm):02860                 CMPB    BTCount+2,S             ; biggest block found ? 
CE3D 2304             (       ddos2f.asm):02861                 BLS     LCDBF                   ; nope skip on
                      (       ddos2f.asm):02862                 
CE3F E76A             (       ddos2f.asm):02863                 STB     BTCount+2,S             ; Yes save it
CE41 EFE4             (       ddos2f.asm):02864                 STU     ,S                      ; update stacked LSN
                      (       ddos2f.asm):02865                 
CE43 301F             (       ddos2f.asm):02866         LCDBF   LEAX    -1,X                    ; back one byte in BAM
CE45 8608             (       ddos2f.asm):02867                 LDA     #SectorsPerBAM          ; multiply BAM byte counter by entries 
CE47 3D               (       ddos2f.asm):02868                 MUL                             ; per BAM byte
CE48 33CB             (       ddos2f.asm):02869                 LEAU    D,U                     ; point LSN at it
                      (       ddos2f.asm):02870                 
CE4A 5F               (       ddos2f.asm):02871         LCDC6   CLRB                            ; clear counter
CE4B A680             (       ddos2f.asm):02872                 LDA     ,X+                     ; get next BAM byte
CE4D 26E6             (       ddos2f.asm):02873                 BNE     LCDB1                   ; if not zero loop again
                      (       ddos2f.asm):02874                 
CE4F 3348             (       ddos2f.asm):02875                 LEAU    SectorsPerBAM,U         ; add group of 8 to LSN
CE51 1F10             (       ddos2f.asm):02876                 TFR     X,D                     ; test for end of BAM 
CE53 C1B4             (       ddos2f.asm):02877                 CMPB    #BAMEntriesSec
CE55 25F3             (       ddos2f.asm):02878                 BCS     LCDC6                   ; nope loop again
                      (       ddos2f.asm):02879                 
CE57 3540             (       ddos2f.asm):02880                 PULS    U                       ; restore LSN of biggest block
                      (       ddos2f.asm):02881                 
CE59 8D63             (       ddos2f.asm):02882                 BSR     GetBit                  ; get bitmap
CE5B 3348             (       ddos2f.asm):02883                 LEAU    SectorsPerBAM,U         ; move up 8 LSNs
CE5D A684             (       ddos2f.asm):02884                 LDA     ,X                      ; get byte of LSN
                      (       ddos2f.asm):02885                 
CE5F E668             (       ddos2f.asm):02886                 LDB     BTCount,S               ; get count
CE61 C101             (       ddos2f.asm):02887                 CMPB    #$01                    ; just 1 group of 8?
CE63 2205             (       ddos2f.asm):02888                 BHI     LCDE6                   ; branch if not....
                      (       ddos2f.asm):02889                 
CE65 335F             (       ddos2f.asm):02890         LCDE1   LEAU    -1,U                    ; Back up LSN.....                      
CE67 48               (       ddos2f.asm):02891                 ASLA                            ; shift bitmap
CE68 24FB             (       ddos2f.asm):02892                 BCC     LCDE1                   ; till we get correct LSN for bit...
                      (       ddos2f.asm):02893                 
CE6A 48               (       ddos2f.asm):02894         LCDE6   ASLA                            ; shift bitmap
CE6B 2404             (       ddos2f.asm):02895                 BCC     LCDED                   ; branch if beginning of bitmap byte?
CE6D 335F             (       ddos2f.asm):02896                 LEAU    -1,U                    ; back up LSN
CE6F 20F9             (       ddos2f.asm):02897                 BRA     LCDE6                   ; loop again
                      (       ddos2f.asm):02898         
CE71 C102             (       ddos2f.asm):02899         LCDED   CMPB    #$02                    ; 2 blocks of 8?        
CE73 241D             (       ddos2f.asm):02900                 BCC     FoundFree               ; yep, found enough
                      (       ddos2f.asm):02901                 
CE75 E167             (       ddos2f.asm):02902                 CMPB    TempCount,S             ; bigger than count
CE77 2219             (       ddos2f.asm):02903                 BHI     FoundFree               ; yep, found enough
                      (       ddos2f.asm):02904                 
CE79 A667             (       ddos2f.asm):02905                 LDA     TempCount,S             ; temp count = $FF
CE7B 4C               (       ddos2f.asm):02906                 INCA
CE7C 260A             (       ddos2f.asm):02907                 BNE     LCE04                   ; no....
                      (       ddos2f.asm):02908                 
CE7E E767             (       ddos2f.asm):02909                 STB     TempCount,S             ; save temp count
CE80 EF65             (       ddos2f.asm):02910                 STU     TempLSN,S               ; and temp LSN  
CE82 A664             (       ddos2f.asm):02911                 LDA     GFlag,S                 ; get GFlag
CE84 8803             (       ddos2f.asm):02912                 EORA    #$03                    ; flip bottom 2 bits
CE86 2091             (       ddos2f.asm):02913                 BRA     LCD95                   ; go look again.....
                      (       ddos2f.asm):02914         
CE88 EE65             (       ddos2f.asm):02915         LCE04   LDU     TempLSN,S               ; get TempLSN
CE8A 8D32             (       ddos2f.asm):02916                 BSR     GetBit                  ; go get it's bitmap entries
CE8C 2604             (       ddos2f.asm):02917                 BNE     FoundFree               ; got some, allocate it 
                      (       ddos2f.asm):02918                 
CE8E C694             (       ddos2f.asm):02919                 LDB     #ErrDF                  ; disk full 
CE90 2026             (       ddos2f.asm):02920                 BRA     GetFreeExtentExit       ; exit, cleaning up
                      (       ddos2f.asm):02921         
CE92                  (       ddos2f.asm):02922         FoundFree   
CE92 8D2A             (       ddos2f.asm):02923                 BSR     GetBit                  ; Get bitmap
CE94 5F               (       ddos2f.asm):02924                 CLRB                            ; sector count?
                      (       ddos2f.asm):02925                 
CE95 5C               (       ddos2f.asm):02926         LCE11   INCB
CE96 2717             (       ddos2f.asm):02927                 BEQ     LCE2B                   ; overflow?
                      (       ddos2f.asm):02928                 
                      (       ddos2f.asm):02929         ; this clears the bit in the BAM, reserving the block for the file        
CE98 3402             (       ddos2f.asm):02930                 PSHS    A                       ; save bitmask
CE9A 43               (       ddos2f.asm):02931                 COMA                            ; compliment, to get turn off mask
CE9B A484             (       ddos2f.asm):02932                 ANDA    ,X                      ; turn of bit
CE9D A784             (       ddos2f.asm):02933                 STA     ,X                      ; resave it
CE9F 3502             (       ddos2f.asm):02934                 PULS    A                       ; restore bitmask
                      (       ddos2f.asm):02935                 
CEA1 48               (       ddos2f.asm):02936                 ASLA                            ; shift bitmask left (try next block)
CEA2 2404             (       ddos2f.asm):02937                 BCC     LCE24                   ; branch if all bits done
                      (       ddos2f.asm):02938                 
CEA4 8601             (       ddos2f.asm):02939                 LDA     #$01                    ; re-initialize mask    
CEA6 3001             (       ddos2f.asm):02940                 LEAX    1,X                     ; get next group of blocks' bits from BAM
CEA8 A584             (       ddos2f.asm):02941         LCE24   BITA    ,X                      ; is sector in use ?
CEAA 26E9             (       ddos2f.asm):02942                 BNE     LCE11                   ; no reserve it
CEAC 1F98             (       ddos2f.asm):02943                 TFR     B,A                     ; yes, get sector count in A
                      (       ddos2f.asm):02944                 
CEAE 8C               (       ddos2f.asm):02945                 FCB     Skip2
CEAF 86FF             (       ddos2f.asm):02946         LCE2B   LDA     #$FF                    ; 
CEB1 AE62             (       ddos2f.asm):02947                 LDX     GFPointBuff,S           ; get disk buffer entry pointer
CEB3 C6FF             (       ddos2f.asm):02948                 LDB     #BuffDirty              ; make buffer dirty so it will be re-written
CEB5 E702             (       ddos2f.asm):02949                 STB     BuffFlag,X
CEB7 5F               (       ddos2f.asm):02950                 CLRB                            ; flag no error
                      (       ddos2f.asm):02951                 
CEB8                  (       ddos2f.asm):02952         GetFreeExtentExit   
CEB8 10FE0601         (       ddos2f.asm):02953                 LDS     Temps1                  ; restore saved stack pointer
CEBC 5D               (       ddos2f.asm):02954                 TSTB                            ; test B, set CC.C on error
CEBD 39               (       ddos2f.asm):02955                 RTS                             ; return to caller
                      (       ddos2f.asm):02956         ;
                      (       ddos2f.asm):02957         ; Get byte and bitmask for LSN
                      (       ddos2f.asm):02958         ;
                      (       ddos2f.asm):02959         ; The appropreate sector is read if not already in memory.
                      (       ddos2f.asm):02960         ;
                      (       ddos2f.asm):02961         ; On error returns to the calling program....
                      (       ddos2f.asm):02962         ;
                      (       ddos2f.asm):02963         ; Entry:
                      (       ddos2f.asm):02964         ;       U       = LSN
                      (       ddos2f.asm):02965         ;       Y       = Directory LSN
                      (       ddos2f.asm):02966         ;
                      (       ddos2f.asm):02967         ; Returns:
                      (       ddos2f.asm):02968         ;       A       = bitmask
                      (       ddos2f.asm):02969         ;       X       = byte within table
                      (       ddos2f.asm):02970         ;       U,Y     = preserved.
                      (       ddos2f.asm):02971         ;
                      (       ddos2f.asm):02972         ; It is important to note that within the BAM a 1 bit represents a free
                      (       ddos2f.asm):02973         ; sector and a 0 bit represents a used sector.
                      (       ddos2f.asm):02974         ; The BAM is also split over the first two sectors of the directory track
                      (       ddos2f.asm):02975         ; such that the first 1440 LSNs are in bytes 0..179 of sector 1
                      (       ddos2f.asm):02976         ; and the second 1440 sectors are in bytes 0..179 of the second sector.
                      (       ddos2f.asm):02977         ;
                      (       ddos2f.asm):02978         
CEBE 3460             (       ddos2f.asm):02979         GetBit  PSHS    Y,U                     ; save regs
CEC0 8601             (       ddos2f.asm):02980                 LDA     #$01                    ; bit for 1st sector
CEC2 118305A0         (       ddos2f.asm):02981                 CMPU    #BAMLSNPerSec           ; LSN in first table?
CEC6 2507             (       ddos2f.asm):02982                 BCS     LCE4B                   ; yes, skip ahead
                      (       ddos2f.asm):02983                 
CEC8 3121             (       ddos2f.asm):02984                 LEAY    1,Y                     ; point to next table
CECA 33C9FA60         (       ddos2f.asm):02985                 LEAU    -BAMLSNPerSec,U         ; decrement U to get offset in second table
CECE 48               (       ddos2f.asm):02986                 ASLA                            ; bit for second sector
                      (       ddos2f.asm):02987                 
CECF 3440             (       ddos2f.asm):02988         LCE4B   PSHS    U                       ; save LSN required
CED1 A56C             (       ddos2f.asm):02989                 BITA    GFlag+8,S               ; Already free?
CED3 260D             (       ddos2f.asm):02990                 BNE     LCE5E                   ; yes.....
                      (       ddos2f.asm):02991                 
CED5 A76C             (       ddos2f.asm):02992                 STA     GFlag+8,S               ; save it
CED7 BDD2CA           (       ddos2f.asm):02993                 JSR     >DOSFindAndRead         ; read LSN (Y), buffer entry ptr returned in X
CEDA 26DC             (       ddos2f.asm):02994                 BNE     GetFreeExtentExit                       ; error exit
                      (       ddos2f.asm):02995                 
CEDC AF6A             (       ddos2f.asm):02996                 STX     GFPointBuff+8,S         ; store disk buffer entry pointer
CEDE 86FF             (       ddos2f.asm):02997                 LDA     #BuffDirty              ; mark buffer dirty
CEE0 A702             (       ddos2f.asm):02998                 STA     BuffFlag,X              
                      (       ddos2f.asm):02999         
CEE2 AE6A             (       ddos2f.asm):03000         LCE5E   LDX     GFPointBuff+8,S         ; get disk buffer entry pointer
CEE4 AE05             (       ddos2f.asm):03001                 LDX     BuffAddr,X              ; get address of data
CEE6 3506             (       ddos2f.asm):03002                 PULS    D                       ; recover required LSN
                      (       ddos2f.asm):03003                 
CEE8 44               (       ddos2f.asm):03004                 LSRA                            ; D=D/8, get LSN bit and byte offset in BAM.
CEE9 56               (       ddos2f.asm):03005                 RORB
CEEA 44               (       ddos2f.asm):03006                 LSRA
CEEB 56               (       ddos2f.asm):03007                 RORB
CEEC 44               (       ddos2f.asm):03008                 LSRA
CEED 56               (       ddos2f.asm):03009                 RORB
                      (       ddos2f.asm):03010                 
CEEE A663             (       ddos2f.asm):03011                 LDA     3,S                     ; get LSB of required LSN
CEF0 8407             (       ddos2f.asm):03012                 ANDA    #$07                    ; mask off bottom 3 bits
CEF2 CEA672           (       ddos2f.asm):03013                 LDU     #DPixMaskTable4Col-1    ; convenient no->bitmask table....                              
CEF5 40               (       ddos2f.asm):03014                 NEGA                            ; negate A
CEF6 A6C6             (       ddos2f.asm):03015                 LDA     A,U                     ; get bit from table
CEF8 3A               (       ddos2f.asm):03016                 ABX                             ; lookup byte in BAM
CEF9 A584             (       ddos2f.asm):03017                 BITA    ,X                      ; extract it
CEFB 35E0             (       ddos2f.asm):03018                 PULS    Y,U,PC                  ; restore and return
                      (       ddos2f.asm):03019         
                      (       ddos2f.asm):03020         ;
                      (       ddos2f.asm):03021         ; Get a file length.
                      (       ddos2f.asm):03022         ;
                      (       ddos2f.asm):03023         ; Entry :
                      (       ddos2f.asm):03024         ;       A       = FCB no.
                      (       ddos2f.asm):03025         ;
                      (       ddos2f.asm):03026         ; Exit :
                      (       ddos2f.asm):03027         ;       U:A     = length of file 
                      (       ddos2f.asm):03028         ;       B       = Error code
                      (       ddos2f.asm):03029         ;
                      (       ddos2f.asm):03030         
                      (       ddos2f.asm):03031         
CEFD                  (       ddos2f.asm):03032         DOSGetFLen   
CEFD 97F1             (       ddos2f.asm):03033                 STA     <DosCurrCtrlBlk         ; save FCB no
CEFF 8D2F             (       ddos2f.asm):03034                 BSR     DosFCBNoToAddr          ; get address of FCB
CF01 6D0F             (       ddos2f.asm):03035                 TST     FCBDirFlags,X           ; get dir flags from FCB
CF03 2A03             (       ddos2f.asm):03036                 BPL     LCE84                   ; ok skip
                      (       ddos2f.asm):03037                 
CF05 C69C             (       ddos2f.asm):03038                 LDB     #ErrFF          ; error : file not found
                      (       ddos2f.asm):03039                 
CF07 39               (       ddos2f.asm):03040         LCE83   RTS
                      (       ddos2f.asm):03041         
CF08 A68812           (       ddos2f.asm):03042         LCE84   LDA     FCBFileLen+2,X          ; number of extra bytes in last sector          
CF0B EE8810           (       ddos2f.asm):03043                 LDU     FCBFileLen,X            ; number of sectors
CF0E 3141             (       ddos2f.asm):03044                 LEAY    1,U                     
CF10 261C             (       ddos2f.asm):03045                 BNE     LCEAA
                      (       ddos2f.asm):03046         
                      (       ddos2f.asm):03047         ; Note U must still be $FFFF here so that FindFSNinU won't stop too soon.
                      (       ddos2f.asm):03048                 
CF12 BDCB7E           (       ddos2f.asm):03049                 JSR     >FindFSNinU             ; Go find File sector no in U
CF15 26F0             (       ddos2f.asm):03050                 BNE     LCE83
                      (       ddos2f.asm):03051                 
CF17 F60682           (       ddos2f.asm):03052                 LDB     DosCurFileNo            ; get file number
CF1A E7881E           (       ddos2f.asm):03053                 STB     FCBDirNoLast,X          ; save in FCB
                      (       ddos2f.asm):03054                 
CF1D A6C818           (       ddos2f.asm):03055         LCE99   LDA     DirEntLastBytes,U       ; get bytes in last sector
CF20 A78812           (       ddos2f.asm):03056                 STA     FCBFileLen+2,X          ; add to file length
CF23 FE066B           (       ddos2f.asm):03057                 LDU     DosTotalSFound
CF26 4D               (       ddos2f.asm):03058                 TSTA                            ; 0 bytes in last sector ?
CF27 2702             (       ddos2f.asm):03059                 BEQ     LCEA7                   ; yep skip ahead
                      (       ddos2f.asm):03060                 
CF29 335F             (       ddos2f.asm):03061                 LEAU    -1,U                    ; decrement total sectors found
CF2B EF8810           (       ddos2f.asm):03062         LCEA7   STU     FCBFileLen,X            ; set file len
CF2E 5F               (       ddos2f.asm):03063         LCEAA   CLRB                            ; no error
CF2F 39               (       ddos2f.asm):03064         LCEAB   RTS
                      (       ddos2f.asm):03065         
                      (       ddos2f.asm):03066         ;
                      (       ddos2f.asm):03067         ; Convert an FCB number to it's address.
                      (       ddos2f.asm):03068         ;
                      (       ddos2f.asm):03069         ; Entry :
                      (       ddos2f.asm):03070         ;       A       = FCB number 0..9
                      (       ddos2f.asm):03071         ;
                      (       ddos2f.asm):03072         ; Exit :
                      (       ddos2f.asm):03073         ;       X       = address of FCB
                      (       ddos2f.asm):03074         ;       D,U,Y   = preserved
                      (       ddos2f.asm):03075         ;
                      (       ddos2f.asm):03076         
CF30                  (       ddos2f.asm):03077         DosFCBNoToAddr   
CF30 3406             (       ddos2f.asm):03078                 PSHS    D
CF32 96F1             (       ddos2f.asm):03079                 LDA     <DosCurrCtrlBlk         ; get current FCB
CF34 C61F             (       ddos2f.asm):03080                 LDB     #DosFCBLength           ; work out offset into table
CF36 3D               (       ddos2f.asm):03081                 MUL
CF37 1F01             (       ddos2f.asm):03082                 TFR     D,X                     ; get offset into X
CF39 308906BD         (       ddos2f.asm):03083                 LEAX    DosFCB0Addr,X           ; work out address of FCB
CF3D 3586             (       ddos2f.asm):03084                 PULS    D,PC
                      (       ddos2f.asm):03085         
                      (       ddos2f.asm):03086         ;
                      (       ddos2f.asm):03087         ; Close All open files and clean up buffers for one drive.
                      (       ddos2f.asm):03088         ;
                      (       ddos2f.asm):03089         ; This should be called four times when basic returns to the "OK" 
                      (       ddos2f.asm):03090         ; prompt.
                      (       ddos2f.asm):03091         ;
                      (       ddos2f.asm):03092         ; Note: only closes files on the current disk (in DosDriveNo).
                      (       ddos2f.asm):03093         ;
                      (       ddos2f.asm):03094         ; Entry:
                      (       ddos2f.asm):03095         ;
                      (       ddos2f.asm):03096         ;       DosDriveNo      = drive no to close files on.
                      (       ddos2f.asm):03097         ;
                      (       ddos2f.asm):03098         ; Returns:
                      (       ddos2f.asm):03099         ;       B               = Error code.
                      (       ddos2f.asm):03100         ;
                      (       ddos2f.asm):03101         
CF3F                  (       ddos2f.asm):03102         DOSCloseAll   
CF3F 860A             (       ddos2f.asm):03103                 LDA     #DosNumFCBs             ; do all FCBs
CF41 97F1             (       ddos2f.asm):03104                 STA     <DosCurrCtrlBlk         ; set current FCB no
                      (       ddos2f.asm):03105                 
CF43 8DEB             (       ddos2f.asm):03106         LCEBF   BSR     DosFCBNoToAddr          ; Get FCB address
CF45 A60B             (       ddos2f.asm):03107                 LDA     FCBDrive,X              ; get drive from FCB 
CF47 91EB             (       ddos2f.asm):03108                 CMPA    <DosDriveNo             ; same as current drive ?
CF49 2604             (       ddos2f.asm):03109                 BNE     LCECB                   ; nope skip on
                      (       ddos2f.asm):03110                 
CF4B 8D0A             (       ddos2f.asm):03111                 BSR     DosCloseFile2           ; close the file
CF4D 26B8             (       ddos2f.asm):03112                 BNE     LCE83                   ; error : exit
                      (       ddos2f.asm):03113         
CF4F 0AF1             (       ddos2f.asm):03114         LCECB   DEC     <DosCurrCtrlBlk         ; do next block
CF51 2AF0             (       ddos2f.asm):03115                 BPL     LCEBF                   ; if more loop again
CF53 5F               (       ddos2f.asm):03116         LCECF   CLRB
CF54 39               (       ddos2f.asm):03117                 RTS
                      (       ddos2f.asm):03118         
                      (       ddos2f.asm):03119         ;
                      (       ddos2f.asm):03120         ; Close a single file.
                      (       ddos2f.asm):03121         ;
                      (       ddos2f.asm):03122         ; Entry:
                      (       ddos2f.asm):03123         ;       A       = FCB no to close.
                      (       ddos2f.asm):03124         ;
                      (       ddos2f.asm):03125         ; Exit:
                      (       ddos2f.asm):03126         ;       B       = Error code.
                      (       ddos2f.asm):03127         ;
                      (       ddos2f.asm):03128         ; If this was the last file open for that drive, it will call cleanup for all
                      (       ddos2f.asm):03129         ; pages associated with that drive, and then invalidate them. The directory
                      (       ddos2f.asm):03130         ; track for that drive is then backed up.
                      (       ddos2f.asm):03131         ;
                      (       ddos2f.asm):03132         
CF55                  (       ddos2f.asm):03133         DOSCloseFile   
CF55 97F1             (       ddos2f.asm):03134                 STA     <DosCurrCtrlBlk         ; set current FCB no
                      (       ddos2f.asm):03135         
CF57                  (       ddos2f.asm):03136         DosCloseFile2   
CF57 8DD7             (       ddos2f.asm):03137                 BSR     DosFCBNoToAddr          ; Get FCB address
CF59 6D84             (       ddos2f.asm):03138                 TST     ,X                      ; is first character of filename zero ?
CF5B 27F6             (       ddos2f.asm):03139                 BEQ     LCECF                   ; yes : return
                      (       ddos2f.asm):03140                 
CF5D 96EB             (       ddos2f.asm):03141                 LDA     <DosDriveNo             ; save current drive on stack
CF5F 3402             (       ddos2f.asm):03142                 PSHS    A
CF61 A60B             (       ddos2f.asm):03143                 LDA     FCBDrive,X              ; get drive from FCB 
CF63 97EB             (       ddos2f.asm):03144                 STA     <DosDriveNo             ; make it current
CF65 6F84             (       ddos2f.asm):03145                 CLR     ,X                      ; zero out first char of filename 
                      (       ddos2f.asm):03146                 
CF67 BDD200           (       ddos2f.asm):03147                 JSR     >DosGetDiskGeometry     ; get disk geometry
CF6A 2626             (       ddos2f.asm):03148                 BNE     DOSCloseFileExit                        ; error : exit
                      (       ddos2f.asm):03149                 
CF6C 6D05             (       ddos2f.asm):03150                 TST     DrvDetUseCnt,X          ; Number of files in use on this drive
CF6E 2707             (       ddos2f.asm):03151                 BEQ     LCEF3                   ; branch if zero
                      (       ddos2f.asm):03152                 
CF70 6A05             (       ddos2f.asm):03153                 DEC     DrvDetUseCnt,X          ; else decrement file in use count
CF72 2703             (       ddos2f.asm):03154                 BEQ     LCEF3                   ; again test for zero
                      (       ddos2f.asm):03155                 
CF74 5F               (       ddos2f.asm):03156                 CLRB                            ; flag no error
CF75 201B             (       ddos2f.asm):03157                 BRA     DOSCloseFileExit        ; and exit
                      (       ddos2f.asm):03158         
                      (       ddos2f.asm):03159         ; clean up the drive
CF77 E602             (       ddos2f.asm):03160         LCEF3   LDB     DrvDetFreeLen,X         ; get free length byte
CF79 270D             (       ddos2f.asm):03161                 BEQ     LCF04                   ; branch if zero
                      (       ddos2f.asm):03162                 
CF7B 3410             (       ddos2f.asm):03163                 PSHS    X                       ; save buffer ptr
CF7D AE03             (       ddos2f.asm):03164                 LDX     DrvDetFreeEPtr,X        ; get free extent pointer
CF7F BDD096           (       ddos2f.asm):03165                 JSR     >DeleteExtent           ; and delete it
                      (       ddos2f.asm):03166                 
CF82 3510             (       ddos2f.asm):03167                 PULS    X                       ; recover buffer ptr
CF84 260C             (       ddos2f.asm):03168                 BNE     DOSCloseFileExit        ; branch if error
                      (       ddos2f.asm):03169                 
CF86 6F02             (       ddos2f.asm):03170                 CLR     DrvDetFreeLen,X         ; free length byte
CF88 BDC7BB           (       ddos2f.asm):03171         LCF04   JSR     >DOSSyncDir             ; Syncronise directory tracks
                      (       ddos2f.asm):03172                 
                      (       ddos2f.asm):03173         ; Invalidate drive table so user can swap disks now.    
CF8B CE0696           (       ddos2f.asm):03174                 LDU     #DosD0Online-1          ; point to drive online table
CF8E 96EB             (       ddos2f.asm):03175                 LDA     <DosDriveNo             ; mark FCB's drive as inactive
CF90 6FC6             (       ddos2f.asm):03176                 CLR     A,U
                      (       ddos2f.asm):03177                 
CF92                  (       ddos2f.asm):03178         DOSCloseFileExit   
CF92 3502             (       ddos2f.asm):03179                 PULS    A                       ; recover acive drive at call
CF94 97EB             (       ddos2f.asm):03180                 STA     <DosDriveNo             ; restore it
CF96 5D               (       ddos2f.asm):03181                 TSTB                            ; set flags for error
CF97 39               (       ddos2f.asm):03182         LCF13   RTS
                      (       ddos2f.asm):03183         
                      (       ddos2f.asm):03184         ;
                      (       ddos2f.asm):03185         ; Create a file.
                      (       ddos2f.asm):03186         ;
                      (       ddos2f.asm):03187         ; If a file exists with the supplied name, is is renamed with a ".BAK" extension.
                      (       ddos2f.asm):03188         ; If there is already a ".BAK" file then it is first deleted.
                      (       ddos2f.asm):03189         ; DOSRCreateFile is called for the real creation.
                      (       ddos2f.asm):03190         ;
                      (       ddos2f.asm):03191         ; Entry:        
                      (       ddos2f.asm):03192         ;       A       = File number
                      (       ddos2f.asm):03193         ;
                      (       ddos2f.asm):03194         ; Exit:
                      (       ddos2f.asm):03195         ;       B       = Error code
                      (       ddos2f.asm):03196         ;
                      (       ddos2f.asm):03197         
CF98                  (       ddos2f.asm):03198         DOSCreateFile   
CF98 B7067D           (       ddos2f.asm):03199                 STA     DosTempFCBNo            ; save file number
CF9B BDCF30           (       ddos2f.asm):03200                 JSR     >DosFCBNoToAddr         ; get file's address
CF9E BF0678           (       ddos2f.asm):03201                 STX     DosSaveFCB              ; save it's FCB address
                      (       ddos2f.asm):03202                 
CFA1 C60C             (       ddos2f.asm):03203                 LDB     #8+3+1                  ; Length of name,extension,drive
CFA3 CE0650           (       ddos2f.asm):03204                 LDU     #DosCurDriveInfo        ; point at current drive info
CFA6 A680             (       ddos2f.asm):03205         LCF22   LDA     ,X+                     ; get a byte from FCB
CFA8 A7C0             (       ddos2f.asm):03206                 STA     ,U+                     ; save in current drive info
CFAA 5A               (       ddos2f.asm):03207                 DECB                            ; decrement count
CFAB 26F9             (       ddos2f.asm):03208                 BNE     LCF22                   ; loop if more to do
                      (       ddos2f.asm):03209                 
CFAD EC5C             (       ddos2f.asm):03210                 LDD     -4,U                    ; get and save current extension
CFAF FD067A           (       ddos2f.asm):03211                 STD     DosSaveExt
CFB2 A65E             (       ddos2f.asm):03212                 LDA     -2,U
CFB4 B7067C           (       ddos2f.asm):03213                 STA     DosSaveExt+2
                      (       ddos2f.asm):03214                 
CFB7 CC4241           (       ddos2f.asm):03215                 LDD     #"BA"                   ; set current extension to "BAK"
CFBA ED5C             (       ddos2f.asm):03216                 STD     -4,U
CFBC 864B             (       ddos2f.asm):03217                 LDA     #'K'
CFBE A75E             (       ddos2f.asm):03218                 STA     -2,U
                      (       ddos2f.asm):03219                 
                      (       ddos2f.asm):03220                 ifdef   PGSFix
                      (       ddos2f.asm):03221                 TST     3,X
                      (       ddos2f.asm):03222                 else
CFC0 6D0F             (       ddos2f.asm):03223                 TST     FCBDirFlags,X           ; test flags, this is incorrect as X no longer 
                      (       ddos2f.asm):03224                                                 ; points at head of FCB!
                      (       ddos2f.asm):03225                 endc
                      (       ddos2f.asm):03226                 
CFC2 2B29             (       ddos2f.asm):03227                 BMI     LCF69                   ; flags minus....brnach :)
                      (       ddos2f.asm):03228                 
CFC4 BDC906           (       ddos2f.asm):03229                 JSR     >DOSOpenFile            ; Try opening 'FILENAME.BAK'
CFC7 C1A0             (       ddos2f.asm):03230                 CMPB    #ErrNE                  ; test if we got file doesn't exist error? 
                      (       ddos2f.asm):03231                 
                      (       ddos2f.asm):03232                 ifdef   PGSFix
                      (       ddos2f.asm):03233                 BEQ     LCF51                   ; correct place to go
                      (       ddos2f.asm):03234                 else
CFC9 2708             (       ddos2f.asm):03235                 BEQ     LCF4F                   ; DDv1 goes here
                      (       ddos2f.asm):03236                 endc
                      (       ddos2f.asm):03237                 
CFCB 5D               (       ddos2f.asm):03238                 TSTB                            ; test for error
CFCC 26C9             (       ddos2f.asm):03239                 BNE     LCF13                   ; if error return
                      (       ddos2f.asm):03240                 
CFCE BDD03A           (       ddos2f.asm):03241                 JSR     >DOSDeleteFile          ; else delete the current BAK file
CFD1 26C4             (       ddos2f.asm):03242                 BNE     LCF13                   ; if error return
                      (       ddos2f.asm):03243                 
                      (       ddos2f.asm):03244                 ifdef   PGSFix
CFD3                  (       ddos2f.asm):03245         LCF4F   leax    12,x                    ; Move FCB pointer forward
CFD3                  (       ddos2f.asm):03246         LCF51   clr     -12,x                   ; clear first char of filename
                      (       ddos2f.asm):03247                 JSR     LDFCA
                      (       ddos2f.asm):03248                 BEQ     LCF69
                      (       ddos2f.asm):03249                 else
CFD3 6D9F0678         (       ddos2f.asm):03250         LCF4F   TST     [DosSaveFCB]            ; test first character of filename
CFD7 2714             (       ddos2f.asm):03251                 BEQ     LCF69                   ; zero skip on
CFD9 B6067D           (       ddos2f.asm):03252                 LDA     DosTempFCBNo            ; get original fileno
                      (       ddos2f.asm):03253                 endc
                      (       ddos2f.asm):03254                 
CFDC BDD152           (       ddos2f.asm):03255                 JSR     >DOSRename              ; rename original file to bak.
CFDF 2704             (       ddos2f.asm):03256                 BEQ     LCF61                   ; no error, branch on
                      (       ddos2f.asm):03257                 
CFE1 C19C             (       ddos2f.asm):03258                 CMPB    #ErrFF                  ; is it ?? error !!!!
CFE3 26B2             (       ddos2f.asm):03259                 BNE     LCF13                   ; no : exit
                      (       ddos2f.asm):03260         
CFE5 B6067D           (       ddos2f.asm):03261         LCF61   LDA     DosTempFCBNo            ; get temp fileno
CFE8 BDCF55           (       ddos2f.asm):03262                 JSR     >DOSCloseFile           ; close the file
CFEB 26AA             (       ddos2f.asm):03263                 BNE     LCF13                   ; error, exit
                      (       ddos2f.asm):03264                 
CFED FC067A           (       ddos2f.asm):03265         LCF69   LDD     DosSaveExt              ; restore original extension
CFF0 FD0658           (       ddos2f.asm):03266                 STD     DosCurExtension
CFF3 B6067C           (       ddos2f.asm):03267                 LDA     DosSaveExt+2
CFF6 B7065A           (       ddos2f.asm):03268                 STA     DosCurExtension+2
                      (       ddos2f.asm):03269                 
CFF9 BDC906           (       ddos2f.asm):03270                 JSR     >DOSOpenFile            ; try opening file
CFFC 2704             (       ddos2f.asm):03271                 BEQ     DOSRawCreate            ; no error, skip
                      (       ddos2f.asm):03272                 
CFFE C1A0             (       ddos2f.asm):03273                 CMPB    #ErrNE                  ; is it file does not exist error?
D000 2695             (       ddos2f.asm):03274                 BNE     LCF13                   ; no, exit
                      (       ddos2f.asm):03275                 
                      (       ddos2f.asm):03276         ;
                      (       ddos2f.asm):03277         ; Raw create
                      (       ddos2f.asm):03278         ;
                      (       ddos2f.asm):03279         ; Entry:
                      (       ddos2f.asm):03280         ;       A       = file no
                      (       ddos2f.asm):03281         ;
                      (       ddos2f.asm):03282         ; Exit:
                      (       ddos2f.asm):03283         ;       B       = Error code
                      (       ddos2f.asm):03284         ;
                      (       ddos2f.asm):03285         ;       
                      (       ddos2f.asm):03286                 
D002                  (       ddos2f.asm):03287         DOSRawCreate   
D002 97F1             (       ddos2f.asm):03288                 STA     <DosCurrCtrlBlk         ; save fileno as current
D004 BDCF30           (       ddos2f.asm):03289                 JSR     >DosFCBNoToAddr         ; get it's FCB address
                      (       ddos2f.asm):03290                 
D007 6D0F             (       ddos2f.asm):03291                 TST     FCBDirFlags,X           ; test FCB's flags
D009 2B03             (       ddos2f.asm):03292                 BMI     LCF8A                   ; 
                      (       ddos2f.asm):03293                  
D00B C69E             (       ddos2f.asm):03294                 LDB     #ErrFE                  ; flag file exists.....
D00D 39               (       ddos2f.asm):03295         LCF89   RTS
                      (       ddos2f.asm):03296         
D00E 4F               (       ddos2f.asm):03297         LCF8A   CLRA                            ; clear, flag normal filename block wanted
D00F BDD17F           (       ddos2f.asm):03298                 JSR     >FindEmptyDir           ; find an empty filename block in directory 
D012 26F9             (       ddos2f.asm):03299                 BNE     LCF89                   ; error, exit
                      (       ddos2f.asm):03300                 
D014 BDCF30           (       ddos2f.asm):03301                 JSR     >DosFCBNoToAddr         ; get address of FCB
D017 A7881D           (       ddos2f.asm):03302                 STA     FCBDiskFileNo,X         ; save filenumber in FCB
D01A A7881E           (       ddos2f.asm):03303                 STA     FCBDirNoLast,X
                      (       ddos2f.asm):03304                 
                      (       ddos2f.asm):03305         ;clear out FCB extents  
D01D C61C             (       ddos2f.asm):03306                 LDB     #FCBSecExtent2          ; point to end of second FCB extent
D01F 6F85             (       ddos2f.asm):03307         LCF9B   CLR     B,X                     ; clear a byte  
D021 5A               (       ddos2f.asm):03308                 DECB                            ; decrement offset
D022 C10C             (       ddos2f.asm):03309                 CMPB    #FCBFilePointer         ; reached FCB file pointer
D024 24F9             (       ddos2f.asm):03310                 BCC     LCF9B                   ; nope, loop again
                      (       ddos2f.asm):03311                 
D026 C618             (       ddos2f.asm):03312                 LDB     #DirEntryLen-1          ; clear bytes in DIR entry
D028 6FC5             (       ddos2f.asm):03313         LCFA4   CLR     B,U                     ; clear a byte
                      (       ddos2f.asm):03314         
D02A                  (       ddos2f.asm):03315         CmdRenameMC
D02A 5A               (       ddos2f.asm):03316                 DECB                            ; decrement count       
D02B 2AFB             (       ddos2f.asm):03317                 BPL     LCFA4                   ; keep going until all done
                      (       ddos2f.asm):03318                 
D02D 3341             (       ddos2f.asm):03319                 LEAU    DirEntFilename,U        ; point at dir entry filename
D02F C60B             (       ddos2f.asm):03320                 LDB     #8+3                    ; length of filename + ext
D031 A680             (       ddos2f.asm):03321         LCFAD   LDA     ,X+                     ; get a byte from FCB
D033 A7C0             (       ddos2f.asm):03322                 STA     ,U+                     ; put in dir entry
D035 5A               (       ddos2f.asm):03323                 DECB                            ; decrement count
D036 26F9             (       ddos2f.asm):03324                 BNE     LCFAD                   ; loop if not all done
                      (       ddos2f.asm):03325                 
D038 5F               (       ddos2f.asm):03326                 CLRB                            ; flag no error
D039 39               (       ddos2f.asm):03327         LCFB5   RTS                             ; return
                      (       ddos2f.asm):03328         
                      (       ddos2f.asm):03329         ;
                      (       ddos2f.asm):03330         ; Delete a file from disk.
                      (       ddos2f.asm):03331         ;
                      (       ddos2f.asm):03332         ; Entry:
                      (       ddos2f.asm):03333         ;       A       = filenumber
                      (       ddos2f.asm):03334         ;
                      (       ddos2f.asm):03335         ; Exit:
                      (       ddos2f.asm):03336         ;       B       = Error code
                      (       ddos2f.asm):03337         ;
                      (       ddos2f.asm):03338         
D03A                  (       ddos2f.asm):03339         DOSDeleteFile   
D03A BDD13F           (       ddos2f.asm):03340                 JSR     >DosCheckProtect        ; check file protection
D03D 26CE             (       ddos2f.asm):03341                 BNE     LCF89                   ; error, return
                      (       ddos2f.asm):03342                 
D03F 3410             (       ddos2f.asm):03343                 PSHS    X                       ; save FCB pointer
D041 E6881D           (       ddos2f.asm):03344                 LDB     FCBDiskFileNo,X         ; get disk file  number
D044 BDD28B           (       ddos2f.asm):03345                 JSR     >DOSGetDirEntry2        ; Get dir entry 
D047 2647             (       ddos2f.asm):03346                 BNE     LD00C                   ; error, cleanup and exit
                      (       ddos2f.asm):03347                 
D049 1F13             (       ddos2f.asm):03348                 TFR     X,U                     ; save dir entry pointer in U
D04B 3510             (       ddos2f.asm):03349                 PULS    X                       ; restore FCB pointer
                      (       ddos2f.asm):03350                 
D04D 314C             (       ddos2f.asm):03351                 LEAY    DirEntFnBlock1,U        ; point Y to first allocation block     
D04F C604             (       ddos2f.asm):03352                 LDB     #$04
D051 A6C4             (       ddos2f.asm):03353         LCFCD   LDA     DirEntAttr,U            ; get attributes from directory entry
D053 8420             (       ddos2f.asm):03354                 ANDA    #AttrContinued          ; is this a continuation block?
D055 2703             (       ddos2f.asm):03355                 BEQ     LCFD6
                      (       ddos2f.asm):03356                 
D057 A6C818           (       ddos2f.asm):03357                 LDA     DirEntFlag,U            ; get block no of continuation entries
D05A 3406             (       ddos2f.asm):03358         LCFD6   PSHS    D                       ; save D
D05C C681             (       ddos2f.asm):03359                 LDB     #AttrAfterDel           ; invalidate block
D05E E7C4             (       ddos2f.asm):03360                 STB     ,U
                      (       ddos2f.asm):03361                 
D060 3410             (       ddos2f.asm):03362                 PSHS    X                       ; save FCB pointer
                      (       ddos2f.asm):03363                 
D062 AEA1             (       ddos2f.asm):03364         LCFDE   LDX     ,Y++                    ; get allocation LSN
D064 E6A0             (       ddos2f.asm):03365                 LDB     ,Y+                     ; get allocation sector count
D066 270A             (       ddos2f.asm):03366                 BEQ     LCFEE                   ; branch if zero sectors, end of allocations
                      (       ddos2f.asm):03367                 
D068 3420             (       ddos2f.asm):03368                 PSHS    Y                       ; save allocation entry pointer
D06A 8D2A             (       ddos2f.asm):03369                 BSR     DeleteExtent            ; delete the extent
D06C 3520             (       ddos2f.asm):03370                 PULS    Y                       ; restore allocation entry pointer
D06E 1026FA07         (       ddos2f.asm):03371                 LBNE    DosFReadErrorExit       ; cleanup and exit if error
                      (       ddos2f.asm):03372                 
D072 6A63             (       ddos2f.asm):03373         LCFEE   DEC     3,S                     ; decrement entry count
D074 26EC             (       ddos2f.asm):03374                 BNE     LCFDE                   ; loop again if more entries in this dir block
                      (       ddos2f.asm):03375                 
D076 3510             (       ddos2f.asm):03376                 PULS    X                       ; restore FCB pointer
D078 E6E4             (       ddos2f.asm):03377                 LDB     ,S                      ; get more extents flag
D07A 2713             (       ddos2f.asm):03378                 BEQ     LD00B                   ; exit if no more extents
                      (       ddos2f.asm):03379                 
D07C 3262             (       ddos2f.asm):03380                 LEAS    2,S                     ; drop counter and flags
D07E 3410             (       ddos2f.asm):03381                 PSHS    X                       ; save FCB pointer
D080 BDD28B           (       ddos2f.asm):03382                 JSR     >DOSGetDirEntry2        ; get next directory block      
D083 1F13             (       ddos2f.asm):03383                 TFR     X,U                     ; put pointer to dir block in U
D085 3510             (       ddos2f.asm):03384                 PULS    X                       ; restore FCB pointer
D087 2684             (       ddos2f.asm):03385                 BNE     LCF89                   ; branch if errors in DOSGetDirEntry2
                      (       ddos2f.asm):03386                 
D089 3141             (       ddos2f.asm):03387                 LEAY    DirEntCntBlock1,U       ; point to first allocation in continuation block
D08B C607             (       ddos2f.asm):03388                 LDB     #DirEntCntExts          ; initilize number of allocations count
D08D 20C2             (       ddos2f.asm):03389                 BRA     LCFCD                   ; go delete them
                      (       ddos2f.asm):03390         
D08F 5F               (       ddos2f.asm):03391         LD00B   CLRB                            ; flag no error
D090 0FF6             (       ddos2f.asm):03392         LD00C   CLR     <DosIOInProgress        ; flag no dos io in progress
D092 3262             (       ddos2f.asm):03393                 LEAS    2,S                     ; clen up stack
D094 5D               (       ddos2f.asm):03394                 TSTB                            ; set CC.C on error
D095 39               (       ddos2f.asm):03395                 RTS
                      (       ddos2f.asm):03396         
                      (       ddos2f.asm):03397         ;
                      (       ddos2f.asm):03398         ; Delete one extent.
                      (       ddos2f.asm):03399         ;
                      (       ddos2f.asm):03400         ; Called by DOSDeleteFile (amongst others). Marks one extent's worth of sectors
                      (       ddos2f.asm):03401         ; free.
                      (       ddos2f.asm):03402         ;
                      (       ddos2f.asm):03403         ; Entry:
                      (       ddos2f.asm):03404         ;       B       = Number of sectors.
                      (       ddos2f.asm):03405         ;       X       = starting LSN.
                      (       ddos2f.asm):03406         ;
                      (       ddos2f.asm):03407         ; Exit:
                      (       ddos2f.asm):03408         ;       B       = Error code.
                      (       ddos2f.asm):03409         ;
                      (       ddos2f.asm):03410         ;
                      (       ddos2f.asm):03411         ; stack frame
                      (       ddos2f.asm):03412         ;       4,s     0
                      (       ddos2f.asm):03413         ;       2,s     LSN to delete
                      (       ddos2f.asm):03414         ;       0,s     Sector count
                      (       ddos2f.asm):03415         ;
                      (       ddos2f.asm):03416         
D096                  (       ddos2f.asm):03417         DeleteExtent   
D096 4F               (       ddos2f.asm):03418                 CLRA                            ; clear A, makes D=sector count
D097 3402             (       ddos2f.asm):03419                 PSHS    A                       ; save A
D099 3416             (       ddos2f.asm):03420                 PSHS    D,X                     ; save sector count and LSN
                      (       ddos2f.asm):03421                 
D09B BDD200           (       ddos2f.asm):03422                 JSR     >DosGetDiskGeometry     ; get the geometry of the disk
D09E 267D             (       ddos2f.asm):03423                 BNE     DeleteExtentExit        ; error, exit
                      (       ddos2f.asm):03424                 
D0A0 10AE84           (       ddos2f.asm):03425                 LDY     DrvDetDirLSN,X          ; get LSN of directory  
D0A3 EC62             (       ddos2f.asm):03426                 LDD     2,S                     ; get LSN of extent to delete
D0A5 8305A0           (       ddos2f.asm):03427                 SUBD    #BAMLSNPerSec           ; subtract BAM entries in first BAM sector
D0A8 250B             (       ddos2f.asm):03428                 BCS     LD031                   ; branch if in first sector (-ve result)
                      (       ddos2f.asm):03429                 
D0AA 3121             (       ddos2f.asm):03430                 LEAY    1,Y                     ; move to next BAM sector
                      (       ddos2f.asm):03431                 
D0AC ED62             (       ddos2f.asm):03432                 STD     2,S                     ; save offset within BAM                        
D0AE E3E4             (       ddos2f.asm):03433                 ADDD    ,S                      ; add sector count
D0B0 8305A0           (       ddos2f.asm):03434                 SUBD    #BAMLSNPerSec           ; subtract BAM entries in first BAM sector
D0B3 2466             (       ddos2f.asm):03435                 BCC     LD098                   ; error allocation overflows BAMs 
                      (       ddos2f.asm):03436                 
D0B5 EC62             (       ddos2f.asm):03437         LD031   LDD     2,S                     ; get LSN of extent to delete
D0B7 E3E4             (       ddos2f.asm):03438                 ADDD    ,S                      ; add number of sectors to delete
D0B9 8305A0           (       ddos2f.asm):03439                 SUBD    #BAMLSNPerSec           ; subtract BAM entries in first BAM sector
D0BC 2507             (       ddos2f.asm):03440                 BCS     LD041                   ; branch if in first BAM sector
                      (       ddos2f.asm):03441                 
D0BE E764             (       ddos2f.asm):03442                 STB     4,S                     ; calc no of sectors in second BAM
D0C0 50               (       ddos2f.asm):03443                 NEGB
D0C1 EB61             (       ddos2f.asm):03444                 ADDB    1,S
D0C3 E761             (       ddos2f.asm):03445                 STB     1,S
                      (       ddos2f.asm):03446                 
D0C5 BDD2CA           (       ddos2f.asm):03447         LD041   JSR     >DOSFindAndRead         ; read required BAM sector
D0C8 2653             (       ddos2f.asm):03448                 BNE     DeleteExtentExit        ; error, exit
                      (       ddos2f.asm):03449                 
D0CA 86FF             (       ddos2f.asm):03450                 LDA     #BuffDirty              ; mark BAM sector buffer dirty
D0CC A702             (       ddos2f.asm):03451                 STA     2,X
                      (       ddos2f.asm):03452                 
D0CE EC62             (       ddos2f.asm):03453                 LDD     2,S                     ; get LSN to delete from
D0D0 44               (       ddos2f.asm):03454                 LSRA                            ; divide LSN by 8, to get the byte needed
D0D1 56               (       ddos2f.asm):03455                 RORB
D0D2 66E4             (       ddos2f.asm):03456                 ROR     ,S
D0D4 44               (       ddos2f.asm):03457                 LSRA
D0D5 56               (       ddos2f.asm):03458                 RORB
D0D6 66E4             (       ddos2f.asm):03459                 ROR     ,S
D0D8 44               (       ddos2f.asm):03460                 LSRA
D0D9 56               (       ddos2f.asm):03461                 RORB
D0DA 66E4             (       ddos2f.asm):03462                 ROR     ,S
                      (       ddos2f.asm):03463                 
                      (       ddos2f.asm):03464         ; this leaves the byte at 0,s with the bottom 3 bits of D in the *TOP* 3 bits
                      (       ddos2f.asm):03465         ; so in the loop below we need to decrement by $20 each loop, rather than 1.
                      (       ddos2f.asm):03466         ; e.g.
                      (       ddos2f.asm):03467         ; D=bbbb bbbb bbbb bbbb  0,S=0000 0000  before shift
                      (       ddos2f.asm):03468         ; D=000b bbbb bbbb bbbb  0,S=bbb0 0000  after shift
                      (       ddos2f.asm):03469         ;
                      (       ddos2f.asm):03470                 
D0DC AE05             (       ddos2f.asm):03471                 LDX     BuffAddr,X              ; get address of BAM buffer
D0DE 3A               (       ddos2f.asm):03472                 ABX                             ; add calculated offset
                      (       ddos2f.asm):03473                 
D0DF C601             (       ddos2f.asm):03474                 LDB     #$01                    ; get bitmap 
D0E1 A6E4             (       ddos2f.asm):03475                 LDA     ,S                      ; get bit number
D0E3 2705             (       ddos2f.asm):03476                 BEQ     LD066                   ; zero, exit loop
                      (       ddos2f.asm):03477                 
D0E5 58               (       ddos2f.asm):03478         LD061   ASLB                            ; shift bit number left
D0E6 8020             (       ddos2f.asm):03479                 SUBA    #$20                    ; we take $20, because of shift above   
D0E8 26FB             (       ddos2f.asm):03480                 BNE     LD061                   ; loop if not zero
                      (       ddos2f.asm):03481         
D0EA E7E4             (       ddos2f.asm):03482         LD066   STB     ,S                      ; 0,S now contains starting bit
D0EC E661             (       ddos2f.asm):03483                 LDB     1,S                     ; get sector count
                      (       ddos2f.asm):03484                 
D0EE A6E4             (       ddos2f.asm):03485         LD06A   LDA     ,S                      ; get bitmask 
D0F0 AA84             (       ddos2f.asm):03486                 ORA     ,X                      ; or it with BAM, deallocate sector
D0F2 A784             (       ddos2f.asm):03487                 STA     ,X                      ; put back in BAM
D0F4 5A               (       ddos2f.asm):03488                 DECB                            ; decrement sector count
D0F5 2718             (       ddos2f.asm):03489                 BEQ     LD08B                   ; branch if no more sectors
                      (       ddos2f.asm):03490                 
D0F7 68E4             (       ddos2f.asm):03491                 ASL     ,S                      ; shift mask left
D0F9 24F3             (       ddos2f.asm):03492                 BCC     LD06A                   ; skip if mask not shifted into carry
                      (       ddos2f.asm):03493                 
D0FB 8601             (       ddos2f.asm):03494                 LDA     #$01                    ; re-initialize mask
D0FD A7E4             (       ddos2f.asm):03495                 STA     ,S                      
D0FF 3001             (       ddos2f.asm):03496                 LEAX    1,X                     ; move to next BAM byte
                      (       ddos2f.asm):03497                 
                      (       ddos2f.asm):03498         ; check to see if we have more than 16 LSNs left to delete, if so do them quickly
                      (       ddos2f.asm):03499         ; by marking groups of 16 sectors free.....
                      (       ddos2f.asm):03500                 
D101 C110             (       ddos2f.asm):03501         LD07D   CMPB    #$10                    ; more than 16 sectors left to flag?    
D103 25E9             (       ddos2f.asm):03502                 BCS     LD06A                   ; no, continue doing a sector at a time
                      (       ddos2f.asm):03503                 
D105 86FF             (       ddos2f.asm):03504                 LDA     #$FF                    ; mark a group of 8 sectors at once
D107 A780             (       ddos2f.asm):03505                 STA     ,X+                     ; mark next 8
D109 A780             (       ddos2f.asm):03506                 STA     ,X+                     ; and next 8
D10B C010             (       ddos2f.asm):03507                 SUBB    #$10                    ; decrement sector count by 16
D10D 26F2             (       ddos2f.asm):03508                 BNE     LD07D                   ; loop again
                      (       ddos2f.asm):03509                 
D10F 8E05A0           (       ddos2f.asm):03510         LD08B   LDX     #BAMLSNPerSec           ; get BAM entries / sec
D112 3264             (       ddos2f.asm):03511                 LEAS    4,S                     ; clean up stack        
D114 E6E0             (       ddos2f.asm):03512                 LDB     ,S+                     ; get count
D116 2707             (       ddos2f.asm):03513                 BEQ     LD09C                   ; it's zero, exit
                      (       ddos2f.asm):03514         
D118                  (       ddos2f.asm):03515         GoDeleteExtent   
D118 16FF7B           (       ddos2f.asm):03516                 LBRA    DeleteExtent
                      (       ddos2f.asm):03517         
D11B C690             (       ddos2f.asm):03518         LD098   LDB     #ErrIV                  ; Error invalid volume
D11D                  (       ddos2f.asm):03519         DeleteExtentExit   
D11D 3265             (       ddos2f.asm):03520                 LEAS    5,S                     ; clean up stack
D11F 39               (       ddos2f.asm):03521         LD09C   RTS                     
                      (       ddos2f.asm):03522         
                      (       ddos2f.asm):03523         ;
                      (       ddos2f.asm):03524         ; Set protection status.
                      (       ddos2f.asm):03525         ;
                      (       ddos2f.asm):03526         ; Entry:
                      (       ddos2f.asm):03527         ;       A       = file number
                      (       ddos2f.asm):03528         ;       B       = 1 protect, 0 unprotect
                      (       ddos2f.asm):03529         ;
                      (       ddos2f.asm):03530         ; Exit:
                      (       ddos2f.asm):03531         ;       B       = error code
                      (       ddos2f.asm):03532         ; 
                      (       ddos2f.asm):03533         
D120                  (       ddos2f.asm):03534         DOSProtectMC
D120 97F1             (       ddos2f.asm):03535         LD09D   STA     <DosCurrCtrlBlk         ; set current file number
D122 BDCF30           (       ddos2f.asm):03536                 JSR     >DosFCBNoToAddr         ; get it's FCB address
                      (       ddos2f.asm):03537                 
D125 A60F             (       ddos2f.asm):03538                 LDA     FCBDirFlags,X           ; get flags from dir entry
D127 2B26             (       ddos2f.asm):03539                 BMI     LD0CC                   ; error.....
                      (       ddos2f.asm):03540                 
D129 5D               (       ddos2f.asm):03541                 TSTB                            ; shoud we protect / unprotect?
D12A 2703             (       ddos2f.asm):03542                 BEQ     LD0AC                   ; branch if unprotect
                      (       ddos2f.asm):03543                 
D12C 8A02             (       ddos2f.asm):03544                 ORA     #AttrWriteProt          ; set protection bit
                      (       ddos2f.asm):03545         
D12E 8C               (       ddos2f.asm):03546                 FCB     Skip2                   ; skip 2 bytes
D12F 84FD             (       ddos2f.asm):03547         LD0AC   ANDA    #~AttrWriteProt         ; reset protection bit
D131 A70F             (       ddos2f.asm):03548                 STA     FCBDirFlags,X           ; put back in dir entry
                      (       ddos2f.asm):03549                 
D133 E6881D           (       ddos2f.asm):03550                 LDB     FCBDiskFileNo,X         ; get file number on disk
D136 BDD28B           (       ddos2f.asm):03551                 JSR     >DOSGetDirEntry2        ; go get it's dir enetry
D139 26E4             (       ddos2f.asm):03552                 BNE     LD09C                   ; error, return
                      (       ddos2f.asm):03553                 
D13B A784             (       ddos2f.asm):03554                 STA     DirEntAttr,X            ; put it in dir attributes.
D13D 5F               (       ddos2f.asm):03555                 CLRB                            ; flag no error
D13E 39               (       ddos2f.asm):03556         LD0BB   RTS
                      (       ddos2f.asm):03557         
D13F                  (       ddos2f.asm):03558         DosCheckProtect   
D13F 97F1             (       ddos2f.asm):03559                 STA     <DosCurrCtrlBlk         ; set current file number
D141 BDCF30           (       ddos2f.asm):03560                 JSR     >DosFCBNoToAddr         ; get it's FCB address
                      (       ddos2f.asm):03561                 
D144 A60F             (       ddos2f.asm):03562                 LDA     FCBDirFlags,X           ; get flags from dir entry
D146 2B07             (       ddos2f.asm):03563                 BMI     LD0CC
                      (       ddos2f.asm):03564                 
D148 8502             (       ddos2f.asm):03565                 BITA    #AttrWriteProt          ; check write protect attribute
D14A 2732             (       ddos2f.asm):03566                 BEQ     LD0FB                   ; not protected....
D14C C698             (       ddos2f.asm):03567                 LDB     #ErrPT                  ; protection error
D14E 39               (       ddos2f.asm):03568                 RTS
                      (       ddos2f.asm):03569         
D14F C69C             (       ddos2f.asm):03570         LD0CC   LDB     #ErrFF                  ; return file not found
D151 39               (       ddos2f.asm):03571         LD0CE   RTS
                      (       ddos2f.asm):03572                 
                      (       ddos2f.asm):03573                 ;
                      (       ddos2f.asm):03574         ; Rename a file.
                      (       ddos2f.asm):03575         ;
                      (       ddos2f.asm):03576         ; Entry:
                      (       ddos2f.asm):03577         ;       DosCurFilename  = newname
                      (       ddos2f.asm):03578         ;       A               = fileid
                      (       ddos2f.asm):03579         ;
                      (       ddos2f.asm):03580         ; Exit:
                      (       ddos2f.asm):03581         ;       B               = Error code
                      (       ddos2f.asm):03582         ;
                      (       ddos2f.asm):03583         
     000B             (       ddos2f.asm):03584         FNLength        EQU     8+3             ; filename length
                      (       ddos2f.asm):03585         
D152                  (       ddos2f.asm):03586         DOSRename
D152 BDD13F           (       ddos2f.asm):03587                 JSR     >DosCheckProtect        ; is the file protected?
D155 2627             (       ddos2f.asm):03588                 BNE     LD0FB                   ; yep, (or error) exit
                      (       ddos2f.asm):03589                 
                      (       ddos2f.asm):03590         ; copy name into FCB    
D157 C60B             (       ddos2f.asm):03591                 LDB     #FNLength               ; byte count to copy                    
D159 CE0650           (       ddos2f.asm):03592                 LDU     #DosCurFilename         ; point at new filename
D15C A6C0             (       ddos2f.asm):03593         LD0D9   LDA     ,U+                     ; get a byte from new name
D15E A780             (       ddos2f.asm):03594                 STA     ,X+                     ; copy into FCB
D160 5A               (       ddos2f.asm):03595                 DECB                            ; dec count
D161 26F9             (       ddos2f.asm):03596                 BNE     LD0D9                   ; loop if more to copy
                      (       ddos2f.asm):03597                 
D163 3015             (       ddos2f.asm):03598                 LEAX    -FNLength,X             ; point back at beginning of FCB
D165 E6881D           (       ddos2f.asm):03599                 LDB     FCBDiskFileNo,X         ; get file number on disk
D168 BDD28B           (       ddos2f.asm):03600                 JSR     >DOSGetDirEntry2        ; go get it's entry
D16B 2611             (       ddos2f.asm):03601                 BNE     LD0FB                   ; error, exit
                      (       ddos2f.asm):03602                 
D16D CE0650           (       ddos2f.asm):03603                 LDU     #DosCurFilename         ; point at new name
D170 C60B             (       ddos2f.asm):03604                 LDB     #FNLength               ; byte count to copy
D172 3001             (       ddos2f.asm):03605                 LEAX    1,X                     ; move past attribute byte
D174 A6C0             (       ddos2f.asm):03606         LD0F1   LDA     ,U+                     ; get a byte from new name
D176 A780             (       ddos2f.asm):03607                 STA     ,X+                     ; save in dir entry
D178 5A               (       ddos2f.asm):03608                 DECB                            ; decrement count
D179 26F9             (       ddos2f.asm):03609                 BNE     LD0F1                   ; loop if more
                      (       ddos2f.asm):03610                 
D17B 0FF6             (       ddos2f.asm):03611                 CLR     <DosIOInProgress        ; clear IO in progress
D17D 5F               (       ddos2f.asm):03612                 CLRB                            ; flag no error
D17E 39               (       ddos2f.asm):03613         LD0FB   RTS
                      (       ddos2f.asm):03614         
                      (       ddos2f.asm):03615         ;
                      (       ddos2f.asm):03616         ; Find empty directory slot.
                      (       ddos2f.asm):03617         ;
                      (       ddos2f.asm):03618         ; Entry:
                      (       ddos2f.asm):03619         ;       A       = 0, normal
                      (       ddos2f.asm):03620         ;               = 1, continuation blocks, can't start in slot 0.
                      (       ddos2f.asm):03621         ;
                      (       ddos2f.asm):03622         ; Return:
                      (       ddos2f.asm):03623         ;       A       = New dir entry number found
                      (       ddos2f.asm):03624         ;       X       = Page table for buffer
                      (       ddos2f.asm):03625         ;       U       = Entry within buffer
                      (       ddos2f.asm):03626         ;       B       = Error code.
                      (       ddos2f.asm):03627         ;
                      (       ddos2f.asm):03628         ; Note that the buffer is always marked dirty.
                      (       ddos2f.asm):03629         ;
                      (       ddos2f.asm):03630         
D17F                  (       ddos2f.asm):03631         FindEmptyDir   
D17F 40               (       ddos2f.asm):03632                 NEGA                            ; convert 0/1 to $00/$FF
D180 B7067E           (       ddos2f.asm):03633                 STA     DosTemp2                ; save in temp
D183 BDD200           (       ddos2f.asm):03634                 JSR     >DosGetDiskGeometry     ; get geometry of the disk
D186 26F6             (       ddos2f.asm):03635                 BNE     LD0FB                   ; error return
                      (       ddos2f.asm):03636                 
D188 AE84             (       ddos2f.asm):03637                 LDX     BuffLSN,X               ; Get LSN from details
D18A 3410             (       ddos2f.asm):03638                 PSHS    X                       ; save on stack
                      (       ddos2f.asm):03639                 
D18C 3002             (       ddos2f.asm):03640                 LEAX    2,X                     ; add 2 to LSN
D18E BF066F           (       ddos2f.asm):03641         LD10B   STX     DosCurLSN               ; make current
D191 1F12             (       ddos2f.asm):03642                 TFR     X,Y                     ; save it in Y
D193 BDD2CA           (       ddos2f.asm):03643                 JSR     >DOSFindAndRead         ; find LSN and read into buffer
D196 2635             (       ddos2f.asm):03644                 BNE     FindEmptyDirExit        ; error, exit
                      (       ddos2f.asm):03645                 
D198 EE05             (       ddos2f.asm):03646                 LDU     BuffAddr,X              ; get buffer address
D19A C60A             (       ddos2f.asm):03647                 LDB     #DirBlksPerSec          ; 10 dir blocks per sector
D19C 7D067E           (       ddos2f.asm):03648                 TST     DosTemp2                ; are we looking for filename, or continuation? 
D19F 2A05             (       ddos2f.asm):03649                 BPL     LD123                   ; branch if filename
                      (       ddos2f.asm):03650                 
D1A1 70067E           (       ddos2f.asm):03651                 NEG     DosTemp2                ; turn $FF->1
D1A4 2007             (       ddos2f.asm):03652                 BRA     LD12A
                      (       ddos2f.asm):03653         
                      (       ddos2f.asm):03654         ; if we get here DosTemp = 0, so look at first directory block,
                      (       ddos2f.asm):03655         ; however the above neg will turn $FF back to $1, so searches for 
                      (       ddos2f.asm):03656         ; continuation blocks always beging at entry 1.
D1A6 A6C4             (       ddos2f.asm):03657         LD123   LDA     DirEntAttr,U            ; get attributes from entry
D1A8 2B1B             (       ddos2f.asm):03658                 BMI     LD142                   ; entry deleted, can be re-used
                      (       ddos2f.asm):03659                 
D1AA 7C067E           (       ddos2f.asm):03660                 INC     DosTemp2                ; increment entry counter
D1AD 33C819           (       ddos2f.asm):03661         LD12A   LEAU    DirEntryLen,U           ; move to next entry in sector
D1B0 5A               (       ddos2f.asm):03662                 DECB                            ; decrement counter
D1B1 26F3             (       ddos2f.asm):03663                 BNE     LD123                   ; loop again if more to search
                      (       ddos2f.asm):03664                 
D1B3 BE066F           (       ddos2f.asm):03665                 LDX     DosCurLSN               ; move to the next sector in the directory
D1B6 3001             (       ddos2f.asm):03666                 LEAX    1,X
D1B8 1F10             (       ddos2f.asm):03667                 TFR     X,D                     ; transfer LSN to D
D1BA A3E4             (       ddos2f.asm):03668                 SUBD    ,S                      ; subtract start LSN
D1BC C112             (       ddos2f.asm):03669                 CMPB    #SectorsPerTrack        ; got to end of dir track?
D1BE 25CE             (       ddos2f.asm):03670                 BCS     LD10B                   ; no search next sector
                      (       ddos2f.asm):03671                 
D1C0 3262             (       ddos2f.asm):03672                 LEAS    2,S                     ; drop saved LSN
D1C2 C692             (       ddos2f.asm):03673                 LDB     #ErrFD                  ; return full directory error
D1C4 39               (       ddos2f.asm):03674                 RTS
                      (       ddos2f.asm):03675         
D1C5 86FF             (       ddos2f.asm):03676         LD142   LDA     #BuffDirty                      
D1C7 A702             (       ddos2f.asm):03677                 STA     BuffFlag,X
D1C9 B6067E           (       ddos2f.asm):03678                 LDA     DosTemp2                ; get dir entry number
D1CC 5F               (       ddos2f.asm):03679                 CLRB                            ; flag no error
D1CD                  (       ddos2f.asm):03680         FindEmptyDirExit   
D1CD 3262             (       ddos2f.asm):03681                 LEAS    2,S                     ; clean up stack
D1CF 39               (       ddos2f.asm):03682                 RTS                             ; return
                      (       ddos2f.asm):03683         
                      (       ddos2f.asm):03684         ;
                      (       ddos2f.asm):03685         ; Get free space on a disk.
                      (       ddos2f.asm):03686         ;
                      (       ddos2f.asm):03687         ; Entry:
                      (       ddos2f.asm):03688         ;       DosDriveNo      = drive to get info for
                      (       ddos2f.asm):03689         ;
                      (       ddos2f.asm):03690         ; Exit: 
                      (       ddos2f.asm):03691         ;       X               = Free sectors
                      (       ddos2f.asm):03692         ;       B               = Error code
                      (       ddos2f.asm):03693         ;
                      (       ddos2f.asm):03694         
D1D0                  (       ddos2f.asm):03695         DOSGetFree   
D1D0 8D2E             (       ddos2f.asm):03696                 BSR     DosGetDiskGeometry      ; get the geometry for the disk
D1D2 2610             (       ddos2f.asm):03697                 BNE     LD161                   ; error, exit
                      (       ddos2f.asm):03698                 
D1D4 10AE84           (       ddos2f.asm):03699                 LDY     ,X                      ; get LSN in buffer...LSN of dir track                  
D1D7 9E8A             (       ddos2f.asm):03700                 LDX     <DBZero                 ; X=0, initialize free block count
D1D9 8D0A             (       ddos2f.asm):03701                 BSR     LD162                   ; get free sectors in first BAM sector
D1DB 2607             (       ddos2f.asm):03702                 BNE     LD161                   ; error, exit
                      (       ddos2f.asm):03703                 
D1DD 3121             (       ddos2f.asm):03704                 LEAY    1,Y                     ; move to next BAM sector
D1DF 8D04             (       ddos2f.asm):03705                 BSR     LD162                   ; get free sectors in second BAM sector
D1E1 2601             (       ddos2f.asm):03706                 BNE     LD161                   ; error, exit
D1E3 5F               (       ddos2f.asm):03707                 CLRB                            ; flag no errors
D1E4 39               (       ddos2f.asm):03708         LD161   RTS
                      (       ddos2f.asm):03709         
                      (       ddos2f.asm):03710         ; count bits in 1 BAM sector
D1E5 3410             (       ddos2f.asm):03711         LD162   PSHS    X                       ; save X
D1E7 BDD2CA           (       ddos2f.asm):03712                 JSR     >DOSFindAndRead         ; read LSN in Y
D1EA 26E1             (       ddos2f.asm):03713                 BNE     FindEmptyDirExit        ; error, exit
                      (       ddos2f.asm):03714                 
D1EC EE05             (       ddos2f.asm):03715                 LDU     BuffAddr,X              ; get pointer to loaded sector
D1EE 3510             (       ddos2f.asm):03716                 PULS    X                       ; restore X
                      (       ddos2f.asm):03717                 
D1F0 C6B4             (       ddos2f.asm):03718                 LDB     #BAMEntriesSec          ; count of bytes to process
D1F2 A6C0             (       ddos2f.asm):03719         LD16F   LDA     ,U+                     ; get a byte from buffer
D1F4 44               (       ddos2f.asm):03720         LD171   LSRA                            ; shift bit 0 into carry
D1F5 2402             (       ddos2f.asm):03721                 BCC     LD176                   ; branch if bit clear, sector in use
                      (       ddos2f.asm):03722                 
D1F7 3001             (       ddos2f.asm):03723                 LEAX    1,X                     ; otherwise increment sector count
D1F9 4D               (       ddos2f.asm):03724         LD176   TSTA                            ; all bits processed?
D1FA 26F8             (       ddos2f.asm):03725                 BNE     LD171                   ; nope, shift and test again
                      (       ddos2f.asm):03726                 
D1FC 5A               (       ddos2f.asm):03727                 DECB                            ; decrement byte count
D1FD 26F3             (       ddos2f.asm):03728                 BNE     LD16F                   ; loop again if not all done
D1FF 39               (       ddos2f.asm):03729                 RTS
                      (       ddos2f.asm):03730                 
                      (       ddos2f.asm):03731         ;
                      (       ddos2f.asm):03732         ; Get geometry for a disk and set the apropreate low memory vars.
                      (       ddos2f.asm):03733         ; Read from disk if in memory copy not valid.
                      (       ddos2f.asm):03734         ;
                      (       ddos2f.asm):03735         ; Entry: 
                      (       ddos2f.asm):03736         ;       DosDriveNo      = drive to get info for
                      (       ddos2f.asm):03737         ;
                      (       ddos2f.asm):03738         ; Exit: 
                      (       ddos2f.asm):03739         ;       Drive vars setup in low ram, to be same as disk in drive.
                      (       ddos2f.asm):03740         ;       X               = Address of buffer detail entry for buffer to use
                      (       ddos2f.asm):03741         ;
                      (       ddos2f.asm):03742         
D200                  (       ddos2f.asm):03743         DosGetDiskGeometry
D200 8E061C           (       ddos2f.asm):03744                 LDX     #Drv0Details            ; Point at drive details
D203 CE0696           (       ddos2f.asm):03745                 LDU     #DosD0Online-1          ; Point at drive online table
D206 C606             (       ddos2f.asm):03746                 LDB     #DrvDeatailLen          ; Get drive table entry len
D208 96EB             (       ddos2f.asm):03747                 LDA     <DosDriveNo             ; Get last used drive
                      (       ddos2f.asm):03748         
D20A 33C6             (       ddos2f.asm):03749                 LEAU    A,U                     ; Point U at drive online flag
D20C 4A               (       ddos2f.asm):03750                 DECA                            ; Make zero based
D20D 3D               (       ddos2f.asm):03751                 MUL                             ; Calculate offset of drive we need
D20E 308B             (       ddos2f.asm):03752                 LEAX    D,X
D210 6DC4             (       ddos2f.asm):03753                 TST     ,U                      ; Is drive online ?
                      (       ddos2f.asm):03754         
D212 263E             (       ddos2f.asm):03755                 BNE     LD1CF                   ; Yes : exit
                      (       ddos2f.asm):03756                 
D214 108E0168         (       ddos2f.asm):03757                 LDY     #SectorsPerTrack*DirPrimary     ; First sector of DIR track ($0168)
D218 8612             (       ddos2f.asm):03758                 LDA     #SectorsPerTrack        ; Set sectors per track for this drive
D21A A7C810           (       ddos2f.asm):03759                 STA     DosSecTrkTblOfs,U       ; Set it
                      (       ddos2f.asm):03760         
D21D 3410             (       ddos2f.asm):03761                 PSHS    X                       ; Save drive detail pointer
D21F BDD2CA           (       ddos2f.asm):03762                 JSR     >DOSFindAndRead         ; Find free buffer and read sector
D222 1026F9B4         (       ddos2f.asm):03763                 LBNE    LCB56                   ; Error : exit
                      (       ddos2f.asm):03764         
                      (       ddos2f.asm):03765         ; At this point X points to buffer details ???
                      (       ddos2f.asm):03766                 
D226 AE05             (       ddos2f.asm):03767                 LDX     BuffAddr,X              ; Get address of buffer data
D228 EC8900FE         (       ddos2f.asm):03768                 LDD     DirTracks1s,X           ; Get complements of tracks/secs per track
D22C 43               (       ddos2f.asm):03769                 COMA                            ; Complemetn them for compare
D22D 53               (       ddos2f.asm):03770                 COMB
D22E 10A38900FC       (       ddos2f.asm):03771                 CMPD    DirTracks,X             ; compare them to validate the disk
D233 3510             (       ddos2f.asm):03772                 PULS    X                       ; restore drive detail pointer
D235 261D             (       ddos2f.asm):03773                 BNE     LD1D1                   ; Not the same, not valid disk.
                      (       ddos2f.asm):03774                 
D237 E7C810           (       ddos2f.asm):03775                 STB     DosSecTrkTblOfs,U       ; Set Sectors/Track for this disk
D23A A74C             (       ddos2f.asm):03776                 STA     DosTracksTblOfs,U       ; Set tracks for this disk
D23C 6AC4             (       ddos2f.asm):03777                 DEC     ,U                      ; Mark drive online
D23E C112             (       ddos2f.asm):03778                 CMPB    #SectorsPerTrack        ; Disk single sided ?
D240 2701             (       ddos2f.asm):03779                 BEQ     LD1C0                   ; yes : skip on
                      (       ddos2f.asm):03780         
D242 5F               (       ddos2f.asm):03781                 CLRB                            ; zero it
D243 3404             (       ddos2f.asm):03782         LD1C0   PSHS    B                       ; save it
D245 6F02             (       ddos2f.asm):03783                 CLR     BuffFlag,X              ; Clear buffer flag
D247 CC0168           (       ddos2f.asm):03784                 LDD     #SectorsPerTrack*DirPrimary     ; First sector of DIR track ($0168)
D24A 6DE0             (       ddos2f.asm):03785                 TST     ,S+                     ; Do we need to double ? 
D24C 2602             (       ddos2f.asm):03786                 BNE     LD1CD                   ; no : skip
                      (       ddos2f.asm):03787                 
D24E 58               (       ddos2f.asm):03788                 ASLB                            ; Multiply D by 2, as we have 2 sides
D24F 49               (       ddos2f.asm):03789                 ROLA
D250 ED84             (       ddos2f.asm):03790         LD1CD   STD     ,X                      ; save it
D252 5F               (       ddos2f.asm):03791         LD1CF   CLRB                            ; No error
D253 39               (       ddos2f.asm):03792                 RTS                             ; Return
                      (       ddos2f.asm):03793         
D254 C690             (       ddos2f.asm):03794         LD1D1   LDB     #ErrIV          ; Flag error, invalid Volume
D256 39               (       ddos2f.asm):03795         LD1D3   RTS
                      (       ddos2f.asm):03796         
                      (       ddos2f.asm):03797         ;
                      (       ddos2f.asm):03798         ; Get directory entry.
                      (       ddos2f.asm):03799         ;
                      (       ddos2f.asm):03800         ; Entry: 
                      (       ddos2f.asm):03801         ;       DosDriveNo      = drive to process
                      (       ddos2f.asm):03802         ;       B               = File number(on disk) to get entry for
                      (       ddos2f.asm):03803         ;
                      (       ddos2f.asm):03804         ; Exit: 
                      (       ddos2f.asm):03805         ;       X               = Pointer to required Dir entry.
                      (       ddos2f.asm):03806         ;       DosCurLSN       = LSN of directory entry.
                      (       ddos2f.asm):03807         ;       DosCurDirBuff   = buffer pointer to LSN buffer
                      (       ddos2f.asm):03808         ;       B               = error code
                      (       ddos2f.asm):03809         ;
                      (       ddos2f.asm):03810         
D257                  (       ddos2f.asm):03811         DOSGetDirEntry   
D257 86FF             (       ddos2f.asm):03812                 LDA     #$FF                    ; Init sector counter
D259 4C               (       ddos2f.asm):03813         LD1D6   INCA                            ; increment sector counter
D25A C00A             (       ddos2f.asm):03814                 SUBB    #DirEntPerSec           ; Decrement file no, by a sectors worth of files
D25C 2CFB             (       ddos2f.asm):03815                 BGE     LD1D6                   ; Done all ? no : continue looping
                      (       ddos2f.asm):03816                 
D25E CB0A             (       ddos2f.asm):03817                 ADDB    #DirEntPerSec           ; Compensate for over loop
                      (       ddos2f.asm):03818                 
                      (       ddos2f.asm):03819         ; At this point A contains the sector number within the directory that we are intereted in.
                      (       ddos2f.asm):03820         ; and B contains the entry within that sector of the file's details.
                      (       ddos2f.asm):03821         
D260 3406             (       ddos2f.asm):03822                 PSHS    D                       ; Save them
D262 8D9C             (       ddos2f.asm):03823                 BSR     DosGetDiskGeometry      ; Setup disk geometry from disk in drive
D264 1026F972         (       ddos2f.asm):03824                 LBNE    LCB56                   ; Error : exit
                      (       ddos2f.asm):03825                 
D268 EC84             (       ddos2f.asm):03826                 LDD     ,X                      ; Get LSN number from buffer
D26A C30002           (       ddos2f.asm):03827                 ADDD    #$0002                  ; Advance past bitmap sectors
D26D EBE0             (       ddos2f.asm):03828                 ADDB    ,S+                     ; Add sector offset calculated above
D26F 8900             (       ddos2f.asm):03829                 ADCA    #$00                    ; Deal with carry
D271 FD066F           (       ddos2f.asm):03830                 STD     DosCurLSN               ; Save LSN
D274 1F02             (       ddos2f.asm):03831                 TFR     D,Y                     ; Get LSN into Y
D276 BDD2CA           (       ddos2f.asm):03832                 JSR     DOSFindAndRead          ; Find free buffer and read sector
                      (       ddos2f.asm):03833         ;***    BSR     DOSFindAndRead          ; Find free buffer and read sector
D279 3502             (       ddos2f.asm):03834                 PULS    A                       ; Retrieve entry number witin sector
                      (       ddos2f.asm):03835         
D27B 260D             (       ddos2f.asm):03836                 BNE     LD28A                   ; Error: exit
D27D 1F13             (       ddos2f.asm):03837                 TFR     X,U
D27F C619             (       ddos2f.asm):03838                 LDB     #DirEntryLen            ; Length of dir entry
D281 3D               (       ddos2f.asm):03839                 MUL                             ; Calculate offset
D282 BF067F           (       ddos2f.asm):03840                 STX     DosCurDirBuff           ; Saave block def pointer
D285 AE05             (       ddos2f.asm):03841                 LDX     BuffAddr,X              ; Get pointer to block data
D287 308B             (       ddos2f.asm):03842                 LEAX    D,X                     ; Get offset of DIR entry into X
D289 5F               (       ddos2f.asm):03843                 CLRB                            ; Flag no error
D28A 39               (       ddos2f.asm):03844         LD28A   RTS
                      (       ddos2f.asm):03845         
                      (       ddos2f.asm):03846         ;
                      (       ddos2f.asm):03847         ; Get directory entry
                      (       ddos2f.asm):03848         ;
                      (       ddos2f.asm):03849         ; Entry:
                      (       ddos2f.asm):03850         ;       B       = directory entry number
                      (       ddos2f.asm):03851         ;
                      (       ddos2f.asm):03852         ; Exit:
                      (       ddos2f.asm):03853         ;       X       = directory entry pointer
                      (       ddos2f.asm):03854         ;       Y       = buffer table pointer
                      (       ddos2f.asm):03855         ;       D       = preserved
                      (       ddos2f.asm):03856         ;
                      (       ddos2f.asm):03857         
D28B                  (       ddos2f.asm):03858         DOSGetDirEntry2
D28B 3406             (       ddos2f.asm):03859                 PSHS    D
D28D 8DC8             (       ddos2f.asm):03860                 BSR     DOSGetDirEntry          ; Get directory entry we are interested in
D28F 1026F947         (       ddos2f.asm):03861                 LBNE    LCB56                   ; Error :
D293 10BE067F         (       ddos2f.asm):03862                 LDY     DosCurDirBuff           ; Get Buffer def block for this entry
D297 86FE             (       ddos2f.asm):03863                 LDA     #BuffDirtyExpire        ; Set flag
D299 A722             (       ddos2f.asm):03864                 STA     BuffFlag,Y
D29B 5F               (       ddos2f.asm):03865                 CLRB                            ; Flag no error
D29C 3586             (       ddos2f.asm):03866                 PULS    D,PC                    ; Restore and return
                      (       ddos2f.asm):03867         
                      (       ddos2f.asm):03868         ;
                      (       ddos2f.asm):03869         ; Find a free disk buffer.
                      (       ddos2f.asm):03870         ; Find buffer with same sector
                      (       ddos2f.asm):03871         ;
                      (       ddos2f.asm):03872         ; Entry: 
                      (       ddos2f.asm):03873         ;       Y               = LSN to find
                      (       ddos2f.asm):03874         ;       DosDriveNo      = drive to process
                      (       ddos2f.asm):03875         ;
                      (       ddos2f.asm):03876         ; Exits:
                      (       ddos2f.asm):03877         ;       X               = buffer table
                      (       ddos2f.asm):03878         ;       U               = pointer to detail entry for free buffer (or 0).
                      (       ddos2f.asm):03879         ;       B               = 0 if found $FF if not found
                      (       ddos2f.asm):03880         ;
                      (       ddos2f.asm):03881         
D29E                  (       ddos2f.asm):03882         FindFreeBuffer   
D29E 8E0634           (       ddos2f.asm):03883                 LDX     #Buff1Details           ; Point at disk buffer detail table
D2A1 DE8A             (       ddos2f.asm):03884                 LDU     <DBZero                 ; U=0 
D2A3 C604             (       ddos2f.asm):03885                 LDB     #BuffCount              ; 4 Disk buffers
                      (       ddos2f.asm):03886         
D2A5 A602             (       ddos2f.asm):03887         LD222   LDA     BuffFlag,X              ; Get buffer flag in A
D2A7 2717             (       ddos2f.asm):03888                 BEQ     LD23D                   ; Zero ?
                      (       ddos2f.asm):03889                 
D2A9 8155             (       ddos2f.asm):03890                 CMPA    #BuffInUse              ; Is buffer in use ?
D2AB 2715             (       ddos2f.asm):03891                 BEQ     LD23F                   ; no, skip
                      (       ddos2f.asm):03892                 
D2AD 10AC84           (       ddos2f.asm):03893                 CMPY    BuffLSN,X               ; is LSN the same?
D2B0 260A             (       ddos2f.asm):03894                 BNE     LD239                   ; no, skip
                      (       ddos2f.asm):03895                 
D2B2 96EB             (       ddos2f.asm):03896                 LDA     <DosDriveNo             ; Get last drive
D2B4 A103             (       ddos2f.asm):03897                 CMPA    BuffDrive,X             ; Is this buffer using the same drive ?
D2B6 2604             (       ddos2f.asm):03898                 BNE     LD239                   ; nope, skip on
D2B8 8D66             (       ddos2f.asm):03899                 BSR     MakeBuffYoungest        ; Make this the youngest buffer
D2BA 5F               (       ddos2f.asm):03900                 CLRB                            ; Flag no error
D2BB 39               (       ddos2f.asm):03901                 RTS
                      (       ddos2f.asm):03902         
D2BC 6D02             (       ddos2f.asm):03903         LD239   TST     BuffFlag,X              ; Is buffer free ?
D2BE 2602             (       ddos2f.asm):03904                 BNE     LD23F                   ; nope, look at next
                      (       ddos2f.asm):03905                 
D2C0 1F13             (       ddos2f.asm):03906         LD23D   TFR     X,U                     ; Select this buffer
D2C2 3007             (       ddos2f.asm):03907         LD23F   LEAX    BuffDetailSize,X        ; move on to next buffer detail entry
D2C4 5A               (       ddos2f.asm):03908                 DECB                            ; Decrement counter
D2C5 26DE             (       ddos2f.asm):03909                 BNE     LD222                   ; Any more to check ? : yes loop again
                      (       ddos2f.asm):03910         
D2C7 C6FF             (       ddos2f.asm):03911                 LDB     #$FF                    ; Flag error
D2C9 39               (       ddos2f.asm):03912         LD246   RTS
                      (       ddos2f.asm):03913                 
                      (       ddos2f.asm):03914         ;
                      (       ddos2f.asm):03915         ; Find a free buffer and read sector.
                      (       ddos2f.asm):03916         ;
                      (       ddos2f.asm):03917         ; Entry: 
                      (       ddos2f.asm):03918         ;       Y               = LSN to read
                      (       ddos2f.asm):03919         ;       DosDriveNo      = drive to process
                      (       ddos2f.asm):03920         ; Exit:
                      (       ddos2f.asm):03921         ;       X               = pointer to buffer entry 
                      (       ddos2f.asm):03922         ;       U               = preserved
                      (       ddos2f.asm):03923         ;       B               = error code 
                      (       ddos2f.asm):03924         ;
                      (       ddos2f.asm):03925         ; A buffer is allocated from the 4 buffer pool in the following order of
                      (       ddos2f.asm):03926         ; preference:
                      (       ddos2f.asm):03927         ;       1, Sector already in buffer
                      (       ddos2f.asm):03928         ;       2, An empty buffer
                      (       ddos2f.asm):03929         ;       3, Least recently used buffer, flushed first.
                      (       ddos2f.asm):03930         ;
                      (       ddos2f.asm):03931         
D2CA                  (       ddos2f.asm):03932         DOSFindAndRead   
D2CA 3440             (       ddos2f.asm):03933                 PSHS    U
D2CC BDD29E           (       ddos2f.asm):03934                 JSR     >FindFreeBuffer         ; Find free buffer, pointer to details returned in U
D2CF 1027F907         (       ddos2f.asm):03935                 LBEQ    LCB56
                      (       ddos2f.asm):03936                 
D2D3 30C4             (       ddos2f.asm):03937                 LEAX    ,U                      ; Make X point to details
D2D5 3540             (       ddos2f.asm):03938                 PULS    U
D2D7 2604             (       ddos2f.asm):03939                 BNE     LD25A
                      (       ddos2f.asm):03940                 
D2D9 8D1C             (       ddos2f.asm):03941                 BSR     FindFreeDiskBuffer      ; Find buffer to read data into
D2DB 2619             (       ddos2f.asm):03942                 BNE     LD2F5 
                      (       ddos2f.asm):03943                 
D2DD 6F02             (       ddos2f.asm):03944         LD25A   CLR     BuffFlag,X              ; Make buffer free
D2DF 10AF84           (       ddos2f.asm):03945                 STY     ,X
D2E2 96EB             (       ddos2f.asm):03946                 LDA     <DosDriveNo             ; Get last drive
D2E4 A703             (       ddos2f.asm):03947                 STA     BuffDrive,X             ; Set this drive's buffer
D2E6 3410             (       ddos2f.asm):03948                 PSHS    X                       ; Save buffer detail pointer
D2E8 AE05             (       ddos2f.asm):03949                 LDX     BuffAddr,X              ; Get address of buffer
D2EA BDD38D           (       ddos2f.asm):03950                 JSR     >DOSReadAbsSector       ; Read the sector
D2ED 3510             (       ddos2f.asm):03951                 PULS    X                       ; Restore buff detail pointer
D2EF 2605             (       ddos2f.asm):03952                 BNE     LD2F5                   ; Error : exit
                      (       ddos2f.asm):03953                 
D2F1 8601             (       ddos2f.asm):03954                 LDA     #$01                    ; Set flag to 1
D2F3 A702             (       ddos2f.asm):03955                 STA     BuffFlag,X
D2F5 5F               (       ddos2f.asm):03956                 CLRB                            ; No error
D2F6 39               (       ddos2f.asm):03957         LD2F5   RTS
                      (       ddos2f.asm):03958         
                      (       ddos2f.asm):03959         ;
                      (       ddos2f.asm):03960         ; Find least recently used disk buffer, if none, and there is 
                      (       ddos2f.asm):03961         ; a dirty buffer, then flush it and use that one.
                      (       ddos2f.asm):03962         ;
                      (       ddos2f.asm):03963         ; Exit : X=pointer to buffer info block.
                      (       ddos2f.asm):03964         ;
                      (       ddos2f.asm):03965         
D2F7                  (       ddos2f.asm):03966         FindFreeDiskBuffer   
D2F7 3466             (       ddos2f.asm):03967                 PSHS    D,Y,U
D2F9 8E0634           (       ddos2f.asm):03968         LD276   LDX     #Buff1Details           ; Point to disk buffer table
D2FC C604             (       ddos2f.asm):03969                 LDB     #$04                    ; Check 4 buffers
D2FE A604             (       ddos2f.asm):03970         LD27B   LDA     BuffAge,X               ; Get buffer age
D300 8101             (       ddos2f.asm):03971                 CMPA    #$01                    ; Oldest ?
D302 2705             (       ddos2f.asm):03972                 BEQ     LD286                   ; Yes go process it
                      (       ddos2f.asm):03973                 
D304 3007             (       ddos2f.asm):03974                 LEAX    7,X                     ; Do next bufffer
D306 5A               (       ddos2f.asm):03975                 DECB                            ; Decrement buffer count
D307 26F5             (       ddos2f.asm):03976                 BNE     LD27B                   ; More : do next
                      (       ddos2f.asm):03977         
D309 8D15             (       ddos2f.asm):03978         LD286   BSR     MakeBuffYoungest        ; Adjust ages of all other buffers
D30B A602             (       ddos2f.asm):03979                 LDA     BuffFlag,X              ; Get buffer flag byte 
D30D 8155             (       ddos2f.asm):03980                 CMPA    #$55                    ; In use ???
D30F 27E8             (       ddos2f.asm):03981                 BEQ     LD276                   ; yes, select another buffer
                      (       ddos2f.asm):03982                 
D311 4C               (       ddos2f.asm):03983                 INCA                            ; Check for Flag=$FF
D312 2604             (       ddos2f.asm):03984                 BNE     LD295                   ; no : skip on
                      (       ddos2f.asm):03985                 
D314 6A02             (       ddos2f.asm):03986                 DEC     BuffFlag,X              ; yes, select another buffer
D316 20E1             (       ddos2f.asm):03987                 BRA     LD276
                      (       ddos2f.asm):03988         
D318 8D1D             (       ddos2f.asm):03989         LD295   BSR     TestAndFlushBuffer      ; Check for buffer flush needed ?
                      (       ddos2f.asm):03990                 
                      (       ddos2f.asm):03991                 ifdef   PGSFix
                      (       ddos2f.asm):03992                 BEQ     LD29C                   ; no error, skip
                      (       ddos2f.asm):03993                 STB     1,s                     ; save error code on stack for return
                      (       ddos2f.asm):03994                 else
D31A 1026F75B         (       ddos2f.asm):03995                 LBNE    DosFReadErrorExit       ; No error: skip
                      (       ddos2f.asm):03996                 endc
                      (       ddos2f.asm):03997                 
D31E 35E6             (       ddos2f.asm):03998                 PULS    D,Y,U,PC                ; restore and return
                      (       ddos2f.asm):03999         
                      (       ddos2f.asm):04000         ;
                      (       ddos2f.asm):04001         ; Update the LRU counts of buffers.
                      (       ddos2f.asm):04002         ;
                      (       ddos2f.asm):04003         ; Entry:
                      (       ddos2f.asm):04004         ;       X       = page table entry
                      (       ddos2f.asm):04005         ;
                      (       ddos2f.asm):04006         ; Exits:
                      (       ddos2f.asm):04007         ;       Entry becomes most recently used.
                      (       ddos2f.asm):04008         ;
                      (       ddos2f.asm):04009         
D320                  (       ddos2f.asm):04010         MakeBuffYoungest   
D320 C604             (       ddos2f.asm):04011                 LDB     #BuffCount              ; Process 4 buffers
D322                  (       ddos2f.asm):04012         LD29C   
D322 A604             (       ddos2f.asm):04013                 LDA     BuffAge,X               ; Get current buffer Age
D324 CE0634           (       ddos2f.asm):04014                 LDU     #Buff1Details           ; Point to disk buffer table
D327 A144             (       ddos2f.asm):04015         LD2A4   CMPA    BuffAge,U               ; Compare to current buffer age
D329 2202             (       ddos2f.asm):04016                 BHI     LD2AA                   ; higher ? skip
D32B 6A44             (       ddos2f.asm):04017                 DEC     BuffAge,U               ; Decrement Age byte (make older)
                      (       ddos2f.asm):04018                 
D32D 3347             (       ddos2f.asm):04019         LD2AA   LEAU    BuffDetailSize,U        ; Do next buffer
D32F 5A               (       ddos2f.asm):04020                 DECB                            ; Decrement count
D330 26F5             (       ddos2f.asm):04021                 BNE     LD2A4                   ; More : do next
D332 8604             (       ddos2f.asm):04022                 LDA     #$04                    ; Mark this as youngest buffer
D334 A704             (       ddos2f.asm):04023                 STA     BuffAge,X
D336 39               (       ddos2f.asm):04024                 RTS
                      (       ddos2f.asm):04025         
                      (       ddos2f.asm):04026         ;
                      (       ddos2f.asm):04027         ; Clean up a buffer.
                      (       ddos2f.asm):04028         ;
                      (       ddos2f.asm):04029         ; If buffer is dirty, flush it to disk, and if verify is on, or 
                      (       ddos2f.asm):04030         ; write is to directory tracks, then verify it.
                      (       ddos2f.asm):04031         ;
                      (       ddos2f.asm):04032         ; Maintain a list of directory sectors which need updating.
                      (       ddos2f.asm):04033         ;
                      (       ddos2f.asm):04034         ; Entry:
                      (       ddos2f.asm):04035         ;       X       = buffer table
                      (       ddos2f.asm):04036         ;
                      (       ddos2f.asm):04037         ; Exit:
                      (       ddos2f.asm):04038         ;       X       = preserved
                      (       ddos2f.asm):04039         ;       B       = error code
                      (       ddos2f.asm):04040         ;
                      (       ddos2f.asm):04041         
D337                  (       ddos2f.asm):04042         TestAndFlushBuffer   
D337 6D02             (       ddos2f.asm):04043                 TST     BuffFlag,X              ; Buffer dirty ?
D339 2B02             (       ddos2f.asm):04044                 BMI     FlushBuffer             ; Yes, flush it !
D33B 5F               (       ddos2f.asm):04045                 CLRB                            ; No error ?
D33C 39               (       ddos2f.asm):04046                 RTS
                      (       ddos2f.asm):04047         
D33D                  (       ddos2f.asm):04048         FlushBuffer
D33D 96EB             (       ddos2f.asm):04049                 LDA     <DosDriveNo             ; Get last drive accessed
D33F 3402             (       ddos2f.asm):04050                 PSHS    A                       ; save it on stack
D341 3410             (       ddos2f.asm):04051                 PSHS    X                       ; Save buffer pointer
D343 86FF             (       ddos2f.asm):04052                 LDA     #$FF                    ; Flag Dos IO in progress
D345 97F6             (       ddos2f.asm):04053                 STA     <DosIOInProgress
D347 6F02             (       ddos2f.asm):04054                 CLR     BuffFlag,X              ; Flag buffer no longer dirty
D349 A603             (       ddos2f.asm):04055                 LDA     BuffDrive,X             ; Get drive this buffer refers to
D34B 97EB             (       ddos2f.asm):04056                 STA     <DosDriveNo             ; Save in last accessed drive
D34D 10AE84           (       ddos2f.asm):04057                 LDY     ,X                      ; get LSN ?
D350 AE05             (       ddos2f.asm):04058                 LDX     BuffAddr,X              ; Get buffer pointer
D352 BDD37D           (       ddos2f.asm):04059                 JSR     >DOSWriteAbsSector      ; Write it
                      (       ddos2f.asm):04060         
D355 3510             (       ddos2f.asm):04061                 PULS    X                       ; Retrieve buffer pointer
D357 261C             (       ddos2f.asm):04062                 BNE     LD2F2                   ; no error : skip ahead
                      (       ddos2f.asm):04063         
D359 96EC             (       ddos2f.asm):04064                 LDA     <DskTrackNo             ; Get current track no
D35B 8114             (       ddos2f.asm):04065                 CMPA    #DirPrimary             ; track 20 (directory) ?
D35D 2611             (       ddos2f.asm):04066                 BNE     LD2ED                   ; no : skip ahead
                      (       ddos2f.asm):04067         
                      (       ddos2f.asm):04068         ;
                      (       ddos2f.asm):04069         ; I do not have a clue why this code does this, it seems to take a byte from
                      (       ddos2f.asm):04070         ; the basic rom do some stuff to it and update the Directory sector status table 
                      (       ddos2f.asm):04071         ; with it !
                      (       ddos2f.asm):04072         ; 
                      (       ddos2f.asm):04073         ; Looking at $A673, the 8 bytes before it are $80,$40,$20,$10,$08,$04,$02,$01
                      (       ddos2f.asm):04074         ; This is the 2 colour pixel mask table, but is a convenient table for mapping a bit
                      (       ddos2f.asm):04075         ; number to the bit it represents.
                      (       ddos2f.asm):04076         ;
                      (       ddos2f.asm):04077                 
D35F CEA673           (       ddos2f.asm):04078                 LDU     #PixMaskTable4Col       ; This for some strange reason points U at basic rom !!!        
D362 96EB             (       ddos2f.asm):04079                 LDA     <DosDriveNo             ; get last drive
D364 40               (       ddos2f.asm):04080                 NEGA
D365 A6C6             (       ddos2f.asm):04081                 LDA     A,U
                      (       ddos2f.asm):04082         
D367 CE06AA           (       ddos2f.asm):04083                 LDU     #DosDirSecStatus-1      ; Point to directory status table
D36A D6ED             (       ddos2f.asm):04084                 LDB     <DskSectorNo            ; get sector number
D36C AAC5             (       ddos2f.asm):04085                 ORA     B,U                     ; Put a byte in table
D36E A7C5             (       ddos2f.asm):04086                 STA     B,U
                      (       ddos2f.asm):04087         
D370 8601             (       ddos2f.asm):04088         LD2ED   LDA     #$01                    ; Mark bufer as youngest
D372 A702             (       ddos2f.asm):04089                 STA     BuffFlag,X
D374 5F               (       ddos2f.asm):04090                 CLRB
                      (       ddos2f.asm):04091                 
D375 3502             (       ddos2f.asm):04092         LD2F2   PULS    A
D377 97EB             (       ddos2f.asm):04093                 STA     <DosDriveNo             ; Restore last drive
D379 0FF6             (       ddos2f.asm):04094                 CLR     <DosIOInProgress        ; Mark no io in progress
D37B 5D               (       ddos2f.asm):04095                 TSTB
D37C 39               (       ddos2f.asm):04096                 RTS
                      (       ddos2f.asm):04097                 
                      (       ddos2f.asm):04098         ;
                      (       ddos2f.asm):04099         ; Write absolute sector.
                      (       ddos2f.asm):04100         ;
                      (       ddos2f.asm):04101         ; Entry :    
                      (       ddos2f.asm):04102         ;       X               = Address to store data
                      (       ddos2f.asm):04103         ;       Y               = LSN to read
                      (       ddos2f.asm):04104         ;       DosDriveNo      = drive to process
                      (       ddos2f.asm):04105         ;
                      (       ddos2f.asm):04106         ; Exit:
                      (       ddos2f.asm):04107         ;       X               = preserved
                      (       ddos2f.asm):04108         ;       B               = error code
                      (       ddos2f.asm):04109         ;
                      (       ddos2f.asm):04110         
D37D                  (       ddos2f.asm):04111         DOSWriteAbsSector   
D37D 8D15             (       ddos2f.asm):04112                 BSR     CalcTrackFromLSN        ; Setup disk vars in low ram with trackno
D37F BDC0FE           (       ddos2f.asm):04113                 JSR     >DosDoWriteSecN         ; go write the sector
D382 9EEE             (       ddos2f.asm):04114         LD2FF   LDX     <DiskBuffPtr            ; Restore buffer pointer 
D384 5D               (       ddos2f.asm):04115                 TSTB                            ; Test for Error
D385 39               (       ddos2f.asm):04116                 RTS                             ; return to caller
                      (       ddos2f.asm):04117         ;
                      (       ddos2f.asm):04118         ; Verify absolute sector.
                      (       ddos2f.asm):04119         ;
                      (       ddos2f.asm):04120         ; Entry and Exit as for Write absolute sector.
                      (       ddos2f.asm):04121         ;
                      (       ddos2f.asm):04122         
D386                  (       ddos2f.asm):04123         DosVerifyAbsSector      
D386 8D0C             (       ddos2f.asm):04124                 BSR     CalcTrackFromLSN        ; Setup disk vars in low ram with trackno
D388 BDC15F           (       ddos2f.asm):04125                 JSR     >DosDoReadSec2
D38B 20F5             (       ddos2f.asm):04126                 BRA     LD2FF
                      (       ddos2f.asm):04127         ;
                      (       ddos2f.asm):04128         ; Read absolute sector.
                      (       ddos2f.asm):04129         ;
                      (       ddos2f.asm):04130         ; Entry and Exit as for Write absolute sector.
                      (       ddos2f.asm):04131         ;
                      (       ddos2f.asm):04132         
D38D                  (       ddos2f.asm):04133         DOSReadAbsSector   
D38D 8D05             (       ddos2f.asm):04134                 BSR     CalcTrackFromLSN        ; Setup disk vars in low ram with trackno
D38F BDC104           (       ddos2f.asm):04135                 JSR     >DosDoReadSec           ; Go read data
D392 20EE             (       ddos2f.asm):04136                 BRA     LD2FF                   ; Return to caller
                      (       ddos2f.asm):04137         
                      (       ddos2f.asm):04138         ;
                      (       ddos2f.asm):04139         ; Calculate track from Logical sector number.
                      (       ddos2f.asm):04140         ; 
                      (       ddos2f.asm):04141         ; Entry: 
                      (       ddos2f.asm):04142         ;       X       = Buffer pointer
                      (       ddos2f.asm):04143         ;       Y       = LSN to read/write
                      (       ddos2f.asm):04144         ;
                      (       ddos2f.asm):04145         ; Exit: 
                      (       ddos2f.asm):04146         ;       A       = Track
                      (       ddos2f.asm):04147         ;       B       = Sector        
                      (       ddos2f.asm):04148         ;       Low ram vars DskTrackNo and DskSectorNo also set.
                      (       ddos2f.asm):04149         ;
                      (       ddos2f.asm):04150         
D394                  (       ddos2f.asm):04151         CalcTrackFromLSN   
D394 9FEE             (       ddos2f.asm):04152                 STX     <DiskBuffPtr            ; Save in buffer pointer
D396 8E06A6           (       ddos2f.asm):04153                 LDX     #DosD0SecTrack-1        ; Point to Sec/Track table
D399 D6EB             (       ddos2f.asm):04154                 LDB     <DosDriveNo             ; Get last drive
D39B E685             (       ddos2f.asm):04155                 LDB     B,X                     ; Get Sec/Track for that drive
D39D 4F               (       ddos2f.asm):04156                 CLRA
D39E 3406             (       ddos2f.asm):04157                 PSHS    D                       ; Save it
D3A0 6FE2             (       ddos2f.asm):04158                 CLR     ,-S                     ; Make room on stack
D3A2 1F20             (       ddos2f.asm):04159                 TFR     Y,D                     ; Get LSN into D
                      (       ddos2f.asm):04160                 
                      (       ddos2f.asm):04161         ; Calculate which track we need
                      (       ddos2f.asm):04162                 
D3A4 6CE4             (       ddos2f.asm):04163         LD321   INC     ,S                      ; Inc track counter
D3A6 A361             (       ddos2f.asm):04164                 SUBD    1,S                     ; Decrement sec/track from LSN
D3A8 2AFA             (       ddos2f.asm):04165                 BPL     LD321                   ; keep looping till it goes -ve
                      (       ddos2f.asm):04166                 
D3AA EB62             (       ddos2f.asm):04167                 ADDB    2,S                     ; Compensate for over-loop
D3AC A6E4             (       ddos2f.asm):04168                 LDA     ,S                      ; Get track needed
D3AE 4A               (       ddos2f.asm):04169                 DECA                            ; Compensate track for over loop
D3AF 5C               (       ddos2f.asm):04170                 INCB
D3B0 3263             (       ddos2f.asm):04171                 LEAS    3,S                     ; Drop stack temps
D3B2 DDEC             (       ddos2f.asm):04172                 STD     <DskTrackNo             ; Save track no
D3B4 39               (       ddos2f.asm):04173                 RTS
                      (       ddos2f.asm):04174         
                      (       ddos2f.asm):04175         ;
                      (       ddos2f.asm):04176         ; Copy command dispatch routine
                      (       ddos2f.asm):04177         ;
                      (       ddos2f.asm):04178         ; Syntax :
                      (       ddos2f.asm):04179         ;       COPY filespec TO filespec       
                      (       ddos2f.asm):04180         ;
                      (       ddos2f.asm):04181         ; Stack setup as follows 
                      (       ddos2f.asm):04182         ;
                      (       ddos2f.asm):04183         ; offset        size    purpose
                      (       ddos2f.asm):04184         ; 0             1       Source FCB number
                      (       ddos2f.asm):04185         ; 1             1       Destination FCB number
                      (       ddos2f.asm):04186         ; 2             2       Buffer pointer ?
                      (       ddos2f.asm):04187         ; 4             3       File pointer pos
                      (       ddos2f.asm):04188         ;
                      (       ddos2f.asm):04189         
     0000             (       ddos2f.asm):04190         CopySrcFCBNo    equ     0               ; Source file FCB no
     0001             (       ddos2f.asm):04191         CopyDstFCBNo    equ     1               ; Destination FCB no
     0002             (       ddos2f.asm):04192         CopyIOBufPtr    equ     2               ; IO buffer pointer
     0004             (       ddos2f.asm):04193         CopySrcFP       equ     4               ; Source filepointer
                      (       ddos2f.asm):04194         
D3B5                  (       ddos2f.asm):04195         CmdCopy 
D3B5 17FB87           (       ddos2f.asm):04196                 LBSR    DOSCloseAll             ; Close all files & devices
D3B8 263B             (       ddos2f.asm):04197                 BNE     LD36B                   ; Error : exit
D3BA 3279             (       ddos2f.asm):04198                 LEAS    -7,S                    ; Make room on stack
                      (       ddos2f.asm):04199                 
                      (       ddos2f.asm):04200         ;
                      (       ddos2f.asm):04201         ; Make a buffer for copying the file.
                      (       ddos2f.asm):04202         ;
                      (       ddos2f.asm):04203         
D3BC 1F40             (       ddos2f.asm):04204                 TFR     S,D                     ; move to D
D3BE 830100           (       ddos2f.asm):04205                 SUBD    #$0100                  ; Make room for 1 sector
D3C1 931F             (       ddos2f.asm):04206                 SUBD    <BasVarEnd              ; Will we overwrite basic ?             
D3C3 102BAF7B         (       ddos2f.asm):04207                 LBMI    BasOMError              ; yes : error, exit
                      (       ddos2f.asm):04208                 
D3C7 5F               (       ddos2f.asm):04209                 CLRB
D3C8 4D               (       ddos2f.asm):04210                 TSTA                            ; At least 1 page of ram available
D3C9 1027AF75         (       ddos2f.asm):04211                 LBEQ    BasOMError              ; no : error, exit
                      (       ddos2f.asm):04212                 
D3CD ED62             (       ddos2f.asm):04213                 STD     CopyIOBufPtr,S          ; IO buffer pointer
D3CF 170353           (       ddos2f.asm):04214                 LBSR    DosGetFilenameAndOpen
D3D2 2621             (       ddos2f.asm):04215                 BNE     LD36B                   ; Error : exit
D3D4 A7E4             (       ddos2f.asm):04216                 STA     CopySrcFCBNo,S          ; save FCB no of source
                      (       ddos2f.asm):04217                 
D3D6 17FB24           (       ddos2f.asm):04218                 LBSR    DOSGetFLen              ; Get file length
D3D9 261A             (       ddos2f.asm):04219                 BNE     LD36B
D3DB 9DA5             (       ddos2f.asm):04220                 JSR     <BasChrGetCurr          ; scan current char from params
                      (       ddos2f.asm):04221                 
D3DD 81BC             (       ddos2f.asm):04222                 CMPA    #DTokTO                 ; "TO" token (Dragon)
D3DF 1026B5D1         (       ddos2f.asm):04223                 LBNE    BasSNError              ; no : Error
                      (       ddos2f.asm):04224                 
D3E3 9D9F             (       ddos2f.asm):04225                 JSR     <BasChrGet              ; Get next character
D3E5 17033D           (       ddos2f.asm):04226                 LBSR    DosGetFilenameAndOpen   ; Get dest filename FCB number in A             
D3E8 2704             (       ddos2f.asm):04227                 BEQ     LD36E                   ; No error : continue
                      (       ddos2f.asm):04228                 
D3EA C1A0             (       ddos2f.asm):04229                 CMPB    #ErrNE          ; File not exist ?
D3EC 2607             (       ddos2f.asm):04230                 BNE     LD36B                   ; does not exit, create it
                      (       ddos2f.asm):04231         
D3EE A761             (       ddos2f.asm):04232         LD36E   STA     CopyDstFCBNo,S          ; Save destination FCB number
D3F0 17FBA5           (       ddos2f.asm):04233                 LBSR    DOSCreateFile           ; re-write destination file
D3F3 2703             (       ddos2f.asm):04234                 BEQ     LD375                   ; no error continue
                      (       ddos2f.asm):04235         
D3F5 7EC71F           (       ddos2f.asm):04236         LD36B   JMP     >DosHookSysError        ; Error : exit
                      (       ddos2f.asm):04237                 
D3F8 A6E4             (       ddos2f.asm):04238         LD375   LDA     CopySrcFCBNo,S          ; Get source FCB no
D3FA 97F1             (       ddos2f.asm):04239                 STA     <DosCurrCtrlBlk         ; Save current FCB
D3FC 17FB31           (       ddos2f.asm):04240                 LBSR    DosFCBNoToAddr          ; Get FCB address
                      (       ddos2f.asm):04241                 
                      (       ddos2f.asm):04242         ; Compare file pointer position with file length for source file
                      (       ddos2f.asm):04243         
D3FF EC0C             (       ddos2f.asm):04244                 LDD     FCBFilePointer,X        ; MSW
D401 10A38810         (       ddos2f.asm):04245                 CMPD    FCBFileLen,X
D405 2507             (       ddos2f.asm):04246                 BCS     LD38B                   ; not there yet, continue copying
                      (       ddos2f.asm):04247         
                      (       ddos2f.asm):04248         ;***    LDD     FCBFilePointer+2,X      ; LSB
                      (       ddos2f.asm):04249         ;***    CMPD    FCBFileLen+2,X
D407 A60E             (       ddos2f.asm):04250                 LDA     FCBFilePointer+2,X      ; LSB
D409 A18812           (       ddos2f.asm):04251                 CMPA    FCBFileLen+2,X
D40C 2750             (       ddos2f.asm):04252                 BEQ     LD3DB                   ; reached EOF, copy done
                      (       ddos2f.asm):04253         
D40E EE0C             (       ddos2f.asm):04254         LD38B   LDU     FCBFilePointer,X        ; get source fileptr in U:A
D410 A60E             (       ddos2f.asm):04255                 LDA     FCBFilePointer+2,X
                      (       ddos2f.asm):04256                 
D412 A766             (       ddos2f.asm):04257                 STA     CopySrcFP+2,S           ; save source filepointer
D414 EF64             (       ddos2f.asm):04258                 STU     CopySrcFP,S
                      (       ddos2f.asm):04259                 
D416 EC62             (       ddos2f.asm):04260                 LDD     CopyIOBufPtr,S          ; point to IO buff
D418 E365             (       ddos2f.asm):04261                 ADDD    CopySrcFP+1,S           ; 
D41A ED65             (       ddos2f.asm):04262                 STD     CopySrcFP+1,S
D41C 2402             (       ddos2f.asm):04263                 BCC     LD39D
                      (       ddos2f.asm):04264                 
D41E 6C64             (       ddos2f.asm):04265                 INC     CopySrcFP,S
D420 A664             (       ddos2f.asm):04266         LD39D   LDA     CopySrcFP,S
D422 A08810           (       ddos2f.asm):04267                 SUBA    FCBFileLen,X
D425 250E             (       ddos2f.asm):04268                 BCS     LD3B2
                      (       ddos2f.asm):04269                 
D427 EC65             (       ddos2f.asm):04270                 LDD     CopySrcFP+1,S
D429 A38811           (       ddos2f.asm):04271                 SUBD    FCBFileLen+1,X
D42C 2307             (       ddos2f.asm):04272                 BLS     LD3B2
                      (       ddos2f.asm):04273                 
D42E EC8811           (       ddos2f.asm):04274                 LDD     FCBFileLen+1,X
D431 A30D             (       ddos2f.asm):04275                 SUBD    FCBFilePointer+1,X
D433 ED62             (       ddos2f.asm):04276                 STD     CopyIOBufPtr,S
                      (       ddos2f.asm):04277                 
D435 A6E4             (       ddos2f.asm):04278         LD3B2   LDA     CopySrcFCBNo,S          ; retrieve source FCB no
D437 EE0C             (       ddos2f.asm):04279                 LDU     FCBFilePointer,X
D439 E60E             (       ddos2f.asm):04280                 LDB     FCBFilePointer+2,X
D43B 10AE62           (       ddos2f.asm):04281                 LDY     CopyIOBufPtr,S
D43E 9E1F             (       ddos2f.asm):04282                 LDX     BasVarEnd
D440 17F5D8           (       ddos2f.asm):04283                 LBSR    DOSFRead                ; go read source file
D443 26B0             (       ddos2f.asm):04284                 BNE     LD36B                   ; error : exit
                      (       ddos2f.asm):04285                 
D445 A661             (       ddos2f.asm):04286                 LDA     CopyDstFCBNo,S          ; get destination FCB
D447 97F1             (       ddos2f.asm):04287                 STA     <DosCurrCtrlBlk         ; make current
D449 17FAE4           (       ddos2f.asm):04288                 LBSR    DosFCBNoToAddr          ; get FCB address
                      (       ddos2f.asm):04289                 
D44C 10AE8810         (       ddos2f.asm):04290                 LDY     FCBFileLen,X
D450 E68812           (       ddos2f.asm):04291                 LDB     FCBFileLen+2,X
D453 EE62             (       ddos2f.asm):04292                 LDU     CopyIOBufPtr,S
D455 9E1F             (       ddos2f.asm):04293                 LDX     BasVarEnd
D457 17F783           (       ddos2f.asm):04294                 LBSR    DOSFWrite               ; go write to destination
                      (       ddos2f.asm):04295                 
D45A 2699             (       ddos2f.asm):04296                 BNE     LD36B                   ; error exit
D45C 209A             (       ddos2f.asm):04297                 BRA     LD375
                      (       ddos2f.asm):04298         
D45E 17FADE           (       ddos2f.asm):04299         LD3DB   LBSR    DOSCloseAll             ; close all files
D461 2692             (       ddos2f.asm):04300                 BNE     LD36B                   ; error exit
D463 3267             (       ddos2f.asm):04301                 LEAS    7,S                     ; cleanup stack
D465 39               (       ddos2f.asm):04302                 RTS
                      (       ddos2f.asm):04303         ;
                      (       ddos2f.asm):04304         ; basic MERGE command
                      (       ddos2f.asm):04305         ;
                      (       ddos2f.asm):04306         ; Merges basic program in memory with a program from disk.
                      (       ddos2f.asm):04307         ;
                      (       ddos2f.asm):04308         ; MERGE "filename"
                      (       ddos2f.asm):04309         ;
                      (       ddos2f.asm):04310         
D466                  (       ddos2f.asm):04311         CmdMerge   
D466 1702B6           (       ddos2f.asm):04312                 LBSR    DosValidateAndOpenBAS   ; open basic program file
D469 268A             (       ddos2f.asm):04313                 BNE     LD36B                   ; error, exit
                      (       ddos2f.asm):04314                 
D46B 8D7D             (       ddos2f.asm):04315                 BSR     ReadHeadGetTypeA        ; read header, get filetype             
D46D 2686             (       ddos2f.asm):04316                 BNE     LD36B                   ; error, exit
                      (       ddos2f.asm):04317                 
D46F 8101             (       ddos2f.asm):04318                 CMPA    #FTypeBas               ; is the file basic?                            
D471 263E             (       ddos2f.asm):04319                 BNE     GenFMError              ; nope, FM error, exit
                      (       ddos2f.asm):04320                 
D473 DE1B             (       ddos2f.asm):04321                 LDU     <BasVarSimpleAddr       ; point at end of basic program
D475 109E19           (       ddos2f.asm):04322                 LDY     <BasStartProg           ; point at beginning of basic program
                      (       ddos2f.asm):04323                 
D478 3460             (       ddos2f.asm):04324                 PSHS    Y,U                     ; save regs
D47A 3341             (       ddos2f.asm):04325                 LEAU    1,U                     ; point 1 byte into vars 
D47C DF19             (       ddos2f.asm):04326                 STU     <BasStartProg           ; make this the new start of basic
D47E 1700DA           (       ddos2f.asm):04327                 LBSR    DoBasLoad               ; glo load program
                      (       ddos2f.asm):04328                 
D481 3550             (       ddos2f.asm):04329                 PULS    X,U                     ; recover old start and end prog addressses
D483 DF1B             (       ddos2f.asm):04330                 STU     <BasVarSimpleAddr       ; and reset them
D485 9F19             (       ddos2f.asm):04331                 STX     <BasStartProg
D487 3341             (       ddos2f.asm):04332                 LEAU    1,U                     ; point to loaded basic program
                      (       ddos2f.asm):04333                 
D489 ECC1             (       ddos2f.asm):04334         LD409   LDD     ,U++                    ; get pointer to next line
D48B 271E             (       ddos2f.asm):04335                 BEQ     LD42B                   ; exit if zero, we have reached the end of loaded program
                      (       ddos2f.asm):04336                 
D48D ECC1             (       ddos2f.asm):04337                 LDD     ,U++                    ; get line number 
D48F FD02DA           (       ddos2f.asm):04338                 STD     BasLinInpHead           ; save it in line input buffer
D492 DD2B             (       ddos2f.asm):04339                 STD     <BasTempLine            ; save it in tem line
D494 5F               (       ddos2f.asm):04340                 CLRB                            ; clear B
D495 8E02DC           (       ddos2f.asm):04341                 LDX     #BasLinInpBuff          ; point at line input buffer
D498 5C               (       ddos2f.asm):04342         LD418   INCB                            ; increment line char count
D499 A6C0             (       ddos2f.asm):04343                 LDA     ,U+                     ; get a loaded byte
D49B A780             (       ddos2f.asm):04344                 STA     ,X+                     ; put it in line input buffer
D49D 26F9             (       ddos2f.asm):04345                 BNE     LD418                   ; loop for next, if byte not zero (EOL)
                      (       ddos2f.asm):04346         
D49F CB04             (       ddos2f.asm):04347                 ADDB    #$04                    ;
D4A1 D703             (       ddos2f.asm):04348                 STB     <BasGenCount
                      (       ddos2f.asm):04349         
D4A3 3440             (       ddos2f.asm):04350                 PSHS    U                       ; save loaded program pointer
D4A5 8D0D             (       ddos2f.asm):04351                 BSR     LD436                   ; put line in basic
D4A7 3540             (       ddos2f.asm):04352                 PULS    U                       ; recover loaded program pointer
D4A9 20DE             (       ddos2f.asm):04353                 BRA     LD409                   ; loop again
                      (       ddos2f.asm):04354         
D4AB 7F0611           (       ddos2f.asm):04355         LD42B   CLR     DosRunLoadFlag          ; clear load run flag
D4AE 160087           (       ddos2f.asm):04356                 LBRA    LD4BD                   ; finish off load
                      (       ddos2f.asm):04357         
D4B1                  (       ddos2f.asm):04358         GenFMError   
D4B1 7EB848           (       ddos2f.asm):04359                 JMP     BasFMError              ; Jump to Basic's FM error handler
                      (       ddos2f.asm):04360         
D4B4 BD83FF           (       ddos2f.asm):04361         LD436   JSR     >BasFindLineNo          ; find the line 
D4B7 2512             (       ddos2f.asm):04362                 BCS     LD44D                   ; branch if new line number
                      (       ddos2f.asm):04363                 
                      (       ddos2f.asm):04364         ; line found with the same number, delete the current line and inser the new one.
D4B9 DC47             (       ddos2f.asm):04365                 LDD     <BasFoundLineNo         ; get address of found line 
D4BB A384             (       ddos2f.asm):04366                 SUBD    ,X                      ; calculate length of founc line (-ve)
D4BD D31B             (       ddos2f.asm):04367                 ADDD    <BasVarSimpleAddr       ; add base of loaded prog to line length 
D4BF DD1B             (       ddos2f.asm):04368                 STD     <BasVarSimpleAddr       ; set end address for copy
D4C1 EE84             (       ddos2f.asm):04369                 LDU     ,X                      ; get address of next line
D4C3 A6C0             (       ddos2f.asm):04370         LD445   LDA     ,U+                     ; get a byte from next line
D4C5 A780             (       ddos2f.asm):04371                 STA     ,X+                     ; overwrite this line
D4C7 9C1B             (       ddos2f.asm):04372                 CMPX    <BasVarSimpleAddr       ; done all?     
D4C9 26F8             (       ddos2f.asm):04373                 BNE     LD445                   ; no,keep going
                      (       ddos2f.asm):04374         
D4CB DC1B             (       ddos2f.asm):04375         LD44D   LDD     <BasVarSimpleAddr       ; get new base of variables
D4CD DD43             (       ddos2f.asm):04376                 STD     <Eval43                 ; save it
D4CF DB03             (       ddos2f.asm):04377                 ADDB    <BasGenCount            ; add gencount to number of bytes moved
D4D1 8900             (       ddos2f.asm):04378                 ADCA    #$00                    ; process any carry B->A
D4D3 DD41             (       ddos2f.asm):04379                 STD     <Eval41                 ; save it
D4D5 BD831C           (       ddos2f.asm):04380                 JSR     >BasChkArrSpaceMv       ; check array space and move
                      (       ddos2f.asm):04381                 
D4D8 CE02D8           (       ddos2f.asm):04382                 LDU     #$02D8                  ; point to input buffer
D4DB A6C0             (       ddos2f.asm):04383         LD45D   LDA     ,U+                     ; get a byte from buffer        
D4DD A780             (       ddos2f.asm):04384                 STA     ,X+                     ; put it in program
D4DF 9C45             (       ddos2f.asm):04385                 CMPX    <Eval45                 ; end of line?
D4E1 26F8             (       ddos2f.asm):04386                 BNE     LD45D                   ; no keep going
D4E3 9E41             (       ddos2f.asm):04387                 LDX     <Eval41                 ; update end of basic program
D4E5 9F1B             (       ddos2f.asm):04388                 STX     <BasVarSimpleAddr
D4E7 7E83ED           (       ddos2f.asm):04389                 JMP     >BasVect2               ; re-link lines.        
                      (       ddos2f.asm):04390         
                      (       ddos2f.asm):04391         ;
                      (       ddos2f.asm):04392         ; Read a header from the open file, into the DosCurDriveInfo
                      (       ddos2f.asm):04393         ; Check that the header contacins the correct marker bytes at beginning and end.
                      (       ddos2f.asm):04394         ; If valid return file type byte in A else generate and FM error.
                      (       ddos2f.asm):04395         ;
                      (       ddos2f.asm):04396         ; Entry:
                      (       ddos2f.asm):04397         ;       DosCurrCtrlBlk  = file no to read
                      (       ddos2f.asm):04398         ;
                      (       ddos2f.asm):04399         ; Exit:
                      (       ddos2f.asm):04400         ;       A               = filetype byte from header
                      (       ddos2f.asm):04401         ;       X               = points to header block
                      (       ddos2f.asm):04402         ;       B               = Error code (despit comments in DDv2c source).
                      (       ddos2f.asm):04403         ;
                      (       ddos2f.asm):04404         
D4EA                  (       ddos2f.asm):04405         ReadHeadGetTypeA   
D4EA 8E0650           (       ddos2f.asm):04406                 LDX     #DosCurDriveInfo        ; point at current drive info
D4ED 108E0009         (       ddos2f.asm):04407                 LDY     #FileHeadLen            ; 9 bytes, header size
D4F1 DE8A             (       ddos2f.asm):04408                 LDU     <DBZero                 ; U=0 filebointer at BOF
D4F3 5F               (       ddos2f.asm):04409                 CLRB                            ; B=0
D4F4 96F1             (       ddos2f.asm):04410                 LDA     <DosCurrCtrlBlk         ; get current control block
D4F6 17F522           (       ddos2f.asm):04411                 LBSR    DOSFRead                ; read file header      
D4F9 2611             (       ddos2f.asm):04412                 BNE     LD50C                   ; error, exit
                      (       ddos2f.asm):04413                 
D4FB 8655             (       ddos2f.asm):04414         LD47E   LDA     #MarkerHeadStart        ; check for header marker bytes
D4FD 8E0650           (       ddos2f.asm):04415                 LDX     #DosCurDriveInfo        ; point at file header in buffer
D500 A184             (       ddos2f.asm):04416                 CMPA    ,X                      ; first marker present?
D502 26AD             (       ddos2f.asm):04417                 BNE     GenFMError              ; generate FM error if not
                      (       ddos2f.asm):04418                 
D504 43               (       ddos2f.asm):04419                 COMA                            ; check for second marker at end of header
D505 A108             (       ddos2f.asm):04420                 CMPA    HdrIDAA,X               ; second marker present?
D507 26A8             (       ddos2f.asm):04421                 BNE     GenFMError              ; generate FM error if not
D509 A601             (       ddos2f.asm):04422                 LDA     HdrType,X               ; get filetype in A             
D50B 5F               (       ddos2f.asm):04423                 CLRB
                      (       ddos2f.asm):04424         
D50C 39               (       ddos2f.asm):04425         LD50C   RTS
                      (       ddos2f.asm):04426         
                      (       ddos2f.asm):04427         ;
                      (       ddos2f.asm):04428         ; Load a basic or binary file into memory.
                      (       ddos2f.asm):04429         ;
                      (       ddos2f.asm):04430         ; If basic, any basic program already in memory will be overwritten 
                      (       ddos2f.asm):04431         ; and variables cleared.
                      (       ddos2f.asm):04432         ;
                      (       ddos2f.asm):04433         ; If binary, the program will be read into any location that is not ROM.
                      (       ddos2f.asm):04434         ;
                      (       ddos2f.asm):04435         ; RUN "filename"        : load and run 
                      (       ddos2f.asm):04436         ; LOAD "filename"       : load but don't run 
                      (       ddos2f.asm):04437         ;
                      (       ddos2f.asm):04438         
                      (       ddos2f.asm):04439         ; Clear various flags
D50D                  (       ddos2f.asm):04440         DosHookRun   
D50D 7F0614           (       ddos2f.asm):04441                 CLR     DosErrGotoFlag          ; Clear on error goto flag
D510 7F0619           (       ddos2f.asm):04442                 CLR     DosErrLast              ; clear last error code
D513 7F0617           (       ddos2f.asm):04443                 CLR     DosErrLineNo            ; clear last error line
D516 7F0618           (       ddos2f.asm):04444                 CLR     DosErrLineNo+1
D519 8122             (       ddos2f.asm):04445                 CMPA    #$22                    ; quote
D51B 2702             (       ddos2f.asm):04446                 BEQ     LD4A2
D51D 4D               (       ddos2f.asm):04447                 TSTA
D51E 39               (       ddos2f.asm):04448                 RTS
                      (       ddos2f.asm):04449         
D51F C601             (       ddos2f.asm):04450         LD4A2   LDB     #$01                    ; flag run
                      (       ddos2f.asm):04451         
D521 21               (       ddos2f.asm):04452                 FCB     Skip1
                      (       ddos2f.asm):04453                 
D522 5F               (       ddos2f.asm):04454         CmdLoad CLRB                            ; flag load
D523 F70611           (       ddos2f.asm):04455                 STB     DosRunLoadFlag          
D526 1701F6           (       ddos2f.asm):04456                 LBSR    DosValidateAndOpenBAS   ; check and open the basic program file
D529 2604             (       ddos2f.asm):04457                 BNE     LD52F                   ; error, exit
                      (       ddos2f.asm):04458                 
D52B 8DBD             (       ddos2f.asm):04459                 BSR     ReadHeadGetTypeA        ; read header of basic program
D52D 2703             (       ddos2f.asm):04460                 BEQ     LD532                   ; no error, continue
                      (       ddos2f.asm):04461         
D52F 7EC71F           (       ddos2f.asm):04462         LD52F   JMP     DosHookSysError         ; call error handler
                      (       ddos2f.asm):04463         
D532 8101             (       ddos2f.asm):04464         LD532   CMPA    #FTypeBas               ; is the file of type basic?
D534 2647             (       ddos2f.asm):04465                 BNE     LD504                   ; nope, go check for machine code
                      (       ddos2f.asm):04466                 
D536 8D23             (       ddos2f.asm):04467                 BSR     DoBasLoad               ; load the file into the program memory
                      (       ddos2f.asm):04468         
D538 0FF6             (       ddos2f.asm):04469         LD4BD   CLR     <DosIOInProgress        ; mark IO not in progress
                      (       ddos2f.asm):04470                 
D53A 9E19             (       ddos2f.asm):04471                 LDX     <BasStartProg           ; point at start of program
D53C BD85EE           (       ddos2f.asm):04472                 JSR     >BasSetProgPtrX         ; asjust pointer
                      (       ddos2f.asm):04473                 
D53F 9E27             (       ddos2f.asm):04474                 LDX     <AddrFWareRamTop        ; get the end of RAM
D541 9F23             (       ddos2f.asm):04475                 STX     <BasVarStrTop           ; setup string variables
                      (       ddos2f.asm):04476                 
D543 9E1B             (       ddos2f.asm):04477                 LDX     <BasVarSimpleAddr       ; arrays top = simple vars top, 
D545 9F1D             (       ddos2f.asm):04478                 STX     <BasVarArrayAddr        ; no arrays defined
                      (       ddos2f.asm):04479                 
D547 9F1F             (       ddos2f.asm):04480                 STX     BasVarEnd               ; and no simple vars defined
D549                  (       ddos2f.asm):04481         LD549   
D549 BD8514           (       ddos2f.asm):04482         LD4CE   JSR     >CmdRestore             ; perform a basic 'RESTORE' reset data pointers
D54C BD8434           (       ddos2f.asm):04483                 JSR     >BasResetStack          ; reset basic stack
                      (       ddos2f.asm):04484                 
D54F 7D0611           (       ddos2f.asm):04485                 TST     DosRunLoadFlag          ; should we run the loaded code?
D552 2703             (       ddos2f.asm):04486                 BEQ     LD4DC                   ; nope, just return
                      (       ddos2f.asm):04487                 
D554 7E849F           (       ddos2f.asm):04488                 JMP     >BasRun                 ; go run it
                      (       ddos2f.asm):04489         
D557 4F               (       ddos2f.asm):04490         LD4DC   CLRA                            ; flag no error
D558 7E8371           (       ddos2f.asm):04491                 JMP     >BasCmdMode             ; return to command mode
                      (       ddos2f.asm):04492         
                      (       ddos2f.asm):04493         ;
                      (       ddos2f.asm):04494         ; Load code of basic program
                      (       ddos2f.asm):04495         ; On entry X points to file header
                      (       ddos2f.asm):04496         ; 
                      (       ddos2f.asm):04497         
D55B                  (       ddos2f.asm):04498         DoBasLoad   
D55B EC04             (       ddos2f.asm):04499                 LDD     HdrLen,X                ; get file length
D55D 1F02             (       ddos2f.asm):04500                 TFR     D,Y                     ; get it into Y for FRead below
D55F D319             (       ddos2f.asm):04501                 ADDD    <BasStartProg           ; add the start of basic, to get the new end
                      (       ddos2f.asm):04502                 
D561 DD1F             (       ddos2f.asm):04503                 STD     BasVarEnd               ; save it 
D563 C640             (       ddos2f.asm):04504                 LDB     #$40                    ; Check we have 128 bytes free RAM
D565 BD8331           (       ddos2f.asm):04505                 JSR     >BasChkB2Free           ; go check, OM error if insufficient
                      (       ddos2f.asm):04506         
D568                  (       ddos2f.asm):04507         LD568   
D568 96F1             (       ddos2f.asm):04508         LD4ED   LDA     <DosCurrCtrlBlk         ; get current control block
D56A C609             (       ddos2f.asm):04509                 LDB     #FileHeadLen            ; start reading at byte 9
D56C 9E19             (       ddos2f.asm):04510                 LDX     <BasStartProg           ; into BasStartProg
D56E DE8A             (       ddos2f.asm):04511                 LDU     <DBZero ; U=0
D570 17F4A8           (       ddos2f.asm):04512                 LBSR    DOSFRead                ; go read it
                      (       ddos2f.asm):04513                 
D573 26BA             (       ddos2f.asm):04514                 BNE     LD52F                   ; error, try catching it
                      (       ddos2f.asm):04515                 
D575 BD83ED           (       ddos2f.asm):04516                 JSR     >BasVect2               ; tidy up after load
D578 3002             (       ddos2f.asm):04517                 LEAX    2,X                     ; point past end of program
D57A 9F1B             (       ddos2f.asm):04518                 STX     <BasVarSimpleAddr       ; save in basic vars
D57C 39               (       ddos2f.asm):04519         LD503   RTS                             ; return
                      (       ddos2f.asm):04520         
D57D 8102             (       ddos2f.asm):04521         LD504   CMPA    #FTypeBin               ; is this file a machine code program?
D57F 1026FF2E         (       ddos2f.asm):04522                 LBNE    GenFMError              ; nope, errror not basic or machine code
                      (       ddos2f.asm):04523                 
D583 EE06             (       ddos2f.asm):04524                 LDU     HdrExec,X               ; get Exec address from header
D585 DF9D             (       ddos2f.asm):04525                 STU     <BasExecAddr            ; save it in basic exec vector
                      (       ddos2f.asm):04526                 
D587 9DA5             (       ddos2f.asm):04527                 JSR     <BasChrGetCurr          ; get current character from basic
D589 2712             (       ddos2f.asm):04528                 BEQ     LD524                   ; no more, skip on
                      (       ddos2f.asm):04529                 
D58B 3410             (       ddos2f.asm):04530                 PSHS    X                       ; save X
D58D 8D6F             (       ddos2f.asm):04531                 BSR     VarGetComma16           ; get load offset in X
D58F 1F13             (       ddos2f.asm):04532                 TFR     X,U                     ; save offset in U
                      (       ddos2f.asm):04533                 
D591 3510             (       ddos2f.asm):04534                 PULS    X                       ; restore header pointer
D593 EC06             (       ddos2f.asm):04535                 LDD     HdrExec,X               ; get exec address
D595 A302             (       ddos2f.asm):04536                 SUBD    HdrLoad,X               ; subtract load address giving exec address offset
D597 EF02             (       ddos2f.asm):04537                 STU     HdrLoad,X               ; save new load address
D599 E302             (       ddos2f.asm):04538                 ADDD    HdrLoad,X               ; add exec offset to new load address
D59B DD9D             (       ddos2f.asm):04539                 STD     <BasExecAddr            ; save it in basic exec address
                      (       ddos2f.asm):04540                 
D59D 10AE04           (       ddos2f.asm):04541         LD524   LDY     HdrLen,X                ; get file length into Y
D5A0 96F1             (       ddos2f.asm):04542                 LDA     <DosCurrCtrlBlk         ; get current control block
D5A2 C609             (       ddos2f.asm):04543                 LDB     #FileHeadLen            ; set file position in U:B
D5A4 DE8A             (       ddos2f.asm):04544                 LDU     <DBZero ; U=0
D5A6 AE02             (       ddos2f.asm):04545                 LDX     HdrLoad,X               ; get load address
D5A8 17F470           (       ddos2f.asm):04546                 LBSR    DOSFRead                ; go read the file into memory
                      (       ddos2f.asm):04547                 
D5AB 2648             (       ddos2f.asm):04548                 BNE     LD5F5                   ; error, try catching it
                      (       ddos2f.asm):04549                 
D5AD 7D0611           (       ddos2f.asm):04550                 TST     DosRunLoadFlag          ; test if we should run loaded code?
D5B0 274B             (       ddos2f.asm):04551                 BEQ     LD5FD                   ; nope return to caller
D5B2 6E9F009D         (       ddos2f.asm):04552                 JMP     [>BasExecAddr]          ; exec loaded program
                      (       ddos2f.asm):04553         
                      (       ddos2f.asm):04554         ;
                      (       ddos2f.asm):04555         ; basic SAVE comamnd
                      (       ddos2f.asm):04556         ;
                      (       ddos2f.asm):04557         ; Save a basic or binary program to disk.
                      (       ddos2f.asm):04558         ;
                      (       ddos2f.asm):04559         ; If basic:
                      (       ddos2f.asm):04560         ;   SAVE "filename"
                      (       ddos2f.asm):04561         ;
                      (       ddos2f.asm):04562         ; If binary:
                      (       ddos2f.asm):04563         ;   SAVE "filename",start,end,entry
                      (       ddos2f.asm):04564         ;
                      (       ddos2f.asm):04565         ; DosCurFilename is used as a buffer to buld the file header :-
                      (       ddos2f.asm):04566         ;
                      (       ddos2f.asm):04567         ; DosCurFilename        $55
                      (       ddos2f.asm):04568         ; DosCurFilename        FileType
                      (       ddos2f.asm):04569         ; DosCurFilename+2      Start address
                      (       ddos2f.asm):04570         ; DosCurFilename+4      Length
                      (       ddos2f.asm):04571         ; DosCurFilename+6      Entry address   
                      (       ddos2f.asm):04572         ; DosCurFilename+8      $AA
                      (       ddos2f.asm):04573         ;
                      (       ddos2f.asm):04574         
D5B6                  (       ddos2f.asm):04575         CmdSave   
D5B6 BD8887           (       ddos2f.asm):04576                 JSR     >VarGetStr              ; get string into temp variable
D5B9 BD8877           (       ddos2f.asm):04577                 JSR     >VarGetExpr             ; Get address of string in FAC
D5BC 9DA5             (       ddos2f.asm):04578                 JSR     <BasChrGetCurr          ; get current basic character
D5BE 2744             (       ddos2f.asm):04579                 BEQ     LD587                   ; none, skip, it's a basic program being saved
                      (       ddos2f.asm):04580                 
D5C0 108EDFAD         (       ddos2f.asm):04581                 LDY     #DosExtBin              ; otherwise it's machine code, point to BIN extension
D5C4 8D26             (       ddos2f.asm):04582                 BSR     LD572                   ; try to open or create the file
                      (       ddos2f.asm):04583                 
D5C6 8D36             (       ddos2f.asm):04584                 BSR     VarGetComma16           ; get start address
D5C8 BF0652           (       ddos2f.asm):04585                 STX     DosCurFilename+2        ; save it away
                      (       ddos2f.asm):04586                 
D5CB 8D31             (       ddos2f.asm):04587                 BSR     VarGetComma16           ; get end address
D5CD 1F10             (       ddos2f.asm):04588                 TFR     X,D                     ; save it in D
D5CF BC0652           (       ddos2f.asm):04589                 CMPX    DosCurFilename+2        ; compare to start address      
D5D2 1025F147         (       ddos2f.asm):04590                 LBCS    DosPRError              ; PR error if it's lower
                      (       ddos2f.asm):04591                 
D5D6 B30652           (       ddos2f.asm):04592                 SUBD    DosCurFilename+2        ; subtract start address from end address giving length in D
D5D9 102BB5B0         (       ddos2f.asm):04593                 LBMI    BasFCError              ; FC error if it's -ve
                      (       ddos2f.asm):04594                 
D5DD C30001           (       ddos2f.asm):04595                 ADDD    #1
D5E0 FD0654           (       ddos2f.asm):04596                 STD     DosCurFilename+4        ; save length
                      (       ddos2f.asm):04597                 
D5E3 8D19             (       ddos2f.asm):04598                 BSR     VarGetComma16           ; get entry address
D5E5 BF0656           (       ddos2f.asm):04599                 STX     DosCurFilename+6        ; save it
                      (       ddos2f.asm):04600         
D5E8 C602             (       ddos2f.asm):04601                 LDB     #FTypeBin               ; set filetype to binary
D5EA 2032             (       ddos2f.asm):04602                 BRA     LD5A1
                      (       ddos2f.asm):04603         
D5EC 170144           (       ddos2f.asm):04604         LD572   LBSR    DosOpenFileExtY         ; get the supplied filename & try opening
D5EF 2707             (       ddos2f.asm):04605                 BEQ     LD57B                   ; all ok, skip on and create
                      (       ddos2f.asm):04606                 
D5F1 C1A0             (       ddos2f.asm):04607                 CMPB    #ErrNE          ; File does not exist error?
D5F3 2703             (       ddos2f.asm):04608                 BEQ     LD57B                   ; yes, try creating  it
                      (       ddos2f.asm):04609         
D5F5 7EC71F           (       ddos2f.asm):04610         LD5F5   JMP     DosHookSysError
                      (       ddos2f.asm):04611                 
D5F8 17F99D           (       ddos2f.asm):04612         LD57B   LBSR    DOSCreateFile           ; (re)create file
D5FB 26F8             (       ddos2f.asm):04613                 BNE     LD5F5                   ; error skip to handler
D5FD 39               (       ddos2f.asm):04614         LD5FD   RTS
                      (       ddos2f.asm):04615         ;
                      (       ddos2f.asm):04616         ; syntax check for a comma then get 16 bit integer.
                      (       ddos2f.asm):04617         ;
D5FE                  (       ddos2f.asm):04618         VarGetComma16   
D5FE BD89AA           (       ddos2f.asm):04619                 JSR     >VarCKComma             ; syntax check for comma
D601 7E8E83           (       ddos2f.asm):04620                 JMP     >VarGet16Bit            ; get 16 bit integer (in X)
                      (       ddos2f.asm):04621         
                      (       ddos2f.asm):04622         ; continuation of save code
D604 108EDFA7         (       ddos2f.asm):04623         LD587   LDY     #DosExtBas              ; point at BAS extension
D608 8DE2             (       ddos2f.asm):04624                 BSR     LD572                   ; try to create or open file
                      (       ddos2f.asm):04625                 
D60A 9E19             (       ddos2f.asm):04626                 LDX     <BasStartProg           ; get the address of the start of the basic program
D60C BF0652           (       ddos2f.asm):04627                 STX     DosCurFilename+2        ; set this as start address
                      (       ddos2f.asm):04628                 
D60F DC1B             (       ddos2f.asm):04629                 LDD     <BasVarSimpleAddr       ; address of simple vars = address of end of program
D611 9319             (       ddos2f.asm):04630                 SUBD    <BasStartProg           ; subtract address of start of program
D613 FD0654           (       ddos2f.asm):04631                 STD     DosCurFilename+4        ; save it in length
                      (       ddos2f.asm):04632                 
D616 8E8B8D           (       ddos2f.asm):04633                 LDX     #BasFCError             ; set exec address to the FC error routine
D619 BF0656           (       ddos2f.asm):04634                 STX     DosCurFilename+6        ; set it
                      (       ddos2f.asm):04635                 
D61C C601             (       ddos2f.asm):04636                 LDB     #FTypeBas               ; filetype basic
                      (       ddos2f.asm):04637         
D61E 8E0650           (       ddos2f.asm):04638         LD5A1   LDX     #DosCurFilename         ; point to DosCurFilename, used as header buffer
D621 8655             (       ddos2f.asm):04639                 LDA     #MarkerHeadStart        ; mark start of header                  
D623 A784             (       ddos2f.asm):04640                 STA     ,X                      ; save in header
D625 43               (       ddos2f.asm):04641                 COMA                            ; complement it to give end marker
D626 A708             (       ddos2f.asm):04642                 STA     HdrIDAA,X               ; save it in header
                      (       ddos2f.asm):04643                 
D628 E701             (       ddos2f.asm):04644                 STB     HdrType,X               ; set filetype
                      (       ddos2f.asm):04645                 
D62A 96F1             (       ddos2f.asm):04646                 LDA     <DosCurrCtrlBlk         ; get current control block
D62C 5F               (       ddos2f.asm):04647                 CLRB                            ; Y:B, filepointer offset = 0:0
D62D 109E8A           (       ddos2f.asm):04648                 LDY     <DBZero
D630 CE0009           (       ddos2f.asm):04649                 LDU     #FileHeadLen            ; length of header
D633 17F5A7           (       ddos2f.asm):04650                 LBSR    DOSFWrite               ; go write it   
D636 26BD             (       ddos2f.asm):04651                 BNE     LD5F5                   ; error, call error handler
                      (       ddos2f.asm):04652         
D638 96F1             (       ddos2f.asm):04653         LD5BE   LDA     <DosCurrCtrlBlk         ; get current control block
D63A C609             (       ddos2f.asm):04654                 LDB     #FileHeadLen            ; file offset, just after header
D63C BE0652           (       ddos2f.asm):04655                 LDX     DosCurFilename+2        ; get start address     
D63F FE0654           (       ddos2f.asm):04656                 LDU     DosCurFilename+4        ; get number of bytes (file len)
D642 109E8A           (       ddos2f.asm):04657                 LDY     <DBZero ; Y=0
D645 17F595           (       ddos2f.asm):04658                 LBSR    DOSFWrite               ; write the rest of the file
D648 26AB             (       ddos2f.asm):04659                 BNE     LD5F5                   ; branch on error
                      (       ddos2f.asm):04660                 
D64A 0FF6             (       ddos2f.asm):04661                 CLR     <DosIOInProgress        ; clear file io
D64C 39               (       ddos2f.asm):04662                 RTS
                      (       ddos2f.asm):04663         
                      (       ddos2f.asm):04664         ;
                      (       ddos2f.asm):04665         ; Basic CHAIN command 
                      (       ddos2f.asm):04666         ;
                      (       ddos2f.asm):04667         ; The command will save all of the users simple variables, arrays and strings.
                      (       ddos2f.asm):04668         ; It will re-initialize the stack so as to flush and FOR-NEXT loops or pending
                      (       ddos2f.asm):04669         ; RETURNS.
                      (       ddos2f.asm):04670         ; It will also reset the READ-DATA pointer back to the beginning of the program. 
                      (       ddos2f.asm):04671         ;
                      (       ddos2f.asm):04672         ; CHAIN "progname"
                      (       ddos2f.asm):04673         ; CHAIN "progname",runline
                      (       ddos2f.asm):04674         ;
                      (       ddos2f.asm):04675         ; Significantly re-arranged from DDv1, to make more space efficient.
                      (       ddos2f.asm):04676         ;
                      (       ddos2f.asm):04677         
D64D                  (       ddos2f.asm):04678         CmdChain   
D64D 8D75             (       ddos2f.asm):04679                 BSR     LD6C4                   ; check and move strings to string area if needed
                      (       ddos2f.asm):04680                 
D64F 1700CD           (       ddos2f.asm):04681                 LBSR    DosValidateAndOpenBAS   ; check and open the basic program file
D652 26A1             (       ddos2f.asm):04682                 BNE     LD5F5                   ; error : exit
                      (       ddos2f.asm):04683                 
D654 17FE93           (       ddos2f.asm):04684                 LBSR    ReadHeadGetTypeA        ; go read the file's header, type in A
D657 269C             (       ddos2f.asm):04685                 BNE     LD5F5                   ; error : exit
                      (       ddos2f.asm):04686                 
D659 8101             (       ddos2f.asm):04687                 CMPA    #FTypeBas               ; make sure it's a basic program type
D65B 1026FE52         (       ddos2f.asm):04688                 LBNE    GenFMError              ; nope : generate FM error
                      (       ddos2f.asm):04689                 
D65F 9DA5             (       ddos2f.asm):04690                 JSR     <BasChrGetCurr          ; get current character from basic
D661 270F             (       ddos2f.asm):04691                 BEQ     LD672                   ; none, assume default line no
                      (       ddos2f.asm):04692         
D663 BD89AA           (       ddos2f.asm):04693                 JSR     VarCKComma              ; syntax check for comma, error if not
D666 BD869A           (       ddos2f.asm):04694                 JSR     BasGetLineNo            ; get line number from basic
                      (       ddos2f.asm):04695         
D669 8D12             (       ddos2f.asm):04696                 BSR     LD67D                   ; move vars to accomodate new program
                      (       ddos2f.asm):04697         
D66B DC2B             (       ddos2f.asm):04698                 LDD     <BasTempLine            ; get line from basic
D66D BD85E7           (       ddos2f.asm):04699                 JSR     BasSkipLineNo           ; 'goto' that line
                      (       ddos2f.asm):04700         
D670 2008             (       ddos2f.asm):04701                 BRA     LD67A
                      (       ddos2f.asm):04702         
D672 8D09             (       ddos2f.asm):04703         LD672   BSR     LD67D                   ; move vars to accomodate new program
                      (       ddos2f.asm):04704         
D674 DE19             (       ddos2f.asm):04705                 LDU     <BasStartProg           ; point at beginning of program
D676 335F             (       ddos2f.asm):04706                 LEAU    -1,U                    ; decrement by 1
D678 DFA6             (       ddos2f.asm):04707                 STU     <BasAddrSigByte         ; move basic's input pointer to start
D67A 7ED549           (       ddos2f.asm):04708         LD67A   JMP     LD549                   ; jump into CmdLoad
                      (       ddos2f.asm):04709         
D67D FC0654           (       ddos2f.asm):04710         LD67D   LDD     DosCurDriveInfo+HdrLen  ; get length of file to chain
D680 1F02             (       ddos2f.asm):04711                 TFR     D,Y                     ; save it 
D682 D319             (       ddos2f.asm):04712                 ADDD    <BasStartProg           ; work out where chained program will end
D684 931B             (       ddos2f.asm):04713                 SUBD    <BasVarSimpleAddr       ; work out offset to current start of vars
D686 3406             (       ddos2f.asm):04714                 PSHS    D                       ; save it
                      (       ddos2f.asm):04715                 
D688 D31F             (       ddos2f.asm):04716                 ADDD    BasVarEnd               ; add offset to end of simple vars
D68A DD1F             (       ddos2f.asm):04717                 STD     BasVarEnd               ; and update end of simple vars
D68C C640             (       ddos2f.asm):04718                 LDB     #$40                    ; reserve 128 bytes of storage
D68E F70611           (       ddos2f.asm):04719                 STB     DosRunLoadFlag          ; flag we want to run it once loaded
D691 BD8331           (       ddos2f.asm):04720                 JSR     >BasChkB2Free           ; check to see if free, error if not
                      (       ddos2f.asm):04721                 
D694 ECE4             (       ddos2f.asm):04722                 LDD     ,S                      ; get offset between new end of prog and beginning 
                      (       ddos2f.asm):04723                                                 ; of vars
D696 2A0F             (       ddos2f.asm):04724                 BPL     LD611                   ; branch if positive
                      (       ddos2f.asm):04725         
                      (       ddos2f.asm):04726         ; -ve offset move vars down, staring at beginning so as not to overwrite ourselves
D698 9E1B             (       ddos2f.asm):04727                 LDX     <BasVarSimpleAddr       ; point at beginning of vars
D69A 338B             (       ddos2f.asm):04728                 LEAU    D,X                     ; add offset
                      (       ddos2f.asm):04729         
D69C A680             (       ddos2f.asm):04730         LD606   LDA     ,X+                     ; get a byte from current vars area
D69E A7C0             (       ddos2f.asm):04731                 STA     ,U+                     ; save it in new vars area
D6A0 11931F           (       ddos2f.asm):04732                 CMPU    BasVarEnd               ; reached end of vars yet
D6A3 23F7             (       ddos2f.asm):04733                 BLS     LD606                   ; nope, loop again
                      (       ddos2f.asm):04734                 
D6A5 200E             (       ddos2f.asm):04735                 BRA     LD61F                   ; branch on over other copy loop
                      (       ddos2f.asm):04736         
                      (       ddos2f.asm):04737         ; +ve offset move vars down, staring at end so as not to overwrite ourselves
D6A7 9E1F             (       ddos2f.asm):04738         LD611   LDX     BasVarEnd               ; point to end of vars
D6A9 3001             (       ddos2f.asm):04739                 LEAX    1,X                     ; add 1
D6AB 338B             (       ddos2f.asm):04740                 LEAU    D,X                     ; add offset
                      (       ddos2f.asm):04741                 
D6AD A682             (       ddos2f.asm):04742         LD617   LDA     ,-X                     ; get a byte from current vars area
D6AF A7C2             (       ddos2f.asm):04743                 STA     ,-U                     ; save it in new vars area
D6B1 9C1B             (       ddos2f.asm):04744                 CMPX    <BasVarSimpleAddr       ; reached beginning of vars?
D6B3 24F8             (       ddos2f.asm):04745                 BCC     LD617                   ; nope, loop again
                      (       ddos2f.asm):04746                 
D6B5 ECE4             (       ddos2f.asm):04747         LD61F   LDD     ,S                      ; get offset 
D6B7 D31B             (       ddos2f.asm):04748                 ADDD    <BasVarSimpleAddr       ; add simple vars address
D6B9 DD1B             (       ddos2f.asm):04749                 STD     <BasVarSimpleAddr       ; save updated address
                      (       ddos2f.asm):04750                 
D6BB 3506             (       ddos2f.asm):04751                 PULS    D                       ; pull offset
D6BD D31D             (       ddos2f.asm):04752                 ADDD    <BasVarArrayAddr        ; add beginning of arrays address
D6BF DD1D             (       ddos2f.asm):04753                 STD     <BasVarArrayAddr        ; save updated address
D6C1 7ED568           (       ddos2f.asm):04754                 JMP     LD568                   ; branch into CmdLoad, to load program
                      (       ddos2f.asm):04755                 
                      (       ddos2f.asm):04756         ; scan simple variable and array areas, for any string variables, check if they 
                      (       ddos2f.asm):04757         ; already reside in the cleared string area at the top of RAM. If not move them
                      (       ddos2f.asm):04758         ; there. This is done as strings may be defined as literals within the program text
                      (       ddos2f.asm):04759         ; these will be erased when chaining a program so we need to move them so they 
                      (       ddos2f.asm):04760         ; persist.
                      (       ddos2f.asm):04761         
                      (       ddos2f.asm):04762         ;LD669   LDU     <BasAddrSigByte                ; get address of current basic program pointer
                      (       ddos2f.asm):04763         ;        PSHS    X,U                    ; save regs
                      (       ddos2f.asm):04764                 
D6C4 9E1B             (       ddos2f.asm):04765         LD6C4   LDX     <BasVarSimpleAddr       ; point at simple variables
D6C6 3002             (       ddos2f.asm):04766                 LEAX    2,X                     ; add 2
D6C8 9C1D             (       ddos2f.asm):04767         LD671   CMPX    <BasVarArrayAddr        ; compare to address of array variables
D6CA 240A             (       ddos2f.asm):04768                 BCC     LD67F                   ; Found end, branch and do arrays
                      (       ddos2f.asm):04769                 
D6CC 6D1F             (       ddos2f.asm):04770                 TST     -1,X                    ; test second character of var name
D6CE 2A02             (       ddos2f.asm):04771                 BPL     LD67B                   ; branch if numeric
D6D0 8D2C             (       ddos2f.asm):04772                 BSR     LD6AD                   ; check and move string to string area if needed
                      (       ddos2f.asm):04773                 
D6D2 3007             (       ddos2f.asm):04774         LD67B   LEAX    7,X                     ; move to next simple var
D6D4 20F2             (       ddos2f.asm):04775                 BRA     LD671                   ; loop again
                      (       ddos2f.asm):04776         
D6D6 DE1D             (       ddos2f.asm):04777         LD67F   LDU     <BasVarArrayAddr        ; point at array area
D6D8 11931F           (       ddos2f.asm):04778         LD681   CMPU    BasVarEnd               ; at end of arrays ?
D6DB 241E             (       ddos2f.asm):04779                 BCC     LD6A5                   ; yep, exit
                      (       ddos2f.asm):04780                 
D6DD EC42             (       ddos2f.asm):04781                 LDD     2,U                     ; get length of array
D6DF 30CB             (       ddos2f.asm):04782                 LEAX    D,U                     ; point X at array base + len
D6E1 3410             (       ddos2f.asm):04783                 PSHS    X                       ; save X
                      (       ddos2f.asm):04784                 
D6E3 6D41             (       ddos2f.asm):04785                 TST     1,U                     ; test array name for string array
D6E5 2A10             (       ddos2f.asm):04786                 BPL     LD6A1                   ; it's numeric, skip on
                      (       ddos2f.asm):04787                 
D6E7 E644             (       ddos2f.asm):04788                 LDB     4,U                     ; get number of dimensions
D6E9 4F               (       ddos2f.asm):04789                 CLRA                            ; zero MSB
D6EA 58               (       ddos2f.asm):04790                 ASLB                            ; multiply no of dimensions, by 2 
                      (       ddos2f.asm):04791                                                 ; as dimension lengths are each 2 bytes
D6EB 30CB             (       ddos2f.asm):04792                 LEAX    D,U                     ; point X at beginning of array data
D6ED 3005             (       ddos2f.asm):04793                 LEAX    5,X                     ; add on header size
                      (       ddos2f.asm):04794                 
D6EF 8D0D             (       ddos2f.asm):04795         LD698   BSR     LD6AD                   ; check string descriptor and move to string space if needed
D6F1 3005             (       ddos2f.asm):04796                 LEAX    5,X                     ; move to next descriptor in array
D6F3 ACE4             (       ddos2f.asm):04797                 CMPX    ,S                      ; reached the end of this array yet?
D6F5 25F8             (       ddos2f.asm):04798                 BCS     LD698                   ; nope, keep checking
                      (       ddos2f.asm):04799                 
D6F7 3540             (       ddos2f.asm):04800         LD6A1   PULS    U                       ; restore pointer to next array
D6F9 20DD             (       ddos2f.asm):04801                 BRA     LD681                   ; and loop again
                      (       ddos2f.asm):04802         
D6FB 7E8CD7           (       ddos2f.asm):04803         LD6A5   Jmp     >VarGarbageCollect      ; garbage collect
                      (       ddos2f.asm):04804         
                      (       ddos2f.asm):04805         ; move a string into the string area if not null and not already there.
                      (       ddos2f.asm):04806         ; enter with X pointing to the descriptor of the string to move, typically from
                      (       ddos2f.asm):04807         ; the simple variables area
                      (       ddos2f.asm):04808         
D6FE 3450             (       ddos2f.asm):04809         LD6AD   PSHS    X,U                     ; save regs
D700 9C21             (       ddos2f.asm):04810                 CMPX    <BasVarStringBase       ; is string in string area in high memory?
D702 2413             (       ddos2f.asm):04811                 BCC     LD6C6                   ; yes, no need to move it
                      (       ddos2f.asm):04812                 
D704 E684             (       ddos2f.asm):04813                 LDB     ,X                      ; get string length
D706 270F             (       ddos2f.asm):04814                 BEQ     LD6C6                   ; no need to move null string
                      (       ddos2f.asm):04815                 
D708 BD8CB3           (       ddos2f.asm):04816                 JSR     >BasResStr2             ; reserve bytes in string area for B bytes
D70B 1F13             (       ddos2f.asm):04817                 TFR     X,U                     ; point U at new string         
D70D 10AEE4           (       ddos2f.asm):04818                 LDY     ,S                      ; point y at old string
D710 AE22             (       ddos2f.asm):04819                 LDX     2,Y                     ; get address of old string data
D712 EF22             (       ddos2f.asm):04820                 STU     2,Y                     ; update sescriptor's string pointer with new string
D714 BDB7CC           (       ddos2f.asm):04821                 JSR     >UtilCopyBXtoU          ; copy the string data
D717 35D0             (       ddos2f.asm):04822         LD6C6   PULS    X,U,PC                  ; restore and return
                      (       ddos2f.asm):04823         
                      (       ddos2f.asm):04824         ;
                      (       ddos2f.asm):04825         ; Validate and open DAT file supplied on command
                      (       ddos2f.asm):04826         ;
                      (       ddos2f.asm):04827         
D719                  (       ddos2f.asm):04828         DosValidateAndOpenDAT   
D719 108EDFAA         (       ddos2f.asm):04829                 LDY     #DosExtDat              ; get pointer to extension 'DAT'
D71D 200A             (       ddos2f.asm):04830                 BRA     DosGetFilenameAndOpenExt
                      (       ddos2f.asm):04831         
                      (       ddos2f.asm):04832         ;
                      (       ddos2f.asm):04833         ; Validate and open Basic program file supplied on command
                      (       ddos2f.asm):04834         ;
                      (       ddos2f.asm):04835         
D71F                  (       ddos2f.asm):04836         DosValidateAndOpenBAS   
D71F 108EDFA7         (       ddos2f.asm):04837                 LDY     #DosExtBas              ; get pointer to extension 'BAS'
D723 2004             (       ddos2f.asm):04838                 BRA     DosGetFilenameAndOpenExt
                      (       ddos2f.asm):04839         
                      (       ddos2f.asm):04840         ;
                      (       ddos2f.asm):04841         ; Get a filename from Dos and open it
                      (       ddos2f.asm):04842         ;       Takes a string supplied on command name, fetches it and
                      (       ddos2f.asm):04843         ;       tries to open the file of that name.
                      (       ddos2f.asm):04844         ; 
                      (       ddos2f.asm):04845         ; If entered at DosGetFilenameAndOpenExt then extension must be pointed to by Y
                      (       ddos2f.asm):04846         ;
                      (       ddos2f.asm):04847         ; Exits with :-
                      (       ddos2f.asm):04848         ;       A       = FCB number for opened file
                      (       ddos2f.asm):04849         ;       B       = Error code 
                      (       ddos2f.asm):04850         ;       Y       = ptr to extension
                      (       ddos2f.asm):04851         ;
                      (       ddos2f.asm):04852         
D725                  (       ddos2f.asm):04853         DosGetFilenameAndOpen   
D725 108EDFB0         (       ddos2f.asm):04854                 LDY     #DosExtNone             ; Point to Blank extension
                      (       ddos2f.asm):04855         
D729                  (       ddos2f.asm):04856         DosGetFilenameAndOpenExt   
D729 3420             (       ddos2f.asm):04857                 PSHS    Y                       ; save extension pointer
D72B BD8887           (       ddos2f.asm):04858                 JSR     >VarGetStr              ; get string into temp variable
D72E BD8877           (       ddos2f.asm):04859                 JSR     >VarGetExpr             ; Get address of string in FAC
D731 3520             (       ddos2f.asm):04860                 PULS    Y
                      (       ddos2f.asm):04861                 
D733                  (       ddos2f.asm):04862         DosOpenFileExtY   
D733 9E52             (       ddos2f.asm):04863                 LDX     <FPA0+2                 ; get address of filename string
D735 3410             (       ddos2f.asm):04864                 PSHS    X
D737 E684             (       ddos2f.asm):04865                 LDB     ,X                      ; Get string length
D739 AE02             (       ddos2f.asm):04866                 LDX     2,X                     ; Get pointer to actual string data
D73B 17F100           (       ddos2f.asm):04867                 LBSR    DosValidateAndOpen      ; Validate & open file (if valid)
D73E 3510             (       ddos2f.asm):04868                 PULS    X
D740 3406             (       ddos2f.asm):04869                 PSHS    D
D742 BD8D9F           (       ddos2f.asm):04870                 JSR     >VarDelVar              ; delete var
D745 3506             (       ddos2f.asm):04871                 PULS    D
D747 5D               (       ddos2f.asm):04872                 TSTB                            ; Test error and set flags
D748 39               (       ddos2f.asm):04873                 RTS
                      (       ddos2f.asm):04874         
                      (       ddos2f.asm):04875         ; 
                      (       ddos2f.asm):04876         ; Close 1 or all files.
                      (       ddos2f.asm):04877         ;
                      (       ddos2f.asm):04878         
D749                  (       ddos2f.asm):04879         DosCloseAllFiles   
D749 860A             (       ddos2f.asm):04880                 LDA     #$0A                    ; set current control block to 10
D74B 97F1             (       ddos2f.asm):04881                 STA     <DosCurrCtrlBlk
                      (       ddos2f.asm):04882                 
D74D 17F807           (       ddos2f.asm):04883         LD6FF   LBSR    DosCloseFile2           ; Try to close the file for this block
D750 2619             (       ddos2f.asm):04884                 BNE     LD71D                   ; error : call error handler
                      (       ddos2f.asm):04885                 
D752 0AF1             (       ddos2f.asm):04886                 DEC     <DosCurrCtrlBlk         ; do next
D754 2AF7             (       ddos2f.asm):04887                 BPL     LD6FF
                      (       ddos2f.asm):04888                 
D756                  (       ddos2f.asm):04889         LD756
D756 0FF6             (       ddos2f.asm):04890         LD708   CLR     <DosIOInProgress        ; flag no dos io 
D758 39               (       ddos2f.asm):04891         LD70A   RTS
                      (       ddos2f.asm):04892         
                      (       ddos2f.asm):04893         ; The code between LD70B to the instruction before LD71D seems unused.....
D759 2FFD             (       ddos2f.asm):04894         LD70B   BLE     LD70A
D75B AEE4             (       ddos2f.asm):04895                 LDX     ,S
D75D 8CB7EE           (       ddos2f.asm):04896                 CMPX    #$B7EE
D760 26F6             (       ddos2f.asm):04897                 BNE     LD70A
D762 3262             (       ddos2f.asm):04898                 LEAS    2,S
D764 D7EB             (       ddos2f.asm):04899                 STB     <DosDriveNo
D766 17F7D6           (       ddos2f.asm):04900                 LBSR    DOSCloseAll
D769 27EB             (       ddos2f.asm):04901                 BEQ     LD708
                      (       ddos2f.asm):04902         
D76B 7EC71F           (       ddos2f.asm):04903         LD71D   JMP     >DosHookSysError
                      (       ddos2f.asm):04904         
D76E                  (       ddos2f.asm):04905         DosHookReadInput   
D76E 8DD9             (       ddos2f.asm):04906                 BSR     DosCloseAllFiles        ; close all files
D770 7EDB69           (       ddos2f.asm):04907                 JMP     >CheckAndDoAuto         ; check see if auto active, if so do it
                      (       ddos2f.asm):04908         
                      (       ddos2f.asm):04909         ;
                      (       ddos2f.asm):04910         ; CREATE command dispatch routine
                      (       ddos2f.asm):04911         ;
                      (       ddos2f.asm):04912         ; Syntax :
                      (       ddos2f.asm):04913         ;
                      (       ddos2f.asm):04914         ;       CREATE "filename",size_in_bytes
                      (       ddos2f.asm):04915         ;
                      (       ddos2f.asm):04916         
D773                  (       ddos2f.asm):04917         CmdCreate   
D773 8DA4             (       ddos2f.asm):04918                 BSR     DosValidateAndOpenDAT   ; validate and open the supplied filename
D775 2708             (       ddos2f.asm):04919                 BEQ     LD732                   ; branch if no error
                      (       ddos2f.asm):04920                 
D777 C19E             (       ddos2f.asm):04921                 CMPB    #ErrFE          ; check for file exists
D779 2704             (       ddos2f.asm):04922                 BEQ     LD732                   ; if it exists just set length
                      (       ddos2f.asm):04923                 
D77B C1A0             (       ddos2f.asm):04924                 CMPB    #ErrNE          ; File does not exist error
D77D 26EC             (       ddos2f.asm):04925                 BNE     LD71D                   ; call error handler
                      (       ddos2f.asm):04926                 
D77F 96F1             (       ddos2f.asm):04927         LD732   LDA     <DosCurrCtrlBlk         ; get current control block
D781 17F814           (       ddos2f.asm):04928                 LBSR    DOSCreateFile           ; go create the file
D784 26E5             (       ddos2f.asm):04929                 BNE     LD71D                   ; if error, call the error handler
                      (       ddos2f.asm):04930                 
D786 9DA5             (       ddos2f.asm):04931                 JSR     <BasChrGetCurr          ; get current character from basic
D788 2736             (       ddos2f.asm):04932                 BEQ     LD773                   ; nothing, return, crate zero length file
                      (       ddos2f.asm):04933                 
D78A BD89AA           (       ddos2f.asm):04934                 JSR     >VarCKComma             ; syntax check for comma 
D78D BD8887           (       ddos2f.asm):04935                 JSR     >VarGetStr
                      (       ddos2f.asm):04936                 
D790 17013F           (       ddos2f.asm):04937                 LBSR    Get24bitUA              ; get filesize?
D793 0D51             (       ddos2f.asm):04938         LD746   TST     <FPA0+1
D795 2712             (       ddos2f.asm):04939                 BEQ     LD75C
                      (       ddos2f.asm):04940                 
D797 CCFF00           (       ddos2f.asm):04941                 LDD     #$FF00                  ; claculate ammount to extend file by
D79A 8D1F             (       ddos2f.asm):04942                 BSR     LD76E
                      (       ddos2f.asm):04943                 
D79C DC52             (       ddos2f.asm):04944                 LDD     <FPA0+2
D79E 83FF00           (       ddos2f.asm):04945                 SUBD    #$FF00
D7A1 DD52             (       ddos2f.asm):04946                 STD     <FPA0+2
D7A3 24EE             (       ddos2f.asm):04947                 BCC     LD746
                      (       ddos2f.asm):04948                 
D7A5 0A51             (       ddos2f.asm):04949                 DEC     <FPA0+1
D7A7 26EA             (       ddos2f.asm):04950                 BNE     LD746
                      (       ddos2f.asm):04951                 
D7A9 DC52             (       ddos2f.asm):04952         LD75C   LDD     <FPA0+2
D7AB 2713             (       ddos2f.asm):04953                 BEQ     LD773
                      (       ddos2f.asm):04954                 
D7AD 1083FF00         (       ddos2f.asm):04955                 CMPD    #$FF00
D7B1 2308             (       ddos2f.asm):04956                 BLS     LD76E
                      (       ddos2f.asm):04957                 
D7B3 83FF00           (       ddos2f.asm):04958                 SUBD    #$FF00
D7B6 8D03             (       ddos2f.asm):04959                 BSR     LD76E
                      (       ddos2f.asm):04960                 
D7B8 CCFF00           (       ddos2f.asm):04961                 LDD     #$FF00
                      (       ddos2f.asm):04962         
D7BB 17F4B2           (       ddos2f.asm):04963         LD76E   LBSR    ExtendFile              ; extend file
D7BE 26AB             (       ddos2f.asm):04964                 BNE     LD71D                   ; call error handler if error
D7C0 39               (       ddos2f.asm):04965         LD773   RTS
                      (       ddos2f.asm):04966         
                      (       ddos2f.asm):04967         ;
                      (       ddos2f.asm):04968         ; Remove a file from disk directory, deallocate any space on the disk
                      (       ddos2f.asm):04969         ; for this file.
                      (       ddos2f.asm):04970         ;
                      (       ddos2f.asm):04971         ;   KILL "filename"
                      (       ddos2f.asm):04972         ;
                      (       ddos2f.asm):04973         
D7C1                  (       ddos2f.asm):04974         CmdKill   
D7C1 17FF61           (       ddos2f.asm):04975                 LBSR    DosGetFilenameAndOpen   ; find the filename and open it
D7C4 2605             (       ddos2f.asm):04976                 BNE     LD77E                   ; error, exit
                      (       ddos2f.asm):04977                 
D7C6 17F871           (       ddos2f.asm):04978                 LBSR    DOSDeleteFile           ; delete the file
D7C9 278B             (       ddos2f.asm):04979                 BEQ     LD708                   ; no error, return to basic
                      (       ddos2f.asm):04980                 
D7CB 7EC71F           (       ddos2f.asm):04981         LD77E   JMP     >DosHookSysError        ; call error handler
                      (       ddos2f.asm):04982         
                      (       ddos2f.asm):04983         ;
                      (       ddos2f.asm):04984         ; Protect/unprotect a file.
                      (       ddos2f.asm):04985         ;
                      (       ddos2f.asm):04986         ;   PROTECT "filename"          turns ON protection
                      (       ddos2f.asm):04987         ;   PROTECT ON "filename"       turns ON protection
                      (       ddos2f.asm):04988         ;   PROTECT OFF "filename"      turns OFF protection
                      (       ddos2f.asm):04989         ;
                      (       ddos2f.asm):04990         
D7CE                  (       ddos2f.asm):04991         CmdProtect   
D7CE 4D               (       ddos2f.asm):04992                 TSTA                            ; test current character
D7CF 2A0A             (       ddos2f.asm):04993                 BPL     BasProtectOn            ; go get filename, protect on
                      (       ddos2f.asm):04994                 
D7D1 81C2             (       ddos2f.asm):04995                 CMPA    #DTokOFF                ; 'OFF' token?
D7D3 2719             (       ddos2f.asm):04996                 BEQ     BasProtectOff           ; yep go deal with it
                      (       ddos2f.asm):04997                 
D7D5 8188             (       ddos2f.asm):04998                 CMPA    #DTokON                 ; 'ON' token
D7D7 1026B1D9         (       ddos2f.asm):04999                 LBNE    BasSNError              ; nope, SN error
                      (       ddos2f.asm):05000         
D7DB                  (       ddos2f.asm):05001         BasProtectOn
D7DB 8D08             (       ddos2f.asm):05002                 BSR     LD798                   ; get filename
D7DD C601             (       ddos2f.asm):05003                 LDB     #$01                    ; flag protect on
D7DF 17F93E           (       ddos2f.asm):05004         LD792   LBSR    DOSProtectMC            ; go turn it off/on
D7E2 26E7             (       ddos2f.asm):05005                 BNE     LD77E                   ; Go handle errors
D7E4 39               (       ddos2f.asm):05006                 RTS
                      (       ddos2f.asm):05007         
D7E5 1728B7           (       ddos2f.asm):05008         LD798   LBSR    BasChrGet               ; get a character from basic
D7E8 17FF3A           (       ddos2f.asm):05009                 LBSR    DosGetFilenameAndOpen   ; get the filename and open file
D7EB 2625             (       ddos2f.asm):05010                 BNE     LD7C4                   ; Go handle errors
D7ED 39               (       ddos2f.asm):05011                 RTS
                      (       ddos2f.asm):05012         
D7EE                  (       ddos2f.asm):05013         BasProtectOff   
D7EE 8DF5             (       ddos2f.asm):05014                 BSR     LD798                   ; go get filename
D7F0 5F               (       ddos2f.asm):05015                 CLRB                            ; flag protect off
D7F1 20EC             (       ddos2f.asm):05016                 BRA     LD792                   ; go do it
                      (       ddos2f.asm):05017         
                      (       ddos2f.asm):05018         ;
                      (       ddos2f.asm):05019         ; Rename a file.
                      (       ddos2f.asm):05020         ;
                      (       ddos2f.asm):05021         ;   RENAME "oldname" TO "newname"
                      (       ddos2f.asm):05022         ;
                      (       ddos2f.asm):05023         
D7F3                  (       ddos2f.asm):05024         CmdRename   
D7F3 17FF2F           (       ddos2f.asm):05025                 LBSR    DosGetFilenameAndOpen   ; get first filename and open it
D7F6 261A             (       ddos2f.asm):05026                 BNE     LD7C4                   ; error, exit
                      (       ddos2f.asm):05027                 
D7F8 3402             (       ddos2f.asm):05028                 PSHS    A                       ; save FIB no
D7FA C6BC             (       ddos2f.asm):05029                 LDB     #DTokTO                 ; check for 'TO' token
D7FC BD89AC           (       ddos2f.asm):05030                 JSR     >VarCKChar              ; syntax check for it
                      (       ddos2f.asm):05031                 
D7FF 17FF23           (       ddos2f.asm):05032                 LBSR    DosGetFilenameAndOpen   ; get second filename and open
D802 270C             (       ddos2f.asm):05033                 BEQ     LD7C2                   ; generate error
                      (       ddos2f.asm):05034                 
D804 C1A0             (       ddos2f.asm):05035                 CMPB    #ErrNE                  ; Error from open "Not exist"?
D806 260A             (       ddos2f.asm):05036                 BNE     LD7C4                   ; no, real error
                      (       ddos2f.asm):05037                 
D808 3502             (       ddos2f.asm):05038                 PULS    A                       ; restore FCB no
D80A 17F945           (       ddos2f.asm):05039                 LBSR    DOSRename               ; go change the name.
D80D 2603             (       ddos2f.asm):05040                 BNE     LD7C4                   ; deal with error
D80F 39               (       ddos2f.asm):05041                 RTS
                      (       ddos2f.asm):05042         
D810 C69E             (       ddos2f.asm):05043         LD7C2   LDB     #ErrFE                  ; File exists error for destinatiion file
D812 7EC71F           (       ddos2f.asm):05044         LD7C4   JMP     >DosHookSysError        ; deal with errors
                      (       ddos2f.asm):05045                 
                      (       ddos2f.asm):05046         ;
                      (       ddos2f.asm):05047         ; Basic FLREAD.
                      (       ddos2f.asm):05048         ; 
                      (       ddos2f.asm):05049         ; FREAD "filename",FROM xx, FOR yy; variable list
                      (       ddos2f.asm):05050         ;
                      (       ddos2f.asm):05051         ;       0 > xx > 350208
                      (       ddos2f.asm):05052         ;       0 > yy > 255
                      (       ddos2f.asm):05053         ;
                      (       ddos2f.asm):05054         
D815                  (       ddos2f.asm):05055         CmdFLRead   
D815 8D0D             (       ddos2f.asm):05056                 BSR     FLReadSetup             ; get setup for read open file etc
D817 86FF             (       ddos2f.asm):05057                 LDA     #$FF                    ; flag FLREAD
D819 B70612           (       ddos2f.asm):05058                 STA     DosFlFreadFlag
D81C 170197           (       ddos2f.asm):05059                 LBSR    LD969                   ; do the read
D81F 8D30             (       ddos2f.asm):05060                 BSR     LD803                   ; fix the pointers
D821 7E9DD9           (       ddos2f.asm):05061                 JMP     >BasLineInputEntry      ; finish off input put it into string
                      (       ddos2f.asm):05062                 
                      (       ddos2f.asm):05063         
D824                  (       ddos2f.asm):05064         FLReadSetup   
D824 17FEF2           (       ddos2f.asm):05065                 LBSR    DosValidateAndOpenDAT   ; validate filename and open it
D827 2652             (       ddos2f.asm):05066                 BNE     LD82D                   ; error, exit
                      (       ddos2f.asm):05067                 
D829 8D53             (       ddos2f.asm):05068                 BSR     FLRWGetNamePos          ; get name of file, and filepointer pos
D82B 17F702           (       ddos2f.asm):05069                 LBSR    DosFCBNoToAddr          ; get address of FCB in X
                      (       ddos2f.asm):05070                 
D82E 7D067E           (       ddos2f.asm):05071                 TST     DosTemp2                ; did we set the filepointer
D831 270A             (       ddos2f.asm):05072                 BEQ     LD7F0                   ; branch if not
                      (       ddos2f.asm):05073                 
D833 FE0664           (       ddos2f.asm):05074                 LDU     DosFWriteAddr           ; get offset to read from
D836 F60666           (       ddos2f.asm):05075                 LDB     DosFWriteAddr+2
D839 EF0C             (       ddos2f.asm):05076                 STU     FCBFilePointer,X        ; copy to FCB
D83B E70E             (       ddos2f.asm):05077                 STB     FCBFilePointer+2,X
                      (       ddos2f.asm):05078                 
D83D 1701E9           (       ddos2f.asm):05079         LD7F0   LBSR    LD9DC                   ; check and read file
D840 8E02DC           (       ddos2f.asm):05080                 LDX     #BasLinInpBuff          ; point at basic input buffer
D843 6F84             (       ddos2f.asm):05081                 CLR     ,X                      ; clear fist byte
D845 172857           (       ddos2f.asm):05082                 LBSR    BasChrGet               ; go read from buffer.
D848 39               (       ddos2f.asm):05083                 RTS                             
                      (       ddos2f.asm):05084         
                      (       ddos2f.asm):05085         ;
                      (       ddos2f.asm):05086         ; Basic FREAD command
                      (       ddos2f.asm):05087         ; 
                      (       ddos2f.asm):05088         
D849                  (       ddos2f.asm):05089         CmdFRead   
D849 8DD9             (       ddos2f.asm):05090                 BSR     FLReadSetup             ; get setup for read open file etc
D84B 7F0612           (       ddos2f.asm):05091                 CLR     DosFlFreadFlag          ; flag FREAD
                      (       ddos2f.asm):05092                 
D84E BD877A           (       ddos2f.asm):05093                 JSR    >CmdReadFromX            ; read  the input
                      (       ddos2f.asm):05094         
                      (       ddos2f.asm):05095         ; give what we didn't use back... this relies on TempL and TempC
                      (       ddos2f.asm):05096         ; being in conecutive memory locations.
                      (       ddos2f.asm):05097         ; Count of read bytes ios in TempC:TempL
                      (       ddos2f.asm):05098         ;
D851 17F6DC           (       ddos2f.asm):05099         LD803   LBSR    DosFCBNoToAddr          ; get address of FCB
D854 F60604           (       ddos2f.asm):05100                 LDB     TempL                   ; is there anything left?       
D857 270E             (       ddos2f.asm):05101                 BEQ     LD819                   ; no
                      (       ddos2f.asm):05102                 
D859 7F0603           (       ddos2f.asm):05103                 CLR     TempL-1                 ; clear remainder count MSB
D85C EC0D             (       ddos2f.asm):05104                 LDD     FCBFilePointer+1,X      ; get filepointer
D85E B30603           (       ddos2f.asm):05105                 SUBD    TempL-1                 ; subtract ammount read
D861 ED0D             (       ddos2f.asm):05106                 STD     FCBFilePointer+1,X      ; save it back
D863 2402             (       ddos2f.asm):05107                 BCC     LD819                   ; any carry to MSB?
D865 6A0C             (       ddos2f.asm):05108                 DEC     FCBFilePointer,X        ; yes do carry
                      (       ddos2f.asm):05109                 
D867 0DF4             (       ddos2f.asm):05110         LD819   TST     <DosRecLenFlag          ; test record length flag       
D869 270D             (       ddos2f.asm):05111                 BEQ     LD82A                   ; zero, exit, no FOR statement
                      (       ddos2f.asm):05112                 
D86B D6F3             (       ddos2f.asm):05113                 LDB     <DosNoBytesMove         ; check number of bytes specified in FOR
D86D 2709             (       ddos2f.asm):05114                 BEQ     LD82A                   ; zero, exit
                      (       ddos2f.asm):05115                 
D86F 4F               (       ddos2f.asm):05116                 CLRA                            ; clear MSB
D870 E30D             (       ddos2f.asm):05117                 ADDD    FCBFilePointer+1,X      ; add FOR to filepointer
D872 ED0D             (       ddos2f.asm):05118                 STD     FCBFilePointer+1,X
D874 2402             (       ddos2f.asm):05119                 BCC     LD82A                   ; branch if no carry
D876 6C0C             (       ddos2f.asm):05120                 INC     FCBFilePointer,X        ; do carry
                      (       ddos2f.asm):05121         
D878 0F6F             (       ddos2f.asm):05122         LD82A   CLR     <TextDevN               ; input back to console
D87A 39               (       ddos2f.asm):05123         LD82C   RTS
                      (       ddos2f.asm):05124         
D87B 7EC71F           (       ddos2f.asm):05125         LD82D   JMP     >DosHookSysError        ; call error handler
                      (       ddos2f.asm):05126         
D87E                  (       ddos2f.asm):05127         FLRWGetNamePos   
D87E BD9C76           (       ddos2f.asm):05128                 JSR     >BasChkDirect           ; check for direct mode, error if so
D881 96F1             (       ddos2f.asm):05129                 LDA     <DosCurrCtrlBlk         ; get current FCB no
D883 17F677           (       ddos2f.asm):05130                 LBSR    DOSGetFLen              ; get file length
D886 26F3             (       ddos2f.asm):05131                 BNE     LD82D                   ; branch if error
                      (       ddos2f.asm):05132                 
D888 FF0664           (       ddos2f.asm):05133                 STU     DosFWriteAddr           ; save file length, as write address
D88B B70666           (       ddos2f.asm):05134                 STA     DosFWriteAddr+2         ; so we default to appending to the file
                      (       ddos2f.asm):05135                 
D88E 0FF4             (       ddos2f.asm):05136                 CLR     <DosRecLenFlag          ; clear record length
D890 7F067E           (       ddos2f.asm):05137                 CLR     DosTemp2                ; clear temp var
D893 8601             (       ddos2f.asm):05138                 LDA     #DevDisk                ; set device number to disk                     
D895 976F             (       ddos2f.asm):05139                 STA     <TextDevN
                      (       ddos2f.asm):05140                 
D897 9DA5             (       ddos2f.asm):05141         LD849   JSR     <BasChrGetCurr          ; get current character from basic
D899 813B             (       ddos2f.asm):05142                 CMPA    #';'                    ; is it a semicolon?    
D89B 2752             (       ddos2f.asm):05143                 BEQ     LD8EF                   ; yep get data to read/write
                      (       ddos2f.asm):05144                 
D89D BD89AA           (       ddos2f.asm):05145                 JSR     >VarCKComma             ; syntax check for comma
D8A0 81E5             (       ddos2f.asm):05146                 CMPA    #DDTokFROM              ; is it 'FROM' token?
D8A2 2614             (       ddos2f.asm):05147                 BNE     LD86A                   ; no, deal with it
                      (       ddos2f.asm):05148                 
D8A4 9D9F             (       ddos2f.asm):05149                 JSR     <BasChrGet              ; get next character from basic
D8A6 BD8887           (       ddos2f.asm):05150                 JSR     >VarGetStr              ; get filepointer pos to read/write
D8A9 8D27             (       ddos2f.asm):05151                 BSR     Get24bitUA              ; convert it to 24 bit in U:A
                      (       ddos2f.asm):05152                 
D8AB FF0664           (       ddos2f.asm):05153                 STU     DosFWriteAddr           ; update the write address
D8AE B70666           (       ddos2f.asm):05154                 STA     DosFWriteAddr+2         ; 
D8B1 86FF             (       ddos2f.asm):05155                 LDA     #$FF                    ; set DosTemp2 flag
D8B3 B7067E           (       ddos2f.asm):05156                 STA     DosTemp2
D8B6 20DF             (       ddos2f.asm):05157                 BRA     LD849                   ; loop again
                      (       ddos2f.asm):05158         
D8B8 8180             (       ddos2f.asm):05159         LD86A   CMPA    #DTokFOR                ; for token?
D8BA 260D             (       ddos2f.asm):05160                 BNE     GenBasSNError           ; nope, generate SN error
                      (       ddos2f.asm):05161                 
D8BC 9D9F             (       ddos2f.asm):05162                 JSR     <BasChrGet              ; get it from basic
D8BE 17EDFF           (       ddos2f.asm):05163                 LBSR    Get8BitorError          ; go get an 8 bit record size
                      (       ddos2f.asm):05164                 
D8C1 D7F3             (       ddos2f.asm):05165                 STB     <DosNoBytesMove         ; save record size
D8C3 C6FF             (       ddos2f.asm):05166                 LDB     #$FF                    ; flag record size used
D8C5 D7F4             (       ddos2f.asm):05167                 STB     <DosRecLenFlag          
D8C7 20CE             (       ddos2f.asm):05168                 BRA     LD849
                      (       ddos2f.asm):05169         
D8C9                  (       ddos2f.asm):05170         GenBasSNError   
D8C9 7E89B4           (       ddos2f.asm):05171                 JMP     >BasSNError             ; generate syntax error
                      (       ddos2f.asm):05172         
D8CC                  (       ddos2f.asm):05173         GenBasFCError   
D8CC 7E8B8D           (       ddos2f.asm):05174                 JMP     >BasFCError             ; generate FC error
                      (       ddos2f.asm):05175         
D8CF                  (       ddos2f.asm):05176         GenBasTMError   
D8CF 7E8882           (       ddos2f.asm):05177                 JMP     >BasTMError             ; generate TM error
                      (       ddos2f.asm):05178         
                      (       ddos2f.asm):05179         ; Get a 24 bit number in U:A ?
D8D2                  (       ddos2f.asm):05180         Get24bitUA   
D8D2 0D54             (       ddos2f.asm):05181                 TST     <FP0SGN                 ; test sign of mantissa
D8D4 2BF6             (       ddos2f.asm):05182                 BMI     GenBasFCError           ; if minus, generate FC error
                      (       ddos2f.asm):05183                 
D8D6 0D06             (       ddos2f.asm):05184                 TST     <BasVarType             ; test variable type
D8D8 26F5             (       ddos2f.asm):05185                 BNE     GenBasTMError           ; if not numeric generate TM error
                      (       ddos2f.asm):05186                 
D8DA 86A0             (       ddos2f.asm):05187                 LDA     #$A0                                            
D8DC 904F             (       ddos2f.asm):05188                 SUBA    <FP0EXP                 ; calculate number of shifts to do
D8DE 270B             (       ddos2f.asm):05189                 BEQ     LD89D                   ; branch if zero, no ajustment needed
                      (       ddos2f.asm):05190                 
D8E0 0450             (       ddos2f.asm):05191         LD892   LSR     <FPA0                   ; rotate / shift FPA0, A times
D8E2 0651             (       ddos2f.asm):05192                 ROR     <FPA0+1
D8E4 0652             (       ddos2f.asm):05193                 ROR     <FPA0+2
D8E6 0653             (       ddos2f.asm):05194                 ROR     <FPA0+3
D8E8 4A               (       ddos2f.asm):05195                 DECA
D8E9 26F5             (       ddos2f.asm):05196                 BNE     LD892
                      (       ddos2f.asm):05197                 
D8EB DE51             (       ddos2f.asm):05198         LD89D   LDU     <FPA0+1                 ; return in U:A
D8ED 9653             (       ddos2f.asm):05199                 LDA     <FPA0+3
D8EF 39               (       ddos2f.asm):05200         LD8EF   RTS
                      (       ddos2f.asm):05201         
                      (       ddos2f.asm):05202         ; 
                      (       ddos2f.asm):05203         ; basic FWRITE command
                      (       ddos2f.asm):05204         ;
                      (       ddos2f.asm):05205         ; FWRITE "filename",AT xx, FOR yy; variable list
                      (       ddos2f.asm):05206         ;
                      (       ddos2f.asm):05207         ;       0 > xx > 350208
                      (       ddos2f.asm):05208         ;       0 > yy > 255
                      (       ddos2f.asm):05209         ;
                      (       ddos2f.asm):05210         
D8F0                  (       ddos2f.asm):05211         CmdFWrite   
D8F0 17FE26           (       ddos2f.asm):05212                 LBSR    DosValidateAndOpenDAT   ; open and validate file
D8F3 2709             (       ddos2f.asm):05213                 BEQ     LD8B3                   ; no error, branch on
                      (       ddos2f.asm):05214                 
D8F5 C1A0             (       ddos2f.asm):05215                 CMPB    #ErrNE                  ; Does the file not exist?
D8F7 2668             (       ddos2f.asm):05216                 BNE     LD8A2                   ; no it was another, error handle it.
                      (       ddos2f.asm):05217                 
D8F9 17F69C           (       ddos2f.asm):05218                 LBSR    DOSCreateFile           ; create the file if it does not exist
D8FC 2663             (       ddos2f.asm):05219                 BNE     LD8A2                   ; error handle it
                      (       ddos2f.asm):05220                 
D8FE 17FF7D           (       ddos2f.asm):05221         LD8B3   LBSR    FLRWGetNamePos          ; get name and filepointer to start writing at
D901 17F9F3           (       ddos2f.asm):05222                 LBSR    FindFreeDiskBuffer      ; find a free disk buffer, to write data into
D904 265B             (       ddos2f.asm):05223                 BNE     LD8A2                   ; error, exit
                      (       ddos2f.asm):05224                 
D906 BF060B           (       ddos2f.asm):05225                 STX     DosFWriteBPtr           ; save the buffer pointer 
D909 8655             (       ddos2f.asm):05226                 LDA     #BuffInUse              ; mark disk buffer in use       
D90B A702             (       ddos2f.asm):05227                 STA     BuffFlag,X              
D90D 0FF2             (       ddos2f.asm):05228                 CLR     <DosBytesInDTA          ; no bytes ready to write       
                      (       ddos2f.asm):05229                 
D90F 9D9F             (       ddos2f.asm):05230                 JSR     <BasChrGet              ; get next character from basic
D911 BD903D           (       ddos2f.asm):05231                 JSR     >CmdPrint               ; write it
                      (       ddos2f.asm):05232                 
D914 0DF4             (       ddos2f.asm):05233                 TST     <DosRecLenFlag          ; test record length
D916 270B             (       ddos2f.asm):05234                 BEQ     LD8D8                   ; not used, skip on
                      (       ddos2f.asm):05235                 
D918 D6F3             (       ddos2f.asm):05236                 LDB     <DosNoBytesMove         ; get record size
D91A 2707             (       ddos2f.asm):05237                 BEQ     LD8D8                   ; branch if buffer full?
                      (       ddos2f.asm):05238                 
D91C 8620             (       ddos2f.asm):05239                 LDA     #' '                    ; else fill remaing buffer with spaces
D91E 8D4A             (       ddos2f.asm):05240         LD8D3   BSR     LD91D                   ; put in buffer
D920 5A               (       ddos2f.asm):05241                 DECB                            ; decrement count
D921 26FB             (       ddos2f.asm):05242                 BNE     LD8D3                   ; branch if any left
                      (       ddos2f.asm):05243                 
D923 0DF2             (       ddos2f.asm):05244         LD8D8   TST     <DosBytesInDTA          ; any bytes in buffer?
D925 2718             (       ddos2f.asm):05245                 BEQ     LD8F4                   ; nope, skip
                      (       ddos2f.asm):05246                 
D927 BE060B           (       ddos2f.asm):05247                 LDX     DosFWriteBPtr           ; get pointer to buffer details
D92A AE05             (       ddos2f.asm):05248                 LDX     BuffAddr,X              ; get buffer address
D92C 4F               (       ddos2f.asm):05249                 CLRA                            ; set D to bytes in buffer
D92D D6F2             (       ddos2f.asm):05250                 LDB     <DosBytesInDTA
D92F 1F03             (       ddos2f.asm):05251                 TFR     D,U                     ; transfer it to U
D931 96F1             (       ddos2f.asm):05252                 LDA     <DosCurrCtrlBlk         ; get current file no
D933 10BE0664         (       ddos2f.asm):05253                 LDY     DosFWriteAddr           ; get filepointer to write at
D937 F60666           (       ddos2f.asm):05254                 LDB     DosFWriteAddr+2
                      (       ddos2f.asm):05255                 
D93A 17F2A0           (       ddos2f.asm):05256                 LBSR    DOSFWrite               ; go write to the file
D93D 2622             (       ddos2f.asm):05257                 BNE     LD8A2                   ; branch on error
                      (       ddos2f.asm):05258                 
D93F BE060B           (       ddos2f.asm):05259         LD8F4   LDX     DosFWriteBPtr           ; get pointer to buffer details
D942 6F02             (       ddos2f.asm):05260                 CLR     BuffFlag,X              ; mark buffer as free
D944 39               (       ddos2f.asm):05261         LD8F9   RTS
                      (       ddos2f.asm):05262         
                      (       ddos2f.asm):05263         
                      (       ddos2f.asm):05264         ;
                      (       ddos2f.asm):05265         ; Check validity of device number
                      (       ddos2f.asm):05266         ;
                      (       ddos2f.asm):05267         
D945                  (       ddos2f.asm):05268         DosHookCheckIONum   
D945 2FFD             (       ddos2f.asm):05269                 BLE     LD8F9                   ; 0 or less, not disk....
D947 C104             (       ddos2f.asm):05270                 CMPB    #$04                    ; we only use 1
D949 2214             (       ddos2f.asm):05271                 BHI     LD914                   ; higher, generate DN error
D94B 3590             (       ddos2f.asm):05272                 PULS    X,PC                    ; restore and return
                      (       ddos2f.asm):05273         
                      (       ddos2f.asm):05274         ;
                      (       ddos2f.asm):05275         ; Check for device open.
                      (       ddos2f.asm):05276         ;   If device number is greater than zero, the a DN error is called for.
                      (       ddos2f.asm):05277         ;
                      (       ddos2f.asm):05278         
D94D                  (       ddos2f.asm):05279         DosHookOpenDev   
D94D 3262             (       ddos2f.asm):05280                 LEAS    2,S                     ; drop return address
D94F BD8887           (       ddos2f.asm):05281                 JSR     >VarGetStr              ; evaluate expression
D952 BD8DEA           (       ddos2f.asm):05282                 JSR     >BasGetStrFirst         ; get first byte of string in B
D955 3404             (       ddos2f.asm):05283                 PSHS    B                       ; save b
D957 BDB7D4           (       ddos2f.asm):05284                 JSR     >BasGetDevNo            ; get device number
D95A 5D               (       ddos2f.asm):05285                 TSTB                            ; check device number
D95B 102FDED6         (       ddos2f.asm):05286                 LBLE    CmdOpenEntry            ; >=0, go open it
                      (       ddos2f.asm):05287                 
D95F C628             (       ddos2f.asm):05288         LD914   LDB     #BErrDN                 ; device number error
D961 7EC71F           (       ddos2f.asm):05289         LD8A2   JMP     DosHookSysError         ; call system error handler
                      (       ddos2f.asm):05290         
                      (       ddos2f.asm):05291         ;
                      (       ddos2f.asm):05292         ; Character output hook.
                      (       ddos2f.asm):05293         ;  The hook routine for writing a single byte to a data file.
                      (       ddos2f.asm):05294         ;
                      (       ddos2f.asm):05295         
D964                  (       ddos2f.asm):05296         DosHookCharOut   
D964 0D6F             (       ddos2f.asm):05297                 TST     <TextDevN               ; test device number
D966 2FDC             (       ddos2f.asm):05298                 BLE     LD8F9                   ; brance if 0 or -ve, not ours                          
                      (       ddos2f.asm):05299                 
D968 3262             (       ddos2f.asm):05300                 LEAS    2,S                     ; discard return address
D96A 3476             (       ddos2f.asm):05301         LD91D   PSHS    D,X,Y,U                 ; save regs
                      (       ddos2f.asm):05302         
D96C D6F4             (       ddos2f.asm):05303                 LDB     <DosRecLenFlag          ; buffering flag?
D96E 2704             (       ddos2f.asm):05304                 BEQ     LD927                   ; not buffering
                      (       ddos2f.asm):05305         
D970 D6F3             (       ddos2f.asm):05306                 LDB     <DosNoBytesMove         ; at end of buffer?
D972 2737             (       ddos2f.asm):05307                 BEQ     LD95E                   ; yes 
                      (       ddos2f.asm):05308         
D974 BE060B           (       ddos2f.asm):05309         LD927   LDX     DosFWriteBPtr           ; get buffer detail pointer
D977 AE05             (       ddos2f.asm):05310                 LDX     BuffAddr,X              ; get buffer address    
D979 D6F2             (       ddos2f.asm):05311                 LDB     <DosBytesInDTA          ; get buffer offset write pointer
D97B 3A               (       ddos2f.asm):05312                 ABX                             ; add to buffer pointer
D97C A784             (       ddos2f.asm):05313                 STA     ,X                      ; save byte in buffer
                      (       ddos2f.asm):05314                 
D97E 0AF3             (       ddos2f.asm):05315                 DEC     <DosNoBytesMove         ; decrement bytes left counter
D980 0CF2             (       ddos2f.asm):05316                 INC     <DosBytesInDTA          ; increment bytes in buffer counter
D982 2627             (       ddos2f.asm):05317                 BNE     LD95E                   ; branch if still space in buffer
                      (       ddos2f.asm):05318                 
D984 96F1             (       ddos2f.asm):05319                 LDA     <DosCurrCtrlBlk         ; get current file no
D986 BE060B           (       ddos2f.asm):05320                 LDX     DosFWriteBPtr           ; get buffer detail pointer
D989 AE05             (       ddos2f.asm):05321                 LDX     BuffAddr,X              ; get buffer address    
D98B CE0100           (       ddos2f.asm):05322                 LDU     #$0100                  ; write 256 bytes
D98E 10BE0664         (       ddos2f.asm):05323                 LDY     DosFWriteAddr           ; get filepointer
D992 F60666           (       ddos2f.asm):05324                 LDB     DosFWriteAddr+2
                      (       ddos2f.asm):05325                 
D995 BDCBDD           (       ddos2f.asm):05326                 JSR     >DOSFWrite              ; go write it
D998 2703             (       ddos2f.asm):05327                 BEQ     LD950                   ; branch if no error
                      (       ddos2f.asm):05328                 
D99A 7EC71F           (       ddos2f.asm):05329                 JMP     >DosHookSysError        ; call error handler
                      (       ddos2f.asm):05330         
D99D FC0665           (       ddos2f.asm):05331         LD950   LDD     DosFWriteAddr+1         ; move filepointer on
D9A0 C30100           (       ddos2f.asm):05332                 ADDD    #$0100
D9A3 2403             (       ddos2f.asm):05333                 BCC     LD95B                   ; branch if no carry
D9A5 7C0664           (       ddos2f.asm):05334                 INC     DosFWriteAddr           ; carry if needed
D9A8 FD0665           (       ddos2f.asm):05335         LD95B   STD     DosFWriteAddr+1         ; save pilepointer
                      (       ddos2f.asm):05336         
D9AB 35F6             (       ddos2f.asm):05337         LD95E   PULS    D,X,Y,U,PC              ; resore and return
                      (       ddos2f.asm):05338         
                      (       ddos2f.asm):05339         ;
                      (       ddos2f.asm):05340         ; Hook to scan input from disk.
                      (       ddos2f.asm):05341         ;
                      (       ddos2f.asm):05342         ; Should do:
                      (       ddos2f.asm):05343         ;   If string:
                      (       ddos2f.asm):05344         ;     do not remove leading spaces.
                      (       ddos2f.asm):05345         ;     Terminate input on:
                      (       ddos2f.asm):05346         ;       $0D - CR
                      (       ddos2f.asm):05347         ;       $2C - comma
                      (       ddos2f.asm):05348         ;       EOF
                      (       ddos2f.asm):05349         ;
                      (       ddos2f.asm):05350         ;   If numeric:
                      (       ddos2f.asm):05351         ;     remove leading spaces
                      (       ddos2f.asm):05352         ;     Terminate on:
                      (       ddos2f.asm):05353         ;       Any character less than or equal to space.
                      (       ddos2f.asm):05354         ;
                      (       ddos2f.asm):05355         
     879A             (       ddos2f.asm):05356         L879A   EQU     $879A                   ; return point (Dragon)
                      (       ddos2f.asm):05357                 
D9AD                  (       ddos2f.asm):05358         DosHookDiskItem   
D9AD 0D6F             (       ddos2f.asm):05359                 TST     <TextDevN               ; test device number
D9AF 2F63             (       ddos2f.asm):05360                 BLE     LDA14                   ; 0 or -ve, not ours
                      (       ddos2f.asm):05361                 
D9B1 8E879A           (       ddos2f.asm):05362                 LDX     #L879A                  ; return point in basic ROM
D9B4 AFE4             (       ddos2f.asm):05363                 STX     ,S                      ; stack it
                      (       ddos2f.asm):05364                 
D9B6 96F4             (       ddos2f.asm):05365         LD969   LDA     <DosRecLenFlag          ; reading?
D9B8 2704             (       ddos2f.asm):05366                 BEQ     LD971                   ; yep
                      (       ddos2f.asm):05367                 
D9BA 96F3             (       ddos2f.asm):05368                 LDA     <DosNoBytesMove         ; check bytes in buffer
D9BC 274D             (       ddos2f.asm):05369                 BEQ     LD9BE                   ; read no more
                      (       ddos2f.asm):05370                 
D9BE 8E02DD           (       ddos2f.asm):05371         LD971   LDX     #BasLinInpBuff+1        ; point at basic line input buffer
D9C1 D6F2             (       ddos2f.asm):05372                 LDB     <DosBytesInDTA          ; current input pointer
D9C3 F70603           (       ddos2f.asm):05373                 STB     TempC                   ; save it in count
D9C6 3A               (       ddos2f.asm):05374                 ABX                             ; add to buffer base
                      (       ddos2f.asm):05375                 
D9C7 F60604           (       ddos2f.asm):05376                 LDB     TempL                   ; save number of bytes in buffer
D9CA F70611           (       ddos2f.asm):05377                 STB     DosRunLoadFlag
D9CD 5F               (       ddos2f.asm):05378                 CLRB                            ; clear byte before current input
D9CE E71F             (       ddos2f.asm):05379                 STB     -1,X
                      (       ddos2f.asm):05380                 
D9D0 D700             (       ddos2f.asm):05381                 STB     <BasBreakFlag           ; clear flag
D9D2 0AF3             (       ddos2f.asm):05382         LD985   DEC     <DosNoBytesMove         
D9D4 7A0604           (       ddos2f.asm):05383                 DEC     TempL
D9D7 0CF2             (       ddos2f.asm):05384                 INC     <DosBytesInDTA
D9D9 A680             (       ddos2f.asm):05385                 LDA     ,X+                     ; get a byte from buffer
D9DB 272E             (       ddos2f.asm):05386                 BEQ     LD9BE                   ; done if EOF
                      (       ddos2f.asm):05387                 
D9DD 810D             (       ddos2f.asm):05388                 CMPA    #$0D                    ; is it CR?
D9DF 272A             (       ddos2f.asm):05389                 BEQ     LD9BE                   ; yep deal with it
                      (       ddos2f.asm):05390                 
D9E1 7D0612           (       ddos2f.asm):05391                 TST     DosFlFreadFlag          ; are we reading a number?
D9E4 2608             (       ddos2f.asm):05392                 BNE     LD9A1                   ; yes, don't check for string terminators
                      (       ddos2f.asm):05393                 
D9E6 812C             (       ddos2f.asm):05394                 CMPA    #','                    ; check for comma
D9E8 2721             (       ddos2f.asm):05395                 BEQ     LD9BE                   ; yep deal with it
                      (       ddos2f.asm):05396                 
D9EA 813A             (       ddos2f.asm):05397                 CMPA    #':'                    ; check for colon
D9EC 271D             (       ddos2f.asm):05398                 BEQ     LD9BE                   ; yep deal with it
                      (       ddos2f.asm):05399                 
D9EE 96F4             (       ddos2f.asm):05400         LD9A1   LDA     <DosRecLenFlag          ; get bytes to read     
D9F0 2704             (       ddos2f.asm):05401                 BEQ     LD9A9                   ; zero, read no more
                      (       ddos2f.asm):05402                 
D9F2 96F3             (       ddos2f.asm):05403                 LDA     <DosNoBytesMove         ; 
D9F4 2715             (       ddos2f.asm):05404                 BEQ     LD9BE
                      (       ddos2f.asm):05405                 
D9F6 5C               (       ddos2f.asm):05406         LD9A9   INCB                            ; number of bytes in string
D9F7 C1FF             (       ddos2f.asm):05407                 CMPB    #$FF                    ; max string length
D9F9 270E             (       ddos2f.asm):05408                 BEQ     LD9BC                   ; yep! string full
                      (       ddos2f.asm):05409                 
D9FB B60604           (       ddos2f.asm):05410                 LDA     TempL                                           
D9FE 26D2             (       ddos2f.asm):05411                 BNE     LD985
                      (       ddos2f.asm):05412                 
                      (       ddos2f.asm):05413         ; read a new buffer of data     
DA00 D600             (       ddos2f.asm):05414                 LDB     <BasBreakFlag           ; 
DA02 2605             (       ddos2f.asm):05415                 BNE     LD9BC
                      (       ddos2f.asm):05416                 
DA04 8D0F             (       ddos2f.asm):05417                 BSR     LD9C8
DA06 5F               (       ddos2f.asm):05418                 CLRB
DA07 20C9             (       ddos2f.asm):05419                 BRA     LD985
                      (       ddos2f.asm):05420         
                      (       ddos2f.asm):05421         ; return to input (basic)
DA09 3001             (       ddos2f.asm):05422         LD9BC   LEAX    1,X                     ; increment past last byte              
DA0B F60603           (       ddos2f.asm):05423         LD9BE   LDB     TempC                   ; get count
DA0E 6F1F             (       ddos2f.asm):05424                 CLR     -1,X                    ; clear line termination byte
DA10 8E02DC           (       ddos2f.asm):05425                 LDX     #BasLinInpBuff          ; point at buffer
DA13 3A               (       ddos2f.asm):05426                 ABX                             ; add offset
DA14 39               (       ddos2f.asm):05427         LDA14   RTS
                      (       ddos2f.asm):05428         
DA15 BDCF30           (       ddos2f.asm):05429         LD9C8   JSR     >DosFCBNoToAddr         ; get address of FCB for file
DA18 4F               (       ddos2f.asm):05430                 CLRA                            ; clear MSB
DA19 F60611           (       ddos2f.asm):05431                 LDB     DosRunLoadFlag          ; load B with ammount to read
DA1C 12               (       ddos2f.asm):05432                 NOP
DA1D 3406             (       ddos2f.asm):05433                 PSHS    D                       ; save D
DA1F EC0D             (       ddos2f.asm):05434                 LDD     FCBFilePointer+1,X      ; get filepointer
DA21 A3E1             (       ddos2f.asm):05435                 SUBD    ,S++                    ; move it back?
DA23 ED0D             (       ddos2f.asm):05436                 STD     FCBFilePointer+1,X
DA25 2402             (       ddos2f.asm):05437                 BCC     LD9DC
DA27 6A0C             (       ddos2f.asm):05438                 DEC     FCBFilePointer,X
                      (       ddos2f.asm):05439                 
DA29 3460             (       ddos2f.asm):05440         LD9DC   PSHS    Y,U                     ; save regs
DA2B CE00FF           (       ddos2f.asm):05441                 LDU     #$00FF                  ; ammount to try reading
DA2E 8D19             (       ddos2f.asm):05442                 BSR     LDA01                   ; check enough bytes left
                      (       ddos2f.asm):05443                 
DA30 CE02DD           (       ddos2f.asm):05444                 LDU     #DBasLinInpBuff+1       ; point at basicline buffer
DA33 6FCB             (       ddos2f.asm):05445                 CLR     D,U                     ; clear byte..... (after end?)
DA35 96F1             (       ddos2f.asm):05446                 LDA     <DosCurrCtrlBlk         ; get current file no
DA37 E60E             (       ddos2f.asm):05447                 LDB     FCBFilePointer+2,X      ; get filepointer
DA39 AE0C             (       ddos2f.asm):05448                 LDX     FCBFilePointer,X
DA3B 1E13             (       ddos2f.asm):05449                 EXG     X,U                     ; swap X and U to get buffer & offset in correct regs
DA3D BDCA1B           (       ddos2f.asm):05450                 JSR     >DOSFRead               ; go read the file
DA40 263D             (       ddos2f.asm):05451                 BNE     LD9FE                   ; error, exit
                      (       ddos2f.asm):05452                 
DA42 8E02DD           (       ddos2f.asm):05453                 LDX     #DBasLinInpBuff+1       ; point at basicline buffer
DA45 6F1F             (       ddos2f.asm):05454                 CLR     -1,X                    ; clear byte before read data
DA47 35E0             (       ddos2f.asm):05455                 PULS    Y,U,PC                  ; restore and return
                      (       ddos2f.asm):05456         
                      (       ddos2f.asm):05457         ; take an ammount of bytes we want to read in U, and work out if there
                      (       ddos2f.asm):05458         ; are still U bytes in the file to read. This is doen by adding U to
                      (       ddos2f.asm):05459         ; the current file pointer, and then comparing it to the file length.
                      (       ddos2f.asm):05460         
DA49 3440             (       ddos2f.asm):05461         LDA01   PSHS    U                       ; save ammount to load?
DA4B EC0D             (       ddos2f.asm):05462                 LDD     FCBFilePointer+1,X      ; get LSW of filepointer
DA4D E3E4             (       ddos2f.asm):05463                 ADDD    ,S                      ; add ammount to filepointer
DA4F 3406             (       ddos2f.asm):05464                 PSHS    D                       ; save it
DA51 A60C             (       ddos2f.asm):05465                 LDA     FCBFilePointer,X        ; get MSB of filepointer        
DA53 8900             (       ddos2f.asm):05466                 ADCA    #$00                    ; propagate carry
DA55 A08810           (       ddos2f.asm):05467                 SUBA    FCBFileLen,X            ; subtract file length msb
DA58 3506             (       ddos2f.asm):05468                 PULS    D                       ; restore LSW of difference, flags untouched
DA5A 2512             (       ddos2f.asm):05469                 BCS     LDA26                   ; was much at least 64K lower so safe to read
DA5C 221F             (       ddos2f.asm):05470                 BHI     LD9FC                   ; error will read past EOF
                      (       ddos2f.asm):05471                 
DA5E A38811           (       ddos2f.asm):05472                 SUBD    FCBFileLen+1,X          ; sheck the LSW of the filepointer
DA61 230B             (       ddos2f.asm):05473                 BLS     LDA26                   ; was lower so safe to read
                      (       ddos2f.asm):05474                 
                      (       ddos2f.asm):05475         ; if we still have bytes that can be read but have not reached EOF, then work
                      (       ddos2f.asm):05476         ; out how many bytes left       
                      (       ddos2f.asm):05477                 
DA63 EC8811           (       ddos2f.asm):05478                 LDD     FCBFileLen+1,X          ; get the file length
DA66 A30D             (       ddos2f.asm):05479                 SUBD    FCBFilePointer+1,X      ; subtract filepointer
DA68 2713             (       ddos2f.asm):05480                 BEQ     LD9FC                   ; special case exactly at EOF
DA6A EDE4             (       ddos2f.asm):05481                 STD     ,S                      ; save ammount we can read
DA6C 0300             (       ddos2f.asm):05482                 COM     <BasBreakFlag           ; ????
                      (       ddos2f.asm):05483                 
DA6E ECE4             (       ddos2f.asm):05484         LDA26   LDD     ,S                      ; get ammount we can read
DA70 F70604           (       ddos2f.asm):05485                 STB     TempL                   ; save LSB (ammount read?)
DA73 F70611           (       ddos2f.asm):05486                 STB     DosRunLoadFlag          ; ???
DA76 7F0603           (       ddos2f.asm):05487                 CLR     TempL-1                 ; MSB that we read
DA79 0FF2             (       ddos2f.asm):05488                 CLR     <DosBytesInDTA          
DA7B 35A0             (       ddos2f.asm):05489                 PULS    Y,PC                    ; restore and return
                      (       ddos2f.asm):05490         
DA7D                  (       ddos2f.asm):05491         LDA7D
DA7D C69A             (       ddos2f.asm):05492         LD9FC   LDB     #ErrPE                  ; read past end of file
DA7F                  (       ddos2f.asm):05493         LDA7F
DA7F 7EC71F           (       ddos2f.asm):05494         LD9FE   JMP     >DosHookSysError        ; call error handler    
                      (       ddos2f.asm):05495                 
                      (       ddos2f.asm):05496         ;
                      (       ddos2f.asm):05497         ; Dir command dispatch routine
                      (       ddos2f.asm):05498         ;
                      (       ddos2f.asm):05499         ; Syntax :
                      (       ddos2f.asm):05500         ;       DIR drivenum    
                      (       ddos2f.asm):05501         ;
                      (       ddos2f.asm):05502         
DA82 2705             (       ddos2f.asm):05503         CmdDir  BEQ     LDA3C                   ; No drive specified, use default
DA84 17EC89           (       ddos2f.asm):05504                 LBSR    GetDriveNoInB           ; Else get from command 
DA87 2003             (       ddos2f.asm):05505                 BRA     LDA3F
                      (       ddos2f.asm):05506         
DA89 F6060A           (       ddos2f.asm):05507         LDA3C   LDB     DosDefDriveNo           ; Get default drive
                      (       ddos2f.asm):05508         
DA8C D7EB             (       ddos2f.asm):05509         LDA3F   STB     <DosDriveNo             ; Flag as last drive used
DA8E 6FE2             (       ddos2f.asm):05510                 CLR     ,-S                     ; make temp on stack (file number on disk counter)
DA90 5F               (       ddos2f.asm):05511                 CLRB
                      (       ddos2f.asm):05512                 
DA91 BD851B           (       ddos2f.asm):05513         LDA44   JSR     >BasPollKeyboard        ; poll keyboard
DA94 17F7C0           (       ddos2f.asm):05514                 LBSR    DOSGetDirEntry          ; go get next entry
DA97 26E6             (       ddos2f.asm):05515                 BNE     LDA7F                   ; error : exit
                      (       ddos2f.asm):05516                 
DA99 A684             (       ddos2f.asm):05517                 LDA     ,X                      ; Get Attribute byte
DA9B 8508             (       ddos2f.asm):05518                 BITA    #AttrEndOfDir           ; Check for end of directory $08
DA9D 2641             (       ddos2f.asm):05519                 BNE     CmdDirDoneAll           ; Yes : stop processing
                      (       ddos2f.asm):05520                 
DA9F 8581             (       ddos2f.asm):05521                 BITA    #AttrDeleted+AttrIsCont ; Is entry a deleted file, or continuation entry ? $81                          ; and another thing
DAA1 2635             (       ddos2f.asm):05522                 BNE     CmdDirDoNextEntry       ; yes : do next
                      (       ddos2f.asm):05523                 
DAA3 3001             (       ddos2f.asm):05524                 LEAX    1,X                     ; Point at filename
DAA5 C608             (       ddos2f.asm):05525                 LDB     #$08                    ; Up to 8 chars
DAA7 8D47             (       ddos2f.asm):05526                 BSR     PrintBCharsFromX        ; Print it
DAA9 C604             (       ddos2f.asm):05527                 LDB     #$04                    ; print extension + '.'
DAAB 862E             (       ddos2f.asm):05528                 LDA     #$2E                    ; '.'
DAAD 8D47             (       ddos2f.asm):05529                 BSR     PrintBCharsFromX2       ; Print it
                      (       ddos2f.asm):05530                 
DAAF A614             (       ddos2f.asm):05531                 LDA     -12,X                   ; Point at attributes
DAB1 8502             (       ddos2f.asm):05532                 BITA    #AttrWriteProt          ; Is this a protected file ?
DAB3 2703             (       ddos2f.asm):05533                 BEQ     LDA70                   ; no skip on
DAB5 8670             (       ddos2f.asm):05534                 LDA     #'p'                    ; Flag protected $70
DAB7 8C               (       ddos2f.asm):05535                 FCB     Skip2
DAB8 8620             (       ddos2f.asm):05536         LDA70   LDA     #$20                    ; space
DABA BDB54A           (       ddos2f.asm):05537                 JSR     >TextOutChar            ; output attribute byte
DABD BD90F5           (       ddos2f.asm):05538                 JSR     >TextOutSpace           ; And a space
DAC0 CEFFFF           (       ddos2f.asm):05539                 LDU     #$FFFF
DAC3 8E06BD           (       ddos2f.asm):05540                 LDX     #DosFCB0Addr            ; Point at first FCB
DAC6 E6E4             (       ddos2f.asm):05541                 LDB     ,S                      ; Get file number
DAC8 E7881D           (       ddos2f.asm):05542                 STB     FCBDiskFileNo,X         ; Save in FCB
                      (       ddos2f.asm):05543         
DACB 17F0B0           (       ddos2f.asm):05544                 LBSR    FindFSNinU              ; find last File sector
DACE 26AF             (       ddos2f.asm):05545                 BNE     LDA7F                   ; error : exit
                      (       ddos2f.asm):05546         
DAD0 17F44A           (       ddos2f.asm):05547                 LBSR    LCE99                   ; add last bytes to length
DAD3 8D28             (       ddos2f.asm):05548                 BSR     LDAB7                   ; Print filesize
                      (       ddos2f.asm):05549                 
DAD5 BD90A1           (       ddos2f.asm):05550                 JSR     TextOutCRLF             ; Output EOL
                      (       ddos2f.asm):05551         
DAD8                  (       ddos2f.asm):05552         CmdDirDoNextEntry   
DAD8 6CE4             (       ddos2f.asm):05553                 INC     ,S                      ; do next
DADA E6E4             (       ddos2f.asm):05554                 LDB     ,S                      ; Get disk file number counter
                      (       ddos2f.asm):05555         ;***       CMPB    #$A0                 ; More than max files on disk ?
DADC C1B4             (       ddos2f.asm):05556                 CMPB    #$B4                    ; More than max files on disk ?
DADE 25B1             (       ddos2f.asm):05557                 BCS     LDA44                   ; Less, loop again.     
                      (       ddos2f.asm):05558         
                      (       ddos2f.asm):05559         ;
                      (       ddos2f.asm):05560         ; We come here either when we have processed $A0 entries, which is the maximum,
                      (       ddos2f.asm):05561         ; or we have reached an entry with the AttrEndOfDir bit set which signals the end
                      (       ddos2f.asm):05562         ; of the directory.
                      (       ddos2f.asm):05563         ;
                      (       ddos2f.asm):05564         
DAE0                  (       ddos2f.asm):05565         CmdDirDoneAll   
DAE0 3502             (       ddos2f.asm):05566                 PULS    A
DAE2 17F6EB           (       ddos2f.asm):05567                 LBSR    DOSGetFree              ; Get free bytes on drive
DAE5 4F               (       ddos2f.asm):05568                 CLRA
DAE6 1F13             (       ddos2f.asm):05569                 TFR     X,U
DAE8 8D13             (       ddos2f.asm):05570                 BSR     LDAB7                   ; Display free bytes
DAEA 8EDB13           (       ddos2f.asm):05571                 LDX     #BytesFreeMess-1        ; Point to message
DAED 7E90E5           (       ddos2f.asm):05572                 JMP     >TextOutString          ; print it, and return
                      (       ddos2f.asm):05573         
                      (       ddos2f.asm):05574         ; Print B chars pointed to by X, if char is $00, then output a space.
                      (       ddos2f.asm):05575         ; Used to print filenames.
                      (       ddos2f.asm):05576         
DAF0                  (       ddos2f.asm):05577         PrintBCharsFromX   
DAF0 A680             (       ddos2f.asm):05578                 LDA     ,X+                     ; Fetch a char
DAF2 2602             (       ddos2f.asm):05579                 BNE     PrintBCharsFromX2       ; Is it zero ? no : skip
DAF4 8620             (       ddos2f.asm):05580                 LDA     #$20                    ; Replace it with a space
                      (       ddos2f.asm):05581         
DAF6                  (       ddos2f.asm):05582         PrintBCharsFromX2
DAF6 BDB54A           (       ddos2f.asm):05583                 JSR     >TextOutChar            ; Output it
DAF9 5A               (       ddos2f.asm):05584                 DECB                            ; Decrement count
DAFA 26F4             (       ddos2f.asm):05585                 BNE     PrintBCharsFromX        ; any left yes : loop again
DAFC 39               (       ddos2f.asm):05586                 RTS
                      (       ddos2f.asm):05587         
DAFD                  (       ddos2f.asm):05588         LDAB7   
DAFD                  (       ddos2f.asm):05589         LDAFD
                      (       ddos2f.asm):05590                 ifdef   PGSFix
                      (       ddos2f.asm):05591                 JSR     LDD95                   ; put number in FPA0, normalize it
                      (       ddos2f.asm):05592                 JMP     TextOutNumFPA0          ; output it
                      (       ddos2f.asm):05593         
DAFD                  (       ddos2f.asm):05594         DosHookReadInputFix
                      (       ddos2f.asm):05595                 PSHS    U,X,D                   ; save regs
                      (       ddos2f.asm):05596                 LDX     #$837D                  ; check source PC on stack
                      (       ddos2f.asm):05597                 CMPX    8,S
                      (       ddos2f.asm):05598                 BNE     LDACB                   ; nope restore & return
                      (       ddos2f.asm):05599                 JSR     DosCloseAllFiles        ; close all files
                      (       ddos2f.asm):05600                 BRA     CheckAndDoAutoFix       ; jump to Auto check
DAFD                  (       ddos2f.asm):05601         LDACB   PULS    U,X,D,PC                ; restore & return
                      (       ddos2f.asm):05602                 NOP
                      (       ddos2f.asm):05603                 else
DAFD DF51             (       ddos2f.asm):05604                 STU     <FPA0+1
DAFF 9753             (       ddos2f.asm):05605                 STA     <FPA0+3
DB01 0F54             (       ddos2f.asm):05606                 CLR     <FP0SGN
DB03 0F50             (       ddos2f.asm):05607                 CLR     <FPA0
DB05 0F63             (       ddos2f.asm):05608                 CLR     <FPSByte
DB07 86A0             (       ddos2f.asm):05609                 LDA     #$A0
DB09 974F             (       ddos2f.asm):05610                 STA     <FP0EXP
DB0B BD9165           (       ddos2f.asm):05611                 JSR     >VarNormFPA0
DB0E BD9587           (       ddos2f.asm):05612                 JSR     >TextOutNumFPA0+5       ; $9587
DB11 7E90E5           (       ddos2f.asm):05613                 JMP     >TextOutString
                      (       ddos2f.asm):05614                 endc
                      (       ddos2f.asm):05615         
DB14                  (       ddos2f.asm):05616         BytesFreeMess
DB14 2046524545204259 (       ddos2f.asm):05617                 FCC    " FREE BYTES"
     544553
DB1F 0D0D00           (       ddos2f.asm):05618                 FCB    $0D,$0D,$00
                      (       ddos2f.asm):05619         
                      (       ddos2f.asm):05620         ;
                      (       ddos2f.asm):05621         ; Auto command dispatch routine
                      (       ddos2f.asm):05622         ;
                      (       ddos2f.asm):05623         ; Syntax :
                      (       ddos2f.asm):05624         ;
                      (       ddos2f.asm):05625         ;       AUTO startline,increment
                      (       ddos2f.asm):05626         ;
                      (       ddos2f.asm):05627         
DB22                  (       ddos2f.asm):05628         CmdAuto 
DB22 9E68             (       ddos2f.asm):05629                 LDX     <BasCurrentLine         ; Get current line number
DB24 3001             (       ddos2f.asm):05630                 LEAX    1,X                     ; will be $000 if we where in direct mode
DB26 1026B063         (       ddos2f.asm):05631                 LBNE    BasFCError              ; nope, not direct mode : error
                      (       ddos2f.asm):05632         
DB2A 8E0064           (       ddos2f.asm):05633         LDAE7   LDX     #AutoStartLine          ; set default start line
DB2D CC000A           (       ddos2f.asm):05634                 LDD     #AutoIncrement          ; set default increment
DB30 3416             (       ddos2f.asm):05635                 PSHS    D,X
                      (       ddos2f.asm):05636                 
DB32 9DA5             (       ddos2f.asm):05637                 JSR     <BasChrGetCurr          ; get current character
DB34 271E             (       ddos2f.asm):05638                 BEQ     CmdAutoDoAuto           ; nothing, used defaults                
                      (       ddos2f.asm):05639                 
DB36 BD8E83           (       ddos2f.asm):05640                 JSR     >VarGet16Bit            ; get startline
DB39 DC52             (       ddos2f.asm):05641                 LDD     <FPA0+2
DB3B ED62             (       ddos2f.asm):05642                 STD     2,S                     ; update value on stack
DB3D 9DA5             (       ddos2f.asm):05643                 JSR     <BasChrGetCurr          ; any more parameters ?
DB3F 2713             (       ddos2f.asm):05644                 BEQ     CmdAutoDoAuto           ; nope use default increment
                      (       ddos2f.asm):05645                 
DB41 BD89AA           (       ddos2f.asm):05646                 JSR     >VarCKComma             ; get comma, error if not
DB44 BD8E83           (       ddos2f.asm):05647                 JSR     >DVarGet16Bit           ; get increment
DB47 DC52             (       ddos2f.asm):05648                 LDD     <FPA0+2
DB49 2706             (       ddos2f.asm):05649                 BEQ     CmdAutoErrorExit        ; increment is zero : error
                      (       ddos2f.asm):05650                 
DB4B EDE4             (       ddos2f.asm):05651                 STD     ,S                      ; update increment value
DB4D 9DA5             (       ddos2f.asm):05652                 JSR     <BasChrGetCurr          ; get current char
DB4F 2703             (       ddos2f.asm):05653                 BEQ     CmdAutoDoAuto           ; no more : do it !
                      (       ddos2f.asm):05654                 
DB51                  (       ddos2f.asm):05655         CmdAutoErrorExit   
DB51 7E89B4           (       ddos2f.asm):05656                 JMP     >BasSNError             ; More chars left, SN? error
                      (       ddos2f.asm):05657         
DB54                  (       ddos2f.asm):05658         CmdAutoDoAuto   
DB54 1A50             (       ddos2f.asm):05659                 ORCC    #(FlagIRQ+FlagFIRQ)     ; Disable interrupts    
DB56 ECE1             (       ddos2f.asm):05660                 LDD     ,S++                    ; Get Increment off stack               
DB58 FD060F           (       ddos2f.asm):05661                 STD     DosAutoInc
DB5B ECE1             (       ddos2f.asm):05662                 LDD     ,S++                    ; Get start line off stack
DB5D B3060F           (       ddos2f.asm):05663                 SUBD    DosAutoInc              ; Subtrack increment
DB60 FD060D           (       ddos2f.asm):05664                 STD     DosAutoCurrent          ; Save in current
DB63 86FF             (       ddos2f.asm):05665                 LDA     #AutoFlag               ; Flag in AUTO mode
DB65 B70613           (       ddos2f.asm):05666                 STA     DosAutoFlag
DB68 39               (       ddos2f.asm):05667                 RTS
                      (       ddos2f.asm):05668         
DB69                  (       ddos2f.asm):05669         CheckAndDoAuto   
DB69 3456             (       ddos2f.asm):05670                 PSHS    D,X,U
DB6B                  (       ddos2f.asm):05671         CheckAndDoAutoFix   
DB6B 7D0613           (       ddos2f.asm):05672                 TST     DosAutoFlag             ; is auto enabled ?
DB6E 2602             (       ddos2f.asm):05673                 BNE     LDB30                   ; yes : handle it
DB70 35D6             (       ddos2f.asm):05674         LDB2E   PULS    D,X,U,PC
                      (       ddos2f.asm):05675         
DB72 FC060D           (       ddos2f.asm):05676         LDB30   LDD     DosAutoCurrent          ; get current line no
DB75 F3060F           (       ddos2f.asm):05677                 ADDD    DosAutoInc              ; add increment
DB78 1083F9FF         (       ddos2f.asm):05678                 CMPD    #BasMaxLineNo           ; greater than max line no ?
DB7C 22F2             (       ddos2f.asm):05679                 BHI     LDB2E                   ; yep : exit
                      (       ddos2f.asm):05680                 
DB7E EDE4             (       ddos2f.asm):05681                 STD     ,S                      ; save new line on stack
DB80 BD957A           (       ddos2f.asm):05682                 JSR     >TextOutNum16           ; output line no
DB83 8620             (       ddos2f.asm):05683                 LDA     #$20                    ; output a space
DB85 BDB54A           (       ddos2f.asm):05684                 JSR     TextOutChar             
                      (       ddos2f.asm):05685                 
DB88 CE03DA           (       ddos2f.asm):05686                 LDU     #BasBuffer+3            ; point at basic buffer
DB8B ECE4             (       ddos2f.asm):05687                 LDD     ,S                      ; get current line no
DB8D FD060D           (       ddos2f.asm):05688                 STD     DosAutoCurrent          ; save it
DB90 8E02DD           (       ddos2f.asm):05689                 LDX     #BasLinInpBuff+1        ; point to line input buffer
DB93 C600             (       ddos2f.asm):05690                 LDB     #$00
DB95 A6C0             (       ddos2f.asm):05691         LDB53   LDA     ,U+                     ; get byte from basic buffer
DB97 2705             (       ddos2f.asm):05692                 BEQ     LDB5C                   ; zero ?
                      (       ddos2f.asm):05693                 
DB99 A780             (       ddos2f.asm):05694                 STA     ,X+                     ; nope put in buffer
DB9B 5C               (       ddos2f.asm):05695                 INCB
DB9C 20F7             (       ddos2f.asm):05696                 BRA     LDB53
                      (       ddos2f.asm):05697         
DB9E 8620             (       ddos2f.asm):05698         LDB5C   LDA     #$20                    ; store space
DBA0 A780             (       ddos2f.asm):05699                 STA     ,X+
DBA2 5C               (       ddos2f.asm):05700                 INCB                    
DBA3 BDB505           (       ddos2f.asm):05701         LDB61   JSR     TextWaitKeyCurs2        ; Wait with cursor
DBA6 810D             (       ddos2f.asm):05702                 CMPA    #$0D                    ; return ?
DBA8 2704             (       ddos2f.asm):05703                 BEQ     LDB6C                   
                      (       ddos2f.asm):05704                 
DBAA 8103             (       ddos2f.asm):05705                 CMPA    #$03                    ; break ?
DBAC 2616             (       ddos2f.asm):05706                 BNE     LDB82
                      (       ddos2f.asm):05707                 
DBAE 7F0613           (       ddos2f.asm):05708         LDB6C   CLR     DosAutoFlag             ; clear auto flag
DBB1 860D             (       ddos2f.asm):05709                 LDA     #$0D                    ; output a return
DBB3 BDB54A           (       ddos2f.asm):05710                 JSR     TextOutChar
                      (       ddos2f.asm):05711                 
DBB6 3268             (       ddos2f.asm):05712                 LEAS    8,S                     ; drop stack frame
DBB8 0F85             (       ddos2f.asm):05713                 CLR     <CasLastSine
DBBA 8E02DD           (       ddos2f.asm):05714                 LDX     #DBasLinInpBuff+1       ; point at input buffer
DBBD 860D             (       ddos2f.asm):05715                 LDA     #$0D
DBBF C601             (       ddos2f.asm):05716                 LDB     #$01
DBC1 7EB5D3           (       ddos2f.asm):05717                 JMP     >BasInBuffFromX         ; input it
                      (       ddos2f.asm):05718         
DBC4 8120             (       ddos2f.asm):05719         LDB82   CMPA    #$20                    ; space ?
DBC6 25DB             (       ddos2f.asm):05720                 BCS     LDB61                   ; yep keep going
                      (       ddos2f.asm):05721         
DBC8 817B             (       ddos2f.asm):05722                 CMPA    #$7B                    ; max ascii char ?
DBCA 24D7             (       ddos2f.asm):05723                 BCC     LDB61                   ; yep keep going
                      (       ddos2f.asm):05724         
DBCC 3268             (       ddos2f.asm):05725                 LEAS    8,S                     ; drop stack frame
DBCE 0F85             (       ddos2f.asm):05726                 CLR     <CasLastSine
DBD0 7EB5D3           (       ddos2f.asm):05727                 JMP     >BasInBuffFromX         
                      (       ddos2f.asm):05728         
DBD3 4F               (       ddos2f.asm):05729         DoBeep  CLRA                            ; A=0   
DBD4 8E0008           (       ddos2f.asm):05730                 LDX     #$0008                  ; Repeat 8 times
DBD7 BDBE12           (       ddos2f.asm):05731         LDB95   JSR     >CasByteOut             ; Output A to cassette
DBDA 301F             (       ddos2f.asm):05732                 LEAX    -1,X                    ; Decrement count
DBDC 26F9             (       ddos2f.asm):05733                 BNE     LDB95                   ; Loop again if all not done
DBDE 39               (       ddos2f.asm):05734         LDB9C   RTS
                      (       ddos2f.asm):05735         
                      (       ddos2f.asm):05736         ;
                      (       ddos2f.asm):05737         ; Beep command dispatch routine
                      (       ddos2f.asm):05738         ;
                      (       ddos2f.asm):05739         ; Syntax :
                      (       ddos2f.asm):05740         ;       BEEP nobeeps
                      (       ddos2f.asm):05741         ;
                      (       ddos2f.asm):05742         
DBDF                  (       ddos2f.asm):05743         CmdBeep   
DBDF 2704             (       ddos2f.asm):05744                 BEQ     CmdBeepDef              ; if no params, default to 1 beep
DBE1 17EADC           (       ddos2f.asm):05745                 LBSR    Get8BitorError          ; get beep count 
                      (       ddos2f.asm):05746         
DBE4 8C               (       ddos2f.asm):05747                 FCB     Skip2
DBE5                  (       ddos2f.asm):05748         CmdBeepDef
DBE5 C601             (       ddos2f.asm):05749                 LDB     #$01                    ; Default beep count
                      (       ddos2f.asm):05750         
DBE7 3404             (       ddos2f.asm):05751                 PSHS    B                       ; save count on stack
DBE9 5F               (       ddos2f.asm):05752                 CLRB
DBEA BDBAED           (       ddos2f.asm):05753                 JSR     SndDTOAOn               ; switch sound to D to A
DBED 8DE4             (       ddos2f.asm):05754         LDBAB   BSR     DoBeep
DBEF BD851B           (       ddos2f.asm):05755                 JSR     >BasPollKeyboard        ; check for key
DBF2 6AE4             (       ddos2f.asm):05756                 DEC     ,S                      ; decrement beep count
DBF4 270A             (       ddos2f.asm):05757                 BEQ     LDBBF                   ; done all : restore and exit
DBF6 108E6000         (       ddos2f.asm):05758                 LDY     #$6000                  ; wait a short while
DBFA 313F             (       ddos2f.asm):05759         LDBB9   LEAY    -1,Y
DBFC 27EF             (       ddos2f.asm):05760                 BEQ     LDBAB                   ; loop back and do next beep
DBFE 20FA             (       ddos2f.asm):05761                 BRA     LDBB9
                      (       ddos2f.asm):05762         
DC00 3584             (       ddos2f.asm):05763         LDBBF   PULS    B,PC
                      (       ddos2f.asm):05764         
                      (       ddos2f.asm):05765         ;
                      (       ddos2f.asm):05766         ; Wait command dispatch routine.
                      (       ddos2f.asm):05767         ;
                      (       ddos2f.asm):05768         ; Syntax :
                      (       ddos2f.asm):05769         ;       WAIT miliseconds
                      (       ddos2f.asm):05770         ;
                      (       ddos2f.asm):05771         
DC02                  (       ddos2f.asm):05772         CmdWait   
DC02 2711             (       ddos2f.asm):05773                 BEQ     WaitExit                ; no params : exit
DC04 BD8E83           (       ddos2f.asm):05774                 JSR     >VarGet16Bit            ; get no of ms to wait
DC07 9E52             (       ddos2f.asm):05775                 LDX     <FPA0+2
DC09 BD851B           (       ddos2f.asm):05776         LDBC8   JSR     >BasPollKeyboard        ; scan keyboard
DC0C C6A0             (       ddos2f.asm):05777                 LDB     #$A0                    ; loop to delay
DC0E 5A               (       ddos2f.asm):05778         LDBCD   DECB
DC0F 26FD             (       ddos2f.asm):05779                 BNE     LDBCD                   ; keep going
                      (       ddos2f.asm):05780                 
DC11 301F             (       ddos2f.asm):05781                 LEAX    -1,X                    ; decrement ms counter
DC13 26F4             (       ddos2f.asm):05782                 BNE     LDBC8                   ; keep going if not zero
DC15                  (       ddos2f.asm):05783         WaitExit
DC15 39               (       ddos2f.asm):05784                 RTS
                      (       ddos2f.asm):05785         
                      (       ddos2f.asm):05786         ;
                      (       ddos2f.asm):05787         ; Swap command dispatch routine.
                      (       ddos2f.asm):05788         ;
                      (       ddos2f.asm):05789         ; Syntax :
                      (       ddos2f.asm):05790         ;       SWAP var1,var2
                      (       ddos2f.asm):05791         ;
                      (       ddos2f.asm):05792         
DC16                  (       ddos2f.asm):05793         CmdSwap   
DC16 BD8A94           (       ddos2f.asm):05794                 JSR     >VarGetVar              ; Get var from basic
DC19 9E39             (       ddos2f.asm):05795                 LDX     <BasVarPtrLast          ; get variable pointer and type
DC1B 9606             (       ddos2f.asm):05796                 LDA     <BasVarType
DC1D 3412             (       ddos2f.asm):05797                 PSHS    A,X                     ; save them
DC1F BD89AA           (       ddos2f.asm):05798                 JSR     >VarCKComma             ; check for comma
DC22 BD8A94           (       ddos2f.asm):05799                 JSR     >VarGetVar              ; get second var
DC25 3522             (       ddos2f.asm):05800                 PULS    A,Y                     ; recover pointer and type of first
DC27 9106             (       ddos2f.asm):05801                 CMPA    <BasVarType             ; var types the same ?
DC29 1026AC55         (       ddos2f.asm):05802                 LBNE    BasTMError              ; nope : error
                      (       ddos2f.asm):05803                 
DC2D DE39             (       ddos2f.asm):05804                 LDU     <BasVarPtrLast          ; get pointer to second var
DC2F 8E0005           (       ddos2f.asm):05805                 LDX     #$0005                  ; 5 bytes for var discriptor
DC32 A6C4             (       ddos2f.asm):05806         LDBF1   LDA     ,U                      ; swap a pair of bytes
DC34 E6A4             (       ddos2f.asm):05807                 LDB     ,Y
DC36 E7C0             (       ddos2f.asm):05808                 STB     ,U+                     ; increment pointers
DC38 A7A0             (       ddos2f.asm):05809                 STA     ,Y+
DC3A 301F             (       ddos2f.asm):05810                 LEAX    -1,X                    ; decrement count
DC3C 26F4             (       ddos2f.asm):05811                 BNE     LDBF1                   ; keep going if more bytes
DC3E 39               (       ddos2f.asm):05812                 RTS
                      (       ddos2f.asm):05813         
                      (       ddos2f.asm):05814         ; Writes to Alpha drive control registers
                      (       ddos2f.asm):05815         ; On entry A contains byte to output
DC3F                  (       ddos2f.asm):05816         AlphaDskCtl   
DC3F 3415             (       ddos2f.asm):05817                 PSHS    X,B,CC                  ; save registers
DC41 C60E             (       ddos2f.asm):05818                 LDB     #AYIOREG                ; select AY-8912 I/O register
DC43 8EFF24           (       ddos2f.asm):05819                 LDX     #PIA2DA                 ; via PIA2
DC46 1A50             (       ddos2f.asm):05820                 ORCC    #(FlagIRQ+FlagFIRQ)     ; disable interrupts
                      (       ddos2f.asm):05821                 
DC48 E702             (       ddos2f.asm):05822                 STB     2,X                     ; select AY-8912 I/O regiter
DC4A E684             (       ddos2f.asm):05823                 LDB     ,X                      ; Latch register to modify 
DC4C CA03             (       ddos2f.asm):05824                 ORB     #$03
DC4E E784             (       ddos2f.asm):05825                 STB     ,X
DC50 C4FC             (       ddos2f.asm):05826                 ANDB    #$FC
DC52 E784             (       ddos2f.asm):05827                 STB     ,X
                      (       ddos2f.asm):05828                 
DC54 A702             (       ddos2f.asm):05829                 STA     2,X                     ; HW mask out to AY-8912
DC56 6C84             (       ddos2f.asm):05830                 INC     ,X                      ; tell AY
DC58 6A84             (       ddos2f.asm):05831                 DEC     ,X
DC5A 3595             (       ddos2f.asm):05832                 PULS    PC,X,B,CC               ; restore and return
                      (       ddos2f.asm):05833         
                      (       ddos2f.asm):05834         ; CmdBoot is here in the DDv1.0 code, not needed for Alpha.
                      (       ddos2f.asm):05835         
                      (       ddos2f.asm):05836         ;
                      (       ddos2f.asm):05837         ;Drive command dispatch routine.
                      (       ddos2f.asm):05838         ;
                      (       ddos2f.asm):05839         ; Syntax :
                      (       ddos2f.asm):05840         ;       DRIVE drivenum  
                      (       ddos2f.asm):05841         ;
                      (       ddos2f.asm):05842         
DC5C                  (       ddos2f.asm):05843         CmdDrive
DC5C 2707             (       ddos2f.asm):05844                 BEQ     LDC46                   ; If no parameters : error
DC5E 17EAAF           (       ddos2f.asm):05845                 LBSR    GetDriveNoInB           ; Get drive number      
DC61 F7060A           (       ddos2f.asm):05846                 STB     DosDefDriveNo           ; set it
DC64 39               (       ddos2f.asm):05847                 RTS
                      (       ddos2f.asm):05848         
                      (       ddos2f.asm):05849         ;       JMP     <BasChrGet              ; back to interpreter loop
                      (       ddos2f.asm):05850         
DC65 7E89B4           (       ddos2f.asm):05851         LDC46   JMP     >BasSNError
                      (       ddos2f.asm):05852         
                      (       ddos2f.asm):05853         ;
                      (       ddos2f.asm):05854         ; Error command dispatch routine.
                      (       ddos2f.asm):05855         ;
                      (       ddos2f.asm):05856         ; Syntax :
                      (       ddos2f.asm):05857         ;       ERROR GOTO lineno
                      (       ddos2f.asm):05858         ;
                      (       ddos2f.asm):05859         
                      (       ddos2f.asm):05860                 ifdef   Dragon
     0081             (       ddos2f.asm):05861         TokGO   equ     DTokGO
     00BC             (       ddos2f.asm):05862         TokTO   equ     DTokTO
                      (       ddos2f.asm):05863                 else
DC68                  (       ddos2f.asm):05864         TokGO   equ     CTokGO
DC68                  (       ddos2f.asm):05865         TokTO   equ     CTokTO
                      (       ddos2f.asm):05866                 endc
                      (       ddos2f.asm):05867         
DC68                  (       ddos2f.asm):05868         CmdError   
DC68 8181             (       ddos2f.asm):05869                 CMPA    #TokGO                  ; Check next token is GO
DC6A 26F9             (       ddos2f.asm):05870                 BNE     LDC46                   ; Error if not
                      (       ddos2f.asm):05871                 
DC6C 9D9F             (       ddos2f.asm):05872                 JSR     <BasChrGet              ; get next char from basic
                      (       ddos2f.asm):05873                 
DC6E 81BC             (       ddos2f.asm):05874                 CMPA    #TokTO                  ; check next token is TO
DC70 26F3             (       ddos2f.asm):05875                 BNE     LDC46                   ; Error if not TO
                      (       ddos2f.asm):05876                 
DC72 9D9F             (       ddos2f.asm):05877                 JSR     <BasChrGet              ; skip to token
DC74 BD869A           (       ddos2f.asm):05878                 JSR     >BasGetLineNo           ; get line number for error handler
DC77 9E2B             (       ddos2f.asm):05879                 LDX     <BasTempLine            
DC79 8CF9FF           (       ddos2f.asm):05880                 CMPX    #BasMaxLineNo           ; if bigger than max line no : FCer
DC7C 1022AF0D         (       ddos2f.asm):05881                 LBHI    BasFCError              
                      (       ddos2f.asm):05882                 
DC80 BF0615           (       ddos2f.asm):05883                 STX     DosErrDestLine          ; save in error handler line 
DC83 2706             (       ddos2f.asm):05884                 BEQ     LDC6C                   ; if Zero : clear error handler flag
DC85 86FF             (       ddos2f.asm):05885                 LDA     #ErrGotoEnabled         ; flag goto enabled
DC87 B70614           (       ddos2f.asm):05886                 STA     DosErrGotoFlag
DC8A 39               (       ddos2f.asm):05887                 RTS
                      (       ddos2f.asm):05888         
DC8B 7F0614           (       ddos2f.asm):05889         LDC6C   CLR     DosErrGotoFlag          ; Turn off error goto
DC8E 39               (       ddos2f.asm):05890                 RTS
                      (       ddos2f.asm):05891                 
                      (       ddos2f.asm):05892         ;
                      (       ddos2f.asm):05893         ; Gets address of a string  supplied on command line into X
                      (       ddos2f.asm):05894         ;
                      (       ddos2f.asm):05895         
DC8F                  (       ddos2f.asm):05896         DosGetStr   
DC8F BD89AA           (       ddos2f.asm):05897                 JSR     >VarCKComma             ; Check for a comma
DC92 BD8A94           (       ddos2f.asm):05898                 JSR     >VarGetVar              ; get next variable
DC95 7E8877           (       ddos2f.asm):05899                 JMP     >VarGetExpr             ; and evaluate it
                      (       ddos2f.asm):05900                 
                      (       ddos2f.asm):05901         ;
                      (       ddos2f.asm):05902         ;Sread command dispatch routine.
                      (       ddos2f.asm):05903         ;
                      (       ddos2f.asm):05904         ; Syntax :
                      (       ddos2f.asm):05905         ;       SREAD driveno,trackno,secno,part1$,part2$
                      (       ddos2f.asm):05906         ;
                      (       ddos2f.asm):05907         
DC98                  (       ddos2f.asm):05908         CmdSread   
DC98 17009C           (       ddos2f.asm):05909                 LBSR    GetSreadWriteParams     ; Get drive,track,secno
DC9B 8DF2             (       ddos2f.asm):05910                 BSR     DosGetStr               ; Get address of first 128 bytes to read
DC9D 3410             (       ddos2f.asm):05911                 PSHS    X                       ; save on stack
DC9F 8DEE             (       ddos2f.asm):05912                 BSR     DosGetStr               ; Get address of second 128 bytes to read
DCA1 3410             (       ddos2f.asm):05913                 PSHS    X
                      (       ddos2f.asm):05914                 
DCA3 C6FF             (       ddos2f.asm):05915                 LDB     #DosFlagTrue
DCA5 D7F6             (       ddos2f.asm):05916                 STB     <DosIOInProgress        ; Flag Dos IO in progress
DCA7 17F64D           (       ddos2f.asm):05917                 LBSR    FindFreeDiskBuffer      ; Find a buffer to read sector into
DCAA 2624             (       ddos2f.asm):05918                 BNE     LDCB1                   ; Error : exit
                      (       ddos2f.asm):05919                 
DCAC 6F02             (       ddos2f.asm):05920                 CLR     BuffFlag,X              ; Clear buffer flag
DCAE AE05             (       ddos2f.asm):05921                 LDX     BuffAddr,X              ; Get buffer address
DCB0 9FEE             (       ddos2f.asm):05922                 STX     <DiskBuffPtr            ; Save as pointer to do read
DCB2 17E44F           (       ddos2f.asm):05923                 LBSR    DosDoReadSec            ; Read the sector
                      (       ddos2f.asm):05924                 
DCB5 F70603           (       ddos2f.asm):05925                 STB     DosErrorCode            ; Save error code in temp storage
DCB8 DEEE             (       ddos2f.asm):05926                 LDU     <DiskBuffPtr            ; Get pointer to read data
DCBA 33C90080         (       ddos2f.asm):05927                 LEAU    $0080,U                 ; Point to second half of sector
DCBE 3510             (       ddos2f.asm):05928                 PULS    X                       ; Get address of second string
DCC0 8D11             (       ddos2f.asm):05929                 BSR     LDCB4                   ; Copy bytes to string
                      (       ddos2f.asm):05930                 
DCC2 DEEE             (       ddos2f.asm):05931                 LDU     <DiskBuffPtr            ; Point at begining of disk buffer
DCC4 3510             (       ddos2f.asm):05932                 PULS    X                       ; Get address of first string
DCC6 8D0B             (       ddos2f.asm):05933                 BSR     LDCB4                   ; Copy bytes to string
                      (       ddos2f.asm):05934                 
DCC8 0FF6             (       ddos2f.asm):05935                 CLR     <DosIOInProgress        ; Flag Dos IO not in progress
DCCA F60603           (       ddos2f.asm):05936                 LDB     DosErrorCode            ; Retrieve error code from read
DCCD 2601             (       ddos2f.asm):05937                 BNE     LDCB1                   ; Error : go to error handler
DCCF 39               (       ddos2f.asm):05938                 RTS                             ; return to caller
                      (       ddos2f.asm):05939         
DCD0 7EC71F           (       ddos2f.asm):05940         LDCB1   JMP     >DosHookSysError        ; Jump to error hook
                      (       ddos2f.asm):05941         
DCD3 3450             (       ddos2f.asm):05942         LDCB4   PSHS    X,U                     ; save regs             
DCD5 C680             (       ddos2f.asm):05943                 LDB     #$80                    ; Make room for 128 bytes
DCD7 BD8C52           (       ddos2f.asm):05944                 JSR     >BasResStr              ; resize the string
DCDA 3384             (       ddos2f.asm):05945                 LEAU    ,X
DCDC 3510             (       ddos2f.asm):05946                 PULS    X
DCDE E784             (       ddos2f.asm):05947                 STB     ,X
DCE0 EF02             (       ddos2f.asm):05948                 STU     2,X
DCE2 3510             (       ddos2f.asm):05949                 PULS    X
DCE4 7EB7CC           (       ddos2f.asm):05950                 JMP     >UtilCopyBXtoU          ; copy the bytes, return to caller
                      (       ddos2f.asm):05951         
                      (       ddos2f.asm):05952         ;
                      (       ddos2f.asm):05953         ; Swrite command dispatch routine.
                      (       ddos2f.asm):05954         ;
                      (       ddos2f.asm):05955         ; Syntax :
                      (       ddos2f.asm):05956         ;       SWRITE driveno,side,sector,part1$,part2$
                      (       ddos2f.asm):05957         ;
                      (       ddos2f.asm):05958         
DCE7                  (       ddos2f.asm):05959         CmdSwrite   
DCE7 8D4E             (       ddos2f.asm):05960                 BSR     GetSreadWriteParams     ; get parameters
DCE9 8D46             (       ddos2f.asm):05961                 BSR     LDD14                   ; get first half of sector
DCEB BD8877           (       ddos2f.asm):05962                 JSR     >VarGetExpr
DCEE 9E52             (       ddos2f.asm):05963                 LDX     <FPA0+2         ; get address of string
DCF0 3410             (       ddos2f.asm):05964                 PSHS    X
DCF2 8D3D             (       ddos2f.asm):05965                 BSR     LDD14                   ; get second half of sector
DCF4 BD8D9A           (       ddos2f.asm):05966                 JSR     >BasGetStrLenAddr       ; get length & addr
DCF7 3414             (       ddos2f.asm):05967                 PSHS    B,X
                      (       ddos2f.asm):05968                 
DCF9 C6FF             (       ddos2f.asm):05969                 LDB     #IOInProgress           ; flag that IO is in progress
DCFB D7F6             (       ddos2f.asm):05970                 STB     <DosIOInProgress
DCFD 17F5F7           (       ddos2f.asm):05971                 LBSR    FindFreeDiskBuffer      ; Go find a disk buffer to use
DD00 26CE             (       ddos2f.asm):05972                 BNE     LDCB1                   ; error : exit
                      (       ddos2f.asm):05973                 
DD02 6F02             (       ddos2f.asm):05974                 CLR     BuffFlag,X              ; make buffer free
DD04 AE05             (       ddos2f.asm):05975                 LDX     BuffAddr,X              ; get buffer address
DD06 9FEE             (       ddos2f.asm):05976                 STX     <DiskBuffPtr            ; use this for disk io
DD08 5F               (       ddos2f.asm):05977                 CLRB
DD09 6F80             (       ddos2f.asm):05978         LDCEA   CLR     ,X+                     ; Clear buffer
DD0B 5A               (       ddos2f.asm):05979                 DECB
DD0C 26FB             (       ddos2f.asm):05980                 BNE     LDCEA
                      (       ddos2f.asm):05981                 
DD0E 3514             (       ddos2f.asm):05982                 PULS    B,X                     ; get saved string pointers for second half of sec
DD10 DEEE             (       ddos2f.asm):05983                 LDU     <DiskBuffPtr            ; point to disk buffer
DD12 33C90080         (       ddos2f.asm):05984                 LEAU    $0080,U                 ; start halfway through
DD16 5D               (       ddos2f.asm):05985                 TSTB                            ; any bytes to transfer ?
DD17 2703             (       ddos2f.asm):05986                 BEQ     LDCFD                   ; nope skip on
DD19 BDB7CC           (       ddos2f.asm):05987                 JSR     UtilCopyBXtoU           ; copy bytes
                      (       ddos2f.asm):05988         
DD1C 3510             (       ddos2f.asm):05989         LDCFD   PULS    X                       ; recover pointer to fist half of sector
DD1E BD8D9F           (       ddos2f.asm):05990                 JSR     >VarDelVar              ; delete var
DD21 DEEE             (       ddos2f.asm):05991                 LDU     <DiskBuffPtr            ; recover disk buffer ptr
DD23 5D               (       ddos2f.asm):05992                 TSTB                            ; any bytes to transfer ?
DD24 2703             (       ddos2f.asm):05993                 BEQ     LDD0A                   ; nope skip
                      (       ddos2f.asm):05994                 
DD26 BDB7CC           (       ddos2f.asm):05995                 JSR     >UtilCopyBXtoU          ; copy first half of sector
                      (       ddos2f.asm):05996                 
DD29 17E3D5           (       ddos2f.asm):05997         LDD0A   LBSR    DosDoWriteSecV          ; go write it
DD2C 25A2             (       ddos2f.asm):05998                 BLO     LDCB1                   ; error : exit
DD2E 0FF6             (       ddos2f.asm):05999                 CLR     <DosIOInProgress        ; flag no io in progresss       
DD30 39               (       ddos2f.asm):06000                 RTS
                      (       ddos2f.asm):06001         
DD31 BD89AA           (       ddos2f.asm):06002         LDD14   JSR     VarCKComma              ; check for comma
DD34 7E8887           (       ddos2f.asm):06003                 JMP     >VarGetStr              ; get string
                      (       ddos2f.asm):06004         
DD37                  (       ddos2f.asm):06005         GetSreadWriteParams   
DD37 2603             (       ddos2f.asm):06006                 BNE     LDD1F                   ; params, read them
DD39 7E89B4           (       ddos2f.asm):06007                 JMP     >BasSNError             ; none : SN Error
                      (       ddos2f.asm):06008         
                      (       ddos2f.asm):06009         ;
                      (       ddos2f.asm):06010         ; Get params for Sread/Swrite
                      (       ddos2f.asm):06011         ;
                      (       ddos2f.asm):06012         
DD3C 17E9D1           (       ddos2f.asm):06013         LDD1F   LBSR    GetDriveNoInB           ; Drive number
DD3F D7EB             (       ddos2f.asm):06014                 STB     <DosDriveNo
DD41 BD8E7E           (       ddos2f.asm):06015                 JSR     >VarGetComma8           ; Track number
DD44 C14F             (       ddos2f.asm):06016                 CMPB    #MaxTrack               ; greater than track 80 ?
DD46 2208             (       ddos2f.asm):06017                 BHI     LDD33                   ; Yes : error
                      (       ddos2f.asm):06018                 
DD48 D7EC             (       ddos2f.asm):06019                 STB     <DskTrackNo             ; Save track number
DD4A BD8E7E           (       ddos2f.asm):06020                 JSR     >VarGetComma8           ; Get sector number
DD4D D7ED             (       ddos2f.asm):06021                 STB     <DskSectorNo            ; save it
DD4F 39               (       ddos2f.asm):06022         LDD32   RTS
                      (       ddos2f.asm):06023         
DD50 7E8B8D           (       ddos2f.asm):06024         LDD33   JMP     >BasFCError             ; Error!
                      (       ddos2f.asm):06025                 
                      (       ddos2f.asm):06026         ;
                      (       ddos2f.asm):06027         ; Verify command dispatch routine.
                      (       ddos2f.asm):06028         ;
                      (       ddos2f.asm):06029         ; Syntax :
                      (       ddos2f.asm):06030         ;       VERIFY ON
                      (       ddos2f.asm):06031         ;       VERIFY OFF
                      (       ddos2f.asm):06032         ;
                      (       ddos2f.asm):06033         
DD53                  (       ddos2f.asm):06034         CmdVerify   
DD53 270E             (       ddos2f.asm):06035                 BEQ     LDD46                   ; end of command : error
                      (       ddos2f.asm):06036         
                      (       ddos2f.asm):06037                 ifndef  Tandy
DD55 81C2             (       ddos2f.asm):06038                 CMPA    #DTokOFF                ; is next token 'OFF'
                      (       ddos2f.asm):06039                 else
                      (       ddos2f.asm):06040                 CMPA    #CTokOFF                ; is next token 'OFF'
                      (       ddos2f.asm):06041                 endc
                      (       ddos2f.asm):06042         
DD57 2603             (       ddos2f.asm):06043                 BNE     LDD3F                   ; no : check for 'ON'
DD59 5F               (       ddos2f.asm):06044                 CLRB                            ; set verify off
DD5A 2009             (       ddos2f.asm):06045                 BRA     LDD48
                      (       ddos2f.asm):06046         
DD5C 8188             (       ddos2f.asm):06047         LDD3F   CMPA    #DTokON                 ; is next token 'ON' ?
DD5E 2703             (       ddos2f.asm):06048                 BEQ     LDD46                   ; yes : skip
DD60 7E89B4           (       ddos2f.asm):06049                 JMP     >BasSNError             ; return error
                      (       ddos2f.asm):06050         
DD63 C6FF             (       ddos2f.asm):06051         LDD46   LDB     #$FF                    ; set verify flag
DD65 F70608           (       ddos2f.asm):06052         LDD48   STB     DosVerifyFlag
DD68 0E9F             (       ddos2f.asm):06053                 JMP     <BasChrGet              ; go get char from basic
                      (       ddos2f.asm):06054                 
DD6A                  (       ddos2f.asm):06055         DosHookEOF   
DD6A 0D06             (       ddos2f.asm):06056                 TST     <BasVarType             ; check var type
DD6C 27E1             (       ddos2f.asm):06057                 BEQ     LDD32                   ; if numeric exit
                      (       ddos2f.asm):06058                 
DD6E 0F06             (       ddos2f.asm):06059                 CLR     <BasVarType             ; set var type numeric !
DD70 3262             (       ddos2f.asm):06060                 LEAS    2,S                     ; drop return addresss
DD72 108EDFAA         (       ddos2f.asm):06061                 LDY     #DosExtDat
DD76 17F9BA           (       ddos2f.asm):06062                 LBSR    DosOpenFileExtY         ; validate and open file
DD79 2619             (       ddos2f.asm):06063                 BNE     JMPSysErrHook           ; Error : exit
                      (       ddos2f.asm):06064                 
DD7B 17F17F           (       ddos2f.asm):06065                 LBSR    DOSGetFLen              ; get file length
DD7E 2614             (       ddos2f.asm):06066                 BNE     JMPSysErrHook           ; Error : exit
                      (       ddos2f.asm):06067                 
DD80 17F1AD           (       ddos2f.asm):06068                 LBSR    DosFCBNoToAddr          ; get address of FCB
DD83 11A30C           (       ddos2f.asm):06069                 CMPU    FCBFilePointer,X        ; check to see if file pointer is same as length, so EOF
DD86 2204             (       ddos2f.asm):06070                 BHI     LDD6F                   ; nope
DD88 A10E             (       ddos2f.asm):06071                 CMPA    FCBFilePointer+2,X      
DD8A 2302             (       ddos2f.asm):06072                 BLS     LDD71                   
                      (       ddos2f.asm):06073                 
DD8C 4F               (       ddos2f.asm):06074         LDD6F   CLRA                            ; return false
DD8D 8C               (       ddos2f.asm):06075                 FCB     Skip2
DD8E 8601             (       ddos2f.asm):06076         LDD71   LDA     #$01                    ; return true
DD90 DE8A             (       ddos2f.asm):06077                 LDU     <DBZero
DD92 201B             (       ddos2f.asm):06078                 BRA     ReturnFP
                      (       ddos2f.asm):06079         
DD94                  (       ddos2f.asm):06080         JMPSysErrHook   
DD94 7EC71F           (       ddos2f.asm):06081                 JMP     >DosHookSysError        ; Deal with errors
                      (       ddos2f.asm):06082         ;
                      (       ddos2f.asm):06083         ; LOC "filename" get file pointer
                      (       ddos2f.asm):06084         ; 
DD97                  (       ddos2f.asm):06085         FuncLoc
DD97 17F97F           (       ddos2f.asm):06086                 LBSR    DosValidateAndOpenDAT   ; Validate and open file
DD9A 26F8             (       ddos2f.asm):06087                 BNE     JMPSysErrHook           ; error : exit
                      (       ddos2f.asm):06088                 
DD9C 17F191           (       ddos2f.asm):06089                 LBSR    DosFCBNoToAddr          ; get address of current FCB
DD9F EE0C             (       ddos2f.asm):06090                 LDU     FCBFilePointer,X        ; get filepointer from FCB
DDA1 A60E             (       ddos2f.asm):06091                 LDA     FCBFilePointer+2,X
DDA3 200A             (       ddos2f.asm):06092                 BRA     ReturnFP                ; return as float in fpa0
                      (       ddos2f.asm):06093                         
                      (       ddos2f.asm):06094         ;
                      (       ddos2f.asm):06095         ; Function LOF "filename" get length of file.
                      (       ddos2f.asm):06096         ; bug: file is left open.
                      (       ddos2f.asm):06097         ; 
DDA5                  (       ddos2f.asm):06098         FuncLof 
DDA5 17F971           (       ddos2f.asm):06099                 LBSR    DosValidateAndOpenDAT   ; Validate and open file
DDA8 26EA             (       ddos2f.asm):06100                 BNE     JMPSysErrHook                   ; error : exit
                      (       ddos2f.asm):06101                 
DDAA 17F150           (       ddos2f.asm):06102                 LBSR    DOSGetFLen              ; get file length
DDAD 26E5             (       ddos2f.asm):06103                 BNE     JMPSysErrHook                   ; error : exit
                      (       ddos2f.asm):06104         
DDAF                  (       ddos2f.asm):06105         ReturnFP   
DDAF 0F06             (       ddos2f.asm):06106                 CLR     <BasVarType             ; numeric var type
DDB1 9753             (       ddos2f.asm):06107                 STA     <FPA0+3                 ; setup as fp var
                      (       ddos2f.asm):06108         
                      (       ddos2f.asm):06109                 ifdef   PGSFix
DDB3                  (       ddos2f.asm):06110         LDD95   CLRB
                      (       ddos2f.asm):06111                 NOP
                      (       ddos2f.asm):06112                 CLR     <FPA0
                      (       ddos2f.asm):06113                 STD     <FPA0+3
                      (       ddos2f.asm):06114                 LDA     #$A0                    ; Exponent
                      (       ddos2f.asm):06115                 STD     <FP0EXP
                      (       ddos2f.asm):06116                 else
DDB3 DF51             (       ddos2f.asm):06117                 STU     <FPA0+1
DDB5 0F50             (       ddos2f.asm):06118                 CLR     <FPA0
DDB7 0F63             (       ddos2f.asm):06119                 CLR     <FPSByte
DDB9 86A0             (       ddos2f.asm):06120                 LDA     #$A0                    ; Exponent
DDBB 974F             (       ddos2f.asm):06121                 STA     <FP0EXP
                      (       ddos2f.asm):06122                 endc
                      (       ddos2f.asm):06123                 
DDBD 7E9165           (       ddos2f.asm):06124                 JMP     >VarNormFPA0            ; normalize FPA0
                      (       ddos2f.asm):06125                 
DDC0                  (       ddos2f.asm):06126         FuncFree   
DDC0 9DA5             (       ddos2f.asm):06127                 JSR     <BasChrGetCurr          ; get current bas char
DDC2 2705             (       ddos2f.asm):06128                 BEQ     LDDAC                   ; none, use default drive no
DDC4 17E949           (       ddos2f.asm):06129                 LBSR    GetDriveNoInB           ; else get drive from command line
DDC7 2003             (       ddos2f.asm):06130                 BRA     LDDAF                   ; skip on
                      (       ddos2f.asm):06131         
DDC9 F6060A           (       ddos2f.asm):06132         LDDAC   LDB     DosDefDriveNo           ; get default drive
DDCC D7EB             (       ddos2f.asm):06133         LDDAF   STB     <DosDriveNo             ; set it as current
DDCE 17F3FF           (       ddos2f.asm):06134                 LBSR    DOSGetFree              ; go get free space
DDD1 26C1             (       ddos2f.asm):06135                 BNE     JMPSysErrHook           ; error : exit
DDD3 1F13             (       ddos2f.asm):06136                 TFR     X,U                     
DDD5 4F               (       ddos2f.asm):06137                 CLRA
DDD6 20D7             (       ddos2f.asm):06138                 BRA     ReturnFP                ; return as float in fpa0
                      (       ddos2f.asm):06139         
DDD8                  (       ddos2f.asm):06140         FuncErl   
DDD8 FC0617           (       ddos2f.asm):06141                 LDD     DosErrLineNo            ; get last error line
DDDB                  (       ddos2f.asm):06142         FuncRetVal   
DDDB 7E8C37           (       ddos2f.asm):06143                 JMP     >VarAssign16Bit2        ; return value to basic
                      (       ddos2f.asm):06144         
DDDE                  (       ddos2f.asm):06145         FuncErr   
DDDE 4F               (       ddos2f.asm):06146                 CLRA                            ; msb=0
DDDF F60619           (       ddos2f.asm):06147                 LDB     DosErrLast              ; get last error no
DDE2 20F7             (       ddos2f.asm):06148                 BRA     FuncRetVal              ; return it to basic
                      (       ddos2f.asm):06149         
DDE4                  (       ddos2f.asm):06150         FuncHimem   
DDE4 DC27             (       ddos2f.asm):06151                 LDD     <AddrFWareRamTop        ; get hardware ramtop
DDE6 20F3             (       ddos2f.asm):06152                 BRA     FuncRetVal              ; return it to basic
                      (       ddos2f.asm):06153         
DDE8                  (       ddos2f.asm):06154         FuncFres   
DDE8 17AEEC           (       ddos2f.asm):06155                 LBSR    VarGarbageCollect       ; collect garbage...defrag string space !
DDEB DC23             (       ddos2f.asm):06156                 LDD     <BasVarStrTop           ; work out size of string space
DDED 9321             (       ddos2f.asm):06157                 SUBD    <BasVarStringBase
DDEF 20EA             (       ddos2f.asm):06158                 BRA     FuncRetVal              ; return it to basic
                      (       ddos2f.asm):06159         
                      (       ddos2f.asm):06160         ;
                      (       ddos2f.asm):06161         ; The actual core disk IO routine, accepts a function code $00..$07
                      (       ddos2f.asm):06162         ; these are dispatched through this table
                      (       ddos2f.asm):06163         ;
                      (       ddos2f.asm):06164         
DDF1                  (       ddos2f.asm):06165         DosFunctionTable  
DDF1 C2CC             (       ddos2f.asm):06166                 FDB     DosFunctionRestore      ; Restore to track 0
DDF3 C2D2             (       ddos2f.asm):06167                 FDB     DosFunctionSeek         ; Seek to a track
DDF5 C2FE             (       ddos2f.asm):06168                 FDB     DosFunctionReadSec      ; Read a sector
DDF7 C369             (       ddos2f.asm):06169                 FDB     DosFunctionWriteSec     ; Write a sector
DDF9 C366             (       ddos2f.asm):06170                 FDB     DosFunctionWriteSec2
DDFB C38C             (       ddos2f.asm):06171                 FDB     DosFunctionWriteTrack   ; Write (format) track
DDFD C2FB             (       ddos2f.asm):06172                 FDB     DosFunctionReadAddr     ; Read address mark
DDFF C326             (       ddos2f.asm):06173                 FDB     DosFunctionReadSec2     ; Read first two bytes of a sector
                      (       ddos2f.asm):06174         
                      (       ddos2f.asm):06175         ;
                      (       ddos2f.asm):06176         ; Data table for Format ?
                      (       ddos2f.asm):06177         ;
                      (       ddos2f.asm):06178                 
DE01                  (       ddos2f.asm):06179         SectorIDTable   
DE01 010A             (       ddos2f.asm):06180                 FCB     $01,$0A                 ; Sector layout table for format ?
DE03 020B             (       ddos2f.asm):06181                 FCB     $02,$0B
DE05 030C             (       ddos2f.asm):06182                 FCB     $03,$0C
DE07 040D             (       ddos2f.asm):06183                 FCB     $04,$0D
DE09 050E             (       ddos2f.asm):06184                 FCB     $05,$0E
DE0B 060F             (       ddos2f.asm):06185                 FCB     $06,$0F
DE0D 0710             (       ddos2f.asm):06186                 FCB     $07,$10
DE0F 0811             (       ddos2f.asm):06187                 FCB     $08,$11
DE11 0912             (       ddos2f.asm):06188                 FCB     $09,$12
DE13 00               (       ddos2f.asm):06189                 FCB     $00
                      (       ddos2f.asm):06190                 
                      (       ddos2f.asm):06191         ; Track header
DE14                  (       ddos2f.asm):06192         TrackHeaderTable        
DE14 354E             (       ddos2f.asm):06193                 FCB     $35,$4E                 ; 54 bytes of $4E Gap 0
DE16 4E               (       ddos2f.asm):06194                 FCB     $4E                     ; terminator $4E
DE17 0800             (       ddos2f.asm):06195                 FCB     $08,$00                 ; 8 bytes of $00 Preamble
DE19 00               (       ddos2f.asm):06196                 FCB     $00                     ; terminator $00        
DE1A 03F6             (       ddos2f.asm):06197                 FCB     $03,$F6                 ; 3 bytes of $F6 Index maek IDAM
DE1C FC               (       ddos2f.asm):06198                 FCB     $FC                     ; terminator $FC
DE1D 1F4E             (       ddos2f.asm):06199                 FCB     $1F,$4E                 ; 31 bytes of $4E Gap 1
DE1F 4E               (       ddos2f.asm):06200                 FCB     $4E                     ; terminator $4E
                      (       ddos2f.asm):06201         
     000C             (       ddos2f.asm):06202         TrackHeaderSize EQU     *-TrackHeaderTable      ; size of track header table
                      (       ddos2f.asm):06203         
DE20                  (       ddos2f.asm):06204         SectorIDLayout  
DE20 0700             (       ddos2f.asm):06205                 FCB     $07,$00                 ; 7 bytes of $00, Sector ID gap
DE22 00               (       ddos2f.asm):06206                 FCB     $00                     ; terminator $00
DE23 03F5             (       ddos2f.asm):06207                 FCB     $03,$F5                 ; 3 bytes of $F5, ID mark IDAM
DE25 FE               (       ddos2f.asm):06208                 FCB     $FE                     ; terminator $FE
                      (       ddos2f.asm):06209                 
     0006             (       ddos2f.asm):06210         SectorIDP1Len   equ     *-SectorIDLayout        ; size of first part of sector ID
                      (       ddos2f.asm):06211         
                      (       ddos2f.asm):06212         
DE26                  (       ddos2f.asm):06213         SectorIDLayout2
DE26 01F7             (       ddos2f.asm):06214                 FCB     $01,$F7                 ; 1 byte of $F7, generates CRC bytes
DE28 4E               (       ddos2f.asm):06215                 FCB     $4E                     ; terminator $4E        
DE29 144E             (       ddos2f.asm):06216                 FCB     $14,$4E                 ; 20 bytes of $4E Gap 2
DE2B 4E               (       ddos2f.asm):06217                 FCB     $4E                     ; terminator $4E
                      (       ddos2f.asm):06218                 
                      (       ddos2f.asm):06219         ; the sector data starts here   
DE2C 0B00             (       ddos2f.asm):06220                 FCB     $0B,$00                 ; 11 bytes of $00
DE2E 00               (       ddos2f.asm):06221                 FCB     $00                     ; terminator $00
DE2F 03F5             (       ddos2f.asm):06222                 FCB     $03,$F5                 ; 3 bytes of $F5 Data IDAM
DE31 FB               (       ddos2f.asm):06223                 FCB     $FB                     ; terminator $FB
DE32 00E5             (       ddos2f.asm):06224                 FCB     $00,$E5                 ; 256 bytes of $E5 sector data
DE34 F7               (       ddos2f.asm):06225                 FCB     $F7                     ; terminator $F7, generates 2 CRC bytes
DE35 174E             (       ddos2f.asm):06226                 FCB     $17,$4E                 ; 23 bytes of $4E
DE37 4E               (       ddos2f.asm):06227                 FCB     $4E                     ; terminator $4E
     0012             (       ddos2f.asm):06228         SectorIDP2Len   equ     *-SectorIDLayout2
                      (       ddos2f.asm):06229         
                      (       ddos2f.asm):06230         ; this data is used at the end of the scrtor data for this track
DE38                  (       ddos2f.asm):06231         TrackFiller
DE38 004E             (       ddos2f.asm):06232                 FCB     $00,$4E                 ; 256 bytes of $4E
DE3A 4E               (       ddos2f.asm):06233                 FCB     $4E                     ; terminator $4E
                      (       ddos2f.asm):06234         
     0003             (       ddos2f.asm):06235         TrackFillerLen  EQU     *-TrackFiller   ; length of filler bytes        
                      (       ddos2f.asm):06236                 
                      (       ddos2f.asm):06237         ; Replacement secondary interrupt vectors       
DE3B                  (       ddos2f.asm):06238         NewVectorTable   
DE3B 09               (       ddos2f.asm):06239                 FCB     (L2@-L1@)               
DE3C 0109             (       ddos2f.asm):06240                 FDB     SecVecNMI
DE3E 7EC77B           (       ddos2f.asm):06241         L1@     JMP     >NMISrv
DE41 7EC784           (       ddos2f.asm):06242                 JMP     >IRQSrv
DE44 7EC837           (       ddos2f.asm):06243                 JMP     >FIRQSrv
DE47                  (       ddos2f.asm):06244         L2@
                      (       ddos2f.asm):06245         
                      (       ddos2f.asm):06246         ; Dos vars, step rates for drives
                      (       ddos2f.asm):06247         
DE47 04               (       ddos2f.asm):06248                 FCB     (EndStep-BeginStep)     ; No bytes
DE48 069F             (       ddos2f.asm):06249                 FDB     DosD0StepRate           ; address to copy
                      (       ddos2f.asm):06250         
DE4A                  (       ddos2f.asm):06251         BeginStep
DE4A 02               (       ddos2f.asm):06252                 FCB     StepRateDefault
DE4B 02               (       ddos2f.asm):06253                 FCB     StepRateDefault
DE4C 02               (       ddos2f.asm):06254                 FCB     StepRateDefault
DE4D 02               (       ddos2f.asm):06255                 FCB     StepRateDefault
DE4E                  (       ddos2f.asm):06256         EndStep
                      (       ddos2f.asm):06257         
                      (       ddos2f.asm):06258         ; New basic dispatch stub
                      (       ddos2f.asm):06259                 
DE4E 1E               (       ddos2f.asm):06260                 FCB     (EndStub-BeginStub)     ; No bytes
DE4F 012A             (       ddos2f.asm):06261                 FDB     BasStub1                ; Copy to stub 1 ($012A) on Dragons
                      (       ddos2f.asm):06262                 
DE51                  (       ddos2f.asm):06263         BeginStub       
DE51 1A               (       ddos2f.asm):06264                 FCB     DDTokCountC             ; Count of new commands 
DE52 DEF1             (       ddos2f.asm):06265                 FDB     DosCmdNames             ; Pointer to command name table
DE54 C6CD             (       ddos2f.asm):06266                 FDB     DosCmdDispatch          ; Pointer to command dispatch routine
DE56 07               (       ddos2f.asm):06267                 FCB     DDTokCountF             ; Count of new functions
DE57 DED8             (       ddos2f.asm):06268                 FDB     DosFuncNames            ; Pointer to function name table
DE59 C6E8             (       ddos2f.asm):06269                 FDB     DosFuncDispatch         ; Pointer to function dispatch table
                      (       ddos2f.asm):06270         
                      (       ddos2f.asm):06271         ; dummy stub to terminate
                      (       ddos2f.asm):06272         
DE5B 00               (       ddos2f.asm):06273                 FCB     $00
DE5C 0000             (       ddos2f.asm):06274                 FDB     $0000
DE5E 89B4             (       ddos2f.asm):06275                 FDB     BasSNError
DE60 00               (       ddos2f.asm):06276                 FCB     $00
DE61 0000             (       ddos2f.asm):06277                 FDB     $0000
DE63 89B4             (       ddos2f.asm):06278                 FDB     BasSNError
DE65 0000000000       (       ddos2f.asm):06279                 FCB     $00,$00,$00,$00,$00
DE6A 0000000000       (       ddos2f.asm):06280                 FCB     $00,$00,$00,$00,$00             
DE6F                  (       ddos2f.asm):06281         EndStub
DE6F 00               (       ddos2f.asm):06282                 FCB     $00
                      (       ddos2f.asm):06283                 
DE70                  (       ddos2f.asm):06284         CommandDispatchTable
DE70 DB22             (       ddos2f.asm):06285                 FDB    CmdAuto
DE72 C5A1             (       ddos2f.asm):06286                 FDB    CmdBackup
DE74 DBDF             (       ddos2f.asm):06287                 FDB    CmdBeep
DE76 C3C3             (       ddos2f.asm):06288                 FDB    CmdBootdsk
DE78 D64D             (       ddos2f.asm):06289                 FDB    CmdChain
DE7A D3B5             (       ddos2f.asm):06290                 FDB    CmdCopy
DE7C D773             (       ddos2f.asm):06291                 FDB    CmdCreate
DE7E DA82             (       ddos2f.asm):06292                 FDB    CmdDir
DE80 DC5C             (       ddos2f.asm):06293                 FDB    CmdDrive
DE82 C3C9             (       ddos2f.asm):06294                 FDB    CmdDskInit
DE84 D849             (       ddos2f.asm):06295                 FDB    CmdFRead
DE86 D8F0             (       ddos2f.asm):06296                 FDB    CmdFWrite
DE88 DC68             (       ddos2f.asm):06297                 FDB    CmdError
DE8A D7C1             (       ddos2f.asm):06298                 FDB    CmdKill
DE8C D522             (       ddos2f.asm):06299                 FDB    $D522
DE8E D466             (       ddos2f.asm):06300                 FDB    CmdMerge
DE90 D7CE             (       ddos2f.asm):06301                 FDB    CmdProtect
DE92 DC02             (       ddos2f.asm):06302                 FDB    CmdWait
DE94 D7F3             (       ddos2f.asm):06303                 FDB    CmdRename
DE96 D5B6             (       ddos2f.asm):06304                 FDB    CmdSave
DE98 DC98             (       ddos2f.asm):06305                 FDB    CmdSread
DE9A DCE7             (       ddos2f.asm):06306                 FDB    CmdSwrite
DE9C DD53             (       ddos2f.asm):06307                 FDB    CmdVerify
DE9E 89B4             (       ddos2f.asm):06308                 FDB    BasSNError
DEA0 D815             (       ddos2f.asm):06309                 FDB    CmdFLRead
DEA2 DC16             (       ddos2f.asm):06310                 FDB    CmdSwap
                      (       ddos2f.asm):06311         
DEA4                  (       ddos2f.asm):06312         FunctionDipatchTable    
DEA4 DDA5             (       ddos2f.asm):06313                 FDB    FuncLof
DEA6 DDC0             (       ddos2f.asm):06314                 FDB    FuncFree
DEA8 DDD8             (       ddos2f.asm):06315                 FDB    FuncErl
DEAA DDDE             (       ddos2f.asm):06316                 FDB    FuncErr
DEAC DDE4             (       ddos2f.asm):06317                 FDB    FuncHimem
DEAE DD97             (       ddos2f.asm):06318                 FDB    FuncLoc
DEB0 DDE8             (       ddos2f.asm):06319                 FDB    FuncFres
                      (       ddos2f.asm):06320         
DEB2                  (       ddos2f.asm):06321         RamHookTable   
DEB2 D94D             (       ddos2f.asm):06322                 FDB     DosHookOpenDev          ; open dev/file
DEB4 D945             (       ddos2f.asm):06323                 FDB     DosHookCheckIONum       ; check io num
DEB6 C29A             (       ddos2f.asm):06324                 FDB     DosHookRetDevParam      ; return dev parameters
DEB8 D964             (       ddos2f.asm):06325                 FDB     DosHookCharOut          ; char output   
DEBA C29A             (       ddos2f.asm):06326                 FDB     DosHookRetDevParam      ; char input
DEBC C29A             (       ddos2f.asm):06327                 FDB     DosHookRetDevParam      ; check dev open for input
DEBE C29A             (       ddos2f.asm):06328                 FDB     DosHookRetDevParam      ; check dev open for output
DEC0 C29A             (       ddos2f.asm):06329                 FDB     DosHookRetDevParam      ; close all devs and files
DEC2 D749             (       ddos2f.asm):06330                 FDB     DosCloseAllFiles        ; close single dev/file
DEC4 C29A             (       ddos2f.asm):06331                 FDB     DosHookRetDevParam      ; first char of new statement
DEC6 D9AD             (       ddos2f.asm):06332                 FDB     DosHookDiskItem         ; Disk file item scanner
DEC8 C29A             (       ddos2f.asm):06333                 FDB     DosHookRetDevParam      ; poll for break
DECA D76E             (       ddos2f.asm):06334                 FDB     DosHookReadInput        ; read line of input
DECC C29A             (       ddos2f.asm):06335                 FDB     DosHookRetDevParam      ; finish loading ASCII program
DECE DD6A             (       ddos2f.asm):06336                 FDB     DosHookEOF              ; EOF function
DED0 C29A             (       ddos2f.asm):06337                 FDB     DosHookRetDevParam      ; Eval expression
DED2 C29A             (       ddos2f.asm):06338                 FDB     DosHookRetDevParam      ; User error trap
DED4 C71F             (       ddos2f.asm):06339                 FDB     DosHookSysError         ; System error trap
DED6 D50D             (       ddos2f.asm):06340                 FDB     DosHookRun              ; run statement
                      (       ddos2f.asm):06341                 
DED8                  (       ddos2f.asm):06342         DosFuncNames   
DED8 4C4FC6           (       ddos2f.asm):06343                 FCS     /LOF/
DEDB 465245C5         (       ddos2f.asm):06344                 FCS     /FREE/
DEDF 4552CC           (       ddos2f.asm):06345                 FCS     /ERL/
DEE2 4552D2           (       ddos2f.asm):06346                 FCS     /ERR/
DEE5 48494D45CD       (       ddos2f.asm):06347                 FCS     /HIMEM/
DEEA 4C4FC3           (       ddos2f.asm):06348                 FCS     /LOC/
DEED 465245A4         (       ddos2f.asm):06349                 FCS     /FRE$/
                      (       ddos2f.asm):06350                 
                      (       ddos2f.asm):06351         ;
                      (       ddos2f.asm):06352         ; New Command names table
                      (       ddos2f.asm):06353         ;
                      (       ddos2f.asm):06354                 
DEF1                  (       ddos2f.asm):06355         DosCmdNames   
DEF1 415554CF         (       ddos2f.asm):06356                 FCS     /AUTO/
DEF5 4241434B55D0     (       ddos2f.asm):06357                 FCS     /BACKUP/
DEFB 424545D0         (       ddos2f.asm):06358                 FCS     /BEEP/
DEFF 424F4F544453CB   (       ddos2f.asm):06359                 FCS     /BOOTDSK/
DF06 43484149CE       (       ddos2f.asm):06360                 FCS     /CHAIN/
DF0B 434F50D9         (       ddos2f.asm):06361                 FCS     /COPY/
DF0F 4352454154C5     (       ddos2f.asm):06362                 FCS     /CREATE/
DF15 4449D2           (       ddos2f.asm):06363                 FCS     /DIR/
DF18 44524956C5       (       ddos2f.asm):06364                 FCS     /DRIVE/
DF1D 44534B494E49D4   (       ddos2f.asm):06365                 FCS     /DSKINIT/
DF24 46524541C4       (       ddos2f.asm):06366                 FCS     /FREAD/
DF29 4657524954C5     (       ddos2f.asm):06367                 FCS     /FWRITE/
DF2F 4552524FD2       (       ddos2f.asm):06368                 FCS     /ERROR/
DF34 4B494CCC         (       ddos2f.asm):06369                 FCS     /KILL/
DF38 4C4F41C4         (       ddos2f.asm):06370                 FCS     /LOAD/
DF3C 4D455247C5       (       ddos2f.asm):06371                 FCS     /MERGE/
DF41 50524F544543D4   (       ddos2f.asm):06372                 FCS     /PROTECT/
DF48 574149D4         (       ddos2f.asm):06373                 FCS     /WAIT/
DF4C 52454E414DC5     (       ddos2f.asm):06374                 FCS     /RENAME/
DF52 534156C5         (       ddos2f.asm):06375                 FCS     /SAVE/
DF56 53524541C4       (       ddos2f.asm):06376                 FCS     /SREAD/
DF5B 5357524954C5     (       ddos2f.asm):06377                 FCS     /SWRITE/
DF61 5645524946D9     (       ddos2f.asm):06378                 FCS     /VERIFY/
DF67 46524FCD         (       ddos2f.asm):06379                 FCS     /FROM/
DF6B 464C524541C4     (       ddos2f.asm):06380                 FCS     /FLREAD/
DF71 535741D0         (       ddos2f.asm):06381                 FCS     /SWAP/
                      (       ddos2f.asm):06382         
                      (       ddos2f.asm):06383         ;
                      (       ddos2f.asm):06384         ; Some mesagaes
                      (       ddos2f.asm):06385         ;
DF75                  (       ddos2f.asm):06386         MessInsertSource
DF75 494E534552542053 (       ddos2f.asm):06387                 FCC    "INSERT SOURCE"
     4F55524345
DF82 0D00             (       ddos2f.asm):06388                 FCB    $0D,$00
                      (       ddos2f.asm):06389         
DF84                  (       ddos2f.asm):06390         MessInsertDest
DF84 494E534552542044 (       ddos2f.asm):06391                 FCC    "INSERT DESTINATION"
     455354494E415449
     4F4E
DF96 0D00             (       ddos2f.asm):06392                 FCB    $0D,$00
                      (       ddos2f.asm):06393         
DF98                  (       ddos2f.asm):06394         MessPressAnyKey
DF98 505245535320414E (       ddos2f.asm):06395                 FCC    "PRESS ANY KEY"
     59204B4559
DFA5 0D00             (       ddos2f.asm):06396                 FCB    $0D,$00
                      (       ddos2f.asm):06397         
DFA7                  (       ddos2f.asm):06398         DosExtBas   
DFA7 424153           (       ddos2f.asm):06399                 FCC    "BAS"
DFAA                  (       ddos2f.asm):06400         DosExtDat   
DFAA 444154           (       ddos2f.asm):06401                 FCC    "DAT"
DFAD                  (       ddos2f.asm):06402         DosExtBin   
DFAD 42494E           (       ddos2f.asm):06403                 FCC    "BIN"
DFB0                  (       ddos2f.asm):06404         DosExtNone   
DFB0 202020           (       ddos2f.asm):06405                 FCC    "   "
                      (       ddos2f.asm):06406         
DFB3                  (       ddos2f.asm):06407         DosErrorCodeTable
DFB3 4E52             (       ddos2f.asm):06408                 FCC     /NR/                    ; $80 : not ready
DFB5 534B             (       ddos2f.asm):06409                 FCC     /SK/                    ; $82 : seek
DFB7 5750             (       ddos2f.asm):06410                 FCC     /WP/                    ; $84 : write protect
DFB9 5254             (       ddos2f.asm):06411                 FCC     /RT/                    ; $86 : record type
DFBB 5246             (       ddos2f.asm):06412                 FCC     /RF/                    ; $88 : record not found
DFBD 4343             (       ddos2f.asm):06413                 FCC     /CC/                    ; $8A : CRC
DFBF 4C44             (       ddos2f.asm):06414                 FCC     /LD/                    ; $8C : Lost data
DFC1 4254             (       ddos2f.asm):06415                 FCC     /BT/                    ; $8E : boot
DFC3 4956             (       ddos2f.asm):06416                 FCC     /IV/                    ; $90 : invalid volume / directory
DFC5 4644             (       ddos2f.asm):06417                 FCC     /FD/                    ; $92 : Full directory
DFC7 4446             (       ddos2f.asm):06418                 FCC     /DF/                    ; $94 : Disk full
DFC9 4653             (       ddos2f.asm):06419                 FCC     /FS/                    ; $96 : File spec
DFCB 5054             (       ddos2f.asm):06420                 FCC     /PT/                    ; $98 : Protection
DFCD 5045             (       ddos2f.asm):06421                 FCC     /PE/                    ; $9A : (read) Past end 
DFCF 4646             (       ddos2f.asm):06422                 FCC     /FF/                    ; $9C : File not Found 
DFD1 4645             (       ddos2f.asm):06423                 FCC     /FE/                    ; $9E : File exists
DFD3 4E45             (       ddos2f.asm):06424                 FCC     /NE/                    ; $A0 : (file does) Not Exist
DFD5 5446             (       ddos2f.asm):06425                 FCC     /TF/                    ; $A2 : Too many Files open
DFD7 5052             (       ddos2f.asm):06426                 FCC     /PR/                    ; $A4 : Parameter
DFD9 3F3F             (       ddos2f.asm):06427                 FCC     /??/                    ; $A6 : Undefined
                      (       ddos2f.asm):06428         
DFDB                  (       ddos2f.asm):06429         DosSignonMess
DFDB 445241474F4E444F (       ddos2f.asm):06430                 FCC    "DRAGONDOS 2.F"
     5320322E46
                      (       ddos2f.asm):06431         
DFE8 0D00             (       ddos2f.asm):06432                 FCB    $0D,$00
                      (       ddos2f.asm):06433         
DFEA FFFFFFFFFFFFFFFF (       ddos2f.asm):06434                 FCB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
DFF2 FFFFFFFFFFFFFFFF (       ddos2f.asm):06435                 FCB    $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
DFFA FFFFFFFFFFFF     (       ddos2f.asm):06436                 FCB    $FF,$FF,$FF,$FF,$FF,$FF
E000                  (       ddos2f.asm):06437         DosEnd
